e":"aisiri-backend","timestamp":"2025-08-20T15:15:06.283Z"}
info: [JWT认证] 认证成功，耗时: 1ms, userId: 68a21bf0cdab688c24714231, URL: /api/aisiri/dispatch {"service":"aisiri-backend","timestamp":"2025-08-20T15:15:06.284Z"}
[23:15:06.285] info: 智能调度请求 {"url":"/api/aisiri/dispatch","userId":"68a21bf0cdab688c24714231","ip":"::1"}
[23:15:06.285] info: 收到智能调度请求
  {
  "userId": "68a21bf0cdab688c24714231",
  "userInput": "给我安排一下，我明天早上10:00需要开个会",
  "sessionId": "session_1755700955510_v8znzzjx1",
  "deviceInfo": {
    "platform": "web",
    "version": "2.0.0"
  }
}
[23:15:06.285] info: 开始智能调度处理
  {
  "requestId": "dispatch-1755702906285-e6fznv6gn",
  "userInput": "给我安排一下，我明天早上10:00需要开个会",
  "userId": "68a21bf0cdab688c24714231",
  "sessionId": "session_1755700955510_v8znzzjx1",
  "inputLength": 22
}
[23:15:06.285] info: 步骤0: 检测图片输入 {"requestId":"dispatch-1755702906285-e6fznv6gn"}
[23:15:06.285] info: 步骤1: 执行意图识别 {"requestId":"dispatch-1755702906285-e6fznv6gn"}
[23:15:06.285] info: 开始意图识别 {"userInput":"给我安排一下，我明天早上10:00需要开个会","inputLength":22}
[23:15:06.285] info: 发送请求到通义千问模型 {"messagesCount":2,"systemPromptLength":714,"userPromptLength":382}
[23:15:06.286] info: 准备调用通义千问API
  {
  "url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",
  "model": "qwen-plus",
  "messagesCount": 2
}
[23:15:08.269] info: 通义千问API调用成功
  {
  "status": 200,
  "usage": {
    "prompt_tokens": 593,
    "completion_tokens": 103,
    "total_tokens": 696,
    "prompt_tokens_details": {
      "cached_tokens": 0
    }
  },
  "model": "qwen-plus"
}
[23:15:08.269] info: 收到模型响应 {"responseLength":260,"responseTime":"1984ms"}
[23:15:08.269] info: 开始解析模型响应
  {
  "responseContent": "{\n  \"intent\": \"SCHEDULE_PLANNING\",\n  \"confidence\": 0.95,\n  \"reasoning\": \"用户明确请求安排明天早上10:00的会议，涉及时间调度和日程规划。\",\n  \"extracted_info\": {\n    \"keywords\": [\"安排\", \"会议\"],\n    \"entities\": {\n      \"time\": \"明天早上10..."
}
[23:15:08.269] info: 意图识别结果解析成功 {"intent":"SCHEDULE_PLANNING","confidence":0.95,"hasExtractedInfo":true}
[23:15:08.269] info: 意图识别完成 {"intent":"SCHEDULE_PLANNING","confidence":0.95,"processingTime":"1984ms","success":true}
[23:15:08.269] info: 意图识别完成
  {
  "requestId": "dispatch-1755702906285-e6fznv6gn",
  "intent": "SCHEDULE_PLANNING",
  "confidence": 0.95,
  "hasImageContext": false
}
[23:15:08.269] info: 步骤2: 分析多重意图 {"requestId":"dispatch-1755702906285-e6fznv6gn"}
[23:15:08.270] info: Action Router 分析完成
  {
  "userInput": "给我安排一下，我明天早上10:00需要开个会",
  "actionPlan": [
    {
      "intent": "TASK_CREATION",
      "priority": 1
    },
    {
      "intent": "SCHEDULE_PLANNING",
      "priority": 2
    }
  ],
  "totalActions": 2
}
[23:15:08.270] info: 多重意图分析完成
  {
  "requestId": "dispatch-1755702906285-e6fznv6gn",
  "intents": [
    "TASK_CREATION",
    "SCHEDULE_PLANNING"
  ],
  "count": 2
}
[23:15:08.270] info: 步骤3: 执行相应的服务 {"requestId":"dispatch-1755702906285-e6fznv6gn"}
[23:15:08.270] info: 执行优先级 1 的服务 {"intents":["TASK_CREATION"],"count":1}
[23:15:08.270] info: 开始执行任务创建
  {
  "userInput": "给我安排一下，我明天早上10:00需要开个会",
  "timeInfo": {
    "date": "2025-08-21",
    "timeBlock": {
      "timeBlockType": "morning",
      "startTime": "08:00",
      "endTime": "12:00"
    },
    "specificTime": null
  },
  "userId": "68a21bf0cdab688c24714231"
}
[23:15:08.271] info: 开始直接创建任务
  {
  "userInput": "给我安排一下，我明天早上10:00需要开个会",
  "userId": "68a21bf0cdab688c24714231",
  "timeInfo": {
    "date": "2025-08-21",
    "timeBlock": {
      "timeBlockType": "morning",
      "startTime": "08:00",
      "endTime": "12:00"
    },
    "specificTime": null
  }
}
[23:15:08.271] info: 开始意图识别 {"userInput":"给我安排一下，我明天早上10:00需要开个会","inputLength":22}
[23:15:08.271] info: 发送请求到通义千问模型 {"messagesCount":2,"systemPromptLength":714,"userPromptLength":382}
[23:15:08.271] info: 准备调用通义千问API
  {
  "url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",
  "model": "qwen-plus",
  "messagesCount": 2
}
[23:15:11.367] info: 通义千问API调用成功
  {
  "status": 200,
  "usage": {
    "prompt_tokens": 593,
    "completion_tokens": 112,
    "total_tokens": 705,
    "prompt_tokens_details": {
      "cached_tokens": 0
    }
  },
  "model": "qwen-plus"
}
[23:15:11.367] info: 收到模型响应 {"responseLength":275,"responseTime":"3096ms"}
[23:15:11.367] info: 开始解析模型响应
  {
  "responseContent": "{\n  \"intent\": \"SCHEDULE_PLANNING\",\n  \"confidence\": 0.95,\n  \"reasoning\": \"用户明确请求安排日程，并提到了具体时间（明天早上10:00）和事件（开会），属于时间调度的范畴。\",\n  \"extracted_info\": {\n    \"keywords\": [\"安排\", \"开会\"],\n    \"entities\": {\n      ..."
}
[23:15:11.367] info: 意图识别结果解析成功 {"intent":"SCHEDULE_PLANNING","confidence":0.95,"hasExtractedInfo":true}
[23:15:11.367] info: 意图识别完成 {"intent":"SCHEDULE_PLANNING","confidence":0.95,"processingTime":"3096ms","success":true}
[23:15:11.368] info: 意图识别完成（用于信息提取） {"intent":"SCHEDULE_PLANNING","confidence":0.95}
[23:15:11.368] info: 强制设置为任务创建意图 {"intent":"TASK_CREATION","confidence":0.95}
[23:15:11.368] info: 解析到具体时间
  {
  "originalTime": "明天早上10:00",
  "parsedTime": "10:00",
  "timeBlock": {
    "startTime": "10:00",
    "endTime": "11:00",
    "timeBlockType": "morning"
  }
}
[23:15:11.368] info: 提取任务信息完成
  {
  "title": "开会",
  "timeBlock": {
    "startTime": "10:00",
    "endTime": "11:00",
    "timeBlockType": "morning"
  },
  "date": "2025-08-21",
  "timeInfoInput": {
    "date": "2025-08-21",
    "timeBlock": {
      "timeBlockType": "morning",
      "startTime": "08:00",
      "endTime": "12:00"
    },
    "specificTime": null
  }
}
[23:15:11.368] info: 提取任务信息完成
  {
  "taskInfo": {
    "title": "开会",
    "userId": "68a21bf0cdab688c24714231",
    "timeBlock": {
      "startTime": "10:00",
      "endTime": "11:00",
      "timeBlockType": "morning"
    },
    "date": "2025-08-21"
  }
}
[23:15:11.369] info: 开始存储任务到数据库
  {
  "taskInfo": {
    "title": "开会",
    "userId": "68a21bf0cdab688c24714231",
    "timeBlock": {
      "startTime": "10:00",
      "endTime": "11:00",
      "timeBlockType": "morning"
    },
    "date": "2025-08-21"
  }
}
[23:15:11.537] info: 任务存储成功 {"taskId":"68a5e67fc0609c9d312e4968"}
[23:15:11.538] info: 任务直接创建成功 {"taskId":"68a5e67fc0609c9d312e4968","title":"开会","processingTime":"3267ms"}
[23:15:11.538] info: 任务创建完成 {"success":true}
[23:15:11.538] info: 优先级 1 的服务执行完成 {"results":["taskCreation"]}
[23:15:11.538] info: 执行优先级 2 的服务 {"intents":["SCHEDULE_PLANNING"],"count":1}
[23:15:11.538] info: 开始执行时间调度
  {
  "userInput": "给我安排一下，我明天早上10:00需要开个会",
  "targetDate": "2025-08-20",
  "userId": "68a21bf0cdab688c24714231",
  "hasPreviousTaskCreation": true
}
[23:15:11.538] info: 开始任务调度规划
  {
  "userId": "68a21bf0cdab688c24714231",
  "userInput": "给我安排一下，我明天早上10:00需要开个会",
  "targetDate": "2025-08-20",
  "userContext": {
    "emotionalState": "neutral",
    "previousTaskCreation": {
      "success": true,
      "message": "任务创建成功",
      "task": {
        "timeBlock": {
          "startTime": "10:00",
          "endTime": "11:00",
          "timeBlockType": "morning"
        },
        "_id": "68a5e67fc0609c9d312e4968",
        "title": "开会",
        "description": "",
        "priority": "medium",
        "completed": false,
        "date": "2025-08-21",
        "userId": "68a21bf0cdab688c24714231",
        "isScheduled": false,
        "createdAt": "2025-08-20T15:15:11.370Z",
        "updatedAt": "2025-08-20T15:15:11.370Z",
        "__v": 0
      },
      "intentResult": {
        "intent": "TASK_CREATION",
        "confidence": 0.95,
        "reasoning": "用户明确请求安排日程，并提到了具体时间（明天早上10:00）和事件（开会），属于时间调度的范畴。",
        "extracted_info": {
          "keywords": [
            "安排",
            "开会"
          ],
          "entities": {
            "time": "明天早上10:00",
            "location": null,
            "task": "开会"
          }
        },
        "original_input": "给我安排一下，我明天早上10:00需要开个会",
        "timestamp": "2025-08-20T15:15:11.367Z",
        "intent_description": "时间调度（日程安排、时间规划）"
      },
      "processingTime": 3267
    }
  }
}
[23:15:11.574] info: 获取用户现有任务 {"userId":"68a21bf0cdab688c24714231","taskCount":8,"date":"2025-08-20"}