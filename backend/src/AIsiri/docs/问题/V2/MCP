
   "CONVERSATION"
  ],
  "count": 2
}
[03:31:30.015] info: æ­¥éª¤3: æ‰§è¡Œç›¸åº”çš„æœåŠ¡ {"requestId":"dispatch-1755631887922-48f8m50l0"}
[03:31:30.015] info: æ‰§è¡Œä¼˜å…ˆçº§ 1 çš„æœåŠ¡ {"intents":["EXTERNAL_TOOL"],"count":1}
[03:31:30.015] info: å¼€å§‹æ‰§è¡Œå¤–éƒ¨å·¥å…·è°ƒç”¨ {"userInput":"æˆ‘å¾ˆå¼€å¿ƒï¼Œä»Šå¤©å¤©æ°”çœŸå¥½","toolType":"weather","userId":"68a21bf0cdab688c24714231"}
[03:31:30.016] error: å¤–éƒ¨å·¥å…·è°ƒç”¨å¤±è´¥
  {
  "error": "Cannot find module '../../../mcp'\nRequire stack:\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/gaodeMcpClient.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/intelligentDispatchService.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/tests/mcp-integration-test.js",
  "toolType": "weather",
  "userInput": "æˆ‘å¾ˆå¼€å¿ƒï¼Œä»Šå¤©å¤©æ°”çœŸå¥½"
}
[03:31:30.016] info: å¤–éƒ¨å·¥å…·è°ƒç”¨å®Œæˆ {"success":false}
[03:31:30.017] info: ä¼˜å…ˆçº§ 1 çš„æœåŠ¡æ‰§è¡Œå®Œæˆ {"results":["externalTool"]}
[03:31:30.017] info: æ‰§è¡Œä¼˜å…ˆçº§ 3 çš„æœåŠ¡ {"intents":["CONVERSATION"],"count":1}
[03:31:30.017] info: å¼€å§‹æ‰§è¡Œå¯¹è¯å¤„ç†
  {
  "userInput": "æˆ‘å¾ˆå¼€å¿ƒï¼Œä»Šå¤©å¤©æ°”çœŸå¥½",
  "userId": "68a21bf0cdab688c24714231",
  "sessionId": "test-session-emotion",
  "hasPreviousResults": true
}
[03:31:30.017] info: å¼€å§‹å¤„ç†å¯¹è¯ {"userId":"68a21bf0cdab688c24714231","sessionId":"test-session-emotion","messageLength":11}
[03:31:30.017] info: å¼€å§‹æ„å›¾è¯†åˆ« æˆ‘å¾ˆå¼€å¿ƒï¼Œä»Šå¤©å¤©æ°”çœŸå¥½... {"userId":"68a21bf0cdab688c24714231"}
[03:31:30.017] info: å¼€å§‹æ„å›¾è¯†åˆ« {"userInput":"æˆ‘å¾ˆå¼€å¿ƒï¼Œä»Šå¤©å¤©æ°”çœŸå¥½","inputLength":11}
[03:31:30.017] info: å‘é€è¯·æ±‚åˆ°é€šä¹‰åƒé—®æ¨¡å‹ {"messagesCount":2,"systemPromptLength":530,"userPromptLength":581}
[03:31:30.017] info: å‡†å¤‡è°ƒç”¨é€šä¹‰åƒé—®API
  {
  "url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",
  "model": "qwen-plus",
  "messagesCount": 2
}
[03:31:33.380] info: é€šä¹‰åƒé—®APIè°ƒç”¨æˆåŠŸ
  {
  "status": 200,
  "usage": {
    "prompt_tokens": 590,
    "completion_tokens": 104,
    "total_tokens": 694,
    "prompt_tokens_details": {
      "cached_tokens": 0
    }
  },
  "model": "qwen-plus"
}
[03:31:33.380] info: æ”¶åˆ°æ¨¡å‹å“åº” {"responseLength":269,"responseTime":"3363ms"}
[03:31:33.380] info: å¼€å§‹è§£ææ¨¡å‹å“åº”
  {
  "responseContent": "{\n  \"intent\": \"CONVERSATION\",\n  \"confidence\": 0.95,\n  \"reasoning\": \"ç”¨æˆ·è¡¨è¾¾äº†æƒ…ç»ªï¼ˆå¼€å¿ƒï¼‰å¹¶è¯„è®ºäº†å¤©æ°”ï¼Œå±äºæ—¥å¸¸æƒ…æ„Ÿäº¤æµå’Œé—²èŠå†…å®¹ï¼Œæ²¡æœ‰æ¶‰åŠä»»åŠ¡åˆ›å»ºã€æ—¶é—´å®‰æ’æˆ–éœ€è¦è°ƒç”¨å¤–éƒ¨å·¥å…·çš„ä¿¡æ¯è¯·æ±‚ã€‚\",\n  \"extracted_info\": {\n    \"keywords\": [\"å¼€å¿ƒ\", \"å¤©æ°”\"],\n    \"entities\": {..."
}
[03:31:33.381] info: æ„å›¾è¯†åˆ«ç»“æœè§£ææˆåŠŸ {"intent":"CONVERSATION","confidence":0.95,"hasExtractedInfo":true}
[03:31:33.381] info: æ„å›¾è¯†åˆ«å®Œæˆ {"intent":"CONVERSATION","confidence":0.95,"processingTime":"3364ms","success":true}
[03:31:33.384] info: ç”¨æˆ·æ¶ˆæ¯å·²ä¿å­˜ {"messageId":"68a4d115a667cc3fb0bead94","intent":"CONVERSATION","confidence":0.95}
[03:31:33.387] info: æ£€æµ‹åˆ°ç”¨æˆ·æƒ…ç»ª
  {
  "userId": "68a21bf0cdab688c24714231",
  "emotion": "happy",
  "keywords": [
    "å¼€å¿ƒ",
    "å¤©æ°”"
  ],
  "hasWeatherInfo": false
}
[03:31:33.387] info: å¼€å§‹ç”ŸæˆAIå›åº” {"userId":"68a21bf0cdab688c24714231","historyCount":5}
[03:31:33.387] info: è°ƒç”¨é€šä¹‰åƒé—®APIç”Ÿæˆå›åº”
  {
  "model": "qwen-plus",
  "messagesCount": 2,
  "url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions"
}
[03:31:36.959] info: AIå›åº”ç”ŸæˆæˆåŠŸ
  {
  "status": 200,
  "responseTime": "3572ms",
  "usage": {
    "prompt_tokens": 813,
    "completion_tokens": 68,
    "total_tokens": 881,
    "prompt_tokens_details": {
      "cached_tokens": 0
    }
  },
  "model": "qwen-plus"
}
[03:31:36.963] info: å¯¹è¯å¤„ç†å®Œæˆ
  {
  "userId": "68a21bf0cdab688c24714231",
  "sessionId": "test-session-emotion",
  "userMessageId": "68a4d115a667cc3fb0bead94",
  "assistantMessageId": "68a4d118a667cc3fb0bead97",
  "totalTime": "6946ms",
  "emotion": "happy",
  "intent": "CONVERSATION"
}
[03:31:36.964] info: å¯¹è¯å¤„ç†å®Œæˆ {"success":true}
[03:31:36.964] info: ä¼˜å…ˆçº§ 3 çš„æœåŠ¡æ‰§è¡Œå®Œæˆ {"results":["externalTool","conversation"]}
[03:31:36.964] info: æœåŠ¡æ‰§è¡Œå®Œæˆ
  {
  "requestId": "dispatch-1755631887922-48f8m50l0",
  "servicesExecuted": [
    "externalTool",
    "conversation"
  ],
  "successCount": 1
}
[03:31:36.964] info: æ­¥éª¤4: ç”Ÿæˆç»Ÿä¸€å›å¤ {"requestId":"dispatch-1755631887922-48f8m50l0"}
[03:31:36.964] info: å¼€å§‹ç”Ÿæˆç»Ÿä¸€å›å¤
  {
  "userInput": "æˆ‘å¾ˆå¼€å¿ƒï¼Œä»Šå¤©å¤©æ°”çœŸå¥½",
  "intentsCount": 2,
  "executionResultsKeys": [
    "externalTool",
    "conversation"
  ],
  "executionResults": {
    "externalTool": {
      "success": false,
      "type": "weather",
      "message": "å¤–éƒ¨å·¥å…·è°ƒç”¨å¤±è´¥: Cannot find module '../../../mcp'\nRequire stack:\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/gaodeMcpClient.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/intelligentDispatchService.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/tests/mcp-integration-test.js",
      "error": "Cannot find module '../../../mcp'\nRequire stack:\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/gaodeMcpClient.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/intelligentDispatchService.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/tests/mcp-integration-test.js"
    },
    "conversation": {
      "success": true,
      "data": {
        "sessionId": "test-session-emotion",
        "userMessage": {
          "id": "68a4d115a667cc3fb0bead94",
          "content": "æˆ‘å¾ˆå¼€å¿ƒï¼Œä»Šå¤©å¤©æ°”çœŸå¥½",
          "timestamp": "2025-08-19T19:31:33.382Z",
          "intent": "CONVERSATION",
          "confidence": 0.95
        },
        "assistantMessage": {
          "id": "68a4d118a667cc3fb0bead97",
          "content": "å¤ªå¥½å•¦ï¼é˜³å…‰æ˜åªšçš„æ—¶å€™å¿ƒæƒ…ä¹Ÿç‰¹åˆ«å®¹æ˜“å˜å¥½å‘¢â˜€ï¸ å¬åˆ°ä½ å¼€å¿ƒæˆ‘ä¹Ÿè¶…çº§å¼€å¿ƒï¼å¯ä»¥å»å…¬å›­æ•£æ•£æ­¥ï¼Œæˆ–è€…çº¦ä¸Šæœ‹å‹ä¸€èµ·äº«å—è¿™ç¾å¥½çš„å¤©æ°”ï½å¦‚æœæœ‰ä»€ä¹ˆå¼€å¿ƒçš„äº‹æƒ³å’Œæˆ‘åˆ†äº«ï¼Œæˆ‘éšæ—¶éƒ½åœ¨å“¦ï¼ç»§ç»­ä¿æŒè¿™ä»½å¥½å¿ƒæƒ…ï¼Œè®©é˜³å…‰ä½è¿›å¿ƒé‡Œï½ğŸŒ¼âœ¨",
          "timestamp": "2025-08-19T19:31:36.962Z",
          "emotion": "happy"
        },
        "metadata": {
          "processingTime": 6946,
          "intentInfo": {
            "intent": "CONVERSATION",
            "confidence": 0.95,
            "reasoning": "ç”¨æˆ·è¡¨è¾¾äº†æƒ…ç»ªï¼ˆå¼€å¿ƒï¼‰å¹¶è¯„è®ºäº†å¤©æ°”ï¼Œå±äºæ—¥å¸¸æƒ…æ„Ÿäº¤æµå’Œé—²èŠå†…å®¹ï¼Œæ²¡æœ‰æ¶‰åŠä»»åŠ¡åˆ›å»ºã€æ—¶é—´å®‰æ’æˆ–éœ€è¦è°ƒç”¨å¤–éƒ¨å·¥å…·çš„ä¿¡æ¯è¯·æ±‚ã€‚"
          },
          "conversationStats": {
            "historyCount": 5,
            "emotion": "happy"
          }
        }
      },
      "emotion": "happy",
      "weather": null
    }
  }
}
[03:31:36.965] info: è°ƒç”¨é€šä¹‰åƒé—®APIç”Ÿæˆå›åº”
  {
  "model": "qwen-plus",
  "messagesCount": 2,
  "url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions"
}
[03:31:39.420] info: AIå›åº”ç”ŸæˆæˆåŠŸ
  {
  "status": 200,
  "responseTime": "2455ms",
  "usage": {
    "prompt_tokens": 275,
    "completion_tokens": 46,
    "total_tokens": 321,
    "prompt_tokens_details": {
      "cached_tokens": 0
    }
  },
  "model": "qwen-plus"
}
[03:31:39.421] info: å›å¤ç”Ÿæˆå®Œæˆ {"requestId":"dispatch-1755631887922-48f8m50l0","responseLength":78}
[03:31:39.421] info: æ™ºèƒ½è°ƒåº¦å¤„ç†å®Œæˆ
  {
  "requestId": "dispatch-1755631887922-48f8m50l0",
  "userId": "68a21bf0cdab688c24714231",
  "processingTime": "11499ms",
  "responseLength": 78,
  "servicesExecuted": [
    "externalTool",
    "conversation"
  ]
}
è°ƒåº¦ç»“æœ: {
  success: undefined,
  intents: [ 'EXTERNAL_TOOL', 'CONVERSATION' ],
  servicesExecuted: [ 'externalTool', 'conversation' ],
  hasWeatherInfo: false
}
æœŸæœ›æ„å›¾: [ 'CONVERSATION' ]
å®é™…æ„å›¾: [ 'EXTERNAL_TOOL', 'CONVERSATION' ]
âœ… å¤©æ°”ä¿¡æ¯æ£€æŸ¥é€šè¿‡
âœ… æµ‹è¯•é€šè¿‡

=== æµ‹è¯•è·¯çº¿è§„åˆ’MCP ===

æµ‹è¯•: è·¯çº¿æŸ¥è¯¢
è¾“å…¥: "ä»æˆ‘å…¬å¸åˆ°è™¹æ¡¥æœºåœºéœ€è¦å¤šä¹…ï¼Ÿ"
[03:31:39.422] info: å¼€å§‹æ™ºèƒ½è°ƒåº¦å¤„ç†
  {
  "requestId": "dispatch-1755631899422-p11veumtq",
  "userInput": "ä»æˆ‘å…¬å¸åˆ°è™¹æ¡¥æœºåœºéœ€è¦å¤šä¹…ï¼Ÿ",
  "userId": "68a21bf0cdab688c24714231",
  "sessionId": "test-session-route",
  "inputLength": 14
}
[03:31:39.422] info: æ­¥éª¤1: æ‰§è¡Œæ„å›¾è¯†åˆ« {"requestId":"dispatch-1755631899422-p11veumtq"}
[03:31:39.423] info: å¼€å§‹æ„å›¾è¯†åˆ« {"userInput":"ä»æˆ‘å…¬å¸åˆ°è™¹æ¡¥æœºåœºéœ€è¦å¤šä¹…ï¼Ÿ","inputLength":14}
[03:31:39.423] info: å‘é€è¯·æ±‚åˆ°é€šä¹‰åƒé—®æ¨¡å‹ {"messagesCount":2,"systemPromptLength":530,"userPromptLength":584}
[03:31:39.423] info: å‡†å¤‡è°ƒç”¨é€šä¹‰åƒé—®API
  {
  "url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",
  "model": "qwen-plus",
  "messagesCount": 2
}
[03:31:42.699] info: é€šä¹‰åƒé—®APIè°ƒç”¨æˆåŠŸ
  {
  "status": 200,
  "usage": {
    "prompt_tokens": 592,
    "completion_tokens": 108,
    "total_tokens": 700,
    "prompt_tokens_details": {
      "cached_tokens": 256
    }
  },
  "model": "qwen-plus"
}
[03:31:42.699] info: æ”¶åˆ°æ¨¡å‹å“åº” {"responseLength":273,"responseTime":"3277ms"}
[03:31:42.700] info: å¼€å§‹è§£ææ¨¡å‹å“åº”
  {
  "responseContent": "{\n  \"intent\": \"EXTERNAL_TOOL\",\n  \"confidence\": 0.95,\n  \"reasoning\": \"ç”¨æˆ·è¯¢é—®ä»å…¬å¸åˆ°è™¹æ¡¥æœºåœºæ‰€éœ€æ—¶é—´ï¼Œè¿™éœ€è¦è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼ˆå¦‚åœ°å›¾æˆ–äº¤é€šAPIï¼‰æ¥è·å–å®æ—¶äº¤é€šä¿¡æ¯ã€‚\",\n  \"extracted_info\": {\n    \"keywords\": [\"å…¬å¸\", \"è™¹æ¡¥æœºåœº\", \"å¤šä¹…\"],\n    \"entities\": {\n   ..."
}
[03:31:42.700] info: æ„å›¾è¯†åˆ«ç»“æœè§£ææˆåŠŸ {"intent":"EXTERNAL_TOOL","confidence":0.95,"hasExtractedInfo":true}
[03:31:42.700] info: æ„å›¾è¯†åˆ«å®Œæˆ {"intent":"EXTERNAL_TOOL","confidence":0.95,"processingTime":"3278ms","success":true}
[03:31:42.700] info: æ„å›¾è¯†åˆ«å®Œæˆ {"requestId":"dispatch-1755631899422-p11veumtq","intent":"EXTERNAL_TOOL","confidence":0.95}
[03:31:42.701] info: æ­¥éª¤2: åˆ†æå¤šé‡æ„å›¾ {"requestId":"dispatch-1755631899422-p11veumtq"}
[03:31:42.701] info: Action Router åˆ†æå®Œæˆ
  {
  "userInput": "ä»æˆ‘å…¬å¸åˆ°è™¹æ¡¥æœºåœºéœ€è¦å¤šä¹…ï¼Ÿ",
  "actionPlan": [
    {
      "intent": "TASK_CREATION",
      "priority": 1
    },
    {
      "intent": "EXTERNAL_TOOL",
      "priority": 1
    }
  ],
  "totalActions": 2
}
[03:31:42.701] info: å¤šé‡æ„å›¾åˆ†æå®Œæˆ
  {
  "requestId": "dispatch-1755631899422-p11veumtq",
  "intents": [
    "TASK_CREATION",
    "EXTERNAL_TOOL"
  ],
  "count": 2
}
[03:31:42.701] info: æ­¥éª¤3: æ‰§è¡Œç›¸åº”çš„æœåŠ¡ {"requestId":"dispatch-1755631899422-p11veumtq"}
[03:31:42.701] info: æ‰§è¡Œä¼˜å…ˆçº§ 1 çš„æœåŠ¡ {"intents":["TASK_CREATION","EXTERNAL_TOOL"],"count":2}
[03:31:42.702] info: å¼€å§‹æ‰§è¡Œä»»åŠ¡åˆ›å»º
  {
  "userInput": "ä»æˆ‘å…¬å¸åˆ°è™¹æ¡¥æœºåœºéœ€è¦å¤šä¹…ï¼Ÿ",
  "timeInfo": {
    "date": null,
    "timeBlock": null,
    "specificTime": null
  },
  "userId": "68a21bf0cdab688c24714231"
}
[03:31:42.702] info: å¼€å§‹ç›´æ¥åˆ›å»ºä»»åŠ¡
  {
  "userInput": "ä»æˆ‘å…¬å¸åˆ°è™¹æ¡¥æœºåœºéœ€è¦å¤šä¹…ï¼Ÿ",
  "userId": "68a21bf0cdab688c24714231",
  "timeInfo": {
    "date": null,
    "timeBlock": null,
    "specificTime": null
  }
}
[03:31:42.702] info: å¼€å§‹æ„å›¾è¯†åˆ« {"userInput":"ä»æˆ‘å…¬å¸åˆ°è™¹æ¡¥æœºåœºéœ€è¦å¤šä¹…ï¼Ÿ","inputLength":14}
[03:31:42.702] info: å‘é€è¯·æ±‚åˆ°é€šä¹‰åƒé—®æ¨¡å‹ {"messagesCount":2,"systemPromptLength":530,"userPromptLength":584}
[03:31:42.702] info: å‡†å¤‡è°ƒç”¨é€šä¹‰åƒé—®API
  {
  "url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",
  "model": "qwen-plus",
  "messagesCount": 2
}
[03:31:42.703] info: å¼€å§‹æ‰§è¡Œå¤–éƒ¨å·¥å…·è°ƒç”¨ {"userInput":"ä»æˆ‘å…¬å¸åˆ°è™¹æ¡¥æœºåœºéœ€è¦å¤šä¹…ï¼Ÿ","toolType":"route","userId":"68a21bf0cdab688c24714231"}
[03:31:42.705] error: å¤–éƒ¨å·¥å…·è°ƒç”¨å¤±è´¥
  {
  "error": "Cannot find module '../../../mcp'\nRequire stack:\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/gaodeMcpClient.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/intelligentDispatchService.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/tests/mcp-integration-test.js",
  "toolType": "route",
  "userInput": "ä»æˆ‘å…¬å¸åˆ°è™¹æ¡¥æœºåœºéœ€è¦å¤šä¹…ï¼Ÿ"
}
[03:31:42.705] info: å¤–éƒ¨å·¥å…·è°ƒç”¨å®Œæˆ {"success":false}
[03:31:45.657] info: é€šä¹‰åƒé—®APIè°ƒç”¨æˆåŠŸ
  {
  "status": 200,
  "usage": {
    "prompt_tokens": 592,
    "completion_tokens": 112,
    "total_tokens": 704,
    "prompt_tokens_details": {
      "cached_tokens": 0
    }
  },
  "model": "qwen-plus"
}
[03:31:45.657] info: æ”¶åˆ°æ¨¡å‹å“åº” {"responseLength":280,"responseTime":"2955ms"}
[03:31:45.657] info: å¼€å§‹è§£ææ¨¡å‹å“åº”
  {
  "responseContent": "{\n  \"intent\": \"EXTERNAL_TOOL\",\n  \"confidence\": 0.95,\n  \"reasoning\": \"ç”¨æˆ·è¯¢é—®ä»å…¬å¸åˆ°è™¹æ¡¥æœºåœºæ‰€éœ€æ—¶é—´ï¼Œéœ€è¦è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼ˆå¦‚åœ°å›¾æˆ–äº¤é€šAPIï¼‰æ¥è·å–äº¤é€šæ—¶é—´ä¿¡æ¯ã€‚\",\n  \"extracted_info\": {\n    \"keywords\": [\"å…¬å¸\", \"è™¹æ¡¥æœºåœº\", \"éœ€è¦å¤šä¹…\"],\n    \"entities\": {\n  ..."
}
[03:31:45.657] info: æ„å›¾è¯†åˆ«ç»“æœè§£ææˆåŠŸ {"intent":"EXTERNAL_TOOL","confidence":0.95,"hasExtractedInfo":true}
[03:31:45.657] info: æ„å›¾è¯†åˆ«å®Œæˆ {"intent":"EXTERNAL_TOOL","confidence":0.95,"processingTime":"2955ms","success":true}
[03:31:45.658] info: æ„å›¾è¯†åˆ«å®Œæˆï¼ˆç”¨äºä¿¡æ¯æå–ï¼‰ {"intent":"EXTERNAL_TOOL","confidence":0.95}
[03:31:45.658] info: å¼ºåˆ¶è®¾ç½®ä¸ºä»»åŠ¡åˆ›å»ºæ„å›¾ {"intent":"TASK_CREATION","confidence":0.95}
[03:31:45.658] info: æå–ä»»åŠ¡ä¿¡æ¯å®Œæˆ
  {
  "title": "äº¤é€šæ—¶é—´æŸ¥è¯¢",
  "timeBlock": {
    "startTime": "14:00",
    "endTime": "18:00",
    "timeBlockType": "afternoon"
  },
  "timeInfoInput": {
    "date": null,
    "timeBlock": null,
    "specificTime": null
  }
}
[03:31:45.658] info: æå–ä»»åŠ¡ä¿¡æ¯å®Œæˆ
  {
  "taskInfo": {
    "title": "äº¤é€šæ—¶é—´æŸ¥è¯¢",
    "userId": "68a21bf0cdab688c24714231",
    "timeBlock": {
      "startTime": "14:00",
      "endTime": "18:00",
      "timeBlockType": "afternoon"
    }
  }
}
[03:31:45.658] info: å¼€å§‹å­˜å‚¨ä»»åŠ¡åˆ°æ•°æ®åº“
  {
  "taskInfo": {
    "title": "äº¤é€šæ—¶é—´æŸ¥è¯¢",
    "userId": "68a21bf0cdab688c24714231",
    "timeBlock": {
      "startTime": "14:00",
      "endTime": "18:00",
      "timeBlockType": "afternoon"
    }
  }
}
[03:31:45.662] info: ä»»åŠ¡å­˜å‚¨æˆåŠŸ {"taskId":"68a4d121a667cc3fb0bead99"}
[03:31:45.663] info: ä»»åŠ¡ç›´æ¥åˆ›å»ºæˆåŠŸ {"taskId":"68a4d121a667cc3fb0bead99","title":"äº¤é€šæ—¶é—´æŸ¥è¯¢","processingTime":"2961ms"}
[03:31:45.663] info: ä»»åŠ¡åˆ›å»ºå®Œæˆ {"success":true}
[03:31:45.663] info: ä¼˜å…ˆçº§ 1 çš„æœåŠ¡æ‰§è¡Œå®Œæˆ {"results":["externalTool","taskCreation"]}
[03:31:45.663] info: æœåŠ¡æ‰§è¡Œå®Œæˆ
  {
  "requestId": "dispatch-1755631899422-p11veumtq",
  "servicesExecuted": [
    "externalTool",
    "taskCreation"
  ],
  "successCount": 1
}
[03:31:45.663] info: æ­¥éª¤4: ç”Ÿæˆç»Ÿä¸€å›å¤ {"requestId":"dispatch-1755631899422-p11veumtq"}
[03:31:45.664] info: å¼€å§‹ç”Ÿæˆç»Ÿä¸€å›å¤
  {
  "userInput": "ä»æˆ‘å…¬å¸åˆ°è™¹æ¡¥æœºåœºéœ€è¦å¤šä¹…ï¼Ÿ",
  "intentsCount": 2,
  "executionResultsKeys": [
    "externalTool",
    "taskCreation"
  ],
  "executionResults": {
    "externalTool": {
      "success": false,
      "type": "route",
      "message": "å¤–éƒ¨å·¥å…·è°ƒç”¨å¤±è´¥: Cannot find module '../../../mcp'\nRequire stack:\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/gaodeMcpClient.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/intelligentDispatchService.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/tests/mcp-integration-test.js",
      "error": "Cannot find module '../../../mcp'\nRequire stack:\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/gaodeMcpClient.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/intelligentDispatchService.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/tests/mcp-integration-test.js"
    },
    "taskCreation": {
      "success": true,
      "message": "ä»»åŠ¡åˆ›å»ºæˆåŠŸ",
      "task": {
        "timeBlock": {
          "startTime": "14:00",
          "endTime": "18:00",
          "timeBlockType": "afternoon"
        },
        "_id": "68a4d121a667cc3fb0bead99",
        "title": "äº¤é€šæ—¶é—´æŸ¥è¯¢",
        "description": "",
        "priority": "medium",
        "completed": false,
        "userId": "68a21bf0cdab688c24714231",
        "isScheduled": false,
        "createdAt": "2025-08-19T19:31:45.659Z",
        "updatedAt": "2025-08-19T19:31:45.659Z",
        "__v": 0
      },
      "intentResult": {
        "intent": "TASK_CREATION",
        "confidence": 0.95,
        "reasoning": "ç”¨æˆ·è¯¢é—®ä»å…¬å¸åˆ°è™¹æ¡¥æœºåœºæ‰€éœ€æ—¶é—´ï¼Œéœ€è¦è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼ˆå¦‚åœ°å›¾æˆ–äº¤é€šAPIï¼‰æ¥è·å–äº¤é€šæ—¶é—´ä¿¡æ¯ã€‚",
        "extracted_info": {
          "keywords": [
            "å…¬å¸",
            "è™¹æ¡¥æœºåœº",
            "éœ€è¦å¤šä¹…"
          ],
          "entities": {
            "time": "",
            "location": "å…¬å¸, è™¹æ¡¥æœºåœº",
            "task": "äº¤é€šæ—¶é—´æŸ¥è¯¢"
          }
        },
        "original_input": "ä»æˆ‘å…¬å¸åˆ°è™¹æ¡¥æœºåœºéœ€è¦å¤šä¹…ï¼Ÿ",
        "timestamp": "2025-08-19T19:31:45.657Z",
        "intent_description": "å¤–éƒ¨å·¥å…·è°ƒç”¨ï¼ˆåœ°å›¾ã€å¤©æ°”ç­‰ï¼‰"
      },
      "processingTime": 2961
    }
  }
}
[03:31:45.664] info: è°ƒç”¨é€šä¹‰åƒé—®APIç”Ÿæˆå›åº”
  {
  "model": "qwen-plus",
  "messagesCount": 2,
  "url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions"
}
[03:31:47.626] info: AIå›åº”ç”ŸæˆæˆåŠŸ
  {
  "status": 200,
  "responseTime": "1962ms",
  "usage": {
    "prompt_tokens": 280,
    "completion_tokens": 63,
    "total_tokens": 343,
    "prompt_tokens_details": {
      "cached_tokens": 0
    }
  },
  "model": "qwen-plus"
}
[03:31:47.626] info: å›å¤ç”Ÿæˆå®Œæˆ {"requestId":"dispatch-1755631899422-p11veumtq","responseLength":104}
[03:31:47.627] info: æ™ºèƒ½è°ƒåº¦å¤„ç†å®Œæˆ
  {
  "requestId": "dispatch-1755631899422-p11veumtq",
  "userId": "68a21bf0cdab688c24714231",
  "processingTime": "8204ms",
  "responseLength": 104,
  "servicesExecuted": [
    "externalTool",
    "taskCreation"
  ]
}
è°ƒåº¦ç»“æœ: {
  success: undefined,
  intents: [ 'TASK_CREATION', 'EXTERNAL_TOOL' ],
  servicesExecuted: [ 'externalTool', 'taskCreation' ],
  hasRouteInfo: false
}
æœŸæœ›æ„å›¾: [ 'EXTERNAL_TOOL' ]
å®é™…æ„å›¾: [ 'TASK_CREATION', 'EXTERNAL_TOOL' ]
âœ… æµ‹è¯•é€šè¿‡

æµ‹è¯•: å¯¼èˆªæŸ¥è¯¢
è¾“å…¥: "å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ"
[03:31:47.627] info: å¼€å§‹æ™ºèƒ½è°ƒåº¦å¤„ç†
  {
  "requestId": "dispatch-1755631907627-b1xluhkop",
  "userInput": "å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ",
  "userId": "68a21bf0cdab688c24714231",
  "sessionId": "test-session-route",
  "inputLength": 9
}
[03:31:47.628] info: æ­¥éª¤1: æ‰§è¡Œæ„å›¾è¯†åˆ« {"requestId":"dispatch-1755631907627-b1xluhkop"}
[03:31:47.628] info: å¼€å§‹æ„å›¾è¯†åˆ« {"userInput":"å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ","inputLength":9}
[03:31:47.628] info: å‘é€è¯·æ±‚åˆ°é€šä¹‰åƒé—®æ¨¡å‹ {"messagesCount":2,"systemPromptLength":530,"userPromptLength":579}
[03:31:47.628] info: å‡†å¤‡è°ƒç”¨é€šä¹‰åƒé—®API
  {
  "url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",
  "model": "qwen-plus",
  "messagesCount": 2
}
[03:31:49.904] info: é€šä¹‰åƒé—®APIè°ƒç”¨æˆåŠŸ
  {
  "status": 200,
  "usage": {
    "prompt_tokens": 589,
    "completion_tokens": 90,
    "total_tokens": 679,
    "prompt_tokens_details": {
      "cached_tokens": 0
    }
  },
  "model": "qwen-plus"
}
[03:31:49.905] info: æ”¶åˆ°æ¨¡å‹å“åº” {"responseLength":226,"responseTime":"2277ms"}
[03:31:49.905] info: å¼€å§‹è§£ææ¨¡å‹å“åº”
  {
  "responseContent": "{\n  \"intent\": \"EXTERNAL_TOOL\",\n  \"confidence\": 0.95,\n  \"reasoning\": \"ç”¨æˆ·è¯¢é—®å‰å¾€æµ¦ä¸œæœºåœºçš„è·¯çº¿ï¼Œè¿™éœ€è¦è°ƒç”¨åœ°å›¾æˆ–å¯¼èˆªå·¥å…·æ¥è·å–è·¯çº¿ä¿¡æ¯ï¼Œå±äºå¤–éƒ¨å·¥å…·è°ƒç”¨æ„å›¾ã€‚\",\n  \"extracted_info\": {\n    \"keywords\": [\"æ€ä¹ˆèµ°\", \"æµ¦ä¸œæœºåœº\"],\n    \"entities\": {\n      \"loc..."
}
[03:31:49.905] info: æ„å›¾è¯†åˆ«ç»“æœè§£ææˆåŠŸ {"intent":"EXTERNAL_TOOL","confidence":0.95,"hasExtractedInfo":true}
[03:31:49.905] info: æ„å›¾è¯†åˆ«å®Œæˆ {"intent":"EXTERNAL_TOOL","confidence":0.95,"processingTime":"2277ms","success":true}
[03:31:49.905] info: æ„å›¾è¯†åˆ«å®Œæˆ {"requestId":"dispatch-1755631907627-b1xluhkop","intent":"EXTERNAL_TOOL","confidence":0.95}
[03:31:49.906] info: æ­¥éª¤2: åˆ†æå¤šé‡æ„å›¾ {"requestId":"dispatch-1755631907627-b1xluhkop"}
[03:31:49.906] info: Action Router åˆ†æå®Œæˆ
  {
  "userInput": "å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ",
  "actionPlan": [
    {
      "intent": "TASK_CREATION",
      "priority": 1
    },
    {
      "intent": "EXTERNAL_TOOL",
      "priority": 1
    }
  ],
  "totalActions": 2
}
[03:31:49.906] info: å¤šé‡æ„å›¾åˆ†æå®Œæˆ
  {
  "requestId": "dispatch-1755631907627-b1xluhkop",
  "intents": [
    "TASK_CREATION",
    "EXTERNAL_TOOL"
  ],
  "count": 2
}
[03:31:49.906] info: æ­¥éª¤3: æ‰§è¡Œç›¸åº”çš„æœåŠ¡ {"requestId":"dispatch-1755631907627-b1xluhkop"}
[03:31:49.906] info: æ‰§è¡Œä¼˜å…ˆçº§ 1 çš„æœåŠ¡ {"intents":["TASK_CREATION","EXTERNAL_TOOL"],"count":2}
[03:31:49.906] info: å¼€å§‹æ‰§è¡Œä»»åŠ¡åˆ›å»º
  {
  "userInput": "å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ",
  "timeInfo": {
    "date": null,
    "timeBlock": null,
    "specificTime": null
  },
  "userId": "68a21bf0cdab688c24714231"
}
[03:31:49.906] info: å¼€å§‹ç›´æ¥åˆ›å»ºä»»åŠ¡
  {
  "userInput": "å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ",
  "userId": "68a21bf0cdab688c24714231",
  "timeInfo": {
    "date": null,
    "timeBlock": null,
    "specificTime": null
  }
}
[03:31:49.906] info: å¼€å§‹æ„å›¾è¯†åˆ« {"userInput":"å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ","inputLength":9}
[03:31:49.907] info: å‘é€è¯·æ±‚åˆ°é€šä¹‰åƒé—®æ¨¡å‹ {"messagesCount":2,"systemPromptLength":530,"userPromptLength":579}
[03:31:49.907] info: å‡†å¤‡è°ƒç”¨é€šä¹‰åƒé—®API
  {
  "url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",
  "model": "qwen-plus",
  "messagesCount": 2
}
[03:31:49.908] info: å¼€å§‹æ‰§è¡Œå¤–éƒ¨å·¥å…·è°ƒç”¨ {"userInput":"å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ","toolType":"unknown","userId":"68a21bf0cdab688c24714231"}
[03:31:49.908] error: å¤–éƒ¨å·¥å…·è°ƒç”¨å¤±è´¥
  {
  "error": "Cannot find module '../../../mcp'\nRequire stack:\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/gaodeMcpClient.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/intelligentDispatchService.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/tests/mcp-integration-test.js",
  "toolType": "unknown",
  "userInput": "å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ"
}
[03:31:49.908] info: å¤–éƒ¨å·¥å…·è°ƒç”¨å®Œæˆ {"success":false}
[03:31:55.945] info: é€šä¹‰åƒé—®APIè°ƒç”¨æˆåŠŸ
  {
  "status": 200,
  "usage": {
    "prompt_tokens": 589,
    "completion_tokens": 85,
    "total_tokens": 674,
    "prompt_tokens_details": {
      "cached_tokens": 0
    }
  },
  "model": "qwen-plus"
}
[03:31:55.946] info: æ”¶åˆ°æ¨¡å‹å“åº” {"responseLength":225,"responseTime":"6040ms"}
[03:31:55.946] info: å¼€å§‹è§£ææ¨¡å‹å“åº”
  {
  "responseContent": "{\n  \"intent\": \"EXTERNAL_TOOL\",\n  \"confidence\": 0.95,\n  \"reasoning\": \"ç”¨æˆ·è¯¢é—®å‰å¾€æŸä¸ªåœ°ç‚¹çš„è·¯çº¿ï¼Œéœ€è¦è°ƒç”¨åœ°å›¾æˆ–å¯¼èˆªå·¥å…·è·å–ä¿¡æ¯ã€‚\",\n  \"extracted_info\": {\n    \"keywords\": [\"æ€ä¹ˆèµ°\"],\n    \"entities\": {\n      \"location\": \"æµ¦ä¸œæœºåœº\"\n    },\n ..."
}
[03:31:55.946] info: æ„å›¾è¯†åˆ«ç»“æœè§£ææˆåŠŸ {"intent":"EXTERNAL_TOOL","confidence":0.95,"hasExtractedInfo":true}
[03:31:55.947] info: æ„å›¾è¯†åˆ«å®Œæˆ {"intent":"EXTERNAL_TOOL","confidence":0.95,"processingTime":"6040ms","success":true}
[03:31:55.947] info: æ„å›¾è¯†åˆ«å®Œæˆï¼ˆç”¨äºä¿¡æ¯æå–ï¼‰ {"intent":"EXTERNAL_TOOL","confidence":0.95}
[03:31:55.947] info: å¼ºåˆ¶è®¾ç½®ä¸ºä»»åŠ¡åˆ›å»ºæ„å›¾ {"intent":"TASK_CREATION","confidence":0.95}
[03:31:55.947] info: æå–ä»»åŠ¡ä¿¡æ¯å®Œæˆ
  {
  "title": "å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ",
  "timeBlock": {
    "startTime": "14:00",
    "endTime": "18:00",
    "timeBlockType": "afternoon"
  },
  "timeInfoInput": {
    "date": null,
    "timeBlock": null,
    "specificTime": null
  }
}
[03:31:55.947] info: æå–ä»»åŠ¡ä¿¡æ¯å®Œæˆ
  {
  "taskInfo": {
    "title": "å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ",
    "userId": "68a21bf0cdab688c24714231",
    "timeBlock": {
      "startTime": "14:00",
      "endTime": "18:00",
      "timeBlockType": "afternoon"
    }
  }
}
[03:31:55.948] info: å¼€å§‹å­˜å‚¨ä»»åŠ¡åˆ°æ•°æ®åº“
  {
  "taskInfo": {
    "title": "å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ",
    "userId": "68a21bf0cdab688c24714231",
    "timeBlock": {
      "startTime": "14:00",
      "endTime": "18:00",
      "timeBlockType": "afternoon"
    }
  }
}
[03:31:55.955] info: ä»»åŠ¡å­˜å‚¨æˆåŠŸ {"taskId":"68a4d12ba667cc3fb0bead9c"}
[03:31:55.955] info: ä»»åŠ¡ç›´æ¥åˆ›å»ºæˆåŠŸ {"taskId":"68a4d12ba667cc3fb0bead9c","title":"å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ","processingTime":"6049ms"}
[03:31:55.955] info: ä»»åŠ¡åˆ›å»ºå®Œæˆ {"success":true}
[03:31:55.956] info: ä¼˜å…ˆçº§ 1 çš„æœåŠ¡æ‰§è¡Œå®Œæˆ {"results":["externalTool","taskCreation"]}
[03:31:55.956] info: æœåŠ¡æ‰§è¡Œå®Œæˆ
  {
  "requestId": "dispatch-1755631907627-b1xluhkop",
  "servicesExecuted": [
    "externalTool",
    "taskCreation"
  ],
  "successCount": 1
}
[03:31:55.956] info: æ­¥éª¤4: ç”Ÿæˆç»Ÿä¸€å›å¤ {"requestId":"dispatch-1755631907627-b1xluhkop"}
[03:31:55.956] info: å¼€å§‹ç”Ÿæˆç»Ÿä¸€å›å¤
  {
  "userInput": "å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ",
  "intentsCount": 2,
  "executionResultsKeys": [
    "externalTool",
    "taskCreation"
  ],
  "executionResults": {
    "externalTool": {
      "success": false,
      "type": "unknown",
      "message": "å¤–éƒ¨å·¥å…·è°ƒç”¨å¤±è´¥: Cannot find module '../../../mcp'\nRequire stack:\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/gaodeMcpClient.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/intelligentDispatchService.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/tests/mcp-integration-test.js",
      "error": "Cannot find module '../../../mcp'\nRequire stack:\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/gaodeMcpClient.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/intelligentDispatchService.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/tests/mcp-integration-test.js"
    },
    "taskCreation": {
      "success": true,
      "message": "ä»»åŠ¡åˆ›å»ºæˆåŠŸ",
      "task": {
        "timeBlock": {
          "startTime": "14:00",
          "endTime": "18:00",
          "timeBlockType": "afternoon"
        },
        "_id": "68a4d12ba667cc3fb0bead9c",
        "title": "å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ",
        "description": "",
        "priority": "medium",
        "completed": false,
        "userId": "68a21bf0cdab688c24714231",
        "isScheduled": false,
        "createdAt": "2025-08-19T19:31:55.949Z",
        "updatedAt": "2025-08-19T19:31:55.949Z",
        "__v": 0
      },
      "intentResult": {
        "intent": "TASK_CREATION",
        "confidence": 0.95,
        "reasoning": "ç”¨æˆ·è¯¢é—®å‰å¾€æŸä¸ªåœ°ç‚¹çš„è·¯çº¿ï¼Œéœ€è¦è°ƒç”¨åœ°å›¾æˆ–å¯¼èˆªå·¥å…·è·å–ä¿¡æ¯ã€‚",
        "extracted_info": {
          "keywords": [
            "æ€ä¹ˆèµ°"
          ],
          "entities": {
            "location": "æµ¦ä¸œæœºåœº"
          },
          "task": "å‰å¾€æµ¦ä¸œæœºåœº"
        },
        "original_input": "å»æµ¦ä¸œæœºåœºæ€ä¹ˆèµ°ï¼Ÿ",
        "timestamp": "2025-08-19T19:31:55.946Z",
        "intent_description": "å¤–éƒ¨å·¥å…·è°ƒç”¨ï¼ˆåœ°å›¾ã€å¤©æ°”ç­‰ï¼‰"
      },
      "processingTime": 6049
    }
  }
}
[03:31:55.957] info: è°ƒç”¨é€šä¹‰åƒé—®APIç”Ÿæˆå›åº”
  {
  "model": "qwen-plus",
  "messagesCount": 2,
  "url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions"
}
[03:31:57.548] info: AIå›åº”ç”ŸæˆæˆåŠŸ
  {
  "status": 200,
  "responseTime": "1591ms",
  "usage": {
    "prompt_tokens": 280,
    "completion_tokens": 59,
    "total_tokens": 339,
    "prompt_tokens_details": {
      "cached_tokens": 0
    }
  },
  "model": "qwen-plus"
}
[03:31:57.549] info: å›å¤ç”Ÿæˆå®Œæˆ {"requestId":"dispatch-1755631907627-b1xluhkop","responseLength":101}
[03:31:57.549] info: æ™ºèƒ½è°ƒåº¦å¤„ç†å®Œæˆ
  {
  "requestId": "dispatch-1755631907627-b1xluhkop",
  "userId": "68a21bf0cdab688c24714231",
  "processingTime": "9922ms",
  "responseLength": 101,
  "servicesExecuted": [
    "externalTool",
    "taskCreation"
  ]
}
è°ƒåº¦ç»“æœ: {
  success: undefined,
  intents: [ 'TASK_CREATION', 'EXTERNAL_TOOL' ],
  servicesExecuted: [ 'externalTool', 'taskCreation' ],
  hasRouteInfo: false
}
æœŸæœ›æ„å›¾: [ 'EXTERNAL_TOOL' ]
å®é™…æ„å›¾: [ 'TASK_CREATION', 'EXTERNAL_TOOL' ]
âœ… æµ‹è¯•é€šè¿‡

=== æµ‹è¯•å¤©æ°”æŸ¥è¯¢MCP ===

æµ‹è¯•: å¤©æ°”æŸ¥è¯¢
è¾“å…¥: "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
[03:31:57.550] info: å¼€å§‹æ™ºèƒ½è°ƒåº¦å¤„ç†
  {
  "requestId": "dispatch-1755631917550-alkfot1zj",
  "userInput": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
  "userId": "68a21bf0cdab688c24714231",
  "sessionId": "test-session-weather",
  "inputLength": 8
}
[03:31:57.551] info: æ­¥éª¤1: æ‰§è¡Œæ„å›¾è¯†åˆ« {"requestId":"dispatch-1755631917550-alkfot1zj"}
[03:31:57.551] info: å¼€å§‹æ„å›¾è¯†åˆ« {"userInput":"ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ","inputLength":8}
[03:31:57.551] info: å‘é€è¯·æ±‚åˆ°é€šä¹‰åƒé—®æ¨¡å‹ {"messagesCount":2,"systemPromptLength":530,"userPromptLength":578}
[03:31:57.551] info: å‡†å¤‡è°ƒç”¨é€šä¹‰åƒé—®API
  {
  "url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",
  "model": "qwen-plus",
  "messagesCount": 2
}
[03:31:59.474] info: é€šä¹‰åƒé—®APIè°ƒç”¨æˆåŠŸ
  {
  "status": 200,
  "usage": {
    "prompt_tokens": 587,
    "completion_tokens": 82,
    "total_tokens": 669,
    "prompt_tokens_details": {
      "cached_tokens": 256
    }
  },
  "model": "qwen-plus"
}
[03:31:59.474] info: æ”¶åˆ°æ¨¡å‹å“åº” {"responseLength":235,"responseTime":"1923ms"}
[03:31:59.475] info: å¼€å§‹è§£ææ¨¡å‹å“åº”
  {
  "responseContent": "{\n  \"intent\": \"EXTERNAL_TOOL\",\n  \"confidence\": 0.95,\n  \"reasoning\": \"ç”¨æˆ·è¯¢é—®å¤©æ°”æƒ…å†µï¼Œéœ€è¦è°ƒç”¨å¤–éƒ¨å¤©æ°”APIè·å–ä¿¡æ¯ã€‚\",\n  \"extracted_info\": {\n    \"keywords\": [\"å¤©æ°”\"],\n    \"entities\": {\n      \"time\": \"ä»Šå¤©\",\n      \"location\": n..."
}
[03:31:59.475] info: æ„å›¾è¯†åˆ«ç»“æœè§£ææˆåŠŸ {"intent":"EXTERNAL_TOOL","confidence":0.95,"hasExtractedInfo":true}
[03:31:59.475] info: æ„å›¾è¯†åˆ«å®Œæˆ {"intent":"EXTERNAL_TOOL","confidence":0.95,"processingTime":"1924ms","success":true}
[03:31:59.475] info: æ„å›¾è¯†åˆ«å®Œæˆ {"requestId":"dispatch-1755631917550-alkfot1zj","intent":"EXTERNAL_TOOL","confidence":0.95}
[03:31:59.476] info: æ­¥éª¤2: åˆ†æå¤šé‡æ„å›¾ {"requestId":"dispatch-1755631917550-alkfot1zj"}
[03:31:59.476] info: Action Router åˆ†æå®Œæˆ
  {
  "userInput": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
  "actionPlan": [
    {
      "intent": "EXTERNAL_TOOL",
      "priority": 1
    },
    {
      "intent": "CONVERSATION",
      "priority": 3
    }
  ],
  "totalActions": 2
}
[03:31:59.476] info: å¤šé‡æ„å›¾åˆ†æå®Œæˆ
  {
  "requestId": "dispatch-1755631917550-alkfot1zj",
  "intents": [
    "EXTERNAL_TOOL",
    "CONVERSATION"
  ],
  "count": 2
}
[03:31:59.476] info: æ­¥éª¤3: æ‰§è¡Œç›¸åº”çš„æœåŠ¡ {"requestId":"dispatch-1755631917550-alkfot1zj"}
[03:31:59.476] info: æ‰§è¡Œä¼˜å…ˆçº§ 1 çš„æœåŠ¡ {"intents":["EXTERNAL_TOOL"],"count":1}
[03:31:59.477] info: å¼€å§‹æ‰§è¡Œå¤–éƒ¨å·¥å…·è°ƒç”¨ {"userInput":"ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ","toolType":"weather","userId":"68a21bf0cdab688c24714231"}
[03:31:59.477] error: å¤–éƒ¨å·¥å…·è°ƒç”¨å¤±è´¥
  {
  "error": "Cannot find module '../../../mcp'\nRequire stack:\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/gaodeMcpClient.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/intelligentDispatchService.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/tests/mcp-integration-test.js",
  "toolType": "weather",
  "userInput": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
}
[03:31:59.478] info: å¤–éƒ¨å·¥å…·è°ƒç”¨å®Œæˆ {"success":false}
[03:31:59.478] info: ä¼˜å…ˆçº§ 1 çš„æœåŠ¡æ‰§è¡Œå®Œæˆ {"results":["externalTool"]}
[03:31:59.478] info: æ‰§è¡Œä¼˜å…ˆçº§ 3 çš„æœåŠ¡ {"intents":["CONVERSATION"],"count":1}
[03:31:59.478] info: å¼€å§‹æ‰§è¡Œå¯¹è¯å¤„ç†
  {
  "userInput": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
  "userId": "68a21bf0cdab688c24714231",
  "sessionId": "test-session-weather",
  "hasPreviousResults": true
}
[03:31:59.478] info: å¼€å§‹å¤„ç†å¯¹è¯ {"userId":"68a21bf0cdab688c24714231","sessionId":"test-session-weather","messageLength":8}
[03:31:59.478] info: å¼€å§‹æ„å›¾è¯†åˆ« ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ... {"userId":"68a21bf0cdab688c24714231"}
[03:31:59.479] info: å¼€å§‹æ„å›¾è¯†åˆ« {"userInput":"ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ","inputLength":8}
[03:31:59.479] info: å‘é€è¯·æ±‚åˆ°é€šä¹‰åƒé—®æ¨¡å‹ {"messagesCount":2,"systemPromptLength":530,"userPromptLength":578}
[03:31:59.479] info: å‡†å¤‡è°ƒç”¨é€šä¹‰åƒé—®API
  {
  "url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",
  "model": "qwen-plus",
  "messagesCount": 2
}
[03:32:01.537] info: é€šä¹‰åƒé—®APIè°ƒç”¨æˆåŠŸ
  {
  "status": 200,
  "usage": {
    "prompt_tokens": 587,
    "completion_tokens": 83,
    "total_tokens": 670,
    "prompt_tokens_details": {
      "cached_tokens": 0
    }
  },
  "model": "qwen-plus"
}
[03:32:01.538] info: æ”¶åˆ°æ¨¡å‹å“åº” {"responseLength":237,"responseTime":"2059ms"}
[03:32:01.538] info: å¼€å§‹è§£ææ¨¡å‹å“åº”
  {
  "responseContent": "{\n  \"intent\": \"EXTERNAL_TOOL\",\n  \"confidence\": 0.95,\n  \"reasoning\": \"ç”¨æˆ·è¯¢é—®å¤©æ°”æƒ…å†µï¼Œéœ€è¦è°ƒç”¨å¤–éƒ¨å¤©æ°”APIè·å–ä¿¡æ¯ã€‚\",\n  \"extracted_info\": {\n    \"keywords\": [\"ä»Šå¤©\", \"å¤©æ°”\"],\n    \"entities\": {\n      \"time\": \"ä»Šå¤©\",\n      \"locati..."
}
[03:32:01.538] info: æ„å›¾è¯†åˆ«ç»“æœè§£ææˆåŠŸ {"intent":"EXTERNAL_TOOL","confidence":0.95,"hasExtractedInfo":true}
[03:32:01.538] info: æ„å›¾è¯†åˆ«å®Œæˆ {"intent":"EXTERNAL_TOOL","confidence":0.95,"processingTime":"2059ms","success":true}
[03:32:01.538] warn: æ¶ˆæ¯æ„å›¾ä¸æ˜¯å¯¹è¯ç±»å‹ {"userId":"68a21bf0cdab688c24714231","intent":"EXTERNAL_TOOL","confidence":0.95}
[03:32:01.538] info: å¯¹è¯å¤„ç†å®Œæˆ {"success":false}
[03:32:01.538] info: ä¼˜å…ˆçº§ 3 çš„æœåŠ¡æ‰§è¡Œå®Œæˆ {"results":["externalTool","conversation"]}
[03:32:01.539] info: æœåŠ¡æ‰§è¡Œå®Œæˆ
  {
  "requestId": "dispatch-1755631917550-alkfot1zj",
  "servicesExecuted": [
    "externalTool",
    "conversation"
  ],
  "successCount": 0
}
[03:32:01.539] info: æ­¥éª¤4: ç”Ÿæˆç»Ÿä¸€å›å¤ {"requestId":"dispatch-1755631917550-alkfot1zj"}
[03:32:01.539] info: å¼€å§‹ç”Ÿæˆç»Ÿä¸€å›å¤
  {
  "userInput": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
  "intentsCount": 2,
  "executionResultsKeys": [
    "externalTool",
    "conversation"
  ],
  "executionResults": {
    "externalTool": {
      "success": false,
      "type": "weather",
      "message": "å¤–éƒ¨å·¥å…·è°ƒç”¨å¤±è´¥: Cannot find module '../../../mcp'\nRequire stack:\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/gaodeMcpClient.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/intelligentDispatchService.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/tests/mcp-integration-test.js",
      "error": "Cannot find module '../../../mcp'\nRequire stack:\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/gaodeMcpClient.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/services/intelligentDispatchService.js\n- /Users/bytedance/Desktop/backend(1) 3/backend/src/AIsiri/tests/mcp-integration-test.js"
    },
    "conversation": {
      "success": false,
      "error": "è¯¥æ¶ˆæ¯ä¸å±äºå¯¹è¯ç±»å‹ï¼Œè¯·ä½¿ç”¨ç›¸åº”çš„åŠŸèƒ½æ¨¡å—å¤„ç†",
      "intent": "EXTERNAL_TOOL",
      "suggestion": "è¯·ä½¿ç”¨ç›¸åº”çš„å·¥å…·åŠŸèƒ½æ¥è·å–å¤–éƒ¨ä¿¡æ¯ï¼ˆå¦‚å¤©æ°”ã€åœ°å›¾ç­‰ï¼‰",
      "emotion": "neutral",
      "weather": null
    }
  }
}
[03:32:01.539] info: è°ƒç”¨é€šä¹‰åƒé—®APIç”Ÿæˆå›åº”
  {
  "model": "qwen-plus",
  "messagesCount": 2,
  "url": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions"
}
[03:32:03.876] info: AIå›åº”ç”ŸæˆæˆåŠŸ
  {
  "status": 200,
  "responseTime": "2337ms",
  "usage": {
    "prompt_tokens": 269,
    "completion_tokens": 53,
    "total_tokens": 322,
    "prompt_tokens_details": {
      "cached_tokens": 0
    }
  },
  "model": "qwen-plus"
}
[03:32:03.877] info: å›å¤ç”Ÿæˆå®Œæˆ {"requestId":"dispatch-1755631917550-alkfot1zj","responseLength":88}
[03:32:03.877] info: æ™ºèƒ½è°ƒåº¦å¤„ç†å®Œæˆ
  {
  "requestId": "dispatch-1755631917550-alkfot1zj",
  "userId": "68a21bf0cdab688c24714231",
  "processingTime": "6327ms",
  "responseLength": 88,
  "servicesExecuted": [
    "externalTool",
    "conversation"
  ]
}
è°ƒåº¦ç»“æœ: {
  success: undefined,
  intents: [ 'EXTERNAL_TOOL', 'CONVERSATION' ],
  servicesExecuted: [ 'externalTool', 'conversation' ],
  hasWeatherInfo: false
}
âš ï¸  å¤©æ°”æŸ¥è¯¢MCPè°ƒç”¨å¤±è´¥
âœ… æµ‹è¯•é€šè¿‡

=== MCPé›†æˆæµ‹è¯•ç»“æœæ±‡æ€» ===
é€šè¿‡: 6/6
æˆåŠŸç‡: 100.0%
ğŸ‰ æ‰€æœ‰MCPé›†æˆæµ‹è¯•éƒ½é€šè¿‡äº†ï¼
MongoDB Disconnected