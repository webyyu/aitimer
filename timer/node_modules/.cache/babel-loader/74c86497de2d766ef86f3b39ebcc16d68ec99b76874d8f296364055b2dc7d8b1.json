{"ast":null,"code":"import { ref, onMounted } from 'vue';\nimport aivoiceAPI from '@/api/aivoice.js';\nexport default {\n  __name: 'VoiceManagerModal',\n  props: {\n    userId: {\n      type: String,\n      required: true\n    }\n  },\n  emits: ['close'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n\n    /* global defineEmits, defineProps */\n    const emit = __emit;\n    const props = __props;\n    const loading = ref(false);\n    const error = ref('');\n    const voiceGroups = ref([]);\n    const cacheBuster = ref(0);\n    const retryCount = ref({\n      encourage: 0,\n      criticize: 0\n    });\n    function close() {\n      emit('close');\n    }\n    function toHttps(url) {\n      if (!url) return url;\n      return url.startsWith('http://') ? 'https://' + url.slice('http://'.length) : url;\n    }\n    function withBuster(url) {\n      if (!url) return url;\n      const sep = url.includes('?') ? '&' : '?';\n      return `${url}${sep}v=${cacheBuster.value}`;\n    }\n    function onAudioError(kind) {\n      if (!retryCount.value[kind]) retryCount.value[kind] = 0;\n      if (retryCount.value[kind] >= 3) return;\n      retryCount.value[kind] += 1;\n      cacheBuster.value = Date.now();\n    }\n    function formatTime(value) {\n      try {\n        return new Date(value).toLocaleString();\n      } catch (_) {\n        return String(value || '');\n      }\n    }\n    async function refresh() {\n      loading.value = true;\n      error.value = '';\n      try {\n        const res = await aivoiceAPI.getBindStatus(props.userId);\n        if (res?.binded === false) {\n          voiceGroups.value = [];\n        } else {\n          voiceGroups.value = Array.isArray(res?.voice_groups) ? res.voice_groups : [];\n        }\n        cacheBuster.value = Date.now();\n      } catch (e) {\n        error.value = e?.message || 'Âä†ËΩΩÂ§±Ë¥•';\n      } finally {\n        loading.value = false;\n      }\n    }\n    async function onDelete(idx) {\n      if (loading.value) return;\n      const ok = window.confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏ÄÁªÑËØ≠Èü≥ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ');\n      if (!ok) return;\n      loading.value = true;\n      error.value = '';\n      try {\n        // Êé•Âè£Á∫¶ÂÆöÊåâÁ¥¢ÂºïÂà†Èô§‰∏∫ 0 Âü∫Á¥¢Âºï\n        await aivoiceAPI.deleteVoiceGroupByIndex(props.userId, idx);\n        await refresh();\n      } catch (e) {\n        error.value = e?.message || 'Âà†Èô§Â§±Ë¥•';\n      } finally {\n        loading.value = false;\n      }\n    }\n    onMounted(refresh);\n    const __returned__ = {\n      emit,\n      props,\n      loading,\n      error,\n      voiceGroups,\n      cacheBuster,\n      retryCount,\n      close,\n      toHttps,\n      withBuster,\n      onAudioError,\n      formatTime,\n      refresh,\n      onDelete,\n      ref,\n      onMounted,\n      get aivoiceAPI() {\n        return aivoiceAPI;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","aivoiceAPI","emit","__emit","props","__props","loading","error","voiceGroups","cacheBuster","retryCount","encourage","criticize","close","toHttps","url","startsWith","slice","length","withBuster","sep","includes","value","onAudioError","kind","Date","now","formatTime","toLocaleString","_","String","refresh","res","getBindStatus","userId","binded","Array","isArray","voice_groups","e","message","onDelete","idx","ok","window","confirm","deleteVoiceGroupByIndex"],"sources":["C:/Users/wuby/OneDrive/Desktop/backend(1) 3/timer/src/components/aivoice/VoiceManagerModal.vue"],"sourcesContent":["<template>\n  <div class=\"modal-overlay vm-overlay\" @click.self=\"close\">\n    <div class=\"modal-container vm-content\" style=\"max-width: 560px;\">\n      <header class=\"modal-header\">\n        <h2 class=\"modal-title\">ÊàëÁöÑËØ≠Èü≥</h2>\n        <div class=\"header-actions\">\n          <button class=\"icon-button\" title=\"Âà∑Êñ∞\" @click=\"refresh\" :disabled=\"loading\">‚ü≥</button>\n          <button class=\"icon-button\" title=\"ÂÖ≥Èó≠\" @click=\"close\">‚úï</button>\n        </div>\n      </header>\n      <main class=\"modal-body list-body\">\n        <div v-if=\"error\" class=\"error-state\">\n          <i class=\"fa-regular fa-circle-xmark\" style=\"font-style: normal; font-size: 32px; color: #ef4444;\">!</i>\n          <p>{{ error }}</p>\n          <button class=\"btn btn-secondary\" @click=\"refresh\" :disabled=\"loading\">ÈáçËØï</button>\n        </div>\n        <div v-else-if=\"!voiceGroups.length && !loading\" class=\"empty-state\">\n          <i class=\"fa-regular fa-folder-open\" style=\"font-style: normal; font-size: 48px; color: #E5E7EB;\">üìÅ</i>\n          <p>ÊöÇÊó†ÂéÜÂè≤ËØ≠Èü≥</p>\n          <span>ÂéªÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑËØ≠Èü≥Èô™‰º¥Âêß</span>\n        </div>\n        <div v-else class=\"vm-list\">\n          <div v-for=\"(g, idx) in voiceGroups\" :key=\"idx\" class=\"list-card\">\n            <div class=\"card-header\">\n              <h3>Á¨¨ {{ voiceGroups.length - idx }} ÁªÑ</h3>\n              <span>ÂàõÂª∫‰∫é: {{ formatTime(g.createdAt) }}</span>\n            </div>\n            <div class=\"card-content\">\n              <div class=\"audio-row\">\n                <span>ÈºìÂä±</span>\n                <div class=\"audio-player\">\n                  <audio v-if=\"g.encourage_url\" :src=\"withBuster(toHttps(g.encourage_url))\" controls @error=\"onAudioError('encourage')\" />\n                  <span v-else class=\"no-audio\">Êó†Èü≥È¢ë</span>\n                </div>\n              </div>\n              <div class=\"audio-row\">\n                <span>ÊâπËØÑ</span>\n                <div class=\"audio-player\">\n                  <audio v-if=\"g.criticize_url\" :src=\"withBuster(toHttps(g.criticize_url))\" controls @error=\"onAudioError('criticize')\" />\n                  <span v-else class=\"no-audio\">Êó†Èü≥È¢ë</span>\n                </div>\n              </div>\n            </div>\n            <div class=\"card-footer\">\n              <button class=\"btn-delete\" @click=\"onDelete(idx)\">Âà†Èô§Ëøô‰∏ÄÁªÑ</button>\n            </div>\n          </div>\n        </div>\n      </main>\n    </div>\n  </div>\n</template>\n\n<script setup>\n/* global defineEmits, defineProps */\nimport { ref, onMounted } from 'vue'\nimport aivoiceAPI from '@/api/aivoice.js'\nconst emit = defineEmits(['close'])\nconst props = defineProps({\n  userId: { type: String, required: true }\n})\nconst loading = ref(false)\nconst error = ref('')\nconst voiceGroups = ref([])\nconst cacheBuster = ref(0)\nconst retryCount = ref({ encourage: 0, criticize: 0 })\n\nfunction close() { emit('close') }\nfunction toHttps(url) { if (!url) return url; return url.startsWith('http://') ? 'https://' + url.slice('http://'.length) : url }\nfunction withBuster(url) { if (!url) return url; const sep = url.includes('?') ? '&' : '?'; return `${url}${sep}v=${cacheBuster.value}` }\nfunction onAudioError(kind) {\n  if (!retryCount.value[kind]) retryCount.value[kind] = 0\n  if (retryCount.value[kind] >= 3) return\n  retryCount.value[kind] += 1\n  cacheBuster.value = Date.now()\n}\nfunction formatTime(value) { try { return new Date(value).toLocaleString() } catch (_) { return String(value || '') } }\n\nasync function refresh() {\n  loading.value = true\n  error.value = ''\n  try {\n    const res = await aivoiceAPI.getBindStatus(props.userId)\n    if (res?.binded === false) {\n      voiceGroups.value = []\n    } else {\n      voiceGroups.value = Array.isArray(res?.voice_groups) ? res.voice_groups : []\n    }\n    cacheBuster.value = Date.now()\n  } catch (e) {\n    error.value = e?.message || 'Âä†ËΩΩÂ§±Ë¥•'\n  } finally {\n    loading.value = false\n  }\n}\n\nasync function onDelete(idx) {\n  if (loading.value) return\n  const ok = window.confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏ÄÁªÑËØ≠Èü≥ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ')\n  if (!ok) return\n  loading.value = true\n  error.value = ''\n  try {\n    // Êé•Âè£Á∫¶ÂÆöÊåâÁ¥¢ÂºïÂà†Èô§‰∏∫ 0 Âü∫Á¥¢Âºï\n    await aivoiceAPI.deleteVoiceGroupByIndex(props.userId, idx)\n    await refresh()\n  } catch (e) {\n    error.value = e?.message || 'Âà†Èô§Â§±Ë¥•'\n  } finally {\n    loading.value = false\n  }\n}\n\nonMounted(refresh)\n</script>\n\n<style scoped>\n:root { --color-primary: #4F46E5; --color-bg: #F8F9FA; --color-surface: #FFFFFF; --color-text-primary: #111827; --color-text-secondary: #374151; --color-text-tertiary: #6B7280; --color-border: #E5E7EB; --radius-lg: 16px; --radius-md: 12px; --radius-full: 999px; }\n.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 2100; padding: 16px; }\n.modal-container { background: #ffffff; border-radius: 18px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); width: 100%; display: flex; flex-direction: column; position: relative; overflow: hidden; max-height: 90vh; }\n.modal-header { padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-border); }\n.modal-title { font-size: 20px; font-weight: 800; color: var(--color-text-primary); margin: 0; display: flex; align-items: center; gap: 8px; }\n.header-actions { display: flex; gap: 12px; }\n.icon-button { background: #F3F4F6; border: none; font-size: 16px; color: #6b7280; cursor: pointer; padding: 8px; border-radius: 10px; width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center; }\n.icon-button:hover { background-color: #E5E7EB; }\n.modal-body { padding: 16px; overflow-y: auto; background: #ffffff; }\n.list-body { background-color: #ffffff; }\n\n/* ÂàóË°®Âç°Áâá */\n.vm-list { display: flex; flex-direction: column; gap: 16px; max-height: 60vh; overflow-y: auto; }\n.list-card { background: #fff; border-radius: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.06); overflow: hidden; }\n.card-header { padding: 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-border); }\n.card-header h3 { margin: 0; font-size: 18px; color: var(--color-text-primary); font-weight: 800; }\n.card-header span { font-size: 12px; color: var(--color-text-tertiary); }\n.card-content { padding: 16px; display: flex; flex-direction: column; gap: 16px; }\n.audio-row { display: flex; align-items: center; justify-content: space-between; }\n.audio-row > span { font-weight: 700; color: var(--color-text-secondary); }\n.audio-player { display: flex; align-items: center; gap: 12px; min-width: 200px; }\n.audio-player audio { width: 260px; height: 36px; }\n.no-audio { color: var(--color-text-tertiary); font-style: italic; font-size: 13px; }\n.card-footer { padding: 10px 16px; text-align: right; border-top: 1px solid var(--color-border); }\n.btn-delete { background: none; border: none; color: #ef4444; font-size: 14px; font-weight: 700; cursor: pointer; padding: 6px 10px; border-radius: 8px; }\n.btn-delete:hover { background: #fee2e2; }\n\n/* Á©∫‰∏éÈîôËØØÁä∂ÊÄÅ */\n.empty-state, .error-state { text-align: center; padding: 48px 24px; }\n.empty-state p, .error-state p { font-size: 16px; font-weight: 700; color: var(--color-text-primary); margin: 8px 0; }\n.empty-state span, .error-state span { font-size: 14px; color: var(--color-text-tertiary); }\n\n/* ÈÄöÁî®ÊåâÈíÆ */\n.btn { height: 44px; padding: 0 18px; border: none; border-radius: 12px; font-size: 15px; font-weight: 700; cursor: pointer; }\n.btn-secondary { background: #E9EEF5; color: var(--color-text-primary); }\n.btn-secondary:hover { background: #E2E8F0; }\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}