{"ast":null,"code":"import { withModifiers as _withModifiers, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createTextVNode as _createTextVNode, normalizeClass as _normalizeClass, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"modal-container ai-voice-modal-content\",\n  style: {\n    \"max-width\": \"420px\",\n    \"border-radius\": \"36px\",\n    \"overflow\": \"hidden\"\n  }\n};\nconst _hoisted_2 = {\n  class: \"modal-header\"\n};\nconst _hoisted_3 = {\n  class: \"modal-title\"\n};\nconst _hoisted_4 = {\n  width: \"18\",\n  height: \"18\",\n  viewBox: \"0 0 24 24\",\n  fill: \"none\",\n  style: {\n    \"vertical-align\": \"middle\"\n  }\n};\nconst _hoisted_5 = {\n  class: \"modal-body\"\n};\nconst _hoisted_6 = {\n  class: \"segmented-control\"\n};\nconst _hoisted_7 = {\n  key: 0,\n  class: \"form-section\"\n};\nconst _hoisted_8 = {\n  class: \"form-group\"\n};\nconst _hoisted_9 = {\n  class: \"form-group\"\n};\nconst _hoisted_10 = {\n  class: \"chip-group\"\n};\nconst _hoisted_11 = [\"onClick\"];\nconst _hoisted_12 = {\n  class: \"form-group\"\n};\nconst _hoisted_13 = {\n  class: \"chip-group\"\n};\nconst _hoisted_14 = [\"onClick\"];\nconst _hoisted_15 = {\n  class: \"form-group\"\n};\nconst _hoisted_16 = {\n  class: \"form-group\"\n};\nconst _hoisted_17 = {\n  key: 1,\n  class: \"form-section\"\n};\nconst _hoisted_18 = {\n  class: \"form-group\"\n};\nconst _hoisted_19 = {\n  class: \"form-group\"\n};\nconst _hoisted_20 = {\n  key: 2,\n  class: \"result-section\"\n};\nconst _hoisted_21 = {\n  key: 0,\n  class: \"audio-card\"\n};\nconst _hoisted_22 = {\n  class: \"audio-player\"\n};\nconst _hoisted_23 = [\"src\"];\nconst _hoisted_24 = {\n  key: 1,\n  class: \"audio-card\"\n};\nconst _hoisted_25 = {\n  class: \"audio-player\"\n};\nconst _hoisted_26 = [\"src\"];\nconst _hoisted_27 = {\n  key: 3,\n  class: \"form-error\"\n};\nconst _hoisted_28 = {\n  class: \"modal-footer\"\n};\nconst _hoisted_29 = [\"disabled\"];\nconst _hoisted_30 = [\"disabled\"];\nconst _hoisted_31 = {\n  key: 0,\n  class: \"loading-overlay\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", {\n    class: \"modal-overlay ai-voice-modal-overlay\",\n    onClick: _withModifiers($setup.close, [\"self\"])\n  }, [_createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"header\", _hoisted_2, [_createElementVNode(\"a\", {\n    href: \"#\",\n    class: \"header-link\",\n    onClick: _withModifiers($setup.openManager, [\"prevent\"])\n  }, \"管理已有语音\"), _createElementVNode(\"h2\", _hoisted_3, [(_openBlock(), _createElementBlock(\"svg\", _hoisted_4, _cache[10] || (_cache[10] = [_createElementVNode(\"path\", {\n    d: \"M12 3a3 3 0 0 1 3 3v5a3 3 0 1 1-6 0V6a3 3 0 0 1 3-3z\",\n    fill: \"#4F46E5\"\n  }, null, -1 /* CACHED */), _createElementVNode(\"path\", {\n    d: \"M5 11a1 1 0 0 1 2 0v1a5 5 0 1 0 10 0v-1a1 1 0 1 1 2 0v1a7 7 0 0 1-6 6.93V21a1 1 0 1 1-2 0v-2.07A7 7 0 0 1 5 12v-1z\",\n    fill: \"#818CF8\"\n  }, null, -1 /* CACHED */)]))), _cache[11] || (_cache[11] = _createTextVNode(\" AI语音陪伴设置 \", -1 /* CACHED */))]), _createElementVNode(\"button\", {\n    class: \"icon-button\",\n    onClick: $setup.close,\n    title: \"关闭\"\n  }, \"✕\")]), _createElementVNode(\"main\", _hoisted_5, [_createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"button\", {\n    class: _normalizeClass({\n      active: $setup.mode === 'ai'\n    }),\n    onClick: _cache[0] || (_cache[0] = $event => $setup.mode = 'ai')\n  }, \"AI生成文本\", 2 /* CLASS */), _createElementVNode(\"button\", {\n    class: _normalizeClass({\n      active: $setup.mode === 'custom'\n    }),\n    onClick: _cache[1] || (_cache[1] = $event => $setup.mode = 'custom')\n  }, \"自定义文本\", 2 /* CLASS */)]), $setup.mode === 'ai' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [!$setup.aiGenerated ? (_openBlock(), _createElementBlock(_Fragment, {\n    key: 0\n  }, [_createElementVNode(\"div\", _hoisted_8, [_cache[12] || (_cache[12] = _createElementVNode(\"label\", null, \"模仿对象\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.mimicTarget = $event),\n    type: \"text\",\n    placeholder: \"例如：一位严厉的健身教练\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.mimicTarget]])]), _createElementVNode(\"div\", _hoisted_9, [_cache[13] || (_cache[13] = _createElementVNode(\"label\", null, \"鼓励风格\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_10, [(_openBlock(), _createElementBlock(_Fragment, null, _renderList($setup.encourageStyles, style => {\n    return _createElementVNode(\"button\", {\n      key: style,\n      class: _normalizeClass([\"chip\", {\n        active: $setup.encourageStyle === style\n      }]),\n      onClick: $event => $setup.encourageStyle = style\n    }, _toDisplayString(style), 11 /* TEXT, CLASS, PROPS */, _hoisted_11);\n  }), 64 /* STABLE_FRAGMENT */))])]), _createElementVNode(\"div\", _hoisted_12, [_cache[14] || (_cache[14] = _createElementVNode(\"label\", null, \"批评风格\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_13, [(_openBlock(), _createElementBlock(_Fragment, null, _renderList($setup.criticizeStyles, style => {\n    return _createElementVNode(\"button\", {\n      key: style,\n      class: _normalizeClass([\"chip\", {\n        active: $setup.criticizeStyle === style\n      }]),\n      onClick: $event => $setup.criticizeStyle = style\n    }, _toDisplayString(style), 11 /* TEXT, CLASS, PROPS */, _hoisted_14);\n  }), 64 /* STABLE_FRAGMENT */))])])], 64 /* STABLE_FRAGMENT */)) : (_openBlock(), _createElementBlock(_Fragment, {\n    key: 1\n  }, [_createElementVNode(\"div\", _hoisted_15, [_cache[15] || (_cache[15] = _createElementVNode(\"label\", null, \"鼓励文本\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"textarea\", {\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $setup.encourageText = $event),\n    rows: \"3\",\n    placeholder: \"AI生成的鼓励语音内容\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.encourageText]]), _cache[16] || (_cache[16] = _createElementVNode(\"span\", {\n    class: \"ai-tag\"\n  }, \"AI智能生成，可修改\", -1 /* CACHED */))]), _createElementVNode(\"div\", _hoisted_16, [_cache[17] || (_cache[17] = _createElementVNode(\"label\", null, \"批评文本\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"textarea\", {\n    \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => $setup.criticizeText = $event),\n    rows: \"3\",\n    placeholder: \"AI生成的批评语音内容\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.criticizeText]]), _cache[18] || (_cache[18] = _createElementVNode(\"span\", {\n    class: \"ai-tag\"\n  }, \"AI智能生成，可修改\", -1 /* CACHED */))])], 64 /* STABLE_FRAGMENT */))])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_17, [_createElementVNode(\"div\", _hoisted_18, [_cache[19] || (_cache[19] = _createElementVNode(\"label\", null, \"鼓励文本\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"textarea\", {\n    \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => $setup.encourageText = $event),\n    rows: \"3\",\n    placeholder: \"请输入鼓励语音内容\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.encourageText]])]), _createElementVNode(\"div\", _hoisted_19, [_cache[20] || (_cache[20] = _createElementVNode(\"label\", null, \"批评文本\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"textarea\", {\n    \"onUpdate:modelValue\": _cache[6] || (_cache[6] = $event => $setup.criticizeText = $event),\n    rows: \"3\",\n    placeholder: \"请输入批评语音内容\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.criticizeText]])])])), $setup.audioUrls.encourage || $setup.audioUrls.criticize ? (_openBlock(), _createElementBlock(\"div\", _hoisted_20, [$setup.audioUrls.encourage ? (_openBlock(), _createElementBlock(\"div\", _hoisted_21, [_cache[21] || (_cache[21] = _createElementVNode(\"span\", {\n    class: \"audio-label\"\n  }, \"鼓励音频\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_22, [_createElementVNode(\"audio\", {\n    src: $setup.withBuster($setup.audioUrls.encourage),\n    controls: \"\",\n    onError: _cache[7] || (_cache[7] = $event => $setup.onAudioError('encourage'))\n  }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_23)])])) : _createCommentVNode(\"v-if\", true), $setup.audioUrls.criticize ? (_openBlock(), _createElementBlock(\"div\", _hoisted_24, [_cache[22] || (_cache[22] = _createElementVNode(\"span\", {\n    class: \"audio-label\"\n  }, \"批评音频\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_25, [_createElementVNode(\"audio\", {\n    src: $setup.withBuster($setup.audioUrls.criticize),\n    controls: \"\",\n    onError: _cache[8] || (_cache[8] = $event => $setup.onAudioError('criticize'))\n  }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_26)])])) : _createCommentVNode(\"v-if\", true)])) : _createCommentVNode(\"v-if\", true), $setup.errorMsg ? (_openBlock(), _createElementBlock(\"p\", _hoisted_27, _toDisplayString($setup.errorMsg), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"footer\", _hoisted_28, [_createElementVNode(\"button\", {\n    class: \"btn btn-secondary\",\n    onClick: $setup.close\n  }, \"关闭\"), $setup.audioUrls.encourage || $setup.audioUrls.criticize ? (_openBlock(), _createElementBlock(\"button\", {\n    key: 0,\n    class: \"btn btn-primary\",\n    onClick: $setup.applyVoice,\n    disabled: $setup.loading\n  }, \"应用语音\", 8 /* PROPS */, _hoisted_29)) : (_openBlock(), _createElementBlock(\"button\", {\n    key: 1,\n    class: \"btn btn-primary\",\n    onClick: $setup.synthesizeVoice,\n    disabled: $setup.loading || $setup.mode === 'custom' && (!$setup.encourageText || !$setup.criticizeText) || $setup.mode === 'ai' && $setup.loading\n  }, _toDisplayString($setup.mode === 'ai' ? $setup.aiGenerated ? $setup.loading ? '合成中...' : '合成语音' : $setup.loading ? '生成中...' : '生成文本' : $setup.loading ? '合成中...' : '合成语音'), 9 /* TEXT, PROPS */, _hoisted_30))]), $setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_31, _cache[23] || (_cache[23] = [_createElementVNode(\"div\", {\n    class: \"spinner\"\n  }, null, -1 /* CACHED */), _createElementVNode(\"p\", null, \"请等待片刻，正在处理...\", -1 /* CACHED */)]))) : _createCommentVNode(\"v-if\", true), $setup.showVoiceManager ? (_openBlock(), _createBlock($setup[\"VoiceManagerModal\"], {\n    key: 1,\n    userId: $setup.resolveUserId(),\n    onClose: _cache[9] || (_cache[9] = $event => $setup.showVoiceManager = false)\n  }, null, 8 /* PROPS */, [\"userId\"])) : _createCommentVNode(\"v-if\", true)])]);\n}","map":{"version":3,"names":["class","style","width","height","viewBox","fill","_createElementBlock","onClick","_withModifiers","$setup","close","_createElementVNode","_hoisted_1","_hoisted_2","href","openManager","_hoisted_3","_hoisted_4","_cache","d","title","_hoisted_5","_hoisted_6","_normalizeClass","active","mode","$event","_hoisted_7","aiGenerated","_Fragment","key","_hoisted_8","mimicTarget","type","placeholder","_hoisted_9","_hoisted_10","_renderList","encourageStyles","encourageStyle","_hoisted_11","_hoisted_12","_hoisted_13","criticizeStyles","criticizeStyle","_hoisted_14","_hoisted_15","encourageText","rows","_hoisted_16","criticizeText","_hoisted_17","_hoisted_18","_hoisted_19","audioUrls","encourage","criticize","_hoisted_20","_hoisted_21","_hoisted_22","src","withBuster","controls","onError","onAudioError","_hoisted_24","_hoisted_25","errorMsg","_hoisted_27","_toDisplayString","_hoisted_28","applyVoice","disabled","loading","_hoisted_29","synthesizeVoice","_hoisted_30","_hoisted_31","showVoiceManager","_createBlock","userId","resolveUserId","onClose"],"sources":["C:\\Users\\wuby\\OneDrive\\Desktop\\已完成\\ai秘书\\backup\\timer\\src\\components\\aivoice\\AIVoiceModal.vue"],"sourcesContent":["<template>\n  <div class=\"modal-overlay ai-voice-modal-overlay\" @click.self=\"close\">\n    <div class=\"modal-container ai-voice-modal-content\" style=\"max-width: 420px; border-radius: 36px; overflow: hidden;\">\n      <header class=\"modal-header\">\n        <a href=\"#\" class=\"header-link\" @click.prevent=\"openManager\">管理已有语音</a>\n        <h2 class=\"modal-title\">\n          <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" style=\"vertical-align: middle\"><path d=\"M12 3a3 3 0 0 1 3 3v5a3 3 0 1 1-6 0V6a3 3 0 0 1 3-3z\" fill=\"#4F46E5\"/><path d=\"M5 11a1 1 0 0 1 2 0v1a5 5 0 1 0 10 0v-1a1 1 0 1 1 2 0v1a7 7 0 0 1-6 6.93V21a1 1 0 1 1-2 0v-2.07A7 7 0 0 1 5 12v-1z\" fill=\"#818CF8\"/></svg>\n          AI语音陪伴设置\n        </h2>\n        <button class=\"icon-button\" @click=\"close\" title=\"关闭\">✕</button>\n      </header>\n      <main class=\"modal-body\">\n        <div class=\"segmented-control\">\n          <button :class=\"{ active: mode==='ai' }\" @click=\"mode='ai'\">AI生成文本</button>\n          <button :class=\"{ active: mode==='custom' }\" @click=\"mode='custom'\">自定义文本</button>\n        </div>\n\n        <div class=\"form-section\" v-if=\"mode==='ai'\">\n          <template v-if=\"!aiGenerated\">\n          <div class=\"form-group\">\n            <label>模仿对象</label>\n              <input v-model=\"mimicTarget\" type=\"text\" placeholder=\"例如：一位严厉的健身教练\" />\n          </div>\n          <div class=\"form-group\">\n            <label>鼓励风格</label>\n              <div class=\"chip-group\">\n                <button v-for=\"style in encourageStyles\" :key=\"style\" class=\"chip\" :class=\"{ active: encourageStyle===style }\" @click=\"encourageStyle=style\">{{ style }}</button>\n              </div>\n            </div>\n            <div class=\"form-group\">\n              <label>批评风格</label>\n              <div class=\"chip-group\">\n                <button v-for=\"style in criticizeStyles\" :key=\"style\" class=\"chip\" :class=\"{ active: criticizeStyle===style }\" @click=\"criticizeStyle=style\">{{ style }}</button>\n              </div>\n            </div>\n          </template>\n          <template v-else>\n            <div class=\"form-group\">\n              <label>鼓励文本</label>\n              <textarea v-model=\"encourageText\" rows=\"3\" placeholder=\"AI生成的鼓励语音内容\"></textarea>\n              <span class=\"ai-tag\">AI智能生成，可修改</span>\n          </div>\n          <div class=\"form-group\">\n              <label>批评文本</label>\n              <textarea v-model=\"criticizeText\" rows=\"3\" placeholder=\"AI生成的批评语音内容\"></textarea>\n              <span class=\"ai-tag\">AI智能生成，可修改</span>\n            </div>\n          </template>\n        </div>\n\n        <div class=\"form-section\" v-else>\n          <div class=\"form-group\">\n            <label>鼓励文本</label>\n            <textarea v-model=\"encourageText\" rows=\"3\" placeholder=\"请输入鼓励语音内容\"></textarea>\n          </div>\n          <div class=\"form-group\">\n            <label>批评文本</label>\n            <textarea v-model=\"criticizeText\" rows=\"3\" placeholder=\"请输入批评语音内容\"></textarea>\n          </div>\n        </div>\n\n        <div v-if=\"audioUrls.encourage || audioUrls.criticize\" class=\"result-section\">\n          <div v-if=\"audioUrls.encourage\" class=\"audio-card\">\n            <span class=\"audio-label\">鼓励音频</span>\n            <div class=\"audio-player\">\n              <audio :src=\"withBuster(audioUrls.encourage)\" controls @error=\"onAudioError('encourage')\" />\n            </div>\n          </div>\n          <div v-if=\"audioUrls.criticize\" class=\"audio-card\">\n            <span class=\"audio-label\">批评音频</span>\n            <div class=\"audio-player\">\n              <audio :src=\"withBuster(audioUrls.criticize)\" controls @error=\"onAudioError('criticize')\" />\n            </div>\n        </div>\n        </div>\n\n        <p v-if=\"errorMsg\" class=\"form-error\">{{ errorMsg }}</p>\n      </main>\n      <footer class=\"modal-footer\">\n        <button class=\"btn btn-secondary\" @click=\"close\">关闭</button>\n        <button\n          v-if=\"audioUrls.encourage || audioUrls.criticize\"\n          class=\"btn btn-primary\"\n          @click=\"applyVoice\"\n          :disabled=\"loading\"\n        >应用语音</button>\n        <button\n          v-else\n          class=\"btn btn-primary\"\n          @click=\"synthesizeVoice\"\n          :disabled=\"loading || (mode==='custom' && (!encourageText || !criticizeText)) || (mode==='ai' && loading)\"\n        >{{\n            mode === 'ai'\n              ? (aiGenerated ? (loading ? '合成中...' : '合成语音') : (loading ? '生成中...' : '生成文本'))\n              : (loading ? '合成中...' : '合成语音')\n        }}</button>\n      </footer>\n\n      <div v-if=\"loading\" class=\"loading-overlay\">\n        <div class=\"spinner\"></div>\n        <p>请等待片刻，正在处理...</p>\n      </div>\n\n      <VoiceManagerModal v-if=\"showVoiceManager\" :userId=\"resolveUserId()\" @close=\"showVoiceManager=false\" />\n    </div>\n  </div>\n</template>\n\n<script setup>\n/* global defineEmits, defineProps */\nimport { ref, watch } from 'vue';\nimport aivoiceAPI from '@/api/aivoice.js'\nimport VoiceManagerModal from './VoiceManagerModal.vue'\nconst emit = defineEmits(['close', 'apply-voice']);\nconst props = defineProps({\n  userId: { type: String, default: '' }\n});\n// 避免未使用告警\nvoid props.userId;\nconst mode = ref('ai');\nconst mimicTarget = ref('');\nconst encourageStyles = ['温柔', '热情', '专业', '调侃'];\nconst criticizeStyles = ['委婉', '严厉', '专业', '调侃'];\nconst encourageStyle = ref(encourageStyles[0]);\nconst criticizeStyle = ref(criticizeStyles[0]);\nconst encourageText = ref('');\nconst criticizeText = ref('');\nconst loading = ref(false);\nconst errorMsg = ref('');\nconst audioUrls = ref({ encourage: '', criticize: '' });\nconst aiGenerated = ref(false);\nconst cacheBuster = ref(0);\nconst retryCount = ref({ encourage: 0, criticize: 0 });\nconst showVoiceManager = ref(false);\n\nfunction close() {\n  if (loading.value) return;\n  emit('close');\n}\nfunction openManager() { showVoiceManager.value = true }\nfunction resolveUserId() {\n  if (props.userId) return props.userId\n  try {\n    const user = JSON.parse(localStorage.getItem('user') || 'null')\n    return user?._id || user?.id || localStorage.getItem('userId') || ''\n  } catch (_) {\n    return localStorage.getItem('userId') || ''\n  }\n}\nfunction toHttps(url) {\n  if (!url) return url\n  if (url.startsWith('http://')) return 'https://' + url.slice('http://'.length)\n  return url\n}\nfunction withBuster(url) {\n  if (!url) return url\n  const sep = url.includes('?') ? '&' : '?'\n  return `${url}${sep}v=${cacheBuster.value}`\n}\nfunction onAudioError(kind) {\n  if (!retryCount.value[kind]) retryCount.value[kind] = 0\n  if (retryCount.value[kind] >= 3) return\n  retryCount.value[kind] += 1\n  cacheBuster.value = Date.now()\n}\n// 已移除跨域可用性轮询，避免触发 CORS 报错\nasync function synthesizeVoice() {\n  if (mode.value === 'custom' && (!encourageText.value || !criticizeText.value)) {\n    errorMsg.value = '请填写完整文本';\n    return;\n  }\n  if (mode.value === 'ai' && !aiGenerated.value) {\n    // 改为真实调用 imitate-text\n    loading.value = true;\n    errorMsg.value = '';\n    try {\n      const res = await aivoiceAPI.imitateText(mimicTarget.value || '默认', encourageStyle.value, criticizeStyle.value)\n      encourageText.value = res?.data?.encourage || res?.encourage || ''\n      criticizeText.value = res?.data?.criticize || res?.criticize || ''\n      if (!encourageText.value || !criticizeText.value) throw new Error('AI文本生成失败')\n      aiGenerated.value = true;\n      loading.value = false;\n    } catch (err) {\n      loading.value = false;\n      errorMsg.value = err?.message || 'AI文本生成失败';\n    }\n    return;\n  }\n  // 第二次点击或自定义模式：调用后端合成\n  if (!encourageText.value || !criticizeText.value) {\n    errorMsg.value = '请填写完整文本';\n    return;\n  }\n  const userId = resolveUserId()\n  if (!userId) {\n    errorMsg.value = '未登录或缺少用户标识，请先登录';\n    return;\n  }\n  loading.value = true;\n  errorMsg.value = '';\n  audioUrls.value = { encourage: '', criticize: '' };\n  retryCount.value = { encourage: 0, criticize: 0 }\n  try {\n    const res = await aivoiceAPI.synthesizeVoice(userId, encourageText.value, criticizeText.value)\n    const encUrl = toHttps(res?.data?.encourage_url || res?.encourage_url || '')\n    const criUrl = toHttps(res?.data?.criticize_url || res?.criticize_url || '')\n    audioUrls.value.encourage = encUrl\n    audioUrls.value.criticize = criUrl\n    cacheBuster.value = Date.now()\n    aiGenerated.value = false;\n    loading.value = false;\n    if (!audioUrls.value.encourage && !audioUrls.value.criticize) {\n      throw new Error('未返回音频链接');\n    }\n  } catch (err) {\n    loading.value = false;\n    errorMsg.value = err?.message || '合成失败，请稍后重试';\n  }\n}\nfunction applyVoice() {\n  emit('apply-voice');\n  close();\n}\nwatch(() => mode.value, () => {\n  aiGenerated.value = false;\n  errorMsg.value = '';\n  encourageText.value = '';\n  criticizeText.value = '';\n  audioUrls.value = { encourage: '', criticize: '' };\n});\n</script>\n\n<style scoped>\n/* 设计色板与基础变量（局部作用域） */\n:root { --color-primary: #4F46E5; --color-bg: #F8F9FA; --color-surface: #FFFFFF; --color-text-primary: #111827; --color-text-secondary: #374151; --color-text-tertiary: #6B7280; --color-border: #E5E7EB; --radius-lg: 36px; --radius-md: 12px; --radius-full: 999px; }\n\n.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 2000; padding: 16px; }\n.modal-container { background: #ffffff; border-radius: var(--radius-lg); box-shadow: 0 16px 40px rgba(17,24,39,0.18); width: 100%; display: flex; flex-direction: column; position: relative; overflow: hidden; animation: fadeIn 0.3s ease; max-height: 90vh; }\n@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }\n\n.modal-header { padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-border); }\n.modal-title { font-size: 18px; font-weight: 600; color: var(--color-text-primary); margin: 0; display: flex; align-items: center; gap: 8px; }\n.header-link { font-size: 14px; color: var(--color-primary); text-decoration: none; font-weight: 500; }\n.icon-button { background: none; border: none; font-size: 18px; color: var(--color-text-tertiary); cursor: pointer; padding: 6px; border-radius: var(--radius-full); width: 32px; height: 32px; display: inline-flex; align-items: center; justify-content: center; }\n.icon-button:hover { background-color: var(--color-bg); }\n\n.modal-body { padding: 24px; overflow-y: auto; background: #ffffff; }\n.modal-footer { padding: 16px 24px; display: flex; justify-content: flex-end; gap: 12px; border-top: 1px solid var(--color-border); }\n\n/* 按钮样式（按截图） */\n.btn { height: 46px; padding: 0 26px; border: none; border-radius: 14px; font-size: 16px; font-weight: 800; cursor: pointer; transition: transform .12s ease, box-shadow .12s ease, background .2s ease; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }\n.btn:active { transform: translateY(0); }\n.btn-primary { background: linear-gradient(90deg,#6C4FE5,#8A8FF8); color: #fff; box-shadow: 0 12px 30px rgba(108,79,229,0.35); }\n.btn-primary:hover { background: linear-gradient(90deg,#5d45d1,#7f87ff); box-shadow: 0 14px 36px rgba(108,79,229,0.42); }\n.btn-primary:disabled { background: #C7C9FF; color: #fff; cursor: not-allowed; box-shadow: none; }\n.btn-secondary { background: #E9EEF5; color: var(--color-text-primary); box-shadow: inset 0 -1px 0 rgba(0,0,0,0.02); }\n.btn-secondary:hover { background: #E2E8F0; }\n.btn.fluid { width: 100%; }\n\n/* 分段控制 */\n.segmented-control { display: flex; background-color: var(--color-bg); border-radius: var(--radius-md); padding: 4px; margin-bottom: 24px; }\n.segmented-control button { flex: 1; padding: 10px 12px; border: none; background: transparent; border-radius: 12px; font-size: 15px; font-weight: 800; color: var(--color-text-secondary); cursor: pointer; transition: all 0.2s ease; }\n.segmented-control button.active { background: #fff; color: var(--color-text-primary); box-shadow: 0 6px 16px rgba(0,0,0,0.06); }\n\n/* 表单 */\n.form-group { margin-bottom: 20px; }\n.form-group label { display: block; font-size: 14px; font-weight: 800; margin-bottom: 8px; color: var(--color-text-primary); }\n.form-group input[type=\"text\"], .form-group textarea { width: 100%; padding: 12px 14px; border: 1px solid #D1D5DB; border-radius: 12px; font-size: 14px; box-sizing: border-box; }\n.form-group input[type=\"text\"]:focus, .form-group textarea:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 2px rgba(79,70,229,0.18); }\n.ai-tag { font-size: 12px; color: var(--color-text-tertiary); margin-top: 6px; display: inline-block; }\n.form-error { color: #EF4444; font-size: 13px; margin-top: 8px; }\n\n/* 选项按钮 */\n.chip-group { display: flex; flex-wrap: wrap; gap: 12px; }\n.chip { padding: 8px 18px; border: 1px solid var(--color-border); border-radius: 999px; background: #fff; color: var(--color-text-secondary); font-size: 15px; font-weight: 800; cursor: pointer; transition: all 0.18s ease; }\n.chip.active { background: linear-gradient(90deg,#6C4FE5,#8A8FF8); color: #fff; border-color: transparent; box-shadow: 0 8px 22px rgba(108,79,229,0.18); transform: none; }\n\n/* 结果音频 */\n.result-section { margin-top: 24px; }\n.audio-card { background-color: #F5F7FB; border-radius: 16px; padding: 16px; margin-bottom: 12px; box-shadow: inset 0 1px 0 rgba(255,255,255,0.6); }\n.audio-label { font-weight: 800; color: var(--color-text-primary); font-size: 14px; margin-bottom: 12px; display: block; }\n.audio-player audio { width: 100%; height: 36px; border-radius: 10px; }\n/* 尝试将系统播放按钮改为紫白风格（Chromium/WebKit 有效） */\n.audio-player audio::-webkit-media-controls-play-button { background-color: #6C4FE5; border-radius: 50%; }\n.audio-player audio::-webkit-media-controls-play-button:hover { background-color: #5d45d1; }\n.audio-player audio::-webkit-media-controls-enclosure { border-radius: 10px; overflow: hidden; }\n\n/* 加载遮罩 */\n.loading-overlay { position: absolute; inset: 0; background: rgba(255,255,255,0.85); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; }\n.spinner { width: 40px; height: 40px; border: 4px solid var(--color-border); border-top-color: var(--color-primary); border-radius: 50%; animation: spin 1s linear infinite; }\n.loading-overlay p { margin-top: 16px; font-weight: 500; }\n@keyframes spin { to { transform: rotate(360deg); } }\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}