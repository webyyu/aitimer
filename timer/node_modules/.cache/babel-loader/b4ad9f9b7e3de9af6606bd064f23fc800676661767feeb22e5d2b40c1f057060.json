{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport { createRouter, createWebHistory } from 'vue-router';\nimport Task from '../views/Task.vue';\nimport Calendar from '../views/Calendar.vue';\nimport AiSecretary from '../views/AiSecretary.vue';\nimport TaskCollections from '../views/TaskCollections.vue';\nimport Stats from '../views/Stats.vue';\nimport Pomodoro from '../views/Pomodoro.vue';\nimport Auth from '../views/Auth.vue';\nimport authAPI from '../api/auth.js';\nconst routes = [{\n  path: '/',\n  redirect: '/task'\n},\n// ËÆ§ËØÅÁõ∏ÂÖ≥Ë∑ØÁî±\n{\n  path: '/auth/:mode?',\n  name: 'Auth',\n  component: Auth,\n  props: true,\n  meta: {\n    requiresGuest: true\n  } // ÈúÄË¶ÅÊú™ÁôªÂΩïÁä∂ÊÄÅ\n},\n// ‰∏ªË¶ÅÂäüËÉΩÈ°µÈù¢ÔºàÈúÄË¶ÅËÆ§ËØÅÔºâ\n{\n  path: '/task',\n  name: 'Task',\n  component: Task,\n  meta: {\n    requiresAuth: true\n  }\n}, {\n  path: '/calendar',\n  name: 'Calendar',\n  component: Calendar,\n  meta: {\n    requiresAuth: true\n  }\n}, {\n  path: '/ai-secretary',\n  name: 'AiSecretary',\n  component: AiSecretary,\n  meta: {\n    requiresAuth: true\n  }\n}, {\n  path: '/task-collections',\n  name: 'TaskCollections',\n  component: TaskCollections,\n  meta: {\n    requiresAuth: true\n  }\n}, {\n  path: '/stats',\n  name: 'Stats',\n  component: Stats,\n  meta: {\n    requiresAuth: true\n  }\n}, {\n  path: '/pomodoro',\n  name: 'Pomodoro',\n  component: Pomodoro,\n  meta: {\n    requiresAuth: true\n  }\n}];\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n});\n\n// Ë∑ØÁî±ÂÆàÂç´ÔºàÂê´‰∏ÄÊ¨°ÊÄßËøúÁ®ãÊ†°È™åÔºâ\nrouter.beforeEach(async (to, from, next) => {\n  console.log(`üß≠ Ë∑ØÁî±ÂØºËà™: ${from.path} -> ${to.path}`);\n\n  // Ê£ÄÊü•Êú¨Âú∞Â≠òÂÇ®‰∏≠ÁöÑËÆ§ËØÅÁä∂ÊÄÅ\n  const token = localStorage.getItem('token');\n  const user = localStorage.getItem('user');\n  const isAuthenticated = !!(token && user);\n  console.log(`üîç ËÆ§ËØÅÁä∂ÊÄÅÊ£ÄÊü•: ${isAuthenticated ? 'Â∑≤ÁôªÂΩï' : 'Êú™ÁôªÂΩï'}`);\n\n  // ÈúÄË¶ÅËÆ§ËØÅÁöÑÈ°µÈù¢\n  if (to.matched.some(record => record.meta.requiresAuth)) {\n    if (!isAuthenticated) {\n      console.log('‚ùå Áî®Êà∑Êú™ÁôªÂΩïÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µ');\n      next({\n        path: '/auth/login',\n        query: {\n          redirect: to.fullPath\n        }\n      });\n      return;\n    }\n    // Ëã•Êú¨Âú∞Áúã‰ººÂ∑≤ÁôªÂΩïÔºå‰ΩÜÊú™ÂÅöËøúÁ®ãÊ†°È™åÔºåÂàôË∞ÉÁî®‰∏ÄÊ¨°ÊúçÂä°Á´ØÊ†°È™å\n    const verified = localStorage.getItem('auth_verified') === 'true';\n    if (!verified) {\n      try {\n        const profileResp = await authAPI.getUserProfile();\n        if (profileResp?.success) {\n          localStorage.setItem('auth_verified', 'true');\n        } else {\n          throw new Error('Profile invalid');\n        }\n      } catch (e) {\n        console.warn('üîí ËøúÁ®ãÊ†°È™åÂ§±Ë¥•ÔºåÊ∏ÖÈô§Êú¨Âú∞ËÆ§ËØÅÂπ∂Ë∑≥ËΩ¨ÁôªÂΩï', e);\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        localStorage.removeItem('auth_verified');\n        next({\n          path: '/auth/login',\n          query: {\n            redirect: to.fullPath\n          }\n        });\n        return;\n      }\n    }\n  }\n\n  // ÈúÄË¶ÅÊú™ÁôªÂΩïÁä∂ÊÄÅÁöÑÈ°µÈù¢ÔºàÂ¶ÇÁôªÂΩï„ÄÅÊ≥®ÂÜåÈ°µÔºâ\n  if (to.matched.some(record => record.meta.requiresGuest)) {\n    if (isAuthenticated) {\n      console.log('‚úÖ Áî®Êà∑Â∑≤ÁôªÂΩïÔºåË∑≥ËΩ¨Âà∞‰∏ªÈ°µ');\n      next('/');\n      return;\n    }\n  }\n\n  // Â¶ÇÊûúËÆøÈóÆÊ†πË∑ØÂæÑ‰∏îÂ∑≤ÁôªÂΩïÔºåÁ°Æ‰øùË∑≥ËΩ¨Âà∞‰ªªÂä°È°µÈù¢\n  if (to.path === '/' && isAuthenticated) {\n    console.log('üè† Â∑≤ÁôªÂΩïÁî®Êà∑ËÆøÈóÆÊ†πË∑ØÂæÑÔºåË∑≥ËΩ¨Âà∞‰ªªÂä°È°µÈù¢');\n    next('/task');\n    return;\n  }\n\n  // Â¶ÇÊûúËÆøÈóÆÊ†πË∑ØÂæÑ‰∏îÊú™ÁôªÂΩïÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µ\n  if (to.path === '/' && !isAuthenticated) {\n    console.log('üîë Êú™ÁôªÂΩïÁî®Êà∑ËÆøÈóÆÊ†πË∑ØÂæÑÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µ');\n    next('/auth/login');\n    return;\n  }\n  console.log('‚úÖ Ë∑ØÁî±ÂØºËà™ÈÄöËøá');\n  next();\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","Task","Calendar","AiSecretary","TaskCollections","Stats","Pomodoro","Auth","authAPI","routes","path","redirect","name","component","props","meta","requiresGuest","requiresAuth","router","history","beforeEach","to","from","next","console","log","token","localStorage","getItem","user","isAuthenticated","matched","some","record","query","fullPath","verified","profileResp","getUserProfile","success","setItem","Error","e","warn","removeItem"],"sources":["/root/timer/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\nimport Task from '../views/Task.vue'\nimport Calendar from '../views/Calendar.vue'\nimport AiSecretary from '../views/AiSecretary.vue'\nimport TaskCollections from '../views/TaskCollections.vue'\nimport Stats from '../views/Stats.vue'\nimport Pomodoro from '../views/Pomodoro.vue'\nimport Auth from '../views/Auth.vue'\nimport authAPI from '../api/auth.js'\n\nconst routes = [\n  {\n    path: '/',\n    redirect: '/task'\n  },\n  // ËÆ§ËØÅÁõ∏ÂÖ≥Ë∑ØÁî±\n  {\n    path: '/auth/:mode?',\n    name: 'Auth',\n    component: Auth,\n    props: true,\n    meta: { requiresGuest: true } // ÈúÄË¶ÅÊú™ÁôªÂΩïÁä∂ÊÄÅ\n  },\n  // ‰∏ªË¶ÅÂäüËÉΩÈ°µÈù¢ÔºàÈúÄË¶ÅËÆ§ËØÅÔºâ\n  {\n    path: '/task',\n    name: 'Task',\n    component: Task,\n    meta: { requiresAuth: true }\n  },\n  {\n    path: '/calendar',\n    name: 'Calendar',\n    component: Calendar,\n    meta: { requiresAuth: true }\n  },\n  {\n    path: '/ai-secretary',\n    name: 'AiSecretary',\n    component: AiSecretary,\n    meta: { requiresAuth: true }\n  },\n  {\n    path: '/task-collections',\n    name: 'TaskCollections',\n    component: TaskCollections,\n    meta: { requiresAuth: true }\n  },\n  {\n    path: '/stats',\n    name: 'Stats',\n    component: Stats,\n    meta: { requiresAuth: true }\n  },\n  {\n    path: '/pomodoro',\n    name: 'Pomodoro',\n    component: Pomodoro,\n    meta: { requiresAuth: true }\n  }\n]\n\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n})\n\n// Ë∑ØÁî±ÂÆàÂç´ÔºàÂê´‰∏ÄÊ¨°ÊÄßËøúÁ®ãÊ†°È™åÔºâ\nrouter.beforeEach(async (to, from, next) => {\n  console.log(`üß≠ Ë∑ØÁî±ÂØºËà™: ${from.path} -> ${to.path}`)\n  \n  // Ê£ÄÊü•Êú¨Âú∞Â≠òÂÇ®‰∏≠ÁöÑËÆ§ËØÅÁä∂ÊÄÅ\n  const token = localStorage.getItem('token')\n  const user = localStorage.getItem('user')\n  const isAuthenticated = !!(token && user)\n  \n  console.log(`üîç ËÆ§ËØÅÁä∂ÊÄÅÊ£ÄÊü•: ${isAuthenticated ? 'Â∑≤ÁôªÂΩï' : 'Êú™ÁôªÂΩï'}`)\n\n  // ÈúÄË¶ÅËÆ§ËØÅÁöÑÈ°µÈù¢\n  if (to.matched.some(record => record.meta.requiresAuth)) {\n    if (!isAuthenticated) {\n      console.log('‚ùå Áî®Êà∑Êú™ÁôªÂΩïÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µ')\n      next({\n        path: '/auth/login',\n        query: { redirect: to.fullPath }\n      })\n      return\n    }\n    // Ëã•Êú¨Âú∞Áúã‰ººÂ∑≤ÁôªÂΩïÔºå‰ΩÜÊú™ÂÅöËøúÁ®ãÊ†°È™åÔºåÂàôË∞ÉÁî®‰∏ÄÊ¨°ÊúçÂä°Á´ØÊ†°È™å\n    const verified = localStorage.getItem('auth_verified') === 'true'\n    if (!verified) {\n      try {\n        const profileResp = await authAPI.getUserProfile()\n        if (profileResp?.success) {\n          localStorage.setItem('auth_verified', 'true')\n        } else {\n          throw new Error('Profile invalid')\n        }\n      } catch (e) {\n        console.warn('üîí ËøúÁ®ãÊ†°È™åÂ§±Ë¥•ÔºåÊ∏ÖÈô§Êú¨Âú∞ËÆ§ËØÅÂπ∂Ë∑≥ËΩ¨ÁôªÂΩï', e)\n        localStorage.removeItem('token')\n        localStorage.removeItem('user')\n        localStorage.removeItem('auth_verified')\n        next({\n          path: '/auth/login',\n          query: { redirect: to.fullPath }\n        })\n        return\n      }\n    }\n  }\n\n  // ÈúÄË¶ÅÊú™ÁôªÂΩïÁä∂ÊÄÅÁöÑÈ°µÈù¢ÔºàÂ¶ÇÁôªÂΩï„ÄÅÊ≥®ÂÜåÈ°µÔºâ\n  if (to.matched.some(record => record.meta.requiresGuest)) {\n    if (isAuthenticated) {\n      console.log('‚úÖ Áî®Êà∑Â∑≤ÁôªÂΩïÔºåË∑≥ËΩ¨Âà∞‰∏ªÈ°µ')\n      next('/')\n      return\n    }\n  }\n\n  // Â¶ÇÊûúËÆøÈóÆÊ†πË∑ØÂæÑ‰∏îÂ∑≤ÁôªÂΩïÔºåÁ°Æ‰øùË∑≥ËΩ¨Âà∞‰ªªÂä°È°µÈù¢\n  if (to.path === '/' && isAuthenticated) {\n    console.log('üè† Â∑≤ÁôªÂΩïÁî®Êà∑ËÆøÈóÆÊ†πË∑ØÂæÑÔºåË∑≥ËΩ¨Âà∞‰ªªÂä°È°µÈù¢')\n    next('/task')\n    return\n  }\n\n  // Â¶ÇÊûúËÆøÈóÆÊ†πË∑ØÂæÑ‰∏îÊú™ÁôªÂΩïÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µ\n  if (to.path === '/' && !isAuthenticated) {\n    console.log('üîë Êú™ÁôªÂΩïÁî®Êà∑ËÆøÈóÆÊ†πË∑ØÂæÑÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µ')\n    next('/auth/login')\n    return\n  }\n\n  console.log('‚úÖ Ë∑ØÁî±ÂØºËà™ÈÄöËøá')\n  next()\n})\n\nexport default router"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}