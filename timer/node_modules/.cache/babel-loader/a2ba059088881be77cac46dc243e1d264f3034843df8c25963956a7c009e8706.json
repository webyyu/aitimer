{"ast":null,"code":"import { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  class: \"modal-container vm-content\",\n  style: {\n    \"max-width\": \"560px\"\n  }\n};\nconst _hoisted_2 = {\n  class: \"modal-header\"\n};\nconst _hoisted_3 = {\n  class: \"header-actions\"\n};\nconst _hoisted_4 = [\"disabled\"];\nconst _hoisted_5 = {\n  class: \"modal-body list-body\"\n};\nconst _hoisted_6 = {\n  key: 0,\n  class: \"error-state\"\n};\nconst _hoisted_7 = [\"disabled\"];\nconst _hoisted_8 = {\n  key: 1,\n  class: \"empty-state\"\n};\nconst _hoisted_9 = {\n  key: 2,\n  class: \"vm-list\"\n};\nconst _hoisted_10 = {\n  class: \"card-header\"\n};\nconst _hoisted_11 = {\n  class: \"card-content\"\n};\nconst _hoisted_12 = {\n  class: \"audio-row\"\n};\nconst _hoisted_13 = {\n  class: \"audio-player\"\n};\nconst _hoisted_14 = [\"src\"];\nconst _hoisted_15 = {\n  key: 1,\n  class: \"no-audio\"\n};\nconst _hoisted_16 = {\n  class: \"audio-row\"\n};\nconst _hoisted_17 = {\n  class: \"audio-player\"\n};\nconst _hoisted_18 = [\"src\"];\nconst _hoisted_19 = {\n  key: 1,\n  class: \"no-audio\"\n};\nconst _hoisted_20 = {\n  class: \"card-footer\"\n};\nconst _hoisted_21 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", {\n    class: \"modal-overlay vm-overlay\",\n    onClick: _withModifiers($setup.close, [\"self\"])\n  }, [_createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"header\", _hoisted_2, [_cache[2] || (_cache[2] = _createElementVNode(\"h2\", {\n    class: \"modal-title\"\n  }, \"ÊàëÁöÑËØ≠Èü≥\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"button\", {\n    class: \"icon-button\",\n    title: \"Âà∑Êñ∞\",\n    onClick: $setup.refresh,\n    disabled: $setup.loading\n  }, \"‚ü≥\", 8 /* PROPS */, _hoisted_4), _createElementVNode(\"button\", {\n    class: \"icon-button\",\n    title: \"ÂÖ≥Èó≠\",\n    onClick: $setup.close\n  }, \"‚úï\")])]), _createElementVNode(\"main\", _hoisted_5, [$setup.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [_cache[3] || (_cache[3] = _createElementVNode(\"i\", {\n    class: \"fa-regular fa-circle-xmark\",\n    style: {\n      \"font-style\": \"normal\",\n      \"font-size\": \"32px\",\n      \"color\": \"#ef4444\"\n    }\n  }, \"!\", -1 /* CACHED */)), _createElementVNode(\"p\", null, _toDisplayString($setup.error), 1 /* TEXT */), _createElementVNode(\"button\", {\n    class: \"btn btn-secondary\",\n    onClick: $setup.refresh,\n    disabled: $setup.loading\n  }, \"ÈáçËØï\", 8 /* PROPS */, _hoisted_7)])) : !$setup.voiceGroups.length && !$setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, _cache[4] || (_cache[4] = [_createElementVNode(\"i\", {\n    class: \"fa-regular fa-folder-open\",\n    style: {\n      \"font-style\": \"normal\",\n      \"font-size\": \"48px\",\n      \"color\": \"#E5E7EB\"\n    }\n  }, \"üìÅ\", -1 /* CACHED */), _createElementVNode(\"p\", null, \"ÊöÇÊó†ÂéÜÂè≤ËØ≠Èü≥\", -1 /* CACHED */), _createElementVNode(\"span\", null, \"ÂéªÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑËØ≠Èü≥Èô™‰º¥Âêß\", -1 /* CACHED */)]))) : (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.voiceGroups, (g, idx) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: idx,\n      class: \"list-card\"\n    }, [_createElementVNode(\"div\", _hoisted_10, [_createElementVNode(\"h3\", null, \"Á¨¨ \" + _toDisplayString($setup.voiceGroups.length - idx) + \" ÁªÑ\", 1 /* TEXT */), _createElementVNode(\"span\", null, \"ÂàõÂª∫‰∫é: \" + _toDisplayString($setup.formatTime(g.createdAt)), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_11, [_createElementVNode(\"div\", _hoisted_12, [_cache[5] || (_cache[5] = _createElementVNode(\"span\", null, \"ÈºìÂä±\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_13, [g.encourage_url ? (_openBlock(), _createElementBlock(\"audio\", {\n      key: 0,\n      src: $setup.withBuster($setup.toHttps(g.encourage_url)),\n      controls: \"\",\n      onError: _cache[0] || (_cache[0] = $event => $setup.onAudioError('encourage'))\n    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_14)) : (_openBlock(), _createElementBlock(\"span\", _hoisted_15, \"Êó†Èü≥È¢ë\"))])]), _createElementVNode(\"div\", _hoisted_16, [_cache[6] || (_cache[6] = _createElementVNode(\"span\", null, \"ÊâπËØÑ\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_17, [g.criticize_url ? (_openBlock(), _createElementBlock(\"audio\", {\n      key: 0,\n      src: $setup.withBuster($setup.toHttps(g.criticize_url)),\n      controls: \"\",\n      onError: _cache[1] || (_cache[1] = $event => $setup.onAudioError('criticize'))\n    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_18)) : (_openBlock(), _createElementBlock(\"span\", _hoisted_19, \"Êó†Èü≥È¢ë\"))])])]), _createElementVNode(\"div\", _hoisted_20, [_createElementVNode(\"button\", {\n      class: \"btn-delete\",\n      onClick: $event => $setup.onDelete(idx)\n    }, \"Âà†Èô§Ëøô‰∏ÄÁªÑ\", 8 /* PROPS */, _hoisted_21)])]);\n  }), 128 /* KEYED_FRAGMENT */))]))])])]);\n}","map":{"version":3,"names":["class","style","_createElementBlock","onClick","_withModifiers","$setup","close","_createElementVNode","_hoisted_1","_hoisted_2","_hoisted_3","title","refresh","disabled","loading","_hoisted_4","_hoisted_5","error","_hoisted_6","_toDisplayString","_hoisted_7","voiceGroups","length","_hoisted_8","_cache","_hoisted_9","_Fragment","_renderList","g","idx","key","_hoisted_10","formatTime","createdAt","_hoisted_11","_hoisted_12","_hoisted_13","encourage_url","src","withBuster","toHttps","controls","onError","$event","onAudioError","_hoisted_15","_hoisted_16","_hoisted_17","criticize_url","_hoisted_19","_hoisted_20","onDelete","_hoisted_21"],"sources":["C:\\Users\\wuby\\OneDrive\\Desktop\\backend(1) 3\\timer\\src\\components\\aivoice\\VoiceManagerModal.vue"],"sourcesContent":["<template>\n  <div class=\"modal-overlay vm-overlay\" @click.self=\"close\">\n    <div class=\"modal-container vm-content\" style=\"max-width: 560px;\">\n      <header class=\"modal-header\">\n        <h2 class=\"modal-title\">ÊàëÁöÑËØ≠Èü≥</h2>\n        <div class=\"header-actions\">\n          <button class=\"icon-button\" title=\"Âà∑Êñ∞\" @click=\"refresh\" :disabled=\"loading\">‚ü≥</button>\n          <button class=\"icon-button\" title=\"ÂÖ≥Èó≠\" @click=\"close\">‚úï</button>\n        </div>\n      </header>\n      <main class=\"modal-body list-body\">\n        <div v-if=\"error\" class=\"error-state\">\n          <i class=\"fa-regular fa-circle-xmark\" style=\"font-style: normal; font-size: 32px; color: #ef4444;\">!</i>\n          <p>{{ error }}</p>\n          <button class=\"btn btn-secondary\" @click=\"refresh\" :disabled=\"loading\">ÈáçËØï</button>\n        </div>\n        <div v-else-if=\"!voiceGroups.length && !loading\" class=\"empty-state\">\n          <i class=\"fa-regular fa-folder-open\" style=\"font-style: normal; font-size: 48px; color: #E5E7EB;\">üìÅ</i>\n          <p>ÊöÇÊó†ÂéÜÂè≤ËØ≠Èü≥</p>\n          <span>ÂéªÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑËØ≠Èü≥Èô™‰º¥Âêß</span>\n        </div>\n        <div v-else class=\"vm-list\">\n          <div v-for=\"(g, idx) in voiceGroups\" :key=\"idx\" class=\"list-card\">\n            <div class=\"card-header\">\n              <h3>Á¨¨ {{ voiceGroups.length - idx }} ÁªÑ</h3>\n              <span>ÂàõÂª∫‰∫é: {{ formatTime(g.createdAt) }}</span>\n            </div>\n            <div class=\"card-content\">\n              <div class=\"audio-row\">\n                <span>ÈºìÂä±</span>\n                <div class=\"audio-player\">\n                  <audio v-if=\"g.encourage_url\" :src=\"withBuster(toHttps(g.encourage_url))\" controls @error=\"onAudioError('encourage')\" />\n                  <span v-else class=\"no-audio\">Êó†Èü≥È¢ë</span>\n                </div>\n              </div>\n              <div class=\"audio-row\">\n                <span>ÊâπËØÑ</span>\n                <div class=\"audio-player\">\n                  <audio v-if=\"g.criticize_url\" :src=\"withBuster(toHttps(g.criticize_url))\" controls @error=\"onAudioError('criticize')\" />\n                  <span v-else class=\"no-audio\">Êó†Èü≥È¢ë</span>\n                </div>\n              </div>\n            </div>\n            <div class=\"card-footer\">\n              <button class=\"btn-delete\" @click=\"onDelete(idx)\">Âà†Èô§Ëøô‰∏ÄÁªÑ</button>\n            </div>\n          </div>\n        </div>\n      </main>\n    </div>\n  </div>\n</template>\n\n<script setup>\n/* global defineEmits, defineProps */\nimport { ref, onMounted } from 'vue'\nimport aivoiceAPI from '@/api/aivoice.js'\nconst emit = defineEmits(['close'])\nconst props = defineProps({\n  userId: { type: String, required: true }\n})\nconst loading = ref(false)\nconst error = ref('')\nconst voiceGroups = ref([])\nconst cacheBuster = ref(0)\nconst retryCount = ref({ encourage: 0, criticize: 0 })\n\nfunction close() { emit('close') }\nfunction toHttps(url) { if (!url) return url; return url.startsWith('http://') ? 'https://' + url.slice('http://'.length) : url }\nfunction withBuster(url) { if (!url) return url; const sep = url.includes('?') ? '&' : '?'; return `${url}${sep}v=${cacheBuster.value}` }\nfunction onAudioError(kind) {\n  if (!retryCount.value[kind]) retryCount.value[kind] = 0\n  if (retryCount.value[kind] >= 3) return\n  retryCount.value[kind] += 1\n  cacheBuster.value = Date.now()\n}\nfunction formatTime(value) { try { return new Date(value).toLocaleString() } catch (_) { return String(value || '') } }\n\nasync function refresh() {\n  loading.value = true\n  error.value = ''\n  try {\n    const res = await aivoiceAPI.getBindStatus(props.userId)\n    if (res?.binded === false) {\n      voiceGroups.value = []\n    } else {\n      voiceGroups.value = Array.isArray(res?.voice_groups) ? res.voice_groups : []\n    }\n    cacheBuster.value = Date.now()\n  } catch (e) {\n    error.value = e?.message || 'Âä†ËΩΩÂ§±Ë¥•'\n  } finally {\n    loading.value = false\n  }\n}\n\nasync function onDelete(idx) {\n  if (loading.value) return\n  const ok = window.confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏ÄÁªÑËØ≠Èü≥ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ')\n  if (!ok) return\n  loading.value = true\n  error.value = ''\n  try {\n    // Êé•Âè£Á∫¶ÂÆöÊåâÁ¥¢ÂºïÂà†Èô§‰∏∫ 0 Âü∫Á¥¢Âºï\n    await aivoiceAPI.deleteVoiceGroupByIndex(props.userId, idx)\n    await refresh()\n  } catch (e) {\n    error.value = e?.message || 'Âà†Èô§Â§±Ë¥•'\n  } finally {\n    loading.value = false\n  }\n}\n\nonMounted(refresh)\n</script>\n\n<style scoped>\n:root { --color-primary: #4F46E5; --color-bg: #F8F9FA; --color-surface: #FFFFFF; --color-text-primary: #111827; --color-text-secondary: #374151; --color-text-tertiary: #6B7280; --color-border: #E5E7EB; --radius-lg: 16px; --radius-md: 12px; --radius-full: 999px; }\n.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 2100; padding: 16px; }\n.modal-container { background: #ffffff; border-radius: 18px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); width: 100%; display: flex; flex-direction: column; position: relative; overflow: hidden; max-height: 90vh; }\n.modal-header { padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-border); }\n.modal-title { font-size: 20px; font-weight: 800; color: var(--color-text-primary); margin: 0; display: flex; align-items: center; gap: 8px; }\n.header-actions { display: flex; gap: 12px; }\n.icon-button { background: #F3F4F6; border: none; font-size: 16px; color: #6b7280; cursor: pointer; padding: 8px; border-radius: 10px; width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center; }\n.icon-button:hover { background-color: #E5E7EB; }\n.modal-body { padding: 16px; overflow-y: auto; background: #ffffff; }\n.list-body { background-color: #ffffff; }\n\n/* ÂàóË°®Âç°Áâá */\n.vm-list { display: flex; flex-direction: column; gap: 16px; max-height: 60vh; overflow-y: auto; }\n.list-card { background: #fff; border-radius: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.06); overflow: hidden; }\n.card-header { padding: 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-border); }\n.card-header h3 { margin: 0; font-size: 18px; color: var(--color-text-primary); font-weight: 800; }\n.card-header span { font-size: 12px; color: var(--color-text-tertiary); }\n.card-content { padding: 16px; display: flex; flex-direction: column; gap: 16px; }\n.audio-row { display: flex; align-items: center; justify-content: space-between; }\n.audio-row > span { font-weight: 700; color: var(--color-text-secondary); }\n.audio-player { display: flex; align-items: center; gap: 12px; min-width: 200px; }\n.audio-player audio { width: 260px; height: 36px; }\n.no-audio { color: var(--color-text-tertiary); font-style: italic; font-size: 13px; }\n.card-footer { padding: 10px 16px; text-align: right; border-top: 1px solid var(--color-border); }\n.btn-delete { background: none; border: none; color: #ef4444; font-size: 14px; font-weight: 700; cursor: pointer; padding: 6px 10px; border-radius: 8px; }\n.btn-delete:hover { background: #fee2e2; }\n\n/* Á©∫‰∏éÈîôËØØÁä∂ÊÄÅ */\n.empty-state, .error-state { text-align: center; padding: 48px 24px; }\n.empty-state p, .error-state p { font-size: 16px; font-weight: 700; color: var(--color-text-primary); margin: 8px 0; }\n.empty-state span, .error-state span { font-size: 14px; color: var(--color-text-tertiary); }\n\n/* ÈÄöÁî®ÊåâÈíÆ */\n.btn { height: 44px; padding: 0 18px; border: none; border-radius: 12px; font-size: 15px; font-weight: 700; cursor: pointer; }\n.btn-secondary { background: #E9EEF5; color: var(--color-text-primary); }\n.btn-secondary:hover { background: #E2E8F0; }\n</style> "],"mappings":";;EAESA,KAAK,EAAC,4BAA4B;EAACC,KAAyB,EAAzB;IAAA;EAAA;;;EAC9BD,KAAK,EAAC;AAAc;;EAErBA,KAAK,EAAC;AAAgB;;;EAKvBA,KAAK,EAAC;AAAsB;;;EACdA,KAAK,EAAC;;;;;EAKyBA,KAAK,EAAC;;;;EAK3CA,KAAK,EAAC;;;EAETA,KAAK,EAAC;AAAa;;EAInBA,KAAK,EAAC;AAAc;;EAClBA,KAAK,EAAC;AAAW;;EAEfA,KAAK,EAAC;AAAc;;;;EAEVA,KAAK,EAAC;;;EAGlBA,KAAK,EAAC;AAAW;;EAEfA,KAAK,EAAC;AAAc;;;;EAEVA,KAAK,EAAC;;;EAIpBA,KAAK,EAAC;AAAa;;;uBA1ClCE,mBAAA,CAiDM;IAjDDF,KAAK,EAAC,0BAA0B;IAAEG,OAAK,EAAAC,cAAA,CAAOC,MAAA,CAAAC,KAAK;MACtDC,mBAAA,CA+CM,OA/CNC,UA+CM,GA9CJD,mBAAA,CAMS,UANTE,UAMS,G,0BALPF,mBAAA,CAAiC;IAA7BP,KAAK,EAAC;EAAa,GAAC,MAAI,qBAC5BO,mBAAA,CAGM,OAHNG,UAGM,GAFJH,mBAAA,CAAsF;IAA9EP,KAAK,EAAC,aAAa;IAACW,KAAK,EAAC,IAAI;IAAER,OAAK,EAAEE,MAAA,CAAAO,OAAO;IAAGC,QAAQ,EAAER,MAAA,CAAAS;KAAS,GAAC,iBAAAC,UAAA,GAC7ER,mBAAA,CAAgE;IAAxDP,KAAK,EAAC,aAAa;IAACW,KAAK,EAAC,IAAI;IAAER,OAAK,EAAEE,MAAA,CAAAC;KAAO,GAAC,E,KAG3DC,mBAAA,CAsCO,QAtCPS,UAsCO,GArCMX,MAAA,CAAAY,KAAK,I,cAAhBf,mBAAA,CAIM,OAJNgB,UAIM,G,0BAHJX,mBAAA,CAAwG;IAArGP,KAAK,EAAC,4BAA4B;IAACC,KAA4D,EAA5D;MAAA;MAAA;MAAA;IAAA;KAA6D,GAAC,qBACpGM,mBAAA,CAAkB,WAAAY,gBAAA,CAAZd,MAAA,CAAAY,KAAK,kBACXV,mBAAA,CAAkF;IAA1EP,KAAK,EAAC,mBAAmB;IAAEG,OAAK,EAAEE,MAAA,CAAAO,OAAO;IAAGC,QAAQ,EAAER,MAAA,CAAAS;KAAS,IAAE,iBAAAM,UAAA,E,MAE1Df,MAAA,CAAAgB,WAAW,CAACC,MAAM,KAAKjB,MAAA,CAAAS,OAAO,I,cAA/CZ,mBAAA,CAIM,OAJNqB,UAIM,EAAAC,MAAA,QAAAA,MAAA,OAHJjB,mBAAA,CAAwG;IAArGP,KAAK,EAAC,2BAA2B;IAACC,KAA4D,EAA5D;MAAA;MAAA;MAAA;IAAA;KAA6D,IAAE,oBACpGM,mBAAA,CAAa,WAAV,QAAM,oBACTA,mBAAA,CAAyB,cAAnB,cAAY,mB,qBAEpBL,mBAAA,CA0BM,OA1BNuB,UA0BM,I,kBAzBJvB,mBAAA,CAwBMwB,SAAA,QAAAC,WAAA,CAxBkBtB,MAAA,CAAAgB,WAAW,GAAtBO,CAAC,EAAEC,GAAG;yBAAnB3B,mBAAA,CAwBM;MAxBgC4B,GAAG,EAAED,GAAG;MAAE7B,KAAK,EAAC;QACpDO,mBAAA,CAGM,OAHNwB,WAGM,GAFJxB,mBAAA,CAA2C,YAAvC,IAAE,GAAAY,gBAAA,CAAGd,MAAA,CAAAgB,WAAW,CAACC,MAAM,GAAGO,GAAG,IAAG,IAAE,iBACtCtB,mBAAA,CAA+C,cAAzC,OAAK,GAAAY,gBAAA,CAAGd,MAAA,CAAA2B,UAAU,CAACJ,CAAC,CAACK,SAAS,kB,GAEtC1B,mBAAA,CAeM,OAfN2B,WAeM,GAdJ3B,mBAAA,CAMM,OANN4B,WAMM,G,0BALJ5B,mBAAA,CAAe,cAAT,IAAE,qBACRA,mBAAA,CAGM,OAHN6B,WAGM,GAFSR,CAAC,CAACS,aAAa,I,cAA5BnC,mBAAA,CAAwH;;MAAzFoC,GAAG,EAAEjC,MAAA,CAAAkC,UAAU,CAAClC,MAAA,CAAAmC,OAAO,CAACZ,CAAC,CAACS,aAAa;MAAII,QAAQ,EAAR,EAAQ;MAAEC,OAAK,EAAAlB,MAAA,QAAAA,MAAA,MAAAmB,MAAA,IAAEtC,MAAA,CAAAuC,YAAY;4EACvG1C,mBAAA,CAAwC,QAAxC2C,WAAwC,EAAV,KAAG,G,KAGrCtC,mBAAA,CAMM,OANNuC,WAMM,G,0BALJvC,mBAAA,CAAe,cAAT,IAAE,qBACRA,mBAAA,CAGM,OAHNwC,WAGM,GAFSnB,CAAC,CAACoB,aAAa,I,cAA5B9C,mBAAA,CAAwH;;MAAzFoC,GAAG,EAAEjC,MAAA,CAAAkC,UAAU,CAAClC,MAAA,CAAAmC,OAAO,CAACZ,CAAC,CAACoB,aAAa;MAAIP,QAAQ,EAAR,EAAQ;MAAEC,OAAK,EAAAlB,MAAA,QAAAA,MAAA,MAAAmB,MAAA,IAAEtC,MAAA,CAAAuC,YAAY;4EACvG1C,mBAAA,CAAwC,QAAxC+C,WAAwC,EAAV,KAAG,G,OAIvC1C,mBAAA,CAEM,OAFN2C,WAEM,GADJ3C,mBAAA,CAAgE;MAAxDP,KAAK,EAAC,YAAY;MAAEG,OAAK,EAAAwC,MAAA,IAAEtC,MAAA,CAAA8C,QAAQ,CAACtB,GAAG;OAAG,OAAK,iBAAAuB,WAAA,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}