{"ast":null,"code":"import { API_CONFIG } from '../config/api.js';\n\n// 使用 fetch 处理表单上传，避免手动设置 Content-Type\nconst BASE_URL = API_CONFIG.baseURL.replace('/api', '');\nfunction getToken() {\n  try {\n    return localStorage.getItem('token') || '';\n  } catch (_) {\n    return '';\n  }\n}\nasync function uploadVoice(file, userId) {\n  const form = new FormData();\n  form.append('file', file);\n  if (userId) form.append('user_id', userId);\n  const resp = await fetch(`${BASE_URL}/api/aivoice/upload-voice`, {\n    method: 'POST',\n    headers: {\n      Authorization: `Bearer ${getToken()}`\n    },\n    body: form\n  });\n  const data = await resp.json().catch(() => ({}));\n  if (!resp.ok || !data?.success) {\n    throw new Error(data?.error || data?.message || resp.statusText || '上传失败');\n  }\n  return data;\n}\n\n// 其余 JSON 请求复用 http 实例\nimport http from './http.js';\nasync function enrollVoice(userId, ossUrl) {\n  const res = await http.post('/aivoice/enroll-voice', {\n    user_id: userId,\n    oss_url: ossUrl\n  });\n  if (!res?.success) {\n    throw new Error(res?.error || res?.message || '复刻失败');\n  }\n  return res;\n}\nasync function getBindStatus(userId) {\n  try {\n    // 优先使用查询参数\n    return await http.get('/aivoice/bind-status', {\n      params: {\n        user_id: userId\n      }\n    });\n  } catch (err) {\n    // 若后端只注册了路径参数路由或返回路由未找到，回退到 /:user_id 形式\n    const code = err?.response?.status;\n    const msg = err?.response?.data || err?.message;\n    if (code === 404 || typeof msg === 'string' && msg.includes('路由未找到')) {\n      return await http.get(`/aivoice/bind-status/${encodeURIComponent(userId)}`);\n    }\n    throw err;\n  }\n}\nasync function synthesizeVoice(userId, encourageText, criticizeText) {\n  const res = await http.post('/aivoice/synthesize-voice', {\n    user_id: userId,\n    encourage_text: encourageText,\n    criticize_text: criticizeText\n  }, {\n    timeout: 30000 // 30秒超时，合成可能较慢\n  });\n  if (!res?.success) {\n    throw new Error(res?.error || res?.message || '合成失败');\n  }\n  return res;\n}\nasync function imitateText(name, encourageTone, criticizeTone) {\n  const payload = {\n    encourage_tone: encourageTone,\n    criticize_tone: criticizeTone\n  };\n  if (name && String(name).trim()) {\n    payload.name = String(name).trim();\n  }\n  const res = await http.post('/aivoice/imitate-text', payload, {\n    timeout: 20000\n  });\n  if (!res?.success) {\n    throw new Error(res?.error || res?.message || 'AI文本生成失败');\n  }\n  return res;\n}\n\n// 新增：删除语音组（按索引）\nasync function deleteVoiceGroupByIndex(userId, groupIndex) {\n  const res = await http.delete('/aivoice/voice-group', {\n    data: {\n      user_id: userId,\n      group_index: groupIndex\n    }\n  });\n  if (!res?.success) {\n    throw new Error(res?.error || res?.message || '删除失败');\n  }\n  return res;\n}\n\n// 新增：删除语音组（按URL匹配）\nasync function deleteVoiceGroupByUrl(userId, encourageUrl, criticizeUrl) {\n  const payload = {\n    user_id: userId\n  };\n  if (encourageUrl) payload.encourage_url = encourageUrl;\n  if (criticizeUrl) payload.criticize_url = criticizeUrl;\n  const res = await http.delete('/aivoice/voice-group', {\n    data: payload\n  });\n  if (!res?.success) {\n    throw new Error(res?.error || res?.message || '删除失败');\n  }\n  return res;\n}\nconst aivoiceAPI = {\n  uploadVoice,\n  enrollVoice,\n  getBindStatus,\n  synthesizeVoice,\n  imitateText,\n  deleteVoiceGroupByIndex,\n  deleteVoiceGroupByUrl\n};\nexport default aivoiceAPI;","map":{"version":3,"names":["API_CONFIG","BASE_URL","baseURL","replace","getToken","localStorage","getItem","_","uploadVoice","file","userId","form","FormData","append","resp","fetch","method","headers","Authorization","body","data","json","catch","ok","success","Error","error","message","statusText","http","enrollVoice","ossUrl","res","post","user_id","oss_url","getBindStatus","get","params","err","code","response","status","msg","includes","encodeURIComponent","synthesizeVoice","encourageText","criticizeText","encourage_text","criticize_text","timeout","imitateText","name","encourageTone","criticizeTone","payload","encourage_tone","criticize_tone","String","trim","deleteVoiceGroupByIndex","groupIndex","delete","group_index","deleteVoiceGroupByUrl","encourageUrl","criticizeUrl","encourage_url","criticize_url","aivoiceAPI"],"sources":["C:/Users/wuby/OneDrive/Desktop/backend(1) 3/timer/src/api/aivoice.js"],"sourcesContent":["import { API_CONFIG } from '../config/api.js'\n\n// 使用 fetch 处理表单上传，避免手动设置 Content-Type\nconst BASE_URL = API_CONFIG.baseURL.replace('/api', '')\n\nfunction getToken() {\n  try {\n    return localStorage.getItem('token') || ''\n  } catch (_) {\n    return ''\n  }\n}\n\nasync function uploadVoice(file, userId) {\n  const form = new FormData()\n  form.append('file', file)\n  if (userId) form.append('user_id', userId)\n\n  const resp = await fetch(`${BASE_URL}/api/aivoice/upload-voice`, {\n    method: 'POST',\n    headers: {\n      Authorization: `Bearer ${getToken()}`\n    },\n    body: form\n  })\n\n  const data = await resp.json().catch(() => ({}))\n  if (!resp.ok || !data?.success) {\n    throw new Error(data?.error || data?.message || resp.statusText || '上传失败')\n  }\n  return data\n}\n\n// 其余 JSON 请求复用 http 实例\nimport http from './http.js'\n\nasync function enrollVoice(userId, ossUrl) {\n  const res = await http.post('/aivoice/enroll-voice', {\n    user_id: userId,\n    oss_url: ossUrl\n  })\n  if (!res?.success) {\n    throw new Error(res?.error || res?.message || '复刻失败')\n  }\n  return res\n}\n\nasync function getBindStatus(userId) {\n  try {\n    // 优先使用查询参数\n    return await http.get('/aivoice/bind-status', { params: { user_id: userId } })\n  } catch (err) {\n    // 若后端只注册了路径参数路由或返回路由未找到，回退到 /:user_id 形式\n    const code = err?.response?.status\n    const msg = err?.response?.data || err?.message\n    if (code === 404 || (typeof msg === 'string' && msg.includes('路由未找到'))) {\n      return await http.get(`/aivoice/bind-status/${encodeURIComponent(userId)}`)\n    }\n    throw err\n  }\n}\n\nasync function synthesizeVoice(userId, encourageText, criticizeText) {\n  const res = await http.post('/aivoice/synthesize-voice', {\n    user_id: userId,\n    encourage_text: encourageText,\n    criticize_text: criticizeText\n  }, {\n    timeout: 30000 // 30秒超时，合成可能较慢\n  })\n  if (!res?.success) {\n    throw new Error(res?.error || res?.message || '合成失败')\n  }\n  return res\n}\n\nasync function imitateText(name, encourageTone, criticizeTone) {\n  const payload = {\n    encourage_tone: encourageTone,\n    criticize_tone: criticizeTone\n  }\n  if (name && String(name).trim()) {\n    payload.name = String(name).trim()\n  }\n  const res = await http.post('/aivoice/imitate-text', payload, { timeout: 20000 })\n  if (!res?.success) {\n    throw new Error(res?.error || res?.message || 'AI文本生成失败')\n  }\n  return res\n}\n\n// 新增：删除语音组（按索引）\nasync function deleteVoiceGroupByIndex(userId, groupIndex) {\n  const res = await http.delete('/aivoice/voice-group', {\n    data: { user_id: userId, group_index: groupIndex }\n  })\n  if (!res?.success) {\n    throw new Error(res?.error || res?.message || '删除失败')\n  }\n  return res\n}\n\n// 新增：删除语音组（按URL匹配）\nasync function deleteVoiceGroupByUrl(userId, encourageUrl, criticizeUrl) {\n  const payload = { user_id: userId }\n  if (encourageUrl) payload.encourage_url = encourageUrl\n  if (criticizeUrl) payload.criticize_url = criticizeUrl\n  const res = await http.delete('/aivoice/voice-group', { data: payload })\n  if (!res?.success) {\n    throw new Error(res?.error || res?.message || '删除失败')\n  }\n  return res\n}\n\nconst aivoiceAPI = {\n  uploadVoice,\n  enrollVoice,\n  getBindStatus,\n  synthesizeVoice,\n  imitateText,\n  deleteVoiceGroupByIndex,\n  deleteVoiceGroupByUrl\n}\n\nexport default aivoiceAPI "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}