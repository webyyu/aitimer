{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n/**\n * AIsiri æ™ºèƒ½è°ƒåº¦æ¶ˆæ¯å¤„ç†æœåŠ¡\n * å¤„ç†èŠå¤©æ¶ˆæ¯çš„æ ¼å¼åŒ–ã€å­˜å‚¨å’ŒçŠ¶æ€ç®¡ç†\n */\n\nimport aisiriService from './aiApi.js';\nimport { MESSAGE_TYPES, SENDERS } from '../types/index.js';\n\n/**\n * ç”Ÿæˆå”¯ä¸€æ¶ˆæ¯ID\n */\nfunction generateMessageId() {\n  return `msg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\n/**\n * åˆ›å»ºæ¶ˆæ¯å¯¹è±¡\n */\nfunction createMessage(content, sender = SENDERS.AI, type = MESSAGE_TYPES.TEXT, metadata = {}) {\n  return {\n    id: generateMessageId(),\n    content,\n    sender,\n    type,\n    timestamp: new Date(),\n    metadata,\n    isUser: sender === SENDERS.USER\n  };\n}\n\n/**\n * æ¶ˆæ¯æœåŠ¡ç±»\n */\nclass MessageService {\n  constructor() {\n    this.messages = [];\n    this.isProcessing = false;\n    this.currentSessionId = null;\n\n    // æ·»åŠ åˆå§‹æ¬¢è¿æ¶ˆæ¯\n    this.addWelcomeMessage();\n    console.log('ğŸ’¬ AIsiriæ™ºèƒ½è°ƒåº¦æ¶ˆæ¯æœåŠ¡åˆå§‹åŒ–å®Œæˆ');\n  }\n\n  /**\n   * æ·»åŠ æ¬¢è¿æ¶ˆæ¯\n   */\n  addWelcomeMessage() {\n    const welcomeMessage = createMessage('ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIæ™ºèƒ½åŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å¸®åŠ©ä½ åˆ›å»ºä»»åŠ¡ã€å®‰æ’æ—¥ç¨‹ã€æä¾›æƒ…ç»ªæ”¯æŒï¼Œä»¥åŠè°ƒç”¨å„ç§å¤–éƒ¨å·¥å…·ã€‚è¯·å‘Šè¯‰æˆ‘ä½ éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ', SENDERS.AI, MESSAGE_TYPES.TEXT);\n    this.messages.push(welcomeMessage);\n  }\n\n  /**\n   * è·å–æ‰€æœ‰æ¶ˆæ¯\n   */\n  getMessages() {\n    return [...this.messages];\n  }\n\n  /**\n   * æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n   */\n  addUserMessage(content) {\n    // æ£€æŸ¥æ˜¯å¦æ˜¯å›¾ç‰‡æ¶ˆæ¯\n    let messageType = MESSAGE_TYPES.TEXT;\n    if (content && content.startsWith('[å›¾ç‰‡]')) {\n      messageType = 'IMAGE'; // ä½¿ç”¨è‡ªå®šä¹‰å›¾ç‰‡ç±»å‹\n    }\n\n    // å¦‚æœæ˜¯åˆ†æç»“æœæ¶ˆæ¯ï¼Œä¸æ·»åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨ï¼ˆç”¨æˆ·ä¸éœ€è¦çœ‹åˆ°ï¼‰\n    if (content && content.startsWith('å›¾ç‰‡åˆ†æç»“æœï¼š')) {\n      console.log(`ğŸ“ å›¾ç‰‡åˆ†æç»“æœï¼ˆéšè—ï¼‰ï¼š${content.substring(0, 50)}...`);\n      // ä¸æ·»åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨ï¼Œåªç”¨äºæ™ºèƒ½è°ƒåº¦\n      return null;\n    }\n    const message = createMessage(content, SENDERS.USER, messageType);\n    this.messages.push(message);\n    console.log(`ğŸ“ ç”¨æˆ·æ¶ˆæ¯: ${content}`);\n    return message;\n  }\n\n  /**\n   * æ·»åŠ AIæ¶ˆæ¯\n   */\n  addAIMessage(content, type = MESSAGE_TYPES.TEXT, metadata = {}) {\n    const message = createMessage(content, SENDERS.AI, type, metadata);\n    this.messages.push(message);\n    console.log(`ğŸ¤– AIå›å¤: ${content.substring(0, 50)}${content.length > 50 ? '...' : ''}`);\n    return message;\n  }\n\n  /**\n   * æ·»åŠ è¯­éŸ³æ¶ˆæ¯\n   */\n  addVoiceMessage(voiceData, isUser = false) {\n    const message = {\n      id: Date.now() + Math.random(),\n      type: MESSAGE_TYPES.VOICE,\n      isUser: isUser,\n      timestamp: new Date(),\n      duration: voiceData.transcription ? Math.ceil(voiceData.transcription.length / 5) : 3,\n      // æ ¹æ®æ–‡å­—é•¿åº¦ä¼°ç®—æ—¶é•¿\n      transcription: voiceData.transcription || '',\n      audioUrl: voiceData.audioUrl || '',\n      audioFile: voiceData.audioFile || null\n    };\n    this.messages.push(message);\n    console.log(`ğŸ¤ ${isUser ? 'ç”¨æˆ·' : 'AI'}è¯­éŸ³æ¶ˆæ¯å·²æ·»åŠ : ${voiceData.transcription?.substring(0, 50) || 'æ— æ–‡å­—'}...`);\n    return message;\n  }\n\n  /**\n   * æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯\n   */\n  addSystemMessage(content) {\n    const message = createMessage(content, SENDERS.SYSTEM, MESSAGE_TYPES.TEXT);\n    this.messages.push(message);\n    console.log(`âš™ï¸  ç³»ç»Ÿæ¶ˆæ¯: ${content}`);\n    return message;\n  }\n\n  /**\n   * å¤„ç†ç”¨æˆ·è¾“å…¥çš„ä¸»è¦æ–¹æ³• - ä½¿ç”¨æ™ºèƒ½è°ƒåº¦ç³»ç»Ÿ\n   */\n  async processUserInput(userInput) {\n    if (this.isProcessing) {\n      console.log('â³ æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨ç­‰...');\n      return;\n    }\n    try {\n      this.isProcessing = true;\n\n      // 1. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n      this.addUserMessage(userInput);\n\n      // 2. è°ƒç”¨AIsiriæ™ºèƒ½è°ƒåº¦\n      console.log('\\nğŸš€ å¼€å§‹æ™ºèƒ½è°ƒåº¦å¤„ç†...');\n      const response = await aisiriService.dispatch(userInput, this.currentSessionId);\n\n      // 3. å¤„ç†æ™ºèƒ½è°ƒåº¦å“åº”\n      await this.handleDispatchResponse(response);\n    } catch (error) {\n      console.error('âŒ æ™ºèƒ½è°ƒåº¦å¤„ç†å¤±è´¥:', error);\n      this.addAIMessage('æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›æŠ€æœ¯é—®é¢˜ã€‚è¯·ç¨åå†è¯•ï¼Œæˆ–è€…å°è¯•é‡æ–°æè¿°ä½ çš„éœ€æ±‚ã€‚', MESSAGE_TYPES.ERROR, {\n        error: error.message\n      });\n    } finally {\n      this.isProcessing = false;\n    }\n  }\n\n  /**\n   * å¤„ç†ç”¨æˆ·è¯­éŸ³è¾“å…¥ - è¿”å›è¯­éŸ³å›å¤\n   */\n  async processVoiceInput(voiceData) {\n    if (this.isProcessing) {\n      console.log('â³ æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨ç­‰...');\n      return;\n    }\n    try {\n      this.isProcessing = true;\n\n      // 1. æ·»åŠ ç”¨æˆ·è¯­éŸ³æ¶ˆæ¯\n      this.addVoiceMessage(voiceData, true); // trueè¡¨ç¤ºæ˜¯ç”¨æˆ·æ¶ˆæ¯\n\n      // 2. è°ƒç”¨AIsiriæ™ºèƒ½è°ƒåº¦\n      console.log('\\nğŸš€ å¼€å§‹æ™ºèƒ½è°ƒåº¦å¤„ç†è¯­éŸ³è¾“å…¥...');\n      const response = await aisiriService.dispatch(voiceData.transcription, this.currentSessionId);\n\n      // 3. å¤„ç†æ™ºèƒ½è°ƒåº¦å“åº”ï¼Œç”Ÿæˆè¯­éŸ³å›å¤\n      await this.handleVoiceDispatchResponse(response, voiceData);\n    } catch (error) {\n      console.error('âŒ è¯­éŸ³æ™ºèƒ½è°ƒåº¦å¤„ç†å¤±è´¥:', error);\n      this.addVoiceMessage({\n        transcription: 'æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›æŠ€æœ¯é—®é¢˜ã€‚è¯·ç¨åå†è¯•ï¼Œæˆ–è€…å°è¯•é‡æ–°æè¿°ä½ çš„éœ€æ±‚ã€‚',\n        duration: 3,\n        isUser: false\n      }, false); // falseè¡¨ç¤ºæ˜¯AIæ¶ˆæ¯\n    } finally {\n      this.isProcessing = false;\n    }\n  }\n\n  /**\n   * å¤„ç†è¯­éŸ³æ™ºèƒ½è°ƒåº¦å“åº” - AIå›å¤ä¿æŒæ–‡å­—å½¢å¼\n   */\n  async handleVoiceDispatchResponse(response, originalVoiceData) {\n    if (!response.success) {\n      // å¤„ç†é”™è¯¯å“åº”\n      const errorMessage = response.error || 'æŠ±æ­‰ï¼Œç³»ç»Ÿé‡åˆ°äº†é—®é¢˜ã€‚';\n      this.addAIMessage(errorMessage, MESSAGE_TYPES.ERROR, {\n        apiError: response.error\n      });\n      return;\n    }\n    const {\n      data\n    } = response;\n\n    // AIå›å¤ä¿æŒæ–‡å­—å½¢å¼ï¼Œä¸è½¬æ¢ä¸ºè¯­éŸ³\n    this.addAIMessage(data.response, MESSAGE_TYPES.TEXT, {\n      intents: data.intents,\n      servicesExecuted: data.servicesExecuted,\n      taskCreated: data.taskCreated,\n      scheduleAdjusted: data.scheduleAdjusted,\n      emotionalSupport: data.emotionalSupport,\n      processingTime: response.processingTime,\n      isVoiceInput: true // æ ‡è®°è¿™æ˜¯æ¥è‡ªè¯­éŸ³è¾“å…¥çš„å›å¤\n    });\n\n    // å¦‚æœæœ‰ä»»åŠ¡åˆ›å»ºï¼Œæ·»åŠ ä»»åŠ¡åˆ›å»ºæ¶ˆæ¯\n    if (data.taskCreated) {\n      this.addTaskCreatedMessage(data.taskCreated);\n    }\n\n    // å¦‚æœæœ‰æ—¥ç¨‹è°ƒæ•´ï¼Œæ·»åŠ æ—¥ç¨‹è°ƒæ•´æ¶ˆæ¯\n    if (data.scheduleAdjusted) {\n      this.addScheduleAdjustedMessage(data.scheduleAdjusted);\n    }\n\n    // é€šçŸ¥ä»»åŠ¡é¡µåˆ·æ–°ï¼ˆå¦‚æœæœ‰ä»»åŠ¡ç›¸å…³æ“ä½œï¼‰\n    if (data.taskCreated || data.scheduleAdjusted) {\n      try {\n        window.dispatchEvent(new CustomEvent('ai-dispatch-completed', {\n          detail: {\n            taskCreated: data.taskCreated,\n            scheduleAdjusted: data.scheduleAdjusted,\n            intents: data.intents\n          }\n        }));\n      } catch (_) {\n        // noop: éƒ¨åˆ†ç¯å¢ƒä¸‹ window ä¸å¯ç”¨\n      }\n    }\n  }\n\n  /**\n   * å¤„ç†æ™ºèƒ½è°ƒåº¦å“åº”\n   */\n  async handleDispatchResponse(response) {\n    if (!response.success) {\n      // å¤„ç†é”™è¯¯å“åº”\n      const errorMessage = response.error || 'æŠ±æ­‰ï¼Œç³»ç»Ÿé‡åˆ°äº†é—®é¢˜ã€‚';\n      this.addAIMessage(errorMessage, MESSAGE_TYPES.ERROR, {\n        apiError: response.error\n      });\n      return;\n    }\n    const {\n      data\n    } = response;\n\n    // æ·»åŠ AIå›å¤\n    this.addAIMessage(data.response, MESSAGE_TYPES.TEXT, {\n      intents: data.intents,\n      servicesExecuted: data.servicesExecuted,\n      taskCreated: data.taskCreated,\n      scheduleAdjusted: data.scheduleAdjusted,\n      emotionalSupport: data.emotionalSupport,\n      processingTime: response.processingTime\n    });\n\n    // å¦‚æœæœ‰ä»»åŠ¡åˆ›å»ºï¼Œæ·»åŠ ä»»åŠ¡åˆ›å»ºæ¶ˆæ¯\n    if (data.taskCreated) {\n      this.addTaskCreatedMessage(data.taskCreated);\n    }\n\n    // å¦‚æœæœ‰æ—¥ç¨‹è°ƒæ•´ï¼Œæ·»åŠ æ—¥ç¨‹è°ƒæ•´æ¶ˆæ¯\n    if (data.scheduleAdjusted) {\n      this.addScheduleAdjustedMessage(data.scheduleAdjusted);\n    }\n\n    // é€šçŸ¥ä»»åŠ¡é¡µåˆ·æ–°ï¼ˆå¦‚æœæœ‰ä»»åŠ¡ç›¸å…³æ“ä½œï¼‰\n    if (data.taskCreated || data.scheduleAdjusted) {\n      try {\n        window.dispatchEvent(new CustomEvent('ai-dispatch-completed', {\n          detail: {\n            taskCreated: data.taskCreated,\n            scheduleAdjusted: data.scheduleAdjusted,\n            intents: data.intents\n          }\n        }));\n      } catch (_) {\n        // noop: éƒ¨åˆ†ç¯å¢ƒä¸‹ window ä¸å¯ç”¨\n      }\n    }\n  }\n\n  /**\n   * æ·»åŠ ä»»åŠ¡åˆ›å»ºæˆåŠŸæ¶ˆæ¯\n   */\n  addTaskCreatedMessage(task) {\n    let message = `âœ… ä»»åŠ¡å·²åˆ›å»ºï¼š${task.title}`;\n    if (task.scheduledTime) {\n      message += `ï¼Œå®‰æ’åœ¨ ${task.date} ${task.scheduledTime}`;\n    }\n    this.addAIMessage(message, MESSAGE_TYPES.TASK_CREATED, {\n      task: task\n    });\n  }\n\n  /**\n   * æ·»åŠ æ—¥ç¨‹è°ƒæ•´æ¶ˆæ¯\n   */\n  addScheduleAdjustedMessage(scheduleInfo) {\n    const message = 'â° æ—¥ç¨‹å·²æ ¹æ®ä½ çš„éœ€æ±‚è¿›è¡Œè°ƒæ•´';\n    this.addAIMessage(message, MESSAGE_TYPES.SCHEDULE_ADJUSTED, {\n      scheduleInfo: scheduleInfo\n    });\n  }\n\n  /**\n   * æ£€æŸ¥æ˜¯å¦æ­£åœ¨å¤„ç†ä¸­\n   */\n  isCurrentlyProcessing() {\n    return this.isProcessing;\n  }\n\n  /**\n   * è·å–å½“å‰ä¼šè¯ID\n   */\n  getCurrentSessionId() {\n    return this.currentSessionId;\n  }\n\n  /**\n   * è®¾ç½®ä¼šè¯ID\n   */\n  setSessionId(sessionId) {\n    this.currentSessionId = sessionId;\n    console.log(`ğŸ”„ è®¾ç½®ä¼šè¯ID: ${sessionId}`);\n  }\n\n  /**\n   * åˆ›å»ºæ–°ä¼šè¯\n   */\n  createNewSession() {\n    this.currentSessionId = aisiriService.createNewSession();\n    console.log(`ğŸ†• åˆ›å»ºæ–°ä¼šè¯: ${this.currentSessionId}`);\n    return this.currentSessionId;\n  }\n\n  /**\n   * æ¸…é™¤æ‰€æœ‰æ¶ˆæ¯\n   */\n  clearMessages() {\n    this.messages = [];\n    this.currentSessionId = null;\n    this.addWelcomeMessage();\n    console.log('ğŸ§¹ æ¶ˆæ¯å†å²å·²æ¸…é™¤');\n  }\n\n  /**\n   * å¯¼å‡ºæ¶ˆæ¯å†å²ï¼ˆç”¨äºè°ƒè¯•ï¼‰\n   */\n  exportMessages() {\n    return {\n      messages: this.getMessages(),\n      sessionId: this.currentSessionId,\n      timestamp: new Date().toISOString()\n    };\n  }\n}\n\n// åˆ›å»ºå•ä¾‹å®ä¾‹\nconst messageService = new MessageService();\nexport default messageService;","map":{"version":3,"names":["aisiriService","MESSAGE_TYPES","SENDERS","generateMessageId","Date","now","Math","random","toString","substr","createMessage","content","sender","AI","type","TEXT","metadata","id","timestamp","isUser","USER","MessageService","constructor","messages","isProcessing","currentSessionId","addWelcomeMessage","console","log","welcomeMessage","push","getMessages","addUserMessage","messageType","startsWith","substring","message","addAIMessage","length","addVoiceMessage","voiceData","VOICE","duration","transcription","ceil","audioUrl","audioFile","addSystemMessage","SYSTEM","processUserInput","userInput","response","dispatch","handleDispatchResponse","error","ERROR","processVoiceInput","handleVoiceDispatchResponse","originalVoiceData","success","errorMessage","apiError","data","intents","servicesExecuted","taskCreated","scheduleAdjusted","emotionalSupport","processingTime","isVoiceInput","addTaskCreatedMessage","addScheduleAdjustedMessage","window","dispatchEvent","CustomEvent","detail","_","task","title","scheduledTime","date","TASK_CREATED","scheduleInfo","SCHEDULE_ADJUSTED","isCurrentlyProcessing","getCurrentSessionId","setSessionId","sessionId","createNewSession","clearMessages","exportMessages","toISOString","messageService"],"sources":["C:/Users/wuby/OneDrive/Desktop/backend(1) 3/timer/src/AIsiri/services/messageService.js"],"sourcesContent":["/**\n * AIsiri æ™ºèƒ½è°ƒåº¦æ¶ˆæ¯å¤„ç†æœåŠ¡\n * å¤„ç†èŠå¤©æ¶ˆæ¯çš„æ ¼å¼åŒ–ã€å­˜å‚¨å’ŒçŠ¶æ€ç®¡ç†\n */\n\nimport aisiriService from './aiApi.js'\nimport { MESSAGE_TYPES, SENDERS } from '../types/index.js'\n\n/**\n * ç”Ÿæˆå”¯ä¸€æ¶ˆæ¯ID\n */\nfunction generateMessageId() {\n  return `msg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n}\n\n/**\n * åˆ›å»ºæ¶ˆæ¯å¯¹è±¡\n */\nfunction createMessage(content, sender = SENDERS.AI, type = MESSAGE_TYPES.TEXT, metadata = {}) {\n  return {\n    id: generateMessageId(),\n    content,\n    sender,\n    type,\n    timestamp: new Date(),\n    metadata,\n    isUser: sender === SENDERS.USER\n  }\n}\n\n/**\n * æ¶ˆæ¯æœåŠ¡ç±»\n */\nclass MessageService {\n  constructor() {\n    this.messages = []\n    this.isProcessing = false\n    this.currentSessionId = null\n    \n    // æ·»åŠ åˆå§‹æ¬¢è¿æ¶ˆæ¯\n    this.addWelcomeMessage()\n    \n    console.log('ğŸ’¬ AIsiriæ™ºèƒ½è°ƒåº¦æ¶ˆæ¯æœåŠ¡åˆå§‹åŒ–å®Œæˆ')\n  }\n\n  /**\n   * æ·»åŠ æ¬¢è¿æ¶ˆæ¯\n   */\n  addWelcomeMessage() {\n    const welcomeMessage = createMessage(\n      'ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIæ™ºèƒ½åŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å¸®åŠ©ä½ åˆ›å»ºä»»åŠ¡ã€å®‰æ’æ—¥ç¨‹ã€æä¾›æƒ…ç»ªæ”¯æŒï¼Œä»¥åŠè°ƒç”¨å„ç§å¤–éƒ¨å·¥å…·ã€‚è¯·å‘Šè¯‰æˆ‘ä½ éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ',\n      SENDERS.AI,\n      MESSAGE_TYPES.TEXT\n    )\n    this.messages.push(welcomeMessage)\n  }\n\n  /**\n   * è·å–æ‰€æœ‰æ¶ˆæ¯\n   */\n  getMessages() {\n    return [...this.messages]\n  }\n\n  /**\n   * æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n   */\n  addUserMessage(content) {\n    // æ£€æŸ¥æ˜¯å¦æ˜¯å›¾ç‰‡æ¶ˆæ¯\n    let messageType = MESSAGE_TYPES.TEXT\n    if (content && content.startsWith('[å›¾ç‰‡]')) {\n      messageType = 'IMAGE' // ä½¿ç”¨è‡ªå®šä¹‰å›¾ç‰‡ç±»å‹\n    }\n    \n    // å¦‚æœæ˜¯åˆ†æç»“æœæ¶ˆæ¯ï¼Œä¸æ·»åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨ï¼ˆç”¨æˆ·ä¸éœ€è¦çœ‹åˆ°ï¼‰\n    if (content && content.startsWith('å›¾ç‰‡åˆ†æç»“æœï¼š')) {\n      console.log(`ğŸ“ å›¾ç‰‡åˆ†æç»“æœï¼ˆéšè—ï¼‰ï¼š${content.substring(0, 50)}...`)\n      // ä¸æ·»åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨ï¼Œåªç”¨äºæ™ºèƒ½è°ƒåº¦\n      return null\n    }\n    \n    const message = createMessage(content, SENDERS.USER, messageType)\n    this.messages.push(message)\n    \n    console.log(`ğŸ“ ç”¨æˆ·æ¶ˆæ¯: ${content}`)\n    return message\n  }\n\n  /**\n   * æ·»åŠ AIæ¶ˆæ¯\n   */\n  addAIMessage(content, type = MESSAGE_TYPES.TEXT, metadata = {}) {\n    const message = createMessage(content, SENDERS.AI, type, metadata)\n    this.messages.push(message)\n    \n    console.log(`ğŸ¤– AIå›å¤: ${content.substring(0, 50)}${content.length > 50 ? '...' : ''}`)\n    return message\n  }\n\n  /**\n   * æ·»åŠ è¯­éŸ³æ¶ˆæ¯\n   */\n  addVoiceMessage(voiceData, isUser = false) {\n    const message = {\n      id: Date.now() + Math.random(),\n      type: MESSAGE_TYPES.VOICE,\n      isUser: isUser,\n      timestamp: new Date(),\n      duration: voiceData.transcription ? Math.ceil(voiceData.transcription.length / 5) : 3, // æ ¹æ®æ–‡å­—é•¿åº¦ä¼°ç®—æ—¶é•¿\n      transcription: voiceData.transcription || '',\n      audioUrl: voiceData.audioUrl || '',\n      audioFile: voiceData.audioFile || null\n    }\n    \n    this.messages.push(message)\n    console.log(`ğŸ¤ ${isUser ? 'ç”¨æˆ·' : 'AI'}è¯­éŸ³æ¶ˆæ¯å·²æ·»åŠ : ${voiceData.transcription?.substring(0, 50) || 'æ— æ–‡å­—'}...`)\n    \n    return message\n  }\n\n  /**\n   * æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯\n   */\n  addSystemMessage(content) {\n    const message = createMessage(content, SENDERS.SYSTEM, MESSAGE_TYPES.TEXT)\n    this.messages.push(message)\n    \n    console.log(`âš™ï¸  ç³»ç»Ÿæ¶ˆæ¯: ${content}`)\n    return message\n  }\n\n  /**\n   * å¤„ç†ç”¨æˆ·è¾“å…¥çš„ä¸»è¦æ–¹æ³• - ä½¿ç”¨æ™ºèƒ½è°ƒåº¦ç³»ç»Ÿ\n   */\n  async processUserInput(userInput) {\n    if (this.isProcessing) {\n      console.log('â³ æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨ç­‰...')\n      return\n    }\n\n    try {\n      this.isProcessing = true\n      \n      // 1. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n      this.addUserMessage(userInput)\n      \n      // 2. è°ƒç”¨AIsiriæ™ºèƒ½è°ƒåº¦\n      console.log('\\nğŸš€ å¼€å§‹æ™ºèƒ½è°ƒåº¦å¤„ç†...')\n      const response = await aisiriService.dispatch(userInput, this.currentSessionId)\n      \n      // 3. å¤„ç†æ™ºèƒ½è°ƒåº¦å“åº”\n      await this.handleDispatchResponse(response)\n      \n    } catch (error) {\n      console.error('âŒ æ™ºèƒ½è°ƒåº¦å¤„ç†å¤±è´¥:', error)\n      this.addAIMessage(\n        'æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›æŠ€æœ¯é—®é¢˜ã€‚è¯·ç¨åå†è¯•ï¼Œæˆ–è€…å°è¯•é‡æ–°æè¿°ä½ çš„éœ€æ±‚ã€‚',\n        MESSAGE_TYPES.ERROR,\n        { error: error.message }\n      )\n    } finally {\n      this.isProcessing = false\n    }\n  }\n\n  /**\n   * å¤„ç†ç”¨æˆ·è¯­éŸ³è¾“å…¥ - è¿”å›è¯­éŸ³å›å¤\n   */\n  async processVoiceInput(voiceData) {\n    if (this.isProcessing) {\n      console.log('â³ æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨ç­‰...')\n      return\n    }\n\n    try {\n      this.isProcessing = true\n      \n      // 1. æ·»åŠ ç”¨æˆ·è¯­éŸ³æ¶ˆæ¯\n      this.addVoiceMessage(voiceData, true) // trueè¡¨ç¤ºæ˜¯ç”¨æˆ·æ¶ˆæ¯\n      \n      // 2. è°ƒç”¨AIsiriæ™ºèƒ½è°ƒåº¦\n      console.log('\\nğŸš€ å¼€å§‹æ™ºèƒ½è°ƒåº¦å¤„ç†è¯­éŸ³è¾“å…¥...')\n      const response = await aisiriService.dispatch(voiceData.transcription, this.currentSessionId)\n      \n      // 3. å¤„ç†æ™ºèƒ½è°ƒåº¦å“åº”ï¼Œç”Ÿæˆè¯­éŸ³å›å¤\n      await this.handleVoiceDispatchResponse(response, voiceData)\n      \n    } catch (error) {\n      console.error('âŒ è¯­éŸ³æ™ºèƒ½è°ƒåº¦å¤„ç†å¤±è´¥:', error)\n      this.addVoiceMessage({\n        transcription: 'æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›æŠ€æœ¯é—®é¢˜ã€‚è¯·ç¨åå†è¯•ï¼Œæˆ–è€…å°è¯•é‡æ–°æè¿°ä½ çš„éœ€æ±‚ã€‚',\n        duration: 3,\n        isUser: false\n      }, false) // falseè¡¨ç¤ºæ˜¯AIæ¶ˆæ¯\n    } finally {\n      this.isProcessing = false\n    }\n  }\n\n  /**\n   * å¤„ç†è¯­éŸ³æ™ºèƒ½è°ƒåº¦å“åº” - AIå›å¤ä¿æŒæ–‡å­—å½¢å¼\n   */\n  async handleVoiceDispatchResponse(response, originalVoiceData) {\n    if (!response.success) {\n      // å¤„ç†é”™è¯¯å“åº”\n      const errorMessage = response.error || 'æŠ±æ­‰ï¼Œç³»ç»Ÿé‡åˆ°äº†é—®é¢˜ã€‚'\n      this.addAIMessage(errorMessage, MESSAGE_TYPES.ERROR, { apiError: response.error })\n      return\n    }\n\n    const { data } = response\n    \n    // AIå›å¤ä¿æŒæ–‡å­—å½¢å¼ï¼Œä¸è½¬æ¢ä¸ºè¯­éŸ³\n    this.addAIMessage(data.response, MESSAGE_TYPES.TEXT, {\n      intents: data.intents,\n      servicesExecuted: data.servicesExecuted,\n      taskCreated: data.taskCreated,\n      scheduleAdjusted: data.scheduleAdjusted,\n      emotionalSupport: data.emotionalSupport,\n      processingTime: response.processingTime,\n      isVoiceInput: true // æ ‡è®°è¿™æ˜¯æ¥è‡ªè¯­éŸ³è¾“å…¥çš„å›å¤\n    })\n    \n    // å¦‚æœæœ‰ä»»åŠ¡åˆ›å»ºï¼Œæ·»åŠ ä»»åŠ¡åˆ›å»ºæ¶ˆæ¯\n    if (data.taskCreated) {\n      this.addTaskCreatedMessage(data.taskCreated)\n    }\n\n    // å¦‚æœæœ‰æ—¥ç¨‹è°ƒæ•´ï¼Œæ·»åŠ æ—¥ç¨‹è°ƒæ•´æ¶ˆæ¯\n    if (data.scheduleAdjusted) {\n      this.addScheduleAdjustedMessage(data.scheduleAdjusted)\n    }\n\n    // é€šçŸ¥ä»»åŠ¡é¡µåˆ·æ–°ï¼ˆå¦‚æœæœ‰ä»»åŠ¡ç›¸å…³æ“ä½œï¼‰\n    if (data.taskCreated || data.scheduleAdjusted) {\n      try {\n        window.dispatchEvent(new CustomEvent('ai-dispatch-completed', {\n          detail: {\n            taskCreated: data.taskCreated,\n            scheduleAdjusted: data.scheduleAdjusted,\n            intents: data.intents\n          }\n        }))\n      } catch (_) {\n        // noop: éƒ¨åˆ†ç¯å¢ƒä¸‹ window ä¸å¯ç”¨\n      }\n    }\n  }\n\n  /**\n   * å¤„ç†æ™ºèƒ½è°ƒåº¦å“åº”\n   */\n  async handleDispatchResponse(response) {\n    if (!response.success) {\n      // å¤„ç†é”™è¯¯å“åº”\n      const errorMessage = response.error || 'æŠ±æ­‰ï¼Œç³»ç»Ÿé‡åˆ°äº†é—®é¢˜ã€‚'\n      this.addAIMessage(errorMessage, MESSAGE_TYPES.ERROR, { apiError: response.error })\n      return\n    }\n\n    const { data } = response\n    \n    // æ·»åŠ AIå›å¤\n    this.addAIMessage(data.response, MESSAGE_TYPES.TEXT, {\n      intents: data.intents,\n      servicesExecuted: data.servicesExecuted,\n      taskCreated: data.taskCreated,\n      scheduleAdjusted: data.scheduleAdjusted,\n      emotionalSupport: data.emotionalSupport,\n      processingTime: response.processingTime\n    })\n\n    // å¦‚æœæœ‰ä»»åŠ¡åˆ›å»ºï¼Œæ·»åŠ ä»»åŠ¡åˆ›å»ºæ¶ˆæ¯\n    if (data.taskCreated) {\n      this.addTaskCreatedMessage(data.taskCreated)\n    }\n\n    // å¦‚æœæœ‰æ—¥ç¨‹è°ƒæ•´ï¼Œæ·»åŠ æ—¥ç¨‹è°ƒæ•´æ¶ˆæ¯\n    if (data.scheduleAdjusted) {\n      this.addScheduleAdjustedMessage(data.scheduleAdjusted)\n    }\n\n    // é€šçŸ¥ä»»åŠ¡é¡µåˆ·æ–°ï¼ˆå¦‚æœæœ‰ä»»åŠ¡ç›¸å…³æ“ä½œï¼‰\n    if (data.taskCreated || data.scheduleAdjusted) {\n      try {\n        window.dispatchEvent(new CustomEvent('ai-dispatch-completed', {\n          detail: {\n            taskCreated: data.taskCreated,\n            scheduleAdjusted: data.scheduleAdjusted,\n            intents: data.intents\n          }\n        }))\n      } catch (_) {\n        // noop: éƒ¨åˆ†ç¯å¢ƒä¸‹ window ä¸å¯ç”¨\n      }\n    }\n  }\n\n  /**\n   * æ·»åŠ ä»»åŠ¡åˆ›å»ºæˆåŠŸæ¶ˆæ¯\n   */\n  addTaskCreatedMessage(task) {\n    let message = `âœ… ä»»åŠ¡å·²åˆ›å»ºï¼š${task.title}`\n    if (task.scheduledTime) {\n      message += `ï¼Œå®‰æ’åœ¨ ${task.date} ${task.scheduledTime}`\n    }\n    \n    this.addAIMessage(message, MESSAGE_TYPES.TASK_CREATED, {\n      task: task\n    })\n  }\n\n  /**\n   * æ·»åŠ æ—¥ç¨‹è°ƒæ•´æ¶ˆæ¯\n   */\n  addScheduleAdjustedMessage(scheduleInfo) {\n    const message = 'â° æ—¥ç¨‹å·²æ ¹æ®ä½ çš„éœ€æ±‚è¿›è¡Œè°ƒæ•´'\n    \n    this.addAIMessage(message, MESSAGE_TYPES.SCHEDULE_ADJUSTED, {\n      scheduleInfo: scheduleInfo\n    })\n  }\n\n  /**\n   * æ£€æŸ¥æ˜¯å¦æ­£åœ¨å¤„ç†ä¸­\n   */\n  isCurrentlyProcessing() {\n    return this.isProcessing\n  }\n\n  /**\n   * è·å–å½“å‰ä¼šè¯ID\n   */\n  getCurrentSessionId() {\n    return this.currentSessionId\n  }\n\n  /**\n   * è®¾ç½®ä¼šè¯ID\n   */\n  setSessionId(sessionId) {\n    this.currentSessionId = sessionId\n    console.log(`ğŸ”„ è®¾ç½®ä¼šè¯ID: ${sessionId}`)\n  }\n\n  /**\n   * åˆ›å»ºæ–°ä¼šè¯\n   */\n  createNewSession() {\n    this.currentSessionId = aisiriService.createNewSession()\n    console.log(`ğŸ†• åˆ›å»ºæ–°ä¼šè¯: ${this.currentSessionId}`)\n    return this.currentSessionId\n  }\n\n  /**\n   * æ¸…é™¤æ‰€æœ‰æ¶ˆæ¯\n   */\n  clearMessages() {\n    this.messages = []\n    this.currentSessionId = null\n    this.addWelcomeMessage()\n    console.log('ğŸ§¹ æ¶ˆæ¯å†å²å·²æ¸…é™¤')\n  }\n\n  /**\n   * å¯¼å‡ºæ¶ˆæ¯å†å²ï¼ˆç”¨äºè°ƒè¯•ï¼‰\n   */\n  exportMessages() {\n    return {\n      messages: this.getMessages(),\n      sessionId: this.currentSessionId,\n      timestamp: new Date().toISOString()\n    }\n  }\n}\n\n// åˆ›å»ºå•ä¾‹å®ä¾‹\nconst messageService = new MessageService()\n\nexport default messageService"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}