{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array-buffer.detached.js\";\nimport \"core-js/modules/es.array-buffer.transfer.js\";\nimport \"core-js/modules/es.array-buffer.transfer-to-fixed-length.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport speechRecognitionService from '../../AIsiri/services/speechRecognitionService.js';\nimport { log } from '../../AIsiri/utils/logger.js';\nimport ImageAnalysisModal from './ImageAnalysisModal.vue';\nexport default {\n  name: 'MessageInput',\n  components: {\n    ImageAnalysisModal\n  },\n  data() {\n    return {\n      inputText: '',\n      isListening: false,\n      isProcessing: false,\n      recognitionResult: null,\n      recognitionStatusText: 'æ­£åœ¨è¯†åˆ«ä¸­...',\n      selectedFile: null,\n      showImageAnalysisModal: false,\n      // æ–°å¢å½•éŸ³ç›¸å…³çŠ¶æ€\n      mediaRecorder: null,\n      audioChunks: [],\n      recordingTime: 0,\n      recordingTimer: null,\n      stream: null,\n      // è§¦æ‘¸ç›¸å…³çŠ¶æ€\n      touchStartY: 0,\n      touchStartTime: 0,\n      shouldCancel: false,\n      // è¯­éŸ³æ¨¡å¼çŠ¶æ€\n      isVoiceMode: false,\n      // åŠ å·èœå•çŠ¶æ€\n      showPlusMenu: false\n    };\n  },\n  mounted() {\n    // æ·»åŠ å…¨å±€ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨\n    document.addEventListener('click', this.handleGlobalClick);\n  },\n  beforeUnmount() {\n    // ç§»é™¤å…¨å±€ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨\n    document.removeEventListener('click', this.handleGlobalClick);\n    // æ¸…ç†èµ„æº\n    if (this.isProcessing) {\n      speechRecognitionService.resetProcessingStatus();\n    }\n    // åœæ­¢å½•éŸ³æµ\n    if (this.stream) {\n      this.stream.getTracks().forEach(track => track.stop());\n    }\n    // åœæ­¢è®¡æ—¶å™¨\n    this.stopRecordingTimer();\n  },\n  methods: {\n    /**\n     * å‘é€æ–‡æœ¬æ¶ˆæ¯\n     */\n    sendMessage() {\n      if (!this.inputText.trim() || this.isProcessing) return;\n      log.user('å‘é€æ–‡æœ¬æ¶ˆæ¯', {\n        message: this.inputText\n      });\n      this.$emit('sendMessage', this.inputText);\n      this.inputText = '';\n    },\n    /**\n     * åˆ‡æ¢è¯­éŸ³/æ–‡å­—è¾“å…¥æ¨¡å¼\n     */\n    toggleVoiceMode() {\n      if (this.isProcessing) return;\n      this.isVoiceMode = !this.isVoiceMode;\n      if (this.isVoiceMode) {\n        // åˆ‡æ¢åˆ°è¯­éŸ³æ¨¡å¼\n        this.showToast('å·²åˆ‡æ¢åˆ°è¯­éŸ³è¾“å…¥æ¨¡å¼', 'info');\n        // èšç„¦åˆ°è¯­éŸ³è¾“å…¥åŒºåŸŸ\n        this.$nextTick(() => {\n          const voiceArea = this.$el.querySelector('.voice-input-area');\n          if (voiceArea) voiceArea.focus();\n        });\n      } else {\n        // åˆ‡æ¢åˆ°æ–‡å­—æ¨¡å¼\n        this.showToast('å·²åˆ‡æ¢åˆ°æ–‡å­—è¾“å…¥æ¨¡å¼', 'info');\n        // èšç„¦åˆ°æ–‡å­—è¾“å…¥æ¡†\n        this.$nextTick(() => {\n          const textInput = this.$el.querySelector('.message-input');\n          if (textInput) textInput.focus();\n        });\n      }\n    },\n    /**\n     * å¼€å§‹è¯­éŸ³è¾“å…¥ï¼ˆè§¦æ‘¸å¼€å§‹ï¼‰\n     */\n    async startVoiceInput(event) {\n      if (this.isProcessing || !this.isVoiceMode) return;\n\n      // è®°å½•è§¦æ‘¸å¼€å§‹ä½ç½®å’Œæ—¶é—´\n      if (event.type === 'touchstart') {\n        this.touchStartY = event.touches[0].clientY;\n        this.touchStartTime = Date.now();\n      } else {\n        this.touchStartY = event.clientY;\n        this.touchStartTime = Date.now();\n      }\n      this.shouldCancel = false;\n      await this.startRecording();\n    },\n    /**\n     * ç»“æŸè¯­éŸ³è¾“å…¥ï¼ˆè§¦æ‘¸ç»“æŸï¼‰\n     */\n    endVoiceInput() {\n      if (!this.isListening) return;\n\n      // æ£€æŸ¥æ˜¯å¦åº”è¯¥å–æ¶ˆ\n      if (this.shouldCancel) {\n        this.cancelRecording();\n      } else {\n        this.stopVoiceInput();\n      }\n    },\n    /**\n     * å¤„ç†è§¦æ‘¸ç§»åŠ¨ï¼ˆä¸Šæ»‘å–æ¶ˆï¼‰\n     */\n    handleTouchMove(event) {\n      if (!this.isListening) return;\n      const currentY = event.touches[0].clientY;\n      const deltaY = this.touchStartY - currentY;\n\n      // ä¸Šæ»‘è¶…è¿‡50pxæ ‡è®°ä¸ºå–æ¶ˆ\n      if (deltaY > 50) {\n        this.shouldCancel = true;\n      } else {\n        this.shouldCancel = false;\n      }\n    },\n    /**\n     * å–æ¶ˆè¯­éŸ³è¾“å…¥ï¼ˆé¼ æ ‡ç¦»å¼€ï¼‰\n     */\n    cancelVoiceInput() {\n      if (this.isListening) {\n        this.cancelRecording();\n      }\n    },\n    /**\n     * å¼€å§‹è¯­éŸ³è¾“å…¥ï¼ˆå®æ—¶å½•éŸ³ï¼‰\n     */\n    async startRecording() {\n      try {\n        log.info('å¼€å§‹å®æ—¶å½•éŸ³');\n\n        // è¯·æ±‚éº¦å…‹é£æƒé™\n        this.stream = await navigator.mediaDevices.getUserMedia({\n          audio: {\n            echoCancellation: true,\n            noiseSuppression: true,\n            sampleRate: 44100\n          }\n        });\n\n        // åˆ›å»ºMediaRecorder - ä½¿ç”¨åç«¯æ”¯æŒçš„æ ¼å¼\n        let mimeType = 'audio/wav';\n\n        // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒçš„æ ¼å¼ï¼Œä¼˜å…ˆä½¿ç”¨åç«¯æ”¯æŒçš„æ ¼å¼\n        if (MediaRecorder.isTypeSupported('audio/wav')) {\n          mimeType = 'audio/wav';\n        } else if (MediaRecorder.isTypeSupported('audio/mp4')) {\n          mimeType = 'audio/mp4';\n        } else if (MediaRecorder.isTypeSupported('audio/webm;codecs=opus')) {\n          mimeType = 'audio/webm;codecs=opus';\n        } else if (MediaRecorder.isTypeSupported('audio/webm')) {\n          mimeType = 'audio/webm';\n        }\n        this.mediaRecorder = new MediaRecorder(this.stream, {\n          mimeType: mimeType\n        });\n\n        // é‡ç½®å½•éŸ³çŠ¶æ€\n        this.audioChunks = [];\n        this.recordingTime = 0;\n\n        // å¼€å§‹å½•éŸ³\n        this.mediaRecorder.start();\n        this.isListening = true;\n\n        // å¼€å§‹è®¡æ—¶\n        this.startRecordingTimer();\n\n        // ç›‘å¬å½•éŸ³æ•°æ®\n        this.mediaRecorder.ondataavailable = event => {\n          if (event.data.size > 0) {\n            this.audioChunks.push(event.data);\n          }\n        };\n\n        // å½•éŸ³ç»“æŸå¤„ç†\n        this.mediaRecorder.onstop = () => {\n          this.handleRecordingComplete();\n        };\n        log.success('å®æ—¶å½•éŸ³å¼€å§‹');\n      } catch (error) {\n        log.error('å¯åŠ¨å½•éŸ³å¤±è´¥', error);\n        this.showToast('æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·æ£€æŸ¥æƒé™è®¾ç½®', 'error');\n\n        // å¦‚æœå®æ—¶å½•éŸ³å¤±è´¥ï¼Œå›é€€åˆ°æ–‡ä»¶é€‰æ‹©æ¨¡å¼\n        this.fallbackToFileInput();\n      }\n    },\n    /**\n     * åœæ­¢è¯­éŸ³è¾“å…¥\n     */\n    stopVoiceInput() {\n      if (this.mediaRecorder && this.isListening) {\n        log.info('åœæ­¢å®æ—¶å½•éŸ³');\n        this.mediaRecorder.stop();\n        this.isListening = false;\n        this.stopRecordingTimer();\n\n        // åœæ­¢éº¦å…‹é£æµ\n        if (this.stream) {\n          this.stream.getTracks().forEach(track => track.stop());\n          this.stream = null;\n        }\n      }\n    },\n    /**\n     * å–æ¶ˆå½•éŸ³\n     */\n    cancelRecording() {\n      if (this.mediaRecorder && this.isListening) {\n        log.info('å–æ¶ˆå½•éŸ³');\n        this.mediaRecorder.stop();\n        this.isListening = false;\n        this.stopRecordingTimer();\n\n        // åœæ­¢éº¦å…‹é£æµ\n        if (this.stream) {\n          this.stream.getTracks().forEach(track => track.stop());\n          this.stream = null;\n        }\n\n        // æ¸…ç†å½•éŸ³æ•°æ®\n        this.audioChunks = [];\n        this.recordingTime = 0;\n\n        // é‡ç½®çŠ¶æ€\n        this.shouldCancel = false;\n        this.showToast('å½•éŸ³å·²å–æ¶ˆ', 'info');\n      }\n    },\n    /**\n     * å¼€å§‹å½•éŸ³è®¡æ—¶å™¨\n     */\n    startRecordingTimer() {\n      this.recordingTimer = setInterval(() => {\n        this.recordingTime++;\n      }, 1000);\n    },\n    /**\n     * åœæ­¢å½•éŸ³è®¡æ—¶å™¨\n     */\n    stopRecordingTimer() {\n      if (this.recordingTimer) {\n        clearInterval(this.recordingTimer);\n        this.recordingTimer = null;\n      }\n    },\n    /**\n     * å¤„ç†å½•éŸ³å®Œæˆ\n     */\n    async handleRecordingComplete() {\n      try {\n        if (this.audioChunks.length === 0) {\n          this.showToast('å½•éŸ³å¤±è´¥ï¼Œæ²¡æœ‰å½•åˆ¶åˆ°éŸ³é¢‘', 'error');\n          return;\n        }\n\n        // åˆ›å»ºéŸ³é¢‘Blob\n        const audioBlob = new Blob(this.audioChunks, {\n          type: this.mediaRecorder.mimeType\n        });\n\n        // è½¬æ¢ä¸ºåç«¯æ”¯æŒçš„æ ¼å¼\n        const convertedAudioFile = await this.convertAudioFormat(audioBlob);\n        log.info('å½•éŸ³å®Œæˆï¼Œå¼€å§‹å¤„ç†', {\n          fileName: convertedAudioFile.name,\n          fileSize: convertedAudioFile.size,\n          duration: this.recordingTime,\n          originalType: this.mediaRecorder.mimeType,\n          convertedType: convertedAudioFile.type\n        });\n\n        // åœ¨è¯­éŸ³æ¨¡å¼ä¸‹ç›´æ¥å‘é€è¯­éŸ³æ¶ˆæ¯ï¼Œå¦åˆ™æ˜¾ç¤ºé¢„è§ˆ\n        if (this.isVoiceMode) {\n          await this.sendVoiceMessage(convertedAudioFile);\n        } else {\n          await this.processAudioFile(convertedAudioFile);\n        }\n      } catch (error) {\n        log.error('å¤„ç†å½•éŸ³å¤±è´¥', error);\n        this.showToast(`å¤„ç†å½•éŸ³å¤±è´¥: ${error.message}`, 'error');\n      } finally {\n        // æ¸…ç†çŠ¶æ€\n        this.audioChunks = [];\n        this.recordingTime = 0;\n        this.mediaRecorder = null;\n      }\n    },\n    /**\n     * è½¬æ¢éŸ³é¢‘æ ¼å¼ä¸ºåç«¯æ”¯æŒçš„æ ¼å¼\n     */\n    async convertAudioFormat(audioBlob) {\n      try {\n        // å¦‚æœå·²ç»æ˜¯æ”¯æŒçš„æ ¼å¼ï¼Œç›´æ¥è¿”å›\n        const supportedTypes = ['audio/wav', 'audio/mpeg', 'audio/mp4', 'audio/aac', 'audio/flac'];\n        if (supportedTypes.includes(audioBlob.type)) {\n          return new File([audioBlob], `recording_${Date.now()}.wav`, {\n            type: audioBlob.type\n          });\n        }\n\n        // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡è¿›è¡Œæ ¼å¼è½¬æ¢\n        const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n        const arrayBuffer = await audioBlob.arrayBuffer();\n        const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n\n        // è½¬æ¢ä¸ºWAVæ ¼å¼\n        const wavBlob = this.audioBufferToWav(audioBuffer);\n\n        // åˆ›å»ºæ–°çš„Fileå¯¹è±¡\n        const wavFile = new File([wavBlob], `recording_${Date.now()}.wav`, {\n          type: 'audio/wav'\n        });\n        log.info('éŸ³é¢‘æ ¼å¼è½¬æ¢å®Œæˆ', {\n          originalType: audioBlob.type,\n          convertedType: 'audio/wav',\n          originalSize: audioBlob.size,\n          convertedSize: wavFile.size\n        });\n        return wavFile;\n      } catch (error) {\n        log.error('éŸ³é¢‘æ ¼å¼è½¬æ¢å¤±è´¥', error);\n        // å¦‚æœè½¬æ¢å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨åŸå§‹æ ¼å¼\n        this.showToast('éŸ³é¢‘æ ¼å¼è½¬æ¢å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹æ ¼å¼', 'warning');\n        return new File([audioBlob], `recording_${Date.now()}.wav`, {\n          type: 'audio/wav'\n        });\n      }\n    },\n    /**\n     * å°†AudioBufferè½¬æ¢ä¸ºWAVæ ¼å¼\n     */\n    audioBufferToWav(buffer) {\n      const length = buffer.length;\n      const numberOfChannels = buffer.numberOfChannels;\n      const sampleRate = buffer.sampleRate;\n      const arrayBuffer = new ArrayBuffer(44 + length * numberOfChannels * 2);\n      const view = new DataView(arrayBuffer);\n\n      // WAVæ–‡ä»¶å¤´\n      const writeString = (offset, string) => {\n        for (let i = 0; i < string.length; i++) {\n          view.setUint8(offset + i, string.charCodeAt(i));\n        }\n      };\n      writeString(0, 'RIFF');\n      view.setUint32(4, 36 + length * numberOfChannels * 2, true);\n      writeString(8, 'WAVE');\n      writeString(12, 'fmt ');\n      view.setUint32(16, 16, true);\n      view.setUint16(20, 1, true);\n      view.setUint16(22, numberOfChannels, true);\n      view.setUint32(24, sampleRate, true);\n      view.setUint32(28, sampleRate * numberOfChannels * 2, true);\n      view.setUint16(32, numberOfChannels * 2, true);\n      view.setUint16(34, 16, true);\n      writeString(36, 'data');\n      view.setUint32(40, length * numberOfChannels * 2, true);\n\n      // å†™å…¥éŸ³é¢‘æ•°æ®\n      let offset = 44;\n      for (let i = 0; i < length; i++) {\n        for (let channel = 0; channel < numberOfChannels; channel++) {\n          const sample = Math.max(-1, Math.min(1, buffer.getChannelData(channel)[i]));\n          view.setInt16(offset, sample < 0 ? sample * 0x8000 : sample * 0x7FFF, true);\n          offset += 2;\n        }\n      }\n      return new Blob([arrayBuffer], {\n        type: 'audio/wav'\n      });\n    },\n    /**\n     * å‘é€è¯­éŸ³æ¶ˆæ¯\n     */\n    async sendVoiceMessage(audioFile) {\n      try {\n        this.isProcessing = true;\n        this.recognitionStatusText = 'æ­£åœ¨å¤„ç†è¯­éŸ³æ¶ˆæ¯...';\n        log.info('å¼€å§‹å¤„ç†è¯­éŸ³æ¶ˆæ¯', {\n          fileName: audioFile.name,\n          fileSize: audioFile.size\n        });\n\n        // éªŒè¯æ–‡ä»¶\n        const validation = speechRecognitionService.validateAudioFile(audioFile);\n        if (!validation.isValid) {\n          throw new Error(validation.errors.join(', '));\n        }\n\n        // å¼€å§‹è¯­éŸ³è¯†åˆ«\n        this.recognitionStatusText = 'æ­£åœ¨è¯†åˆ«ä¸­ï¼Œè¯·ç¨å€™...';\n        const result = await speechRecognitionService.recognizeVoice(audioFile);\n        if (result.success) {\n          // å‘é€è¯­éŸ³æ¶ˆæ¯\n          this.$emit('sendVoiceMessage', {\n            type: 'voice',\n            audioFile: audioFile,\n            transcription: result.transcription,\n            audioUrl: result.audioUrl,\n            duration: this.recordingTime\n          });\n          log.success('è¯­éŸ³æ¶ˆæ¯å‘é€æˆåŠŸ', {\n            transcription: result.transcription\n          });\n          this.showToast('è¯­éŸ³æ¶ˆæ¯å‘é€æˆåŠŸï¼', 'success');\n        } else {\n          throw new Error('è¯†åˆ«å¤±è´¥');\n        }\n      } catch (error) {\n        log.error('è¯­éŸ³æ¶ˆæ¯å‘é€å¤±è´¥', error);\n        this.recognitionStatusText = 'å‘é€å¤±è´¥';\n        this.showToast(`è¯­éŸ³æ¶ˆæ¯å‘é€å¤±è´¥: ${error.message}`, 'error');\n      } finally {\n        this.isProcessing = false;\n        this.isListening = false;\n        this.selectedFile = null;\n\n        // æ¸…ç©ºæ–‡ä»¶è¾“å…¥\n        if (this.$refs.fileInput) {\n          this.$refs.fileInput.value = '';\n        }\n      }\n    },\n    /**\n     * å¤„ç†éŸ³é¢‘æ–‡ä»¶ï¼ˆå½•éŸ³æˆ–ä¸Šä¼ ï¼‰\n     */\n    async processAudioFile(audioFile) {\n      try {\n        this.isProcessing = true;\n        this.recognitionStatusText = 'æ­£åœ¨ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶...';\n        log.info('å¼€å§‹è¯­éŸ³è¯†åˆ«', {\n          fileName: audioFile.name,\n          fileSize: audioFile.size\n        });\n\n        // éªŒè¯æ–‡ä»¶\n        const validation = speechRecognitionService.validateAudioFile(audioFile);\n        if (!validation.isValid) {\n          throw new Error(validation.errors.join(', '));\n        }\n\n        // å¼€å§‹è¯­éŸ³è¯†åˆ«\n        this.recognitionStatusText = 'æ­£åœ¨è¯†åˆ«ä¸­ï¼Œè¯·ç¨å€™...';\n        const result = await speechRecognitionService.recognizeVoice(audioFile);\n        if (result.success) {\n          this.recognitionResult = result;\n          this.recognitionStatusText = 'è¯†åˆ«å®Œæˆ';\n          log.success('è¯­éŸ³è¯†åˆ«æˆåŠŸ', {\n            transcription: result.transcription\n          });\n\n          // è‡ªåŠ¨å¡«å……åˆ°è¾“å…¥æ¡†\n          this.inputText = result.transcription;\n\n          // æ˜¾ç¤ºæˆåŠŸæç¤º\n          this.showToast('è¯­éŸ³è¯†åˆ«æˆåŠŸï¼', 'success');\n        } else {\n          throw new Error('è¯†åˆ«å¤±è´¥');\n        }\n      } catch (error) {\n        log.error('è¯­éŸ³è¯†åˆ«å¤±è´¥', error);\n        this.recognitionStatusText = 'è¯†åˆ«å¤±è´¥';\n        this.showToast(`è¯­éŸ³è¯†åˆ«å¤±è´¥: ${error.message}`, 'error');\n      } finally {\n        this.isProcessing = false;\n        this.isListening = false;\n        this.selectedFile = null;\n\n        // æ¸…ç©ºæ–‡ä»¶è¾“å…¥\n        if (this.$refs.fileInput) {\n          this.$refs.fileInput.value = '';\n        }\n      }\n    },\n    /**\n     * å›é€€åˆ°æ–‡ä»¶é€‰æ‹©æ¨¡å¼\n     */\n    fallbackToFileInput() {\n      log.info('å›é€€åˆ°æ–‡ä»¶é€‰æ‹©æ¨¡å¼');\n      this.$refs.fileInput.click();\n    },\n    /**\n     * å¤„ç†æ–‡ä»¶é€‰æ‹©ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰\n     */\n    async handleFileSelect(event) {\n      const file = event.target.files[0];\n      if (!file) {\n        this.stopVoiceInput();\n        return;\n      }\n      try {\n        this.selectedFile = file;\n        await this.processAudioFile(file);\n      } catch (error) {\n        log.error('æ–‡ä»¶å¤„ç†å¤±è´¥', error);\n        this.showToast(`æ–‡ä»¶å¤„ç†å¤±è´¥: ${error.message}`, 'error');\n      }\n    },\n    /**\n     * ç¼–è¾‘è¯†åˆ«ç»“æœ\n     */\n    editRecognitionResult() {\n      if (this.recognitionResult) {\n        this.inputText = this.recognitionResult.transcription;\n        this.clearRecognitionResult();\n        // èšç„¦åˆ°è¾“å…¥æ¡†\n        this.$nextTick(() => {\n          const input = this.$el.querySelector('.message-input');\n          if (input) input.focus();\n        });\n      }\n    },\n    /**\n     * å‘é€è¯†åˆ«ç»“æœ\n     */\n    sendRecognitionResult() {\n      if (this.recognitionResult) {\n        this.inputText = this.recognitionResult.transcription;\n        this.sendMessage();\n        this.clearRecognitionResult();\n      }\n    },\n    /**\n     * æ¸…é™¤è¯†åˆ«ç»“æœ\n     */\n    clearRecognitionResult() {\n      this.recognitionResult = null;\n    },\n    /**\n     * è·å–è¯­éŸ³æŒ‰é’®å›¾æ ‡\n     */\n    getVoiceButtonIcon() {\n      if (this.isProcessing) {\n        return 'spinner';\n      } else if (this.isListening) {\n        return 'microphone-slash';\n      } else {\n        return 'microphone';\n      }\n    },\n    /**\n     * è·å–è¯­éŸ³æŒ‰é’®æ ‡é¢˜\n     */\n    getVoiceButtonTitle() {\n      if (this.isProcessing) {\n        return 'æ­£åœ¨è¯†åˆ«ä¸­...';\n      } else if (this.isListening) {\n        return 'æŒ‰ä½è¯´è¯';\n      } else {\n        return 'æŒ‰ä½è¯´è¯';\n      }\n    },\n    /**\n     * è·å–è¯­éŸ³è¾“å…¥åŒºåŸŸå ä½ç¬¦æ–‡æœ¬\n     */\n    getVoicePlaceholderText() {\n      if (this.isListening) {\n        return 'å½•éŸ³ä¸­';\n      } else {\n        return 'æŒ‰ä½è¯´è¯';\n      }\n    },\n    /**\n     * æ˜¾ç¤ºæç¤ºä¿¡æ¯\n     */\n    showToast(message, type = 'info') {\n      // ä½¿ç”¨å…¨å±€toastæˆ–console\n      if (this.$toast) {\n        this.$toast[type]?.(message) || this.$toast(message);\n      } else {\n        console.log(`[${type.toUpperCase()}] ${message}`);\n      }\n    },\n    /**\n     * å¤„ç†å…¨å±€ç‚¹å‡»äº‹ä»¶\n     */\n    handleGlobalClick(event) {\n      // å¦‚æœç‚¹å‡»çš„æ˜¯åŠ å·æŒ‰é’®ï¼Œä¸å¤„ç†\n      if (event.target.closest('.plus-btn')) {\n        return;\n      }\n      // å¦‚æœç‚¹å‡»çš„æ˜¯åŠŸèƒ½æŒ‰é’®é¢æ¿ï¼Œä¸å¤„ç†\n      if (event.target.closest('.function-panel')) {\n        return;\n      }\n      // å…¶ä»–æƒ…å†µå…³é—­åŠ å·èœå•\n      if (this.showPlusMenu) {\n        this.showPlusMenu = false;\n      }\n    },\n    /**\n     * åˆ‡æ¢åŠ å·èœå•æ˜¾ç¤ºçŠ¶æ€\n     */\n    togglePlusMenu() {\n      this.showPlusMenu = !this.showPlusMenu;\n      log.info('åˆ‡æ¢åŠ å·èœå•', {\n        show: this.showPlusMenu\n      });\n    },\n    /**\n     * æ‰“å¼€ç›¸å†Œé€‰æ‹©å›¾ç‰‡\n     */\n    openPhotoLibrary() {\n      this.showPlusMenu = false;\n      this.$refs.imageInput.click();\n      log.info('æ‰“å¼€ç›¸å†Œé€‰æ‹©å›¾ç‰‡');\n    },\n    /**\n     * æ‰“å¼€ç›¸æœºæ‹ç…§\n     */\n    openCamera() {\n      this.showPlusMenu = false;\n      // åˆ›å»ºç›¸æœºè¾“å…¥ï¼Œæ”¯æŒæ‹ç…§\n      const cameraInput = document.createElement('input');\n      cameraInput.type = 'file';\n      cameraInput.accept = 'image/*';\n      cameraInput.capture = 'camera';\n      cameraInput.style.display = 'none';\n      cameraInput.onchange = event => {\n        const file = event.target.files[0];\n        if (file) {\n          this.handleImageSelect({\n            target: {\n              files: [file]\n            }\n          });\n        }\n        // æ¸…ç†ä¸´æ—¶å…ƒç´ \n        document.body.removeChild(cameraInput);\n      };\n      document.body.appendChild(cameraInput);\n      cameraInput.click();\n      log.info('æ‰“å¼€ç›¸æœºæ‹ç…§');\n    },\n    /**\n     * å¤„ç†å›¾ç‰‡é€‰æ‹©\n     */\n    async handleImageSelect(event) {\n      const file = event.target.files[0];\n      if (!file) return;\n      log.info('é€‰æ‹©å›¾ç‰‡æ–‡ä»¶', {\n        fileName: file.name,\n        fileSize: file.size,\n        fileType: file.type\n      });\n\n      // éªŒè¯å›¾ç‰‡æ–‡ä»¶\n      if (!file.type.startsWith('image/')) {\n        this.showToast('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶', 'error');\n        return;\n      }\n      try {\n        // ç›´æ¥å‘é€å›¾ç‰‡æ¶ˆæ¯ï¼Œä¸è¿›è¡Œåˆ†æ\n        this.isProcessing = true;\n        this.recognitionStatusText = 'æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...';\n\n        // ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ å›¾ç‰‡åˆ°OSSè·å–URL\n        this.recognitionStatusText = 'æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...';\n        const imageUrl = await this.uploadImageToOSS(file);\n\n        // ç¬¬äºŒæ­¥ï¼šç”¨URLè§¦å‘åç«¯åˆ†æ\n        this.recognitionStatusText = 'æ­£åœ¨åˆ†æå›¾ç‰‡...';\n        const analysis = await this.analyzeImageByURL(imageUrl, 'è¯·åˆ†æè¿™å¼ å›¾ç‰‡çš„å†…å®¹');\n        if (analysis) {\n          // å›¾ç‰‡åˆ†æå®Œæˆåï¼Œå‘é€åŒ…å«å›¾ç‰‡URLå’Œåˆ†æç»“æœçš„æ¶ˆæ¯\n          // å‰ç«¯ä¼šæ˜¾ç¤ºåŸå›¾ï¼ŒAIä¼šåŸºäºåˆ†æç»“æœå›å¤\n          const imageMessage = `[å›¾ç‰‡]${imageUrl}`;\n\n          // å‘é€åŒ…å«å›¾ç‰‡URLçš„æ¶ˆæ¯ç»™æ™ºèƒ½è°ƒåº¦æœåŠ¡\n          this.$emit('sendMessage', imageMessage);\n\n          // å‘é€åŒ…å«åˆ†æç»“æœçš„æ¶ˆæ¯ç»™æ™ºèƒ½è°ƒåº¦æœåŠ¡ï¼Œè®©AIèƒ½åŸºäºåˆ†æç»“æœå›å¤\n          // æ³¨æ„ï¼šè¿™é‡Œå‘é€çš„æ˜¯åˆ†æç»“æœï¼Œä¸æ˜¯å›¾ç‰‡URL\n          const analysisMessage = `è¯·åŸºäºä»¥ä¸‹å›¾ç‰‡åˆ†æç»“æœå›å¤ï¼š${analysis.content}`;\n          this.$emit('sendMessage', analysisMessage);\n          this.showToast('å›¾ç‰‡ä¸Šä¼ åˆ†æå®Œæˆï¼', 'success');\n\n          // è®°å½•åˆ†æç»“æœåˆ°æ—¥å¿—ï¼Œä¾›è°ƒè¯•ä½¿ç”¨\n          log.info('å›¾ç‰‡åˆ†æå®Œæˆï¼Œå·²å‘é€ç»™æ™ºèƒ½è°ƒåº¦æœåŠ¡', {\n            fileName: file.name,\n            imageUrl: imageUrl,\n            analysisContent: analysis.content,\n            messageLength: imageMessage.length\n          });\n        } else {\n          throw new Error('å›¾ç‰‡åˆ†æå¤±è´¥');\n        }\n      } catch (error) {\n        log.error('å›¾ç‰‡å¤„ç†å¤±è´¥', error);\n        this.showToast(`å›¾ç‰‡å¤„ç†å¤±è´¥: ${error.message}`, 'error');\n      } finally {\n        this.isProcessing = false;\n        this.selectedFile = null;\n\n        // æ¸…ç©ºæ–‡ä»¶è¾“å…¥\n        this.$refs.imageInput.value = '';\n      }\n    },\n    /**\n     * æ‰“å¼€å›¾ç‰‡åˆ†ææ¨¡æ€æ¡†\n     */\n    openImageAnalysis() {\n      this.showImageAnalysisModal = true;\n      log.info('æ‰“å¼€å›¾ç‰‡åˆ†ææ¨¡æ€æ¡†');\n    },\n    /**\n     * å…³é—­å›¾ç‰‡åˆ†ææ¨¡æ€æ¡†\n     */\n    closeImageAnalysisModal() {\n      this.showImageAnalysisModal = false;\n      log.info('å…³é—­å›¾ç‰‡åˆ†ææ¨¡æ€æ¡†');\n    },\n    /**\n     * æ ¼å¼åŒ–æ–‡ä»¶å¤§å°\n     */\n    formatFileSize(bytes) {\n      if (bytes === 0) return '0 Bytes';\n      const k = 1024;\n      const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n      const i = Math.floor(Math.log(bytes) / Math.log(k));\n      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n    },\n    /**\n     * ä¸Šä¼ å›¾ç‰‡åˆ°OSS\n     */\n    async uploadImageToOSS(file) {\n      try {\n        const formData = new FormData();\n        formData.append('image', file);\n        const response = await fetch('/api/image-analysis/upload', {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${localStorage.getItem('token')}` // å¦‚æœéœ€è¦è®¤è¯\n          },\n          body: formData\n        });\n        if (!response.ok) {\n          throw new Error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥');\n        }\n        const result = await response.json();\n        if (result.success && result.imageUrl) {\n          log.info('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ', {\n            imageUrl: result.imageUrl\n          });\n          return result.imageUrl;\n        } else {\n          log.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¿”å›ç»“æœ:', result);\n          throw new Error(result.error || 'å›¾ç‰‡ä¸Šä¼ å¤±è´¥');\n        }\n      } catch (error) {\n        log.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥', error);\n        throw new Error(`å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ${error.message}`);\n      }\n    },\n    /**\n     * æ ¹æ®URLåˆ†æå›¾ç‰‡\n     */\n    async analyzeImageByURL(imageUrl, prompt) {\n      try {\n        const response = await fetch('/api/image-analysis/analyze-url', {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${localStorage.getItem('token')}`,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            imageUrl: imageUrl,\n            prompt: prompt || 'è¯·åˆ†æè¿™å¼ å›¾ç‰‡çš„å†…å®¹'\n          })\n        });\n        if (!response.ok) {\n          throw new Error('å›¾ç‰‡åˆ†æå¤±è´¥');\n        }\n        const result = await response.json();\n        if (result.success && result.analysis) {\n          log.info('å›¾ç‰‡åˆ†ææˆåŠŸ', {\n            analysis: result.analysis\n          });\n          return result.analysis;\n        } else {\n          throw new Error(result.error || 'å›¾ç‰‡åˆ†æå¤±è´¥');\n        }\n      } catch (error) {\n        log.error('å›¾ç‰‡åˆ†æå¤±è´¥', error);\n        throw new Error(`å›¾ç‰‡åˆ†æå¤±è´¥: ${error.message}`);\n      }\n    },\n    /**\n     * å¤„ç†å›¾ç‰‡åˆ†æå®Œæˆ\n     */\n    handleImageAnalysisComplete(result) {\n      log.info('å›¾ç‰‡åˆ†æå®Œæˆ', result);\n\n      // å°†åˆ†æç»“æœä½œä¸ºæ¶ˆæ¯å‘é€\n      const analysisMessage = `ğŸ–¼ï¸ å›¾ç‰‡åˆ†æç»“æœï¼š\\n\\n${result.analysis.content}`;\n      this.$emit('sendMessage', analysisMessage);\n\n      // å…³é—­æ¨¡æ€æ¡†\n      this.closeImageAnalysisModal();\n\n      // æ˜¾ç¤ºæˆåŠŸæç¤º\n      this.showToast('å›¾ç‰‡åˆ†æå®Œæˆï¼Œå·²å‘é€ç»“æœï¼', 'success');\n    }\n  }\n};","map":{"version":3,"names":["speechRecognitionService","log","ImageAnalysisModal","name","components","data","inputText","isListening","isProcessing","recognitionResult","recognitionStatusText","selectedFile","showImageAnalysisModal","mediaRecorder","audioChunks","recordingTime","recordingTimer","stream","touchStartY","touchStartTime","shouldCancel","isVoiceMode","showPlusMenu","mounted","document","addEventListener","handleGlobalClick","beforeUnmount","removeEventListener","resetProcessingStatus","getTracks","forEach","track","stop","stopRecordingTimer","methods","sendMessage","trim","user","message","$emit","toggleVoiceMode","showToast","$nextTick","voiceArea","$el","querySelector","focus","textInput","startVoiceInput","event","type","touches","clientY","Date","now","startRecording","endVoiceInput","cancelRecording","stopVoiceInput","handleTouchMove","currentY","deltaY","cancelVoiceInput","info","navigator","mediaDevices","getUserMedia","audio","echoCancellation","noiseSuppression","sampleRate","mimeType","MediaRecorder","isTypeSupported","start","startRecordingTimer","ondataavailable","size","push","onstop","handleRecordingComplete","success","error","fallbackToFileInput","setInterval","clearInterval","length","audioBlob","Blob","convertedAudioFile","convertAudioFormat","fileName","fileSize","duration","originalType","convertedType","sendVoiceMessage","processAudioFile","supportedTypes","includes","File","audioContext","window","AudioContext","webkitAudioContext","arrayBuffer","audioBuffer","decodeAudioData","wavBlob","audioBufferToWav","wavFile","originalSize","convertedSize","buffer","numberOfChannels","ArrayBuffer","view","DataView","writeString","offset","string","i","setUint8","charCodeAt","setUint32","setUint16","channel","sample","Math","max","min","getChannelData","setInt16","audioFile","validation","validateAudioFile","isValid","Error","errors","join","result","recognizeVoice","transcription","audioUrl","$refs","fileInput","value","click","handleFileSelect","file","target","files","editRecognitionResult","clearRecognitionResult","input","sendRecognitionResult","getVoiceButtonIcon","getVoiceButtonTitle","getVoicePlaceholderText","$toast","console","toUpperCase","closest","togglePlusMenu","show","openPhotoLibrary","imageInput","openCamera","cameraInput","createElement","accept","capture","style","display","onchange","handleImageSelect","body","removeChild","appendChild","fileType","startsWith","imageUrl","uploadImageToOSS","analysis","analyzeImageByURL","imageMessage","analysisMessage","content","analysisContent","messageLength","openImageAnalysis","closeImageAnalysisModal","formatFileSize","bytes","k","sizes","floor","parseFloat","pow","toFixed","formData","FormData","append","response","fetch","method","headers","localStorage","getItem","ok","json","prompt","JSON","stringify","handleImageAnalysisComplete"],"sources":["C:\\Users\\wuby\\OneDrive\\Desktop\\backend(1) 3\\timer\\src\\components\\AIsecretary\\MessageInput.vue"],"sourcesContent":["<template>\n  <div>\n    <!-- è¾“å…¥åŒºåŸŸ -->\n    <div class=\"input-area\" :class=\"{ 'expanded': showPlusMenu }\">\n      <div class=\"input-container\">\n        <!-- è¯­éŸ³è¾“å…¥æŒ‰é’® -->\n        <button \n          class=\"voice-btn\" \n          @click=\"toggleVoiceMode\"\n          :class=\"{ 'active': isVoiceMode, 'processing': isProcessing }\"\n          :disabled=\"isProcessing\"\n          :title=\"isVoiceMode ? 'åˆ‡æ¢åˆ°æ–‡å­—è¾“å…¥' : 'åˆ‡æ¢åˆ°è¯­éŸ³è¾“å…¥'\"\n        >\n          <font-awesome-icon \n            :icon=\"isVoiceMode ? 'keyboard' : 'microphone'\" \n            :class=\"{ 'pulse': isProcessing }\"\n          />\n        </button>\n\n        <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ï¼ˆä¿ç•™ä½œä¸ºå¤‡ç”¨ï¼‰ -->\n        <input \n          ref=\"fileInput\"\n          type=\"file\" \n          accept=\"audio/*\"\n          style=\"display: none\"\n          @change=\"handleFileSelect\"\n        >\n\n        <!-- éšè—çš„å›¾ç‰‡æ–‡ä»¶è¾“å…¥ -->\n        <input \n          ref=\"imageInput\"\n          type=\"file\" \n          accept=\"image/*\"\n          style=\"display: none\"\n          @change=\"handleImageSelect\"\n        >\n\n        <!-- åŠ¨æ€è¾“å…¥åŒºåŸŸ -->\n        <div class=\"dynamic-input-area\">\n          <!-- æ–‡å­—è¾“å…¥æ¨¡å¼ -->\n          <input \n            v-if=\"!isVoiceMode\"\n            v-model=\"inputText\"\n            type=\"text\" \n            placeholder=\"è¾“å…¥ä½ çš„å­¦ä¹ ç›®æ ‡æˆ–é—®é¢˜...\"\n            class=\"message-input\"\n            @keypress.enter=\"sendMessage\"\n            :disabled=\"isProcessing\"\n          />\n          \n          <!-- è¯­éŸ³è¾“å…¥æ¨¡å¼ -->\n          <div \n            v-else\n            class=\"voice-input-area\"\n            @touchstart=\"startVoiceInput\"\n            @touchend=\"endVoiceInput\"\n            @touchmove=\"handleTouchMove\"\n            @mousedown=\"startVoiceInput\"\n            @mouseup=\"endVoiceInput\"\n            @mouseleave=\"cancelVoiceInput\"\n            :class=\"{ 'listening': isListening }\"\n          >\n            <font-awesome-icon icon=\"microphone\" class=\"voice-area-icon\" />\n            <span class=\"voice-placeholder\">{{ getVoicePlaceholderText() }}</span>\n          </div>\n        </div>\n\n        <!-- å‘é€æŒ‰é’® -->\n        <button \n          class=\"send-btn\"\n          @click=\"sendMessage\"\n          :disabled=\"!inputText.trim() || isProcessing\"\n        >\n          <font-awesome-icon icon=\"paper-plane\" />\n        </button>\n\n        <!-- åŠ å·æŒ‰é’® -->\n        <button \n          class=\"plus-btn\"\n          @click=\"togglePlusMenu\"\n          :disabled=\"isProcessing\"\n          :class=\"{ 'active': showPlusMenu }\"\n          title=\"æ›´å¤šåŠŸèƒ½\"\n        >\n          <font-awesome-icon icon=\"plus\" />\n        </button>\n      </div>\n\n      <!-- è¯­éŸ³è¯†åˆ«çŠ¶æ€æç¤º -->\n      <div v-if=\"isProcessing\" class=\"recognition-status\">\n        <div class=\"status-content\">\n          <font-awesome-icon icon=\"spinner\" spin />\n          <span>{{ recognitionStatusText }}</span>\n        </div>\n      </div>\n\n      <!-- è¯­éŸ³è¯†åˆ«ç»“æœé¢„è§ˆ -->\n      <div v-if=\"recognitionResult && !isProcessing\" class=\"recognition-preview\">\n        <div class=\"preview-header\">\n          <font-awesome-icon icon=\"microphone\" />\n          <span>è¯­éŸ³è¯†åˆ«ç»“æœ</span>\n          <button class=\"preview-close\" @click=\"clearRecognitionResult\">\n            <font-awesome-icon icon=\"times\" />\n          </button>\n        </div>\n        <div class=\"preview-content\">\n          <p class=\"preview-text\">{{ recognitionResult.transcription }}</p>\n          <div class=\"preview-actions\">\n            <button class=\"preview-btn preview-btn-edit\" @click=\"editRecognitionResult\">\n              <font-awesome-icon icon=\"edit\" />\n              ç¼–è¾‘\n            </button>\n            <button class=\"preview-btn preview-btn-send\" @click=\"sendRecognitionResult\">\n              <font-awesome-icon icon=\"paper-plane\" />\n              å‘é€\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- åŠŸèƒ½æŒ‰é’®é¢æ¿ - ç‹¬ç«‹åœ¨è¾“å…¥åŒºåŸŸå¤– -->\n    <div v-if=\"showPlusMenu\" class=\"function-panel\">\n      <div class=\"function-buttons\">\n        <div class=\"function-button\" @click=\"openPhotoLibrary\">\n          <div class=\"button-icon\">\n            <font-awesome-icon icon=\"images\" />\n          </div>\n          <span class=\"button-text\">ç›¸å†Œ</span>\n        </div>\n        <div class=\"function-button\" @click=\"openCamera\">\n          <div class=\"button-icon\">\n            <font-awesome-icon icon=\"camera\" />\n          </div>\n          <span class=\"button-text\">æ‹æ‘„</span>\n        </div>\n      </div>\n    </div>\n\n    <!-- å›¾ç‰‡åˆ†ææ¨¡æ€æ¡† -->\n    <ImageAnalysisModal\n      :visible=\"showImageAnalysisModal\"\n      :preSelectedFile=\"selectedFile\"\n      @close=\"closeImageAnalysisModal\"\n      @analysisComplete=\"handleImageAnalysisComplete\"\n      @showToast=\"showToast\"\n    />\n  </div>\n</template>\n\n<script>\nimport speechRecognitionService from '../../AIsiri/services/speechRecognitionService.js'\nimport { log } from '../../AIsiri/utils/logger.js'\nimport ImageAnalysisModal from './ImageAnalysisModal.vue'\n\nexport default {\n  name: 'MessageInput',\n  components: {\n    ImageAnalysisModal\n  },\n  data() {\n    return {\n      inputText: '',\n      isListening: false,\n      isProcessing: false,\n      recognitionResult: null,\n      recognitionStatusText: 'æ­£åœ¨è¯†åˆ«ä¸­...',\n      selectedFile: null,\n      showImageAnalysisModal: false,\n      // æ–°å¢å½•éŸ³ç›¸å…³çŠ¶æ€\n      mediaRecorder: null,\n      audioChunks: [],\n      recordingTime: 0,\n      recordingTimer: null,\n      stream: null,\n      // è§¦æ‘¸ç›¸å…³çŠ¶æ€\n      touchStartY: 0,\n      touchStartTime: 0,\n      shouldCancel: false,\n      // è¯­éŸ³æ¨¡å¼çŠ¶æ€\n      isVoiceMode: false,\n      // åŠ å·èœå•çŠ¶æ€\n      showPlusMenu: false\n    }\n  },\n  mounted() {\n    // æ·»åŠ å…¨å±€ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨\n    document.addEventListener('click', this.handleGlobalClick);\n  },\n  beforeUnmount() {\n    // ç§»é™¤å…¨å±€ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨\n    document.removeEventListener('click', this.handleGlobalClick);\n    // æ¸…ç†èµ„æº\n    if (this.isProcessing) {\n      speechRecognitionService.resetProcessingStatus();\n    }\n    // åœæ­¢å½•éŸ³æµ\n    if (this.stream) {\n      this.stream.getTracks().forEach(track => track.stop());\n    }\n    // åœæ­¢è®¡æ—¶å™¨\n    this.stopRecordingTimer();\n  },\n  methods: {\n    /**\n     * å‘é€æ–‡æœ¬æ¶ˆæ¯\n     */\n    sendMessage() {\n      if (!this.inputText.trim() || this.isProcessing) return;\n      \n      log.user('å‘é€æ–‡æœ¬æ¶ˆæ¯', { message: this.inputText })\n      this.$emit('sendMessage', this.inputText);\n      this.inputText = '';\n    },\n\n    /**\n     * åˆ‡æ¢è¯­éŸ³/æ–‡å­—è¾“å…¥æ¨¡å¼\n     */\n    toggleVoiceMode() {\n      if (this.isProcessing) return;\n      \n      this.isVoiceMode = !this.isVoiceMode;\n      \n      if (this.isVoiceMode) {\n        // åˆ‡æ¢åˆ°è¯­éŸ³æ¨¡å¼\n        this.showToast('å·²åˆ‡æ¢åˆ°è¯­éŸ³è¾“å…¥æ¨¡å¼', 'info');\n        // èšç„¦åˆ°è¯­éŸ³è¾“å…¥åŒºåŸŸ\n        this.$nextTick(() => {\n          const voiceArea = this.$el.querySelector('.voice-input-area');\n          if (voiceArea) voiceArea.focus();\n        });\n      } else {\n        // åˆ‡æ¢åˆ°æ–‡å­—æ¨¡å¼\n        this.showToast('å·²åˆ‡æ¢åˆ°æ–‡å­—è¾“å…¥æ¨¡å¼', 'info');\n        // èšç„¦åˆ°æ–‡å­—è¾“å…¥æ¡†\n        this.$nextTick(() => {\n          const textInput = this.$el.querySelector('.message-input');\n          if (textInput) textInput.focus();\n        });\n      }\n    },\n\n    /**\n     * å¼€å§‹è¯­éŸ³è¾“å…¥ï¼ˆè§¦æ‘¸å¼€å§‹ï¼‰\n     */\n    async startVoiceInput(event) {\n      if (this.isProcessing || !this.isVoiceMode) return;\n      \n      // è®°å½•è§¦æ‘¸å¼€å§‹ä½ç½®å’Œæ—¶é—´\n      if (event.type === 'touchstart') {\n        this.touchStartY = event.touches[0].clientY;\n        this.touchStartTime = Date.now();\n      } else {\n        this.touchStartY = event.clientY;\n        this.touchStartTime = Date.now();\n      }\n      \n      this.shouldCancel = false;\n      \n      await this.startRecording();\n    },\n\n    /**\n     * ç»“æŸè¯­éŸ³è¾“å…¥ï¼ˆè§¦æ‘¸ç»“æŸï¼‰\n     */\n    endVoiceInput() {\n      if (!this.isListening) return;\n      \n      // æ£€æŸ¥æ˜¯å¦åº”è¯¥å–æ¶ˆ\n      if (this.shouldCancel) {\n        this.cancelRecording();\n      } else {\n        this.stopVoiceInput();\n      }\n    },\n\n    /**\n     * å¤„ç†è§¦æ‘¸ç§»åŠ¨ï¼ˆä¸Šæ»‘å–æ¶ˆï¼‰\n     */\n    handleTouchMove(event) {\n      if (!this.isListening) return;\n      \n      const currentY = event.touches[0].clientY;\n      const deltaY = this.touchStartY - currentY;\n      \n      // ä¸Šæ»‘è¶…è¿‡50pxæ ‡è®°ä¸ºå–æ¶ˆ\n      if (deltaY > 50) {\n        this.shouldCancel = true;\n      } else {\n        this.shouldCancel = false;\n      }\n    },\n\n    /**\n     * å–æ¶ˆè¯­éŸ³è¾“å…¥ï¼ˆé¼ æ ‡ç¦»å¼€ï¼‰\n     */\n    cancelVoiceInput() {\n      if (this.isListening) {\n        this.cancelRecording();\n      }\n    },\n\n    /**\n     * å¼€å§‹è¯­éŸ³è¾“å…¥ï¼ˆå®æ—¶å½•éŸ³ï¼‰\n     */\n    async startRecording() {\n      try {\n        log.info('å¼€å§‹å®æ—¶å½•éŸ³')\n        \n        // è¯·æ±‚éº¦å…‹é£æƒé™\n        this.stream = await navigator.mediaDevices.getUserMedia({ \n          audio: {\n            echoCancellation: true,\n            noiseSuppression: true,\n            sampleRate: 44100\n          } \n        });\n        \n        // åˆ›å»ºMediaRecorder - ä½¿ç”¨åç«¯æ”¯æŒçš„æ ¼å¼\n        let mimeType = 'audio/wav';\n        \n        // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒçš„æ ¼å¼ï¼Œä¼˜å…ˆä½¿ç”¨åç«¯æ”¯æŒçš„æ ¼å¼\n        if (MediaRecorder.isTypeSupported('audio/wav')) {\n          mimeType = 'audio/wav';\n        } else if (MediaRecorder.isTypeSupported('audio/mp4')) {\n          mimeType = 'audio/mp4';\n        } else if (MediaRecorder.isTypeSupported('audio/webm;codecs=opus')) {\n          mimeType = 'audio/webm;codecs=opus';\n        } else if (MediaRecorder.isTypeSupported('audio/webm')) {\n          mimeType = 'audio/webm';\n        }\n        \n        this.mediaRecorder = new MediaRecorder(this.stream, {\n          mimeType: mimeType\n        });\n        \n        // é‡ç½®å½•éŸ³çŠ¶æ€\n        this.audioChunks = [];\n        this.recordingTime = 0;\n        \n        // å¼€å§‹å½•éŸ³\n        this.mediaRecorder.start();\n        this.isListening = true;\n        \n        // å¼€å§‹è®¡æ—¶\n        this.startRecordingTimer();\n        \n        // ç›‘å¬å½•éŸ³æ•°æ®\n        this.mediaRecorder.ondataavailable = (event) => {\n          if (event.data.size > 0) {\n            this.audioChunks.push(event.data);\n          }\n        };\n        \n        // å½•éŸ³ç»“æŸå¤„ç†\n        this.mediaRecorder.onstop = () => {\n          this.handleRecordingComplete();\n        };\n        \n        log.success('å®æ—¶å½•éŸ³å¼€å§‹')\n        \n      } catch (error) {\n        log.error('å¯åŠ¨å½•éŸ³å¤±è´¥', error);\n        this.showToast('æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·æ£€æŸ¥æƒé™è®¾ç½®', 'error');\n        \n        // å¦‚æœå®æ—¶å½•éŸ³å¤±è´¥ï¼Œå›é€€åˆ°æ–‡ä»¶é€‰æ‹©æ¨¡å¼\n        this.fallbackToFileInput();\n      }\n    },\n\n    /**\n     * åœæ­¢è¯­éŸ³è¾“å…¥\n     */\n    stopVoiceInput() {\n      if (this.mediaRecorder && this.isListening) {\n        log.info('åœæ­¢å®æ—¶å½•éŸ³')\n        this.mediaRecorder.stop();\n        this.isListening = false;\n        this.stopRecordingTimer();\n        \n        // åœæ­¢éº¦å…‹é£æµ\n        if (this.stream) {\n          this.stream.getTracks().forEach(track => track.stop());\n          this.stream = null;\n        }\n      }\n    },\n\n    /**\n     * å–æ¶ˆå½•éŸ³\n     */\n    cancelRecording() {\n      if (this.mediaRecorder && this.isListening) {\n        log.info('å–æ¶ˆå½•éŸ³')\n        this.mediaRecorder.stop();\n        this.isListening = false;\n        this.stopRecordingTimer();\n        \n        // åœæ­¢éº¦å…‹é£æµ\n        if (this.stream) {\n          this.stream.getTracks().forEach(track => track.stop());\n          this.stream = null;\n        }\n        \n        // æ¸…ç†å½•éŸ³æ•°æ®\n        this.audioChunks = [];\n        this.recordingTime = 0;\n        \n        // é‡ç½®çŠ¶æ€\n        this.shouldCancel = false;\n        \n        this.showToast('å½•éŸ³å·²å–æ¶ˆ', 'info');\n      }\n    },\n\n    /**\n     * å¼€å§‹å½•éŸ³è®¡æ—¶å™¨\n     */\n    startRecordingTimer() {\n      this.recordingTimer = setInterval(() => {\n        this.recordingTime++;\n      }, 1000);\n    },\n\n    /**\n     * åœæ­¢å½•éŸ³è®¡æ—¶å™¨\n     */\n    stopRecordingTimer() {\n      if (this.recordingTimer) {\n        clearInterval(this.recordingTimer);\n        this.recordingTimer = null;\n      }\n    },\n\n\n\n    /**\n     * å¤„ç†å½•éŸ³å®Œæˆ\n     */\n    async handleRecordingComplete() {\n      try {\n        if (this.audioChunks.length === 0) {\n          this.showToast('å½•éŸ³å¤±è´¥ï¼Œæ²¡æœ‰å½•åˆ¶åˆ°éŸ³é¢‘', 'error');\n          return;\n        }\n\n        // åˆ›å»ºéŸ³é¢‘Blob\n        const audioBlob = new Blob(this.audioChunks, { type: this.mediaRecorder.mimeType });\n        \n        // è½¬æ¢ä¸ºåç«¯æ”¯æŒçš„æ ¼å¼\n        const convertedAudioFile = await this.convertAudioFormat(audioBlob);\n        \n        log.info('å½•éŸ³å®Œæˆï¼Œå¼€å§‹å¤„ç†', { \n          fileName: convertedAudioFile.name, \n          fileSize: convertedAudioFile.size,\n          duration: this.recordingTime,\n          originalType: this.mediaRecorder.mimeType,\n          convertedType: convertedAudioFile.type\n        });\n\n        // åœ¨è¯­éŸ³æ¨¡å¼ä¸‹ç›´æ¥å‘é€è¯­éŸ³æ¶ˆæ¯ï¼Œå¦åˆ™æ˜¾ç¤ºé¢„è§ˆ\n        if (this.isVoiceMode) {\n          await this.sendVoiceMessage(convertedAudioFile);\n        } else {\n          await this.processAudioFile(convertedAudioFile);\n        }\n        \n      } catch (error) {\n        log.error('å¤„ç†å½•éŸ³å¤±è´¥', error);\n        this.showToast(`å¤„ç†å½•éŸ³å¤±è´¥: ${error.message}`, 'error');\n      } finally {\n        // æ¸…ç†çŠ¶æ€\n        this.audioChunks = [];\n        this.recordingTime = 0;\n        this.mediaRecorder = null;\n      }\n    },\n\n    /**\n     * è½¬æ¢éŸ³é¢‘æ ¼å¼ä¸ºåç«¯æ”¯æŒçš„æ ¼å¼\n     */\n    async convertAudioFormat(audioBlob) {\n      try {\n        // å¦‚æœå·²ç»æ˜¯æ”¯æŒçš„æ ¼å¼ï¼Œç›´æ¥è¿”å›\n        const supportedTypes = ['audio/wav', 'audio/mpeg', 'audio/mp4', 'audio/aac', 'audio/flac'];\n        if (supportedTypes.includes(audioBlob.type)) {\n          return new File([audioBlob], `recording_${Date.now()}.wav`, { type: audioBlob.type });\n        }\n\n        // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡è¿›è¡Œæ ¼å¼è½¬æ¢\n        const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n        const arrayBuffer = await audioBlob.arrayBuffer();\n        const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n        \n        // è½¬æ¢ä¸ºWAVæ ¼å¼\n        const wavBlob = this.audioBufferToWav(audioBuffer);\n        \n        // åˆ›å»ºæ–°çš„Fileå¯¹è±¡\n        const wavFile = new File([wavBlob], `recording_${Date.now()}.wav`, { \n          type: 'audio/wav' \n        });\n        \n        log.info('éŸ³é¢‘æ ¼å¼è½¬æ¢å®Œæˆ', { \n          originalType: audioBlob.type, \n          convertedType: 'audio/wav',\n          originalSize: audioBlob.size,\n          convertedSize: wavFile.size\n        });\n        \n        return wavFile;\n        \n      } catch (error) {\n        log.error('éŸ³é¢‘æ ¼å¼è½¬æ¢å¤±è´¥', error);\n        // å¦‚æœè½¬æ¢å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨åŸå§‹æ ¼å¼\n        this.showToast('éŸ³é¢‘æ ¼å¼è½¬æ¢å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹æ ¼å¼', 'warning');\n        return new File([audioBlob], `recording_${Date.now()}.wav`, { type: 'audio/wav' });\n      }\n    },\n\n    /**\n     * å°†AudioBufferè½¬æ¢ä¸ºWAVæ ¼å¼\n     */\n    audioBufferToWav(buffer) {\n      const length = buffer.length;\n      const numberOfChannels = buffer.numberOfChannels;\n      const sampleRate = buffer.sampleRate;\n      const arrayBuffer = new ArrayBuffer(44 + length * numberOfChannels * 2);\n      const view = new DataView(arrayBuffer);\n      \n      // WAVæ–‡ä»¶å¤´\n      const writeString = (offset, string) => {\n        for (let i = 0; i < string.length; i++) {\n          view.setUint8(offset + i, string.charCodeAt(i));\n        }\n      };\n      \n      writeString(0, 'RIFF');\n      view.setUint32(4, 36 + length * numberOfChannels * 2, true);\n      writeString(8, 'WAVE');\n      writeString(12, 'fmt ');\n      view.setUint32(16, 16, true);\n      view.setUint16(20, 1, true);\n      view.setUint16(22, numberOfChannels, true);\n      view.setUint32(24, sampleRate, true);\n      view.setUint32(28, sampleRate * numberOfChannels * 2, true);\n      view.setUint16(32, numberOfChannels * 2, true);\n      view.setUint16(34, 16, true);\n      writeString(36, 'data');\n      view.setUint32(40, length * numberOfChannels * 2, true);\n      \n      // å†™å…¥éŸ³é¢‘æ•°æ®\n      let offset = 44;\n      for (let i = 0; i < length; i++) {\n        for (let channel = 0; channel < numberOfChannels; channel++) {\n          const sample = Math.max(-1, Math.min(1, buffer.getChannelData(channel)[i]));\n          view.setInt16(offset, sample < 0 ? sample * 0x8000 : sample * 0x7FFF, true);\n          offset += 2;\n        }\n      }\n      \n      return new Blob([arrayBuffer], { type: 'audio/wav' });\n    },\n\n    /**\n     * å‘é€è¯­éŸ³æ¶ˆæ¯\n     */\n    async sendVoiceMessage(audioFile) {\n      try {\n        this.isProcessing = true;\n        this.recognitionStatusText = 'æ­£åœ¨å¤„ç†è¯­éŸ³æ¶ˆæ¯...';\n        \n        log.info('å¼€å§‹å¤„ç†è¯­éŸ³æ¶ˆæ¯', { fileName: audioFile.name, fileSize: audioFile.size });\n\n        // éªŒè¯æ–‡ä»¶\n        const validation = speechRecognitionService.validateAudioFile(audioFile);\n        if (!validation.isValid) {\n          throw new Error(validation.errors.join(', '));\n        }\n\n        // å¼€å§‹è¯­éŸ³è¯†åˆ«\n        this.recognitionStatusText = 'æ­£åœ¨è¯†åˆ«ä¸­ï¼Œè¯·ç¨å€™...';\n        const result = await speechRecognitionService.recognizeVoice(audioFile);\n        \n        if (result.success) {\n          // å‘é€è¯­éŸ³æ¶ˆæ¯\n          this.$emit('sendVoiceMessage', {\n            type: 'voice',\n            audioFile: audioFile,\n            transcription: result.transcription,\n            audioUrl: result.audioUrl,\n            duration: this.recordingTime\n          });\n          \n          log.success('è¯­éŸ³æ¶ˆæ¯å‘é€æˆåŠŸ', { transcription: result.transcription });\n          this.showToast('è¯­éŸ³æ¶ˆæ¯å‘é€æˆåŠŸï¼', 'success');\n        } else {\n          throw new Error('è¯†åˆ«å¤±è´¥');\n        }\n      } catch (error) {\n        log.error('è¯­éŸ³æ¶ˆæ¯å‘é€å¤±è´¥', error);\n        this.recognitionStatusText = 'å‘é€å¤±è´¥';\n        this.showToast(`è¯­éŸ³æ¶ˆæ¯å‘é€å¤±è´¥: ${error.message}`, 'error');\n      } finally {\n        this.isProcessing = false;\n        this.isListening = false;\n        this.selectedFile = null;\n        \n        // æ¸…ç©ºæ–‡ä»¶è¾“å…¥\n        if (this.$refs.fileInput) {\n          this.$refs.fileInput.value = '';\n        }\n      }\n    },\n\n    /**\n     * å¤„ç†éŸ³é¢‘æ–‡ä»¶ï¼ˆå½•éŸ³æˆ–ä¸Šä¼ ï¼‰\n     */\n    async processAudioFile(audioFile) {\n      try {\n        this.isProcessing = true;\n        this.recognitionStatusText = 'æ­£åœ¨ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶...';\n        \n        log.info('å¼€å§‹è¯­éŸ³è¯†åˆ«', { fileName: audioFile.name, fileSize: audioFile.size });\n\n        // éªŒè¯æ–‡ä»¶\n        const validation = speechRecognitionService.validateAudioFile(audioFile);\n        if (!validation.isValid) {\n          throw new Error(validation.errors.join(', '));\n        }\n\n        // å¼€å§‹è¯­éŸ³è¯†åˆ«\n        this.recognitionStatusText = 'æ­£åœ¨è¯†åˆ«ä¸­ï¼Œè¯·ç¨å€™...';\n        const result = await speechRecognitionService.recognizeVoice(audioFile);\n        \n        if (result.success) {\n          this.recognitionResult = result;\n          this.recognitionStatusText = 'è¯†åˆ«å®Œæˆ';\n          log.success('è¯­éŸ³è¯†åˆ«æˆåŠŸ', { transcription: result.transcription });\n          \n          // è‡ªåŠ¨å¡«å……åˆ°è¾“å…¥æ¡†\n          this.inputText = result.transcription;\n          \n          // æ˜¾ç¤ºæˆåŠŸæç¤º\n          this.showToast('è¯­éŸ³è¯†åˆ«æˆåŠŸï¼', 'success');\n        } else {\n          throw new Error('è¯†åˆ«å¤±è´¥');\n        }\n      } catch (error) {\n        log.error('è¯­éŸ³è¯†åˆ«å¤±è´¥', error);\n        this.recognitionStatusText = 'è¯†åˆ«å¤±è´¥';\n        this.showToast(`è¯­éŸ³è¯†åˆ«å¤±è´¥: ${error.message}`, 'error');\n      } finally {\n        this.isProcessing = false;\n        this.isListening = false;\n        this.selectedFile = null;\n        \n        // æ¸…ç©ºæ–‡ä»¶è¾“å…¥\n        if (this.$refs.fileInput) {\n          this.$refs.fileInput.value = '';\n        }\n      }\n    },\n\n    /**\n     * å›é€€åˆ°æ–‡ä»¶é€‰æ‹©æ¨¡å¼\n     */\n    fallbackToFileInput() {\n      log.info('å›é€€åˆ°æ–‡ä»¶é€‰æ‹©æ¨¡å¼')\n      this.$refs.fileInput.click();\n    },\n\n    /**\n     * å¤„ç†æ–‡ä»¶é€‰æ‹©ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰\n     */\n    async handleFileSelect(event) {\n      const file = event.target.files[0];\n      if (!file) {\n        this.stopVoiceInput();\n        return;\n      }\n\n      try {\n        this.selectedFile = file;\n        await this.processAudioFile(file);\n      } catch (error) {\n        log.error('æ–‡ä»¶å¤„ç†å¤±è´¥', error);\n        this.showToast(`æ–‡ä»¶å¤„ç†å¤±è´¥: ${error.message}`, 'error');\n      }\n    },\n\n    /**\n     * ç¼–è¾‘è¯†åˆ«ç»“æœ\n     */\n    editRecognitionResult() {\n      if (this.recognitionResult) {\n        this.inputText = this.recognitionResult.transcription;\n        this.clearRecognitionResult();\n        // èšç„¦åˆ°è¾“å…¥æ¡†\n        this.$nextTick(() => {\n          const input = this.$el.querySelector('.message-input');\n          if (input) input.focus();\n        });\n      }\n    },\n\n    /**\n     * å‘é€è¯†åˆ«ç»“æœ\n     */\n    sendRecognitionResult() {\n      if (this.recognitionResult) {\n        this.inputText = this.recognitionResult.transcription;\n        this.sendMessage();\n        this.clearRecognitionResult();\n      }\n    },\n\n    /**\n     * æ¸…é™¤è¯†åˆ«ç»“æœ\n     */\n    clearRecognitionResult() {\n      this.recognitionResult = null;\n    },\n\n    /**\n     * è·å–è¯­éŸ³æŒ‰é’®å›¾æ ‡\n     */\n    getVoiceButtonIcon() {\n      if (this.isProcessing) {\n        return 'spinner';\n      } else if (this.isListening) {\n        return 'microphone-slash';\n      } else {\n        return 'microphone';\n      }\n    },\n\n    /**\n     * è·å–è¯­éŸ³æŒ‰é’®æ ‡é¢˜\n     */\n    getVoiceButtonTitle() {\n      if (this.isProcessing) {\n        return 'æ­£åœ¨è¯†åˆ«ä¸­...';\n      } else if (this.isListening) {\n        return 'æŒ‰ä½è¯´è¯';\n      } else {\n        return 'æŒ‰ä½è¯´è¯';\n      }\n    },\n\n    /**\n     * è·å–è¯­éŸ³è¾“å…¥åŒºåŸŸå ä½ç¬¦æ–‡æœ¬\n     */\n    getVoicePlaceholderText() {\n      if (this.isListening) {\n        return 'å½•éŸ³ä¸­';\n      } else {\n        return 'æŒ‰ä½è¯´è¯';\n      }\n    },\n\n    /**\n     * æ˜¾ç¤ºæç¤ºä¿¡æ¯\n     */\n    showToast(message, type = 'info') {\n      // ä½¿ç”¨å…¨å±€toastæˆ–console\n      if (this.$toast) {\n        this.$toast[type]?.(message) || this.$toast(message);\n      } else {\n        console.log(`[${type.toUpperCase()}] ${message}`);\n      }\n    },\n\n    /**\n     * å¤„ç†å…¨å±€ç‚¹å‡»äº‹ä»¶\n     */\n    handleGlobalClick(event) {\n      // å¦‚æœç‚¹å‡»çš„æ˜¯åŠ å·æŒ‰é’®ï¼Œä¸å¤„ç†\n      if (event.target.closest('.plus-btn')) {\n        return;\n      }\n      // å¦‚æœç‚¹å‡»çš„æ˜¯åŠŸèƒ½æŒ‰é’®é¢æ¿ï¼Œä¸å¤„ç†\n      if (event.target.closest('.function-panel')) {\n        return;\n      }\n      // å…¶ä»–æƒ…å†µå…³é—­åŠ å·èœå•\n      if (this.showPlusMenu) {\n        this.showPlusMenu = false;\n      }\n    },\n\n    /**\n     * åˆ‡æ¢åŠ å·èœå•æ˜¾ç¤ºçŠ¶æ€\n     */\n    togglePlusMenu() {\n      this.showPlusMenu = !this.showPlusMenu;\n      log.info('åˆ‡æ¢åŠ å·èœå•', { show: this.showPlusMenu });\n    },\n\n    /**\n     * æ‰“å¼€ç›¸å†Œé€‰æ‹©å›¾ç‰‡\n     */\n    openPhotoLibrary() {\n      this.showPlusMenu = false;\n      this.$refs.imageInput.click();\n      log.info('æ‰“å¼€ç›¸å†Œé€‰æ‹©å›¾ç‰‡');\n    },\n\n    /**\n     * æ‰“å¼€ç›¸æœºæ‹ç…§\n     */\n    openCamera() {\n      this.showPlusMenu = false;\n      // åˆ›å»ºç›¸æœºè¾“å…¥ï¼Œæ”¯æŒæ‹ç…§\n      const cameraInput = document.createElement('input');\n      cameraInput.type = 'file';\n      cameraInput.accept = 'image/*';\n      cameraInput.capture = 'camera';\n      cameraInput.style.display = 'none';\n      \n      cameraInput.onchange = (event) => {\n        const file = event.target.files[0];\n        if (file) {\n          this.handleImageSelect({ target: { files: [file] } });\n        }\n        // æ¸…ç†ä¸´æ—¶å…ƒç´ \n        document.body.removeChild(cameraInput);\n      };\n      \n      document.body.appendChild(cameraInput);\n      cameraInput.click();\n      log.info('æ‰“å¼€ç›¸æœºæ‹ç…§');\n    },\n\n    /**\n     * å¤„ç†å›¾ç‰‡é€‰æ‹©\n     */\n    async handleImageSelect(event) {\n      const file = event.target.files[0];\n      if (!file) return;\n      \n      log.info('é€‰æ‹©å›¾ç‰‡æ–‡ä»¶', { fileName: file.name, fileSize: file.size, fileType: file.type });\n      \n      // éªŒè¯å›¾ç‰‡æ–‡ä»¶\n      if (!file.type.startsWith('image/')) {\n        this.showToast('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶', 'error');\n        return;\n      }\n      \n      try {\n        // ç›´æ¥å‘é€å›¾ç‰‡æ¶ˆæ¯ï¼Œä¸è¿›è¡Œåˆ†æ\n        this.isProcessing = true;\n        this.recognitionStatusText = 'æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...';\n        \n        // ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ å›¾ç‰‡åˆ°OSSè·å–URL\n        this.recognitionStatusText = 'æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...';\n        const imageUrl = await this.uploadImageToOSS(file);\n        \n        // ç¬¬äºŒæ­¥ï¼šç”¨URLè§¦å‘åç«¯åˆ†æ\n        this.recognitionStatusText = 'æ­£åœ¨åˆ†æå›¾ç‰‡...';\n        const analysis = await this.analyzeImageByURL(imageUrl, 'è¯·åˆ†æè¿™å¼ å›¾ç‰‡çš„å†…å®¹');\n        \n        if (analysis) {\n          // å›¾ç‰‡åˆ†æå®Œæˆåï¼Œå‘é€åŒ…å«å›¾ç‰‡URLå’Œåˆ†æç»“æœçš„æ¶ˆæ¯\n          // å‰ç«¯ä¼šæ˜¾ç¤ºåŸå›¾ï¼ŒAIä¼šåŸºäºåˆ†æç»“æœå›å¤\n          const imageMessage = `[å›¾ç‰‡]${imageUrl}`;\n          \n          // å‘é€åŒ…å«å›¾ç‰‡URLçš„æ¶ˆæ¯ç»™æ™ºèƒ½è°ƒåº¦æœåŠ¡\n          this.$emit('sendMessage', imageMessage);\n          \n          // å‘é€åŒ…å«åˆ†æç»“æœçš„æ¶ˆæ¯ç»™æ™ºèƒ½è°ƒåº¦æœåŠ¡ï¼Œè®©AIèƒ½åŸºäºåˆ†æç»“æœå›å¤\n          // æ³¨æ„ï¼šè¿™é‡Œå‘é€çš„æ˜¯åˆ†æç»“æœï¼Œä¸æ˜¯å›¾ç‰‡URL\n          const analysisMessage = `è¯·åŸºäºä»¥ä¸‹å›¾ç‰‡åˆ†æç»“æœå›å¤ï¼š${analysis.content}`;\n          this.$emit('sendMessage', analysisMessage);\n          \n          this.showToast('å›¾ç‰‡ä¸Šä¼ åˆ†æå®Œæˆï¼', 'success');\n          \n          // è®°å½•åˆ†æç»“æœåˆ°æ—¥å¿—ï¼Œä¾›è°ƒè¯•ä½¿ç”¨\n          log.info('å›¾ç‰‡åˆ†æå®Œæˆï¼Œå·²å‘é€ç»™æ™ºèƒ½è°ƒåº¦æœåŠ¡', { \n            fileName: file.name,\n            imageUrl: imageUrl,\n            analysisContent: analysis.content,\n            messageLength: imageMessage.length\n          });\n        } else {\n          throw new Error('å›¾ç‰‡åˆ†æå¤±è´¥');\n        }\n        \n      } catch (error) {\n        log.error('å›¾ç‰‡å¤„ç†å¤±è´¥', error);\n        this.showToast(`å›¾ç‰‡å¤„ç†å¤±è´¥: ${error.message}`, 'error');\n      } finally {\n        this.isProcessing = false;\n        this.selectedFile = null;\n        \n        // æ¸…ç©ºæ–‡ä»¶è¾“å…¥\n        this.$refs.imageInput.value = '';\n      }\n    },\n\n    /**\n     * æ‰“å¼€å›¾ç‰‡åˆ†ææ¨¡æ€æ¡†\n     */\n    openImageAnalysis() {\n      this.showImageAnalysisModal = true;\n      log.info('æ‰“å¼€å›¾ç‰‡åˆ†ææ¨¡æ€æ¡†');\n    },\n\n    /**\n     * å…³é—­å›¾ç‰‡åˆ†ææ¨¡æ€æ¡†\n     */\n    closeImageAnalysisModal() {\n      this.showImageAnalysisModal = false;\n      log.info('å…³é—­å›¾ç‰‡åˆ†ææ¨¡æ€æ¡†');\n    },\n\n    /**\n     * æ ¼å¼åŒ–æ–‡ä»¶å¤§å°\n     */\n    formatFileSize(bytes) {\n      if (bytes === 0) return '0 Bytes';\n      const k = 1024;\n      const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n      const i = Math.floor(Math.log(bytes) / Math.log(k));\n      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n    },\n\n    /**\n     * ä¸Šä¼ å›¾ç‰‡åˆ°OSS\n     */\n    async uploadImageToOSS(file) {\n      try {\n        const formData = new FormData();\n        formData.append('image', file);\n        \n        const response = await fetch('/api/image-analysis/upload', {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${localStorage.getItem('token')}` // å¦‚æœéœ€è¦è®¤è¯\n          },\n          body: formData\n        });\n        \n        if (!response.ok) {\n          throw new Error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥');\n        }\n        \n        const result = await response.json();\n        \n        if (result.success && result.imageUrl) {\n          log.info('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ', { imageUrl: result.imageUrl });\n          return result.imageUrl;\n        } else {\n          log.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¿”å›ç»“æœ:', result);\n          throw new Error(result.error || 'å›¾ç‰‡ä¸Šä¼ å¤±è´¥');\n        }\n      } catch (error) {\n        log.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥', error);\n        throw new Error(`å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ${error.message}`);\n      }\n    },\n\n    /**\n     * æ ¹æ®URLåˆ†æå›¾ç‰‡\n     */\n    async analyzeImageByURL(imageUrl, prompt) {\n      try {\n        const response = await fetch('/api/image-analysis/analyze-url', {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${localStorage.getItem('token')}`,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            imageUrl: imageUrl,\n            prompt: prompt || 'è¯·åˆ†æè¿™å¼ å›¾ç‰‡çš„å†…å®¹'\n          })\n        });\n        \n        if (!response.ok) {\n          throw new Error('å›¾ç‰‡åˆ†æå¤±è´¥');\n        }\n        \n        const result = await response.json();\n        \n        if (result.success && result.analysis) {\n          log.info('å›¾ç‰‡åˆ†ææˆåŠŸ', { analysis: result.analysis });\n          return result.analysis;\n        } else {\n          throw new Error(result.error || 'å›¾ç‰‡åˆ†æå¤±è´¥');\n        }\n      } catch (error) {\n        log.error('å›¾ç‰‡åˆ†æå¤±è´¥', error);\n        throw new Error(`å›¾ç‰‡åˆ†æå¤±è´¥: ${error.message}`);\n      }\n    },\n\n    /**\n     * å¤„ç†å›¾ç‰‡åˆ†æå®Œæˆ\n     */\n    handleImageAnalysisComplete(result) {\n      log.info('å›¾ç‰‡åˆ†æå®Œæˆ', result);\n      \n      // å°†åˆ†æç»“æœä½œä¸ºæ¶ˆæ¯å‘é€\n      const analysisMessage = `ğŸ–¼ï¸ å›¾ç‰‡åˆ†æç»“æœï¼š\\n\\n${result.analysis.content}`;\n      this.$emit('sendMessage', analysisMessage);\n      \n      // å…³é—­æ¨¡æ€æ¡†\n      this.closeImageAnalysisModal();\n      \n      // æ˜¾ç¤ºæˆåŠŸæç¤º\n      this.showToast('å›¾ç‰‡åˆ†æå®Œæˆï¼Œå·²å‘é€ç»“æœï¼', 'success');\n    }\n  }\n}\n</script>\n\n<style scoped>\n.input-area {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background: rgba(255, 255, 255, 0.95);\n  backdrop-filter: blur(20px);\n  border-top: 1px solid rgba(255, 255, 255, 0.3);\n  padding: 8px 16px 8px;\n  z-index: 1000;\n}\n\n.input-container {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.voice-btn {\n  width: 40px;\n  height: 40px;\n  border-radius: 20px;\n  border: none;\n  background: #f2f2f7;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s;\n  color: #667eea;\n  position: relative;\n}\n\n.voice-btn.active {\n  background: #ff9500;\n  color: white;\n}\n\n.voice-btn:hover:not(:disabled) {\n  background: #e5e5ea;\n  transform: scale(1.05);\n}\n\n.voice-btn.listening {\n  background: #ff3b30;\n  color: white;\n  animation: pulse 1.5s infinite;\n}\n\n.voice-btn.processing {\n  background: #007aff;\n  color: white;\n  cursor: not-allowed;\n}\n\n.voice-btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n.voice-btn .pulse {\n  animation: spin 1s linear infinite;\n}\n\n.message-input {\n  width: 100%;\n  border: none;\n  outline: none;\n  font-size: 16px;\n  padding: 12px;\n  background: transparent;\n  border-radius: 20px;\n  background: #f2f2f7;\n  transition: all 0.2s;\n  box-sizing: border-box;\n}\n\n.message-input:focus {\n  background: #ffffff;\n  box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2);\n}\n\n.message-input:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n.message-input::placeholder {\n  color: #8e8e93;\n}\n\n/* åŠ¨æ€è¾“å…¥åŒºåŸŸ */\n.dynamic-input-area {\n  flex: 1;\n  position: relative;\n  min-width: 0; /* ç¡®ä¿flexå­å…ƒç´ å¯ä»¥æ”¶ç¼© */\n}\n\n/* è¯­éŸ³è¾“å…¥åŒºåŸŸ */\n.voice-input-area {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 12px;\n  background: #f2f2f7;\n  border-radius: 20px;\n  cursor: pointer;\n  transition: all 0.2s;\n  min-height: 44px;\n  user-select: none;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.voice-input-area:hover {\n  background: #e5e5ea;\n}\n\n.voice-input-area.listening {\n  background: #ff8e8e;\n  color: white;\n  /* ç§»é™¤æ˜æ˜¾çš„åŠ¨ç”»æ•ˆæœ */\n}\n\n.voice-input-area .voice-area-icon {\n  font-size: 18px;\n  color: #667eea;\n}\n\n.voice-input-area.listening .voice-area-icon {\n  color: white;\n}\n\n.voice-input-area .voice-placeholder {\n  font-size: 16px;\n  color: #8e8e93;\n  font-weight: 500;\n}\n\n.voice-input-area.listening .voice-placeholder {\n  color: white;\n}\n\n.send-btn {\n  width: 40px;\n  height: 40px;\n  border-radius: 20px;\n  border: none;\n  background: #007aff;\n  color: white;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.send-btn:disabled {\n  background: #e5e5ea;\n  color: #8e8e93;\n  cursor: not-allowed;\n}\n\n.send-btn:not(:disabled):hover {\n  background: #0056d3;\n  transform: scale(1.05);\n}\n\n/* åŠ å·æŒ‰é’®æ ·å¼ - æ¨¡ä»¿å¾®ä¿¡é£æ ¼ */\n.plus-btn {\n  width: 40px;\n  height: 40px;\n  border-radius: 20px;\n  border: none;\n  background: #f2f2f7;\n  color: #8e8e93;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.plus-btn:hover:not(:disabled) {\n  background: #e5e5ea;\n  color: #007aff;\n  transform: scale(1.05);\n}\n\n.plus-btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n.plus-btn svg {\n  font-size: 16px;\n}\n\n/* è¾“å…¥åŒºåŸŸå±•å¼€çŠ¶æ€ */\n.input-area.expanded {\n  transform: translateY(-170px);\n  transition: transform 0.3s ease-out;\n}\n\n/* åŠ å·æŒ‰é’®æ¿€æ´»çŠ¶æ€ */\n.plus-btn.active {\n  background: #007aff;\n  color: white;\n  transform: rotate(45deg);\n}\n\n/* åŠŸèƒ½æŒ‰é’®é¢æ¿ - æ¨¡ä»¿å¾®ä¿¡æ ·å¼ */\n.function-panel {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background: #f7f7f7;\n  border-top: 1px solid #d0d0d0;\n  padding: 20px 20px 30px 20px;\n  z-index: 999;\n  animation: slideUp 0.3s ease-out;\n  height: 170px;\n  box-sizing: border-box;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.function-buttons {\n  display: flex;\n  justify-content: center;\n  gap: 40px;\n  max-width: 400px;\n  margin: 0 auto;\n}\n\n.function-button {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n  min-width: 120px;\n}\n\n.function-button:hover {\n  transform: scale(1.05);\n}\n\n.button-icon {\n  width: 80px;\n  height: 80px;\n  border-radius: 20px;\n  background: #4285f4;\n  color: white;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 32px;\n  box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);\n}\n\n.button-text {\n  font-size: 16px;\n  color: #333;\n  font-weight: 600;\n  text-align: center;\n}\n\n@keyframes slideUp {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.menu-item {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 12px 16px;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n  color: #333;\n  font-size: 14px;\n  font-weight: 500;\n  min-width: 120px;\n}\n\n.menu-item:hover {\n  background: #f2f2f7;\n  transform: scale(1.02);\n}\n\n.menu-item svg {\n  font-size: 16px;\n  color: #007aff;\n  width: 20px;\n  text-align: center;\n}\n\n/* å½•éŸ³çŠ¶æ€æç¤ºç›¸å…³æ ·å¼å·²åˆ é™¤ */\n\n/* è¯­éŸ³è¯†åˆ«çŠ¶æ€æç¤º */\n.recognition-status {\n  position: absolute;\n  bottom: 100%;\n  left: 0;\n  right: 0;\n  background: rgba(0, 122, 255, 0.1);\n  border-top: 1px solid rgba(0, 122, 255, 0.2);\n  padding: 8px 16px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.status-content {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #007aff;\n  font-size: 14px;\n}\n\n.status-content svg {\n  font-size: 16px;\n}\n\n/* è¯­éŸ³è¯†åˆ«ç»“æœé¢„è§ˆ */\n.recognition-preview {\n  position: absolute;\n  bottom: 100%;\n  left: 0;\n  right: 0;\n  background: rgba(255, 255, 255, 0.98);\n  backdrop-filter: blur(20px);\n  border-top: 1px solid rgba(0, 122, 255, 0.2);\n  border-radius: 16px 16px 0 0;\n  margin: 0 8px;\n  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);\n  overflow: hidden;\n}\n\n.preview-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px 16px;\n  background: rgba(0, 122, 255, 0.1);\n  border-bottom: 1px solid rgba(0, 122, 255, 0.1);\n  color: #007aff;\n  font-weight: 600;\n  font-size: 14px;\n}\n\n.preview-header svg {\n  font-size: 16px;\n}\n\n.preview-close {\n  margin-left: auto;\n  background: none;\n  border: none;\n  color: #007aff;\n  cursor: pointer;\n  padding: 4px;\n  border-radius: 4px;\n  transition: all 0.2s;\n}\n\n.preview-close:hover {\n  background: rgba(0, 122, 255, 0.1);\n}\n\n.preview-content {\n  padding: 16px;\n}\n\n.preview-text {\n  margin: 0 0 16px 0;\n  font-size: 16px;\n  line-height: 1.5;\n  color: #333;\n  background: #f8f9fa;\n  padding: 12px;\n  border-radius: 8px;\n  border-left: 4px solid #007aff;\n}\n\n.preview-actions {\n  display: flex;\n  gap: 8px;\n}\n\n.preview-btn {\n  flex: 1;\n  padding: 10px 16px;\n  border: none;\n  border-radius: 8px;\n  font-size: 14px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n}\n\n.preview-btn-edit {\n  background: #f2f2f7;\n  color: #666;\n}\n\n.preview-btn-edit:hover {\n  background: #e5e5ea;\n}\n\n.preview-btn-send {\n  background: #007aff;\n  color: white;\n}\n\n.preview-btn-send:hover {\n  background: #0056d3;\n}\n\n/* åŠ¨ç”» */\n@keyframes pulse {\n  0%, 100% {\n    transform: scale(1);\n  }\n  50% {\n    transform: scale(1.1);\n  }\n}\n\n@keyframes spin {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n/* å“åº”å¼è®¾è®¡ */\n@media (max-width: 430px) {\n  .input-area {\n    padding: 8px 12px 8px;\n  }\n  \n  .voice-btn,\n  .send-btn {\n    width: 36px;\n    height: 36px;\n  }\n  \n  .message-input {\n    font-size: 15px;\n    padding: 10px;\n  }\n  \n  .preview-content {\n    padding: 12px;\n  }\n  \n  .preview-text {\n    font-size: 15px;\n    padding: 10px;\n  }\n  \n  .preview-btn {\n    padding: 8px 12px;\n    font-size: 13px;\n  }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}