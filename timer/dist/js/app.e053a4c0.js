(function(){"use strict";var e={9869:function(e,t,s){var a=s(5130),o=s(6768);const i={id:"app"};function n(e,t,s,a,n,r){const l=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)("div",i,[(0,o.bF)(l)])}var r={name:"App"},l=s(1241);const c=(0,l.A)(r,[["render",n]]);var d=c,u=(s(8111),s(3579),s(1387)),h=s(4232);const m={class:"home-container"},g={class:"header"},p={class:"view-toggle"},k={class:"content"},v={key:0,class:"time-view-container"},f={class:"time-segment-section"},y={class:"segmented"},b=["onClick"],w={class:"sidebar-header"},C={class:"sidebar-content"},L=["onClick"],T={class:"setting-label"},S={class:"setting-description"};function I(e,t,s,a,i,n){const r=(0,o.g2)("font-awesome-icon"),l=(0,o.g2)("TaskTimeBlocks"),c=(0,o.g2)("TaskQuadrant"),d=(0,o.g2)("AddTaskModal"),u=(0,o.g2)("VoiceCloneModal"),I=(0,o.g2)("AIVoiceModal"),E=(0,o.g2)("TabBar");return(0,o.uX)(),(0,o.CE)("div",m,[(0,o.Lk)("div",g,[(0,o.Lk)("div",{class:"settings-btn",onClick:t[0]||(t[0]=(...e)=>n.toggleSidebar&&n.toggleSidebar(...e))},[(0,o.bF)(r,{icon:"cog"})]),(0,o.Lk)("div",p,[(0,o.Lk)("button",{class:(0,h.C4)(["toggle-btn",{active:"time"===i.currentView}]),onClick:t[1]||(t[1]=e=>n.switchView("time"))}," æ—¶é—´å— ",2),(0,o.Lk)("button",{class:(0,h.C4)(["toggle-btn",{active:"quadrant"===i.currentView}]),onClick:t[2]||(t[2]=e=>n.switchView("quadrant"))}," å››è±¡é™ ",2)]),(0,o.Lk)("div",{class:"settings-btn",onClick:t[3]||(t[3]=(...e)=>n.openAddTask&&n.openAddTask(...e))},[(0,o.bF)(r,{icon:"plus"})])]),(0,o.Lk)("div",k,["time"===i.currentView?((0,o.uX)(),(0,o.CE)("div",v,[(0,o.Lk)("div",f,[t[9]||(t[9]=(0,o.Lk)("div",{class:"section-title"},[(0,o.Lk)("h3",null,"æ—¶é—´æ®µ"),(0,o.Lk)("a",{href:"/task-collections",class:"view-all-link"},"ä»»åŠ¡é›†")],-1)),(0,o.Lk)("div",y,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.timeSegments,e=>((0,o.uX)(),(0,o.CE)("button",{key:e.value,class:(0,h.C4)({active:i.currentTimeSegment===e.value}),onClick:t=>n.switchTimeSegment(e.value)},(0,h.v_)(e.label),11,b))),128))])]),(0,o.bF)(l,{"time-blocks":n.filteredTimeBlocks,onTaskClick:n.openPomodoro,onTaskToggle:n.toggleTask,onToggleCollapse:n.toggleTimeBlockCollapse},null,8,["time-blocks","onTaskClick","onTaskToggle","onToggleCollapse"])])):((0,o.uX)(),(0,o.Wv)(c,{key:1,quadrants:i.quadrants,onTaskClick:n.openPomodoro,onTaskToggle:n.toggleTask},null,8,["quadrants","onTaskClick","onTaskToggle"]))]),(0,o.Lk)("div",{class:(0,h.C4)(["sidebar",{open:i.sidebarOpen}])},[(0,o.Lk)("div",w,[t[10]||(t[10]=(0,o.Lk)("div",{class:"sidebar-title"},"è®¾ç½®",-1)),(0,o.Lk)("div",{class:"close-sidebar",onClick:t[4]||(t[4]=(...e)=>n.toggleSidebar&&n.toggleSidebar(...e))},[(0,o.bF)(r,{icon:"times"})])]),(0,o.Lk)("div",C,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.settings,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"setting-item",onClick:t=>n.handleSettingClick(e)},[(0,o.Lk)("div",T,(0,h.v_)(e.label),1),(0,o.Lk)("div",S,(0,h.v_)(e.description),1)],8,L))),128))])],2),(0,o.bF)(d,{visible:i.showAddModal,onClose:n.closeAddTask,onSubmit:n.handleAddTask},null,8,["visible","onClose","onSubmit"]),i.showVoiceCloneModal?((0,o.uX)(),(0,o.Wv)(u,{key:0,hasCloned:i.hasClonedVoice,onClose:t[5]||(t[5]=e=>i.showVoiceCloneModal=!1),onCloneSuccess:n.onCloneSuccess},null,8,["hasCloned","onCloneSuccess"])):(0,o.Q3)("",!0),i.showAIVoiceModal?((0,o.uX)(),(0,o.Wv)(I,{key:1,onClose:t[6]||(t[6]=e=>i.showAIVoiceModal=!1),onApplyVoice:n.onApplyVoice},null,8,["onApplyVoice"])):(0,o.Q3)("",!0),i.sidebarOpen?((0,o.uX)(),(0,o.CE)("div",{key:2,class:"overlay",onClick:t[7]||(t[7]=(...e)=>n.toggleSidebar&&n.toggleSidebar(...e))})):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"ai-assistant-btn",onClick:t[8]||(t[8]=(...e)=>n.goToAISecretary&&n.goToAISecretary(...e))},[(0,o.bF)(r,{icon:"robot"})]),(0,o.bF)(E)])}s(4114),s(2489),s(116),s(7588),s(1701);const E={class:"task-time-blocks-container"},M={class:"time-blocks"},A=["onClick"],D={class:"time-label"},$={class:"time-count"},P={class:"time-block-content"},F={key:0,class:"empty-state"};function _(e,t,s,i,n,r){const l=(0,o.g2)("font-awesome-icon"),c=(0,o.g2)("TaskItem");return(0,o.uX)(),(0,o.CE)("div",E,[(0,o.Lk)("div",M,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.timeBlocks,s=>((0,o.uX)(),(0,o.CE)("div",{key:s.id,class:(0,h.C4)(["time-block-item",{collapsed:s.collapsed}])},[(0,o.Lk)("div",{class:"time-block-header",onClick:e=>r.toggleCollapse(s.id)},[(0,o.Lk)("div",D,[(0,o.eW)((0,h.v_)(s.label)+" ",1),(0,o.bF)(l,{icon:s.collapsed?"chevron-down":"chevron-up",class:"collapse-icon"},null,8,["icon"])]),(0,o.Lk)("div",$,(0,h.v_)(s.tasks.length),1)],8,A),(0,o.bo)((0,o.Lk)("div",P,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.tasks,t=>((0,o.uX)(),(0,o.Wv)(c,{key:t.id,task:t,onClick:s=>e.$emit("task-click",t),onToggle:s=>e.$emit("task-toggle",t)},null,8,["task","onClick","onToggle"]))),128)),0===s.tasks.length?((0,o.uX)(),(0,o.CE)("div",F,[(0,o.bF)(l,{icon:"clock"}),t[0]||(t[0]=(0,o.Lk)("span",null,"æš‚æ— å®‰æŽ’",-1))])):(0,o.Q3)("",!0)],512),[[a.aG,!s.collapsed]])],2))),128))])])}const R={class:"task-content"},x={class:"task-title"},X={key:0,class:"task-time"},U={key:1,class:"task-description"},V={key:1,class:"task-actions"};function B(e,t,s,i,n,r){const l=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",{class:(0,h.C4)(["task-item",{completed:s.task.completed}]),onClick:t[3]||(t[3]=t=>e.$emit("click",s.task))},[(0,o.Lk)("div",{class:(0,h.C4)(["task-checkbox",{checked:s.task.completed}]),onClick:t[0]||(t[0]=(0,a.D$)((...e)=>r.toggleTask&&r.toggleTask(...e),["stop"]))},[s.task.completed?((0,o.uX)(),(0,o.Wv)(l,{key:0,icon:"check"})):(0,o.Q3)("",!0)],2),(0,o.Lk)("div",R,[(0,o.Lk)("div",x,(0,h.v_)(s.task.title),1),s.task.time?((0,o.uX)(),(0,o.CE)("div",X,(0,h.v_)(s.task.time),1)):(0,o.Q3)("",!0),s.task.description?((0,o.uX)(),(0,o.CE)("div",U,(0,h.v_)(s.task.description),1)):(0,o.Q3)("",!0)]),s.task.priority?((0,o.uX)(),(0,o.CE)("div",{key:0,class:(0,h.C4)(["task-priority",`priority-${s.task.priority}`])},(0,h.v_)(r.getPriorityText(s.task.priority)),3)):(0,o.Q3)("",!0),s.showActions?((0,o.uX)(),(0,o.CE)("div",V,[(0,o.Lk)("button",{onClick:t[1]||(t[1]=(0,a.D$)(t=>e.$emit("edit",s.task),["stop"])),class:"action-btn"},[(0,o.bF)(l,{icon:"edit"})]),(0,o.Lk)("button",{onClick:t[2]||(t[2]=(0,a.D$)(t=>e.$emit("delete",s.task),["stop"])),class:"action-btn delete"},[(0,o.bF)(l,{icon:"trash"})])])):(0,o.Q3)("",!0)],2)}var N={name:"TaskItem",props:{task:{type:Object,required:!0},showActions:{type:Boolean,default:!1}},emits:["click","toggle","edit","delete"],methods:{toggleTask(){this.$emit("toggle",this.task)},getPriorityText(e){const t={high:"é«˜",medium:"ä¸­",low:"ä½Ž"};return t[e]||""}}};const O=(0,l.A)(N,[["render",B],["__scopeId","data-v-8073a8c0"]]);var q=O,z={name:"TaskTimeBlocks",components:{TaskItem:q},props:{timeBlocks:{type:Array,required:!0}},emits:["task-click","task-toggle","toggle-collapse"],methods:{toggleCollapse(e){this.$emit("toggle-collapse",e)}}};const j=(0,l.A)(z,[["render",_],["__scopeId","data-v-ee45c46a"]]);var K=j;const W={class:"task-quadrant-container"},Q={class:"quadrant-grid"},G={class:"quadrant-header"},H={class:"quadrant-title"},J={class:"quadrant-count"},Y={class:"quadrant-content"},Z={key:0,class:"empty-state"};function ee(e,t,s,a,i,n){const r=(0,o.g2)("TaskItem"),l=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",W,[(0,o.Lk)("div",Q,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.quadrants,s=>((0,o.uX)(),(0,o.CE)("div",{key:s.id,class:(0,h.C4)(["quadrant-item",`quadrant-${s.id}`])},[(0,o.Lk)("div",G,[(0,o.Lk)("div",H,(0,h.v_)(s.title),1),(0,o.Lk)("div",J,(0,h.v_)(s.tasks.length),1)]),(0,o.Lk)("div",Y,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.tasks,t=>((0,o.uX)(),(0,o.Wv)(r,{key:t.id,task:t,onClick:s=>e.$emit("task-click",t),onToggle:s=>e.$emit("task-toggle",t)},null,8,["task","onClick","onToggle"]))),128)),0===s.tasks.length?((0,o.uX)(),(0,o.CE)("div",Z,[(0,o.bF)(l,{icon:"inbox"}),t[0]||(t[0]=(0,o.Lk)("span",null,"æš‚æ— ä»»åŠ¡",-1))])):(0,o.Q3)("",!0)])],2))),128))])])}var te={name:"TaskQuadrant",components:{TaskItem:q},props:{quadrants:{type:Array,required:!0}},emits:["task-click","task-toggle"]};const se=(0,l.A)(te,[["render",ee],["__scopeId","data-v-8f4a88f6"]]);var ae=se;const oe={class:"modal-header"},ie={class:"form-section"},ne={class:"form-section"},re={class:"quadrant-selector"},le=["onClick"],ce={class:"form-section"},de={class:"time-row"},ue=["min"],he={class:"form-actions"},me=["disabled"];function ge(e,t,s,i,n,r){const l=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.Wv)(o.Im,{to:"body"},[(0,o.bF)(a.eB,{name:"modal-fade"},{default:(0,o.k6)(()=>[s.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"modal-overlay",onClick:t[7]||(t[7]=(...e)=>r.handleClose&&r.handleClose(...e))},[(0,o.bF)(a.eB,{name:"modal-slide"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",{class:"modal-container",onClick:t[6]||(t[6]=(0,a.D$)(()=>{},["stop"]))},[(0,o.Lk)("div",oe,[t[8]||(t[8]=(0,o.Lk)("h2",{class:"modal-title"},"æ·»åŠ æ–°ä»»åŠ¡",-1)),(0,o.Lk)("button",{class:"close-button",onClick:t[0]||(t[0]=(...e)=>r.handleClose&&r.handleClose(...e))},[(0,o.bF)(l,{icon:"times"})])]),(0,o.Lk)("form",{onSubmit:t[5]||(t[5]=(0,a.D$)((...e)=>r.handleSubmit&&r.handleSubmit(...e),["prevent"])),class:"modal-form"},[(0,o.Lk)("div",ie,[t[9]||(t[9]=(0,o.Lk)("label",{class:"form-label"},"ä»»åŠ¡åç§°",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.formData.title=e),type:"text",class:"form-input",placeholder:"ä¾‹å¦‚ï¼šè€ƒç ”æ•°å­¦å¤ä¹ ",maxlength:"50",required:""},null,512),[[a.Jo,n.formData.title]])]),(0,o.Lk)("div",ne,[t[10]||(t[10]=(0,o.Lk)("label",{class:"form-label"},"åˆ†ç±»",-1)),(0,o.Lk)("div",re,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.quadrants,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:(0,h.C4)(["quadrant-option",{active:n.formData.quadrant===e.id}]),onClick:t=>n.formData.quadrant=e.id},[(0,o.Lk)("div",{class:"quadrant-color",style:(0,h.Tr)({backgroundColor:e.color})},null,4),(0,o.Lk)("span",null,(0,h.v_)(e.label),1)],10,le))),128))])]),(0,o.Lk)("div",ce,[t[11]||(t[11]=(0,o.Lk)("label",{class:"form-label"},[(0,o.eW)("æ—¥æœŸå’Œæ—¶é—´ "),(0,o.Lk)("span",{class:"optional-label"},"é€‰å¡«")],-1)),(0,o.Lk)("div",de,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.formData.date=e),type:"date",class:"form-input date-input",min:r.today},null,8,ue),[[a.Jo,n.formData.date]]),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>n.formData.time=e),type:"time",class:"form-input time-input"},null,512),[[a.Jo,n.formData.time]])])]),(0,o.Lk)("div",he,[(0,o.Lk)("button",{type:"button",class:"btn-secondary",onClick:t[4]||(t[4]=(...e)=>r.handleClose&&r.handleClose(...e))}," å–æ¶ˆ "),(0,o.Lk)("button",{type:"submit",class:"btn-primary",disabled:!n.formData.title.trim()}," æ·»åŠ ä»»åŠ¡ ",8,me)])],32)])]),_:1})])):(0,o.Q3)("",!0)]),_:1})])}var pe={name:"AddTaskModal",props:{visible:{type:Boolean,default:!1}},emits:["close","submit"],data(){return{formData:{title:"",date:"",time:"",quadrant:2},quadrants:[{id:1,label:"é‡è¦ä¸”ç´§æ€¥",color:"#ff3b30"},{id:2,label:"é‡è¦ä¸ç´§æ€¥",color:"#007aff"},{id:3,label:"ç´§æ€¥ä¸é‡è¦",color:"#ff9500"},{id:4,label:"ä¸é‡è¦ä¸ç´§æ€¥",color:"#34c759"}]}},computed:{today(){const e=new Date,t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${a}`},currentTime(){const e=new Date;return e.toTimeString().slice(0,5)}},watch:{visible(e){e&&(this.formData.date=this.today,this.formData.time=this.currentTime)}},methods:{handleClose(){this.$emit("close")},handleSubmit(){const e={...this.formData,id:Date.now(),completed:!1,createdAt:(new Date).toISOString(),userId:"default-user",timeBlockType:this.getTimeBlockType(this.formData.time),isScheduled:!!this.formData.time};this.$emit("submit",e),this.resetForm()},getTimeBlockType(e){if(!e)return"unscheduled";const t=parseInt(e.split(":")[0]);return t>=7&&t<12?"morning":t>=12&&t<18?"afternoon":t>=18&&t<24?"evening":"unscheduled"},resetForm(){this.formData={title:"",date:this.today,time:"",quadrant:2}}}};const ke=(0,l.A)(pe,[["render",ge],["__scopeId","data-v-7d4bac7d"]]);var ve=ke;const fe={class:"tab-bar"};function ye(e,t,s,a,i,n){const r=(0,o.g2)("font-awesome-icon"),l=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",fe,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.tabs,t=>((0,o.uX)(),(0,o.Wv)(l,{key:t.name,to:t.path,class:(0,h.C4)(["tab-item",{active:e.$route.name===t.name}])},{default:(0,o.k6)(()=>[(0,o.bF)(r,{icon:t.icon,class:"tab-icon"},null,8,["icon"]),(0,o.Lk)("span",null,(0,h.v_)(t.label),1)]),_:2},1032,["to","class"]))),128))])}var be={name:"TabBar",data(){return{tabs:[{name:"Task",path:"/task",icon:"tasks",label:"ä»»åŠ¡"},{name:"TaskCollections",path:"/task-collections",icon:"layer-group",label:"ä»»åŠ¡é›†"},{name:"AiSecretary",path:"/ai-secretary",icon:"robot",label:"AIåŠ©æ‰‹"},{name:"Stats",path:"/stats",icon:"chart-line",label:"ç»Ÿè®¡"},{name:"Calendar",path:"/calendar",icon:"calendar",label:"æ—¥åŽ†"}]}}};const we=(0,l.A)(be,[["render",ye],["__scopeId","data-v-65858b4d"]]);var Ce=we,Le=s(144);const Te=!1,Se={baseURL:"/api",aiBaseURL:"/api/ai",aisiriBaseURL:"/api/aisiri",speechRecognitionBaseURL:"/api",timeout:6e4,headers:{"Content-Type":"application/json"}};function Ie(e){return`${Se.aisiriBaseURL}${e}`}function Ee(e){return e.startsWith("/api/")?e:`/api${e}`}Se.baseURL;var Me=s(4373);const Ae=Me.A.create({baseURL:Se.baseURL,timeout:Se.timeout,headers:Se.headers});Ae.interceptors.request.use(e=>{const t=localStorage.getItem("token");if(t&&(e.headers.Authorization=`Bearer ${t}`),console.log("ðŸ“¡ API Request:",e.method?.toUpperCase(),e.url),e.data){const t={...e.data};t.password&&(t.password="***"),console.log("ðŸ“¤ Request Data:",t)}return e},e=>(console.error("âŒ Request Error:",e),Promise.reject(e))),Ae.interceptors.response.use(e=>(console.log("ðŸ“¨ API Response:",e.status,e.config.url),console.log("ðŸ“¥ Response Data:",e.data),e.data),e=>(console.error("âŒ Response Error:",e.response?.status,e.response?.data||e.message),401===e.response?.status&&(console.log("ðŸ”’ Tokenè¿‡æœŸæˆ–æ— æ•ˆï¼Œæ¸…é™¤æœ¬åœ°å­˜å‚¨"),localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.pathname.includes("/auth")||(console.log("ðŸ”„ è·³è½¬åˆ°ç™»å½•é¡µé¢"),window.location.href="/auth/login")),Promise.reject(e)));var De=Ae;const $e=Se.baseURL.replace("/api","");function Pe(){try{return localStorage.getItem("token")||""}catch(e){return""}}async function Fe(e,t){const s=new FormData;s.append("file",e),t&&s.append("user_id",t);const a=await fetch(`${$e}/api/aivoice/upload-voice`,{method:"POST",headers:{Authorization:`Bearer ${Pe()}`},body:s}),o=await a.json().catch(()=>({}));if(!a.ok||!o?.success)throw new Error(o?.error||o?.message||a.statusText||"ä¸Šä¼ å¤±è´¥");return o}async function _e(e,t){const s=await De.post("/aivoice/enroll-voice",{user_id:e,oss_url:t});if(!s?.success)throw new Error(s?.error||s?.message||"å¤åˆ»å¤±è´¥");return s}async function Re(e){try{return await De.get("/aivoice/bind-status",{params:{user_id:e}})}catch(t){const s=t?.response?.status,a=t?.response?.data||t?.message;if(404===s||"string"===typeof a&&a.includes("è·¯ç”±æœªæ‰¾åˆ°"))return await De.get(`/aivoice/bind-status/${encodeURIComponent(e)}`);throw t}}async function xe(e,t,s){const a=await De.post("/aivoice/synthesize-voice",{user_id:e,encourage_text:t,criticize_text:s},{timeout:3e4});if(!a?.success)throw new Error(a?.error||a?.message||"åˆæˆå¤±è´¥");return a}async function Xe(e,t,s){const a={encourage_tone:t,criticize_tone:s};e&&String(e).trim()&&(a.name=String(e).trim());const o=await De.post("/aivoice/imitate-text",a,{timeout:2e4});if(!o?.success)throw new Error(o?.error||o?.message||"AIæ–‡æœ¬ç”Ÿæˆå¤±è´¥");return o}async function Ue(e,t){const s=await De.delete("/aivoice/voice-group",{data:{user_id:e,group_index:t}});if(!s?.success)throw new Error(s?.error||s?.message||"åˆ é™¤å¤±è´¥");return s}async function Ve(e,t,s){const a={user_id:e};t&&(a.encourage_url=t),s&&(a.criticize_url=s);const o=await De.delete("/aivoice/voice-group",{data:a});if(!o?.success)throw new Error(o?.error||o?.message||"åˆ é™¤å¤±è´¥");return o}const Be={uploadVoice:Fe,enrollVoice:_e,getBindStatus:Re,synthesizeVoice:xe,imitateText:Xe,deleteVoiceGroupByIndex:Ue,deleteVoiceGroupByUrl:Ve};var Ne=Be;const Oe={class:"modal-container voice-clone-modal-content",style:{"max-width":"400px"}},qe={class:"modal-body"},ze={key:0,class:"file-info"},je={key:1,class:"form-error"},Ke={class:"modal-footer"},We=["disabled"],Qe=["disabled"],Ge={class:"modal-header",style:{"border-top":"1px solid var(--color-border)","border-bottom":"none"}},He={class:"modal-body"},Je={key:0,class:"success-feedback"},Ye={style:{"margin-top":"16px"}},Ze={key:0,class:"file-info"},et={key:1,class:"form-error"},tt={class:"modal-footer",id:"cloned-footer"},st=["disabled"],at=["disabled"],ot=["disabled"],it={key:2,class:"loading-overlay"},nt={key:3,class:"success-msg"},rt="https://vitebucket.oss-cn-hangzhou.aliyuncs.com/voice/685660fc1fc9dcbdaea1a51d/1750861142930_huangquan1.mp3";var lt={__name:"VoiceCloneModal",props:{hasCloned:{type:Boolean,default:!1},userId:{type:String,default:""}},emits:["close","clone-success"],setup(e,{emit:t}){const s=t,i=e,n=(0,Le.KR)(null),r=(0,Le.KR)(""),l=(0,Le.KR)(""),c=(0,Le.KR)(""),d=(0,Le.KR)(!1),u=(0,Le.KR)(!1),m=(0,Le.KR)(i.hasCloned);function g(){u.value||s("close")}function p(e){const t=e.target.files[0];if(t){if(!["audio/mp3","audio/wav","audio/mpeg","audio/x-wav"].includes(t.type))return l.value="ä»…æ”¯æŒmp3æˆ–wavæ ¼å¼",n.value=null,void(r.value="");if(t.size>15728640)return l.value="æ–‡ä»¶ä¸èƒ½è¶…è¿‡15MB",n.value=null,void(r.value="");l.value="",n.value=t,r.value=t.name}}function k(){if(i.userId)return i.userId;try{const e=JSON.parse(localStorage.getItem("user")||"null");return e?._id||e?.id||localStorage.getItem("userId")||""}catch(e){return localStorage.getItem("userId")||""}}async function v(){if(m.value&&!d.value)return void s("clone-success");if(!n.value)return void(l.value="è¯·å…ˆé€‰æ‹©éŸ³é¢‘æ–‡ä»¶");const e=k();if(e){u.value=!0,c.value="",l.value="";try{const t=await Ne.uploadVoice(n.value,e),a=t.url,o=await Ne.enrollVoice(e,a);c.value="update_voice"===o.action?"éŸ³è‰²å·²æ›´æ–°ï¼":"å¤åˆ»æˆåŠŸï¼",m.value=!0,u.value=!1,setTimeout(()=>{c.value="",s("clone-success")},800)}catch(t){u.value=!1,l.value=t?.message||"å¤„ç†å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•"}}else l.value="æœªç™»å½•æˆ–ç¼ºå°‘ç”¨æˆ·æ ‡è¯†ï¼Œè¯·å…ˆç™»å½•"}async function f(){const e=k();if(e){u.value=!0,c.value="",l.value="";try{await Ne.enrollVoice(e,rt),c.value="è¯•ç”¨å£°éŸ³å¤åˆ»æˆåŠŸï¼",m.value=!0,u.value=!1,setTimeout(()=>{c.value="",s("clone-success")},800)}catch(t){u.value=!1,l.value=t?.message||"è¯•ç”¨å£°éŸ³å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•"}}else l.value="æœªç™»å½•æˆ–ç¼ºå°‘ç”¨æˆ·æ ‡è¯†ï¼Œè¯·å…ˆç™»å½•"}return(0,o.wB)(()=>i.hasCloned,e=>{m.value=!!e}),(0,o.sV)(async()=>{const e=k();if(e)try{const t=await Ne.getBindStatus(e),s=!!(t?.binded??t?.has_voice??t?.bound);m.value=s}catch(t){}}),(e,t)=>((0,o.uX)(),(0,o.CE)("div",{class:"modal-overlay voice-clone-modal-overlay",onClick:(0,a.D$)(g,["self"])},[(0,o.Lk)("div",Oe,[(0,o.Lk)("header",{class:"modal-header"},[t[5]||(t[5]=(0,o.Lk)("h2",{class:"modal-title"},"å£°éŸ³å¤åˆ»",-1)),(0,o.Lk)("button",{class:"icon-button",onClick:g},"âœ•")]),m.value?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.Lk)("header",Ge,[t[9]||(t[9]=(0,o.Lk)("h2",{class:"modal-title"},"å£°éŸ³å·²å¤åˆ»",-1)),(0,o.Lk)("button",{class:"btn-link",onClick:t[2]||(t[2]=e=>d.value=!d.value)},(0,h.v_)(d.value?"å–æ¶ˆæ›´æ–°":"æ›´æ–°å£°éŸ³"),1)]),(0,o.Lk)("main",He,[d.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",Je,t[10]||(t[10]=[(0,o.Lk)("i",{class:"fa-regular fa-circle-check",style:{"font-style":"normal",color:"#10B981"}},"âœ”",-1),(0,o.Lk)("p",null,"ä½ çš„ä¸“å±žéŸ³è‰²å·²å°±ç»ªï¼",-1)]))),(0,o.bo)((0,o.Lk)("div",Ye,[(0,o.Lk)("div",{class:"upload-area",onClick:t[3]||(t[3]=t=>e.$refs.updateInput&&e.$refs.updateInput.click())},[t[11]||(t[11]=(0,o.Lk)("i",{class:"fa-solid fa-cloud-arrow-up",style:{"font-style":"normal",color:"#4F46E5"}},"â˜",-1)),t[12]||(t[12]=(0,o.Lk)("p",null,"ä¸Šä¼ æ–°çš„éŸ³é¢‘æ–‡ä»¶",-1)),t[13]||(t[13]=(0,o.Lk)("span",null,"æ”¯æŒ mp3/wav æ ¼å¼ï¼Œå¤§å° â‰¤ 15MB",-1)),(0,o.Lk)("input",{ref:"updateInput",type:"file",accept:"audio/*",onChange:p,style:{display:"none"}},null,544)]),r.value?((0,o.uX)(),(0,o.CE)("div",Ze,[(0,o.Lk)("span",null,"ðŸ“„ "+(0,h.v_)(r.value),1),(0,o.Lk)("button",{class:"icon-button",onClick:t[4]||(t[4]=()=>{n.value=null,r.value=""})},"âœ•")])):(0,o.Q3)("",!0),l.value?((0,o.uX)(),(0,o.CE)("div",et,(0,h.v_)(l.value),1)):(0,o.Q3)("",!0)],512),[[a.aG,d.value]])]),(0,o.Lk)("footer",tt,[d.value?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("button",{class:"btn btn-secondary",onClick:g,disabled:u.value},"å…³é—­",8,st),(0,o.Lk)("button",{class:"btn btn-primary",disabled:!n.value||u.value,onClick:v},(0,h.v_)(u.value?"è¯·ç­‰å¾…...":"æäº¤æ›´æ–°"),9,at)],64)):((0,o.uX)(),(0,o.CE)("button",{key:1,class:"btn btn-primary",onClick:v,disabled:u.value},"è¿›å…¥å£°éŸ³åˆæˆ",8,ot))])],64)):((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("main",qe,[(0,o.Lk)("div",{class:"upload-area",onClick:t[0]||(t[0]=t=>e.$refs.fileInput&&e.$refs.fileInput.click())},[t[6]||(t[6]=(0,o.Lk)("i",{class:"fa-solid fa-cloud-arrow-up",style:{"font-style":"normal",color:"#4F46E5"}},"â˜",-1)),t[7]||(t[7]=(0,o.Lk)("p",null,"æ‹–æ‹½æˆ–ç‚¹å‡»ä¸Šä¼ éŸ³é¢‘",-1)),t[8]||(t[8]=(0,o.Lk)("span",null,"æ”¯æŒ mp3/wav æ ¼å¼ï¼Œå¤§å° â‰¤ 15MB",-1)),(0,o.Lk)("input",{ref:"fileInput",type:"file",accept:"audio/*",onChange:p,style:{display:"none"}},null,544)]),r.value?((0,o.uX)(),(0,o.CE)("div",ze,[(0,o.Lk)("span",null,"ðŸ“„ "+(0,h.v_)(r.value),1),(0,o.Lk)("button",{class:"icon-button",onClick:t[1]||(t[1]=()=>{n.value=null,r.value=""})},"âœ•")])):(0,o.Q3)("",!0),l.value?((0,o.uX)(),(0,o.CE)("div",je,(0,h.v_)(l.value),1)):(0,o.Q3)("",!0)]),(0,o.Lk)("footer",Ke,[(0,o.Lk)("button",{class:"btn btn-secondary",onClick:g},"å…³é—­"),(0,o.Lk)("button",{class:"btn btn-primary",disabled:!n.value||u.value,onClick:v},(0,h.v_)(u.value?"è¯·ç­‰å¾…...":"ä¸‹ä¸€æ­¥"),9,We)]),m.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("button",{key:0,class:"try-voice-btn",onClick:f,disabled:u.value,title:"ä½¿ç”¨ç¤ºä¾‹å£°éŸ³è¿›è¡Œå¤åˆ»"}," ðŸŽµ è¯•ç”¨å£°éŸ³ ",8,Qe))],64)),u.value?((0,o.uX)(),(0,o.CE)("div",it,t[14]||(t[14]=[(0,o.Lk)("div",{class:"spinner"},null,-1),(0,o.Lk)("p",null,"è¯·ç­‰å¾…ç‰‡åˆ»ï¼Œæ­£åœ¨å¤„ç†...",-1)]))):(0,o.Q3)("",!0),c.value?((0,o.uX)(),(0,o.CE)("p",nt,(0,h.v_)(c.value),1)):(0,o.Q3)("",!0)])]))}};const ct=(0,l.A)(lt,[["__scopeId","data-v-212a53c7"]]);var dt=ct;const ut={class:"modal-container vm-content",style:{"max-width":"560px"}},ht={class:"modal-header"},mt={class:"header-actions"},gt=["disabled"],pt={class:"modal-body list-body"},kt={key:0,class:"error-state"},vt=["disabled"],ft={key:1,class:"empty-state"},yt={key:2,class:"vm-list"},bt={class:"card-header"},wt={class:"card-content"},Ct={class:"audio-row"},Lt={class:"audio-player"},Tt=["src"],St={key:1,class:"no-audio"},It={class:"audio-row"},Et={class:"audio-player"},Mt=["src"],At={key:1,class:"no-audio"},Dt={class:"card-footer"},$t=["onClick"];var Pt={__name:"VoiceManagerModal",props:{userId:{type:String,required:!0}},emits:["close"],setup(e,{emit:t}){const s=t,i=e,n=(0,Le.KR)(!1),r=(0,Le.KR)(""),l=(0,Le.KR)([]),c=(0,Le.KR)(0),d=(0,Le.KR)({encourage:0,criticize:0});function u(){s("close")}function m(e){return e&&e.startsWith("http://")?"https://"+e.slice(7):e}function g(e){if(!e)return e;const t=e.includes("?")?"&":"?";return`${e}${t}v=${c.value}`}function p(e){d.value[e]||(d.value[e]=0),d.value[e]>=3||(d.value[e]+=1,c.value=Date.now())}function k(e){try{return new Date(e).toLocaleString()}catch(t){return String(e||"")}}async function v(){n.value=!0,r.value="";try{const e=await Ne.getBindStatus(i.userId);l.value=!1===e?.binded?[]:Array.isArray(e?.voice_groups)?e.voice_groups:[],c.value=Date.now()}catch(e){r.value=e?.message||"åŠ è½½å¤±è´¥"}finally{n.value=!1}}async function f(e){if(n.value)return;const t=window.confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸€ç»„è¯­éŸ³å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚");if(t){n.value=!0,r.value="";try{await Ne.deleteVoiceGroupByIndex(i.userId,e),await v()}catch(s){r.value=s?.message||"åˆ é™¤å¤±è´¥"}finally{n.value=!1}}}return(0,o.sV)(v),(e,t)=>((0,o.uX)(),(0,o.CE)("div",{class:"modal-overlay vm-overlay",onClick:(0,a.D$)(u,["self"])},[(0,o.Lk)("div",ut,[(0,o.Lk)("header",ht,[t[2]||(t[2]=(0,o.Lk)("h2",{class:"modal-title"},"æˆ‘çš„è¯­éŸ³",-1)),(0,o.Lk)("div",mt,[(0,o.Lk)("button",{class:"icon-button",title:"åˆ·æ–°",onClick:v,disabled:n.value},"âŸ³",8,gt),(0,o.Lk)("button",{class:"icon-button",title:"å…³é—­",onClick:u},"âœ•")])]),(0,o.Lk)("main",pt,[r.value?((0,o.uX)(),(0,o.CE)("div",kt,[t[3]||(t[3]=(0,o.Lk)("i",{class:"fa-regular fa-circle-xmark",style:{"font-style":"normal","font-size":"32px",color:"#ef4444"}},"!",-1)),(0,o.Lk)("p",null,(0,h.v_)(r.value),1),(0,o.Lk)("button",{class:"btn btn-secondary",onClick:v,disabled:n.value},"é‡è¯•",8,vt)])):l.value.length||n.value?((0,o.uX)(),(0,o.CE)("div",yt,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.value,(e,s)=>((0,o.uX)(),(0,o.CE)("div",{key:s,class:"list-card"},[(0,o.Lk)("div",bt,[(0,o.Lk)("h3",null,"ç¬¬ "+(0,h.v_)(l.value.length-s)+" ç»„",1),(0,o.Lk)("span",null,"åˆ›å»ºäºŽ: "+(0,h.v_)(k(e.createdAt)),1)]),(0,o.Lk)("div",wt,[(0,o.Lk)("div",Ct,[t[5]||(t[5]=(0,o.Lk)("span",null,"é¼“åŠ±",-1)),(0,o.Lk)("div",Lt,[e.encourage_url?((0,o.uX)(),(0,o.CE)("audio",{key:0,src:g(m(e.encourage_url)),controls:"",onError:t[0]||(t[0]=e=>p("encourage"))},null,40,Tt)):((0,o.uX)(),(0,o.CE)("span",St,"æ— éŸ³é¢‘"))])]),(0,o.Lk)("div",It,[t[6]||(t[6]=(0,o.Lk)("span",null,"æ‰¹è¯„",-1)),(0,o.Lk)("div",Et,[e.criticize_url?((0,o.uX)(),(0,o.CE)("audio",{key:0,src:g(m(e.criticize_url)),controls:"",onError:t[1]||(t[1]=e=>p("criticize"))},null,40,Mt)):((0,o.uX)(),(0,o.CE)("span",At,"æ— éŸ³é¢‘"))])])]),(0,o.Lk)("div",Dt,[(0,o.Lk)("button",{class:"btn-delete",onClick:e=>f(s)},"åˆ é™¤è¿™ä¸€ç»„",8,$t)])]))),128))])):((0,o.uX)(),(0,o.CE)("div",ft,t[4]||(t[4]=[(0,o.Lk)("i",{class:"fa-regular fa-folder-open",style:{"font-style":"normal","font-size":"48px",color:"#E5E7EB"}},"ðŸ“",-1),(0,o.Lk)("p",null,"æš‚æ— åŽ†å²è¯­éŸ³",-1),(0,o.Lk)("span",null,"åŽ»åˆ›å»ºä¸€ä¸ªæ–°çš„è¯­éŸ³é™ªä¼´å§",-1)])))])])]))}};const Ft=(0,l.A)(Pt,[["__scopeId","data-v-3b2eea2b"]]);var _t=Ft;const Rt={class:"modal-container ai-voice-modal-content",style:{"max-width":"420px","border-radius":"36px",overflow:"hidden"}},xt={class:"modal-header"},Xt={class:"modal-title"},Ut={width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",style:{"vertical-align":"middle"}},Vt={class:"modal-body"},Bt={class:"segmented-control"},Nt={key:0,class:"form-section"},Ot={class:"form-group"},qt={class:"form-group"},zt={class:"chip-group"},jt=["onClick"],Kt={class:"form-group"},Wt={class:"chip-group"},Qt=["onClick"],Gt={class:"form-group"},Ht={class:"form-group"},Jt={key:1,class:"form-section"},Yt={class:"form-group"},Zt={class:"form-group"},es={key:2,class:"result-section"},ts={key:0,class:"audio-card"},ss={class:"audio-player"},as=["src"],os={key:1,class:"audio-card"},is={class:"audio-player"},ns=["src"],rs={key:3,class:"form-error"},ls={class:"modal-footer"},cs=["disabled"],ds=["disabled"],us={key:0,class:"loading-overlay"};var hs={__name:"AIVoiceModal",props:{userId:{type:String,default:""}},emits:["close","apply-voice"],setup(e,{emit:t}){const s=t,i=e;i.userId;const n=(0,Le.KR)("ai"),r=(0,Le.KR)(""),l=["æ¸©æŸ”","çƒ­æƒ…","ä¸“ä¸š","è°ƒä¾ƒ"],c=["å§”å©‰","ä¸¥åŽ‰","ä¸“ä¸š","è°ƒä¾ƒ"],d=(0,Le.KR)(l[0]),u=(0,Le.KR)(c[0]),m=(0,Le.KR)(""),g=(0,Le.KR)(""),p=(0,Le.KR)(!1),k=(0,Le.KR)(""),v=(0,Le.KR)({encourage:"",criticize:""}),f=(0,Le.KR)(!1),y=(0,Le.KR)(0),b=(0,Le.KR)({encourage:0,criticize:0}),w=(0,Le.KR)(!1);function C(){p.value||s("close")}function L(){w.value=!0}function T(){if(i.userId)return i.userId;try{const e=JSON.parse(localStorage.getItem("user")||"null");return e?._id||e?.id||localStorage.getItem("userId")||""}catch(e){return localStorage.getItem("userId")||""}}function S(e){return e&&e.startsWith("http://")?"https://"+e.slice(7):e}function I(e){if(!e)return e;const t=e.includes("?")?"&":"?";return`${e}${t}v=${y.value}`}function E(e){b.value[e]||(b.value[e]=0),b.value[e]>=3||(b.value[e]+=1,y.value=Date.now())}async function M(){if("custom"===n.value&&(!m.value||!g.value))return void(k.value="è¯·å¡«å†™å®Œæ•´æ–‡æœ¬");if("ai"===n.value&&!f.value){p.value=!0,k.value="";try{const e=await Ne.imitateText(r.value||"é»˜è®¤",d.value,u.value);if(m.value=e?.data?.encourage||e?.encourage||"",g.value=e?.data?.criticize||e?.criticize||"",!m.value||!g.value)throw new Error("AIæ–‡æœ¬ç”Ÿæˆå¤±è´¥");f.value=!0,p.value=!1}catch(t){p.value=!1,k.value=t?.message||"AIæ–‡æœ¬ç”Ÿæˆå¤±è´¥"}return}if(!m.value||!g.value)return void(k.value="è¯·å¡«å†™å®Œæ•´æ–‡æœ¬");const e=T();if(e){p.value=!0,k.value="",v.value={encourage:"",criticize:""},b.value={encourage:0,criticize:0};try{const t=await Ne.synthesizeVoice(e,m.value,g.value),s=S(t?.data?.encourage_url||t?.encourage_url||""),a=S(t?.data?.criticize_url||t?.criticize_url||"");if(v.value.encourage=s,v.value.criticize=a,y.value=Date.now(),f.value=!1,p.value=!1,!v.value.encourage&&!v.value.criticize)throw new Error("æœªè¿”å›žéŸ³é¢‘é“¾æŽ¥")}catch(t){p.value=!1,k.value=t?.message||"åˆæˆå¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•"}}else k.value="æœªç™»å½•æˆ–ç¼ºå°‘ç”¨æˆ·æ ‡è¯†ï¼Œè¯·å…ˆç™»å½•"}function A(){s("apply-voice"),C()}return(0,o.wB)(()=>n.value,()=>{f.value=!1,k.value="",m.value="",g.value="",v.value={encourage:"",criticize:""}}),(e,t)=>((0,o.uX)(),(0,o.CE)("div",{class:"modal-overlay ai-voice-modal-overlay",onClick:(0,a.D$)(C,["self"])},[(0,o.Lk)("div",Rt,[(0,o.Lk)("header",xt,[(0,o.Lk)("a",{href:"#",class:"header-link",onClick:(0,a.D$)(L,["prevent"])},"ç®¡ç†å·²æœ‰è¯­éŸ³"),(0,o.Lk)("h2",Xt,[((0,o.uX)(),(0,o.CE)("svg",Ut,t[10]||(t[10]=[(0,o.Lk)("path",{d:"M12 3a3 3 0 0 1 3 3v5a3 3 0 1 1-6 0V6a3 3 0 0 1 3-3z",fill:"#4F46E5"},null,-1),(0,o.Lk)("path",{d:"M5 11a1 1 0 0 1 2 0v1a5 5 0 1 0 10 0v-1a1 1 0 1 1 2 0v1a7 7 0 0 1-6 6.93V21a1 1 0 1 1-2 0v-2.07A7 7 0 0 1 5 12v-1z",fill:"#818CF8"},null,-1)]))),t[11]||(t[11]=(0,o.eW)(" AIè¯­éŸ³é™ªä¼´è®¾ç½® ",-1))]),(0,o.Lk)("button",{class:"icon-button",onClick:C,title:"å…³é—­"},"âœ•")]),(0,o.Lk)("main",Vt,[(0,o.Lk)("div",Bt,[(0,o.Lk)("button",{class:(0,h.C4)({active:"ai"===n.value}),onClick:t[0]||(t[0]=e=>n.value="ai")},"AIç”Ÿæˆæ–‡æœ¬",2),(0,o.Lk)("button",{class:(0,h.C4)({active:"custom"===n.value}),onClick:t[1]||(t[1]=e=>n.value="custom")},"è‡ªå®šä¹‰æ–‡æœ¬",2)]),"ai"===n.value?((0,o.uX)(),(0,o.CE)("div",Nt,[f.value?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.Lk)("div",Gt,[t[15]||(t[15]=(0,o.Lk)("label",null,"é¼“åŠ±æ–‡æœ¬",-1)),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>m.value=e),rows:"3",placeholder:"AIç”Ÿæˆçš„é¼“åŠ±è¯­éŸ³å†…å®¹"},null,512),[[a.Jo,m.value]]),t[16]||(t[16]=(0,o.Lk)("span",{class:"ai-tag"},"AIæ™ºèƒ½ç”Ÿæˆï¼Œå¯ä¿®æ”¹",-1))]),(0,o.Lk)("div",Ht,[t[17]||(t[17]=(0,o.Lk)("label",null,"æ‰¹è¯„æ–‡æœ¬",-1)),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[4]||(t[4]=e=>g.value=e),rows:"3",placeholder:"AIç”Ÿæˆçš„æ‰¹è¯„è¯­éŸ³å†…å®¹"},null,512),[[a.Jo,g.value]]),t[18]||(t[18]=(0,o.Lk)("span",{class:"ai-tag"},"AIæ™ºèƒ½ç”Ÿæˆï¼Œå¯ä¿®æ”¹",-1))])],64)):((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("div",Ot,[t[12]||(t[12]=(0,o.Lk)("label",null,"æ¨¡ä»¿å¯¹è±¡",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>r.value=e),type:"text",placeholder:"ä¾‹å¦‚ï¼šä¸€ä½ä¸¥åŽ‰çš„å¥èº«æ•™ç»ƒ"},null,512),[[a.Jo,r.value]])]),(0,o.Lk)("div",qt,[t[13]||(t[13]=(0,o.Lk)("label",null,"é¼“åŠ±é£Žæ ¼",-1)),(0,o.Lk)("div",zt,[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(l,e=>(0,o.Lk)("button",{key:e,class:(0,h.C4)(["chip",{active:d.value===e}]),onClick:t=>d.value=e},(0,h.v_)(e),11,jt)),64))])]),(0,o.Lk)("div",Kt,[t[14]||(t[14]=(0,o.Lk)("label",null,"æ‰¹è¯„é£Žæ ¼",-1)),(0,o.Lk)("div",Wt,[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(c,e=>(0,o.Lk)("button",{key:e,class:(0,h.C4)(["chip",{active:u.value===e}]),onClick:t=>u.value=e},(0,h.v_)(e),11,Qt)),64))])])],64))])):((0,o.uX)(),(0,o.CE)("div",Jt,[(0,o.Lk)("div",Yt,[t[19]||(t[19]=(0,o.Lk)("label",null,"é¼“åŠ±æ–‡æœ¬",-1)),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[5]||(t[5]=e=>m.value=e),rows:"3",placeholder:"è¯·è¾“å…¥é¼“åŠ±è¯­éŸ³å†…å®¹"},null,512),[[a.Jo,m.value]])]),(0,o.Lk)("div",Zt,[t[20]||(t[20]=(0,o.Lk)("label",null,"æ‰¹è¯„æ–‡æœ¬",-1)),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>g.value=e),rows:"3",placeholder:"è¯·è¾“å…¥æ‰¹è¯„è¯­éŸ³å†…å®¹"},null,512),[[a.Jo,g.value]])])])),v.value.encourage||v.value.criticize?((0,o.uX)(),(0,o.CE)("div",es,[v.value.encourage?((0,o.uX)(),(0,o.CE)("div",ts,[t[21]||(t[21]=(0,o.Lk)("span",{class:"audio-label"},"é¼“åŠ±éŸ³é¢‘",-1)),(0,o.Lk)("div",ss,[(0,o.Lk)("audio",{src:I(v.value.encourage),controls:"",onError:t[7]||(t[7]=e=>E("encourage"))},null,40,as)])])):(0,o.Q3)("",!0),v.value.criticize?((0,o.uX)(),(0,o.CE)("div",os,[t[22]||(t[22]=(0,o.Lk)("span",{class:"audio-label"},"æ‰¹è¯„éŸ³é¢‘",-1)),(0,o.Lk)("div",is,[(0,o.Lk)("audio",{src:I(v.value.criticize),controls:"",onError:t[8]||(t[8]=e=>E("criticize"))},null,40,ns)])])):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0),k.value?((0,o.uX)(),(0,o.CE)("p",rs,(0,h.v_)(k.value),1)):(0,o.Q3)("",!0)]),(0,o.Lk)("footer",ls,[(0,o.Lk)("button",{class:"btn btn-secondary",onClick:C},"å…³é—­"),v.value.encourage||v.value.criticize?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"btn btn-primary",onClick:A,disabled:p.value},"åº”ç”¨è¯­éŸ³",8,cs)):((0,o.uX)(),(0,o.CE)("button",{key:1,class:"btn btn-primary",onClick:M,disabled:p.value||"custom"===n.value&&(!m.value||!g.value)||"ai"===n.value&&p.value},(0,h.v_)("ai"===n.value?f.value?p.value?"åˆæˆä¸­...":"åˆæˆè¯­éŸ³":p.value?"ç”Ÿæˆä¸­...":"ç”Ÿæˆæ–‡æœ¬":p.value?"åˆæˆä¸­...":"åˆæˆè¯­éŸ³"),9,ds))]),p.value?((0,o.uX)(),(0,o.CE)("div",us,t[23]||(t[23]=[(0,o.Lk)("div",{class:"spinner"},null,-1),(0,o.Lk)("p",null,"è¯·ç­‰å¾…ç‰‡åˆ»ï¼Œæ­£åœ¨å¤„ç†...",-1)]))):(0,o.Q3)("",!0),w.value?((0,o.uX)(),(0,o.Wv)(_t,{key:1,userId:T(),onClose:t[9]||(t[9]=e=>w.value=!1)},null,8,["userId"])):(0,o.Q3)("",!0)])]))}};const ms=(0,l.A)(hs,[["__scopeId","data-v-c4edabf2"]]);var gs=ms;const ps={getAllTasks(e={}){return De.get("/tasks",{params:e})},getUnscheduledTasks(){return De.get("/tasks/unscheduled")},getTasksByTimeBlock(e){return De.get(`/tasks/timeblock/${e}`)},createTask(e){return De.post("/tasks",e)},getTaskById(e){return De.get(`/tasks/${e}`)},updateTask(e,t){return De.put(`/tasks/${e}`,t)},deleteTask(e){return De.delete(`/tasks/${e}`)},toggleTaskStatus(e){return De.patch(`/tasks/${e}/toggle`)}};var ks=ps;const vs=Se.baseURL,fs=Me.A.create({baseURL:vs,timeout:1e4,headers:{"Content-Type":"application/json"}}),ys={getCollections(e={}){return fs.get("/collections",{params:e})},getCollection(e){return fs.get(`/collections/${e}`)},createCollection(e){return fs.post("/collections",e)},updateCollection(e,t){return fs.put(`/collections/${e}`,t)},deleteCollection(e,t=!1){return fs.delete(`/collections/${e}`,{params:{force:t}})},archiveCollection(e,t=!0){return fs.put(`/collections/${e}/archive`,{archived:t})},getStats(e={}){return fs.get("/collections/stats",{params:e})},getOtherCollection(e={}){return fs.get("/collections/other",{params:e})}};fs.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers=e.headers||{},e.headers["Authorization"]=`Bearer ${t}`),console.log(`ðŸ”µ APIè¯·æ±‚: ${e.method?.toUpperCase()} ${e.url}`,e.data||e.params),e},e=>(console.error("âŒ APIè¯·æ±‚é”™è¯¯:",e),Promise.reject(e))),fs.interceptors.response.use(e=>(console.log(`ðŸŸ¢ APIå“åº”: ${e.config.method?.toUpperCase()} ${e.config.url}`,e.data),e),e=>{console.error("âŒ APIå“åº”é”™è¯¯:",e.response?.data||e.message);const t=e.response?.data?.message||e.message||"ç½‘ç»œé”™è¯¯";return 401===e.response?.status&&"undefined"!==typeof window&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/auth/login"),"undefined"!==typeof window&&window.app&&window.app.$toast&&window.app.$toast.error(t),Promise.reject(e)});var bs=ys;const ws={getAllPomodoros(e={}){return De.get("/pomodoro",{params:e})},createPomodoro(e){return De.post("/pomodoro",e)},getPomodoroById(e){return De.get(`/pomodoro/${e}`)},updatePomodoro(e,t){return De.put(`/pomodoro/${e}`,t)},deletePomodoro(e){return De.delete(`/pomodoro/${e}`)},getPomodoroStats(e={}){return De.get("/pomodoro/stats",{params:e})},getTodayPomodoros(e="default"){const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1);return this.getAllPomodoros({userId:e,startDate:s.toISOString(),endDate:a.toISOString()})},getTaskPomodoros(e,t="default"){return this.getAllPomodoros({userId:t,taskName:e})},getTaskStats(e,t="default"){return this.getPomodoroStats({userId:t,taskName:e})}};var Cs=ws;const Ls={tasks:ks,collections:bs,pomodoros:Cs,aivoice:Ne};var Ts=Ls;function Ss(){try{const e=JSON.parse(localStorage.getItem("user")||"null");return e?._id||e?.id||localStorage.getItem("userId")||""}catch(e){return localStorage.getItem("userId")||""}}function Is(e){return e&&e.startsWith("http://")?"https://"+e.slice(7):e}function Es(e){return e[Math.floor(Math.random()*e.length)]}function Ms(e){const t=e.includes("?")?"&":"?";return`${e}${t}t=${Date.now()}`}async function As(e){const t=Ss();if(!t)return[];try{const s=await Ne.getBindStatus(t);if(!1===s?.binded)return[];const a=[];"encourage"===e?s?.encourage_url&&a.push(Is(s.encourage_url)):s?.criticize_url&&a.push(Is(s.criticize_url));const o=Array.isArray(s?.voice_groups)?s.voice_groups:[];for(const t of o){const s="encourage"===e?t?.encourage_url:t?.criticize_url;s&&a.push(Is(s))}return a.filter(Boolean)}catch(s){return[]}}function Ds(e,t=3){return new Promise(s=>{let a=0;const o=()=>{a+=1;const i=new Audio(Ms(e));i.preload="auto";const n=()=>{i.oncanplaythrough=null,i.onerror=null};i.oncanplaythrough=async()=>{n();try{await i.play()}catch(e){}s()},i.onerror=()=>{n(),a<t?setTimeout(o,600*a):s()},i.load()};o()})}async function $s(e){try{const t=await As(e);if(!t.length)return;const s=Es(t);await Ds(s,3)}catch(t){}}var Ps={name:"TaskPage",components:{TaskTimeBlocks:K,TaskQuadrant:ae,AddTaskModal:ve,TabBar:Ce,VoiceCloneModal:dt,AIVoiceModal:gs},data(){return{currentView:"time",currentTimeSegment:"morning",sidebarOpen:!1,showAddModal:!1,timeBlocks:[],unscheduledTasks:[],timeSegments:[{value:"morning",label:"æ—©ä¸Š"},{value:"afternoon",label:"ä¸‹åˆ"},{value:"evening",label:"æ™šä¸Š"}],quadrants:[{id:1,title:"é‡è¦ä¸”ç´§æ€¥",tasks:[]},{id:2,title:"é‡è¦ä¸ç´§æ€¥",tasks:[]},{id:3,title:"ç´§æ€¥ä¸é‡è¦",tasks:[]},{id:4,title:"ä¸é‡è¦ä¸ç´§æ€¥",tasks:[]}],settings:[{id:1,label:"é€šçŸ¥è®¾ç½®",description:"ç®¡ç†ä»»åŠ¡æé†’å’ŒæŽ¨é€"},{id:2,label:"å­¦ä¹ è®¡åˆ’",description:"è°ƒæ•´AIç”Ÿæˆçš„å­¦ä¹ è®¡åˆ’"},{id:3,label:"ä¸»é¢˜è®¾ç½®",description:"åˆ‡æ¢æ·±è‰²/æµ…è‰²æ¨¡å¼"},{id:4,label:"æ•°æ®åŒæ­¥",description:"äº‘ç«¯å¤‡ä»½å’Œæ¢å¤"},{id:5,label:"AIè¯­éŸ³",description:"å®šåˆ¶ä½ çš„aiè¯­éŸ³åŠ©æ‰‹"},{id:6,label:"é€€å‡ºç™»å½•",description:"é€€å‡ºåˆ°ç™»å½•ç•Œé¢"}],showVoiceCloneModal:!1,hasClonedVoice:!1,showAIVoiceModal:!1}},computed:{filteredTimeBlocks(){return this.timeBlocks.filter(e=>{const t={morning:["morning"],afternoon:["afternoon"],evening:["evening"]};return t[this.currentTimeSegment]?.includes(e.timeBlockType)})},currentUserId(){const e=JSON.parse(localStorage.getItem("user")||"null");return e?._id||e?.id||null}},created(){this.fetchTasks()},activated(){this.fetchTasks(),this.autoSwitchTimeSegment()},methods:{handleSettingClick(e){if(!e||5!==e.id&&"AIè¯­éŸ³"!==e.label){if(e&&(6===e.id||"é€€å‡ºç™»å½•"===e.label))try{console.log("ðŸ”’ [TaskPage] æ‰§è¡Œé€€å‡ºç™»å½•"),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("auth_verified")}finally{this.sidebarOpen=!1,this.$router.replace({path:"/auth/login"})}}else this.showVoiceCloneModal=!0},onCloneSuccess(){this.hasClonedVoice=!0,this.showVoiceCloneModal=!1,this.showAIVoiceModal=!0},onApplyVoice(){this.showAIVoiceModal=!1},async fetchTasks(){try{console.log("ðŸ”„ [TaskPage] å¼€å§‹èŽ·å–ä»»åŠ¡åˆ—è¡¨...");const e=this.currentUserId;if(!e)return console.warn("âš ï¸ [TaskPage] æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ"),void this.$router.replace({path:"/auth/login",query:{redirect:this.$route.fullPath}});console.log("ðŸ“‹ [TaskPage] èŽ·å–æ‰€æœ‰ä»»åŠ¡...");const t=await Ts.tasks.getAllTasks({userId:e});console.log("ðŸ“‹ [TaskPage] ä»»åŠ¡å“åº”:",t),t.success&&t.data?(console.log("âœ… [TaskPage] æˆåŠŸèŽ·å–ä»»åŠ¡:",t.data.length),this.processTasks(t.data)):(console.warn("âš ï¸ [TaskPage] ä»»åŠ¡å“åº”æ ¼å¼å¼‚å¸¸ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®"),this.initializeMockData())}catch(e){console.error("âŒ [TaskPage] èŽ·å–ä»»åŠ¡å¤±è´¥:",e),this.initializeMockData()}},async refreshTasks(){await this.fetchTasks()},processTasks(e){console.log("ðŸ“Š [TaskPage] å¼€å§‹å¤„ç†ä»»åŠ¡æ•°æ®:",e.length),this.timeBlocks=[{id:1,label:"æ—©æ™¨ 0:00 - 8:00",timeBlockType:"morning",tasks:[],collapsed:!1},{id:2,label:"ä¸Šåˆ 8:00 - 16:00",timeBlockType:"afternoon",tasks:[],collapsed:!1},{id:3,label:"æ™šä¸Š 16:00 - 24:00",timeBlockType:"evening",tasks:[],collapsed:!1}],this.quadrants.forEach(e=>e.tasks=[]),this.unscheduledTasks=[],e.forEach(e=>{console.log("ðŸ” [TaskPage] å¤„ç†ä»»åŠ¡:",e.title,e);const t=this.quadrants.find(t=>t.id==e.quadrant);t&&t.tasks.push({id:e._id,title:e.title,completed:e.completed});let s="æœªæŒ‡å®š",a="unscheduled";if(e.timeBlock&&e.timeBlock.startTime){const t=parseInt(e.timeBlock.startTime.split(":")[0]);s=`${e.timeBlock.startTime} - ${e.timeBlock.endTime||this.addHour(e.timeBlock.startTime)}`,t>=0&&t<8?a="morning":t>=8&&t<16?a="afternoon":t>=16&&t<24&&(a="evening"),console.log(`ðŸŽ¯ [TaskPage] AIç”Ÿæˆä»»åŠ¡"${e.title}"æ ¹æ®startTimeè®¡ç®—æ—¶é—´å—ç±»åž‹: ${a}`)}else if(e.time&&e.time.trim()){const t=parseInt(e.time.split(":")[0]);s=`${e.time} - ${this.addHour(e.time)}`,t>=0&&t<8?a="morning":t>=8&&t<16?a="afternoon":t>=16&&t<24&&(a="evening"),console.log(`â° [TaskPage] ç”¨æˆ·ç”Ÿæˆä»»åŠ¡"${e.title}"æ ¹æ®timeè®¡ç®—æ—¶é—´å—ç±»åž‹: ${a}`)}const o={id:e._id,title:e.title,time:s,priority:e.priority||"medium",completed:e.completed};if("unscheduled"!==a){const t=this.timeBlocks.find(e=>e.timeBlockType===a);t?(t.tasks.push(o),console.log(`ðŸ“ [TaskPage] ä»»åŠ¡"${e.title}"åˆ†é…åˆ°${t.label}`)):this.unscheduledTasks.push(o)}else this.unscheduledTasks.push(o),console.log(`ðŸ“ [TaskPage] ä»»åŠ¡"${e.title}"åˆ†é…åˆ°æœªæŒ‡å®šä»»åŠ¡`)}),console.log("ðŸ“Š [TaskPage] æ—¶é—´å—ä»»åŠ¡åˆ†é…è¯¦æƒ…:"),this.timeBlocks.forEach(e=>{console.log(`  ${e.label} (${e.timeBlockType}): ${e.tasks.length}ä¸ªä»»åŠ¡`),e.tasks.forEach(e=>{console.log(`    - ${e.title} (${e.time})`)}),0===e.tasks.length?e.collapsed=!0:e.collapsed=!1}),console.log(`ðŸ“‹ [TaskPage] æœªæŒ‡å®šæ—¶é—´ä»»åŠ¡: ${this.unscheduledTasks.length}ä¸ª`),this.unscheduledTasks.forEach(e=>{console.log(`  - ${e.title}`)})},initializeMockData(){console.log("âš ï¸ [TaskPage] APIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®"),this.timeBlocks=[{id:1,label:"æ—©æ™¨ 0:00 - 8:00",timeBlockType:"morning",tasks:[{id:1,title:"è‹±è¯­æ™¨è¯»è®¡åˆ’",time:"7:30 - 8:30",priority:"high",completed:!1}],collapsed:!1},{id:2,label:"ä¸Šåˆ 8:00 - 16:00",timeBlockType:"afternoon",tasks:[{id:2,title:"è€ƒç ”æ•°å­¦å¤ä¹ ",time:"9:00 - 11:00",priority:"high",completed:!0},{id:3,title:"æ”¿æ²»çŸ¥è¯†ç‚¹èƒŒè¯µ",time:"11:00 - 12:00",priority:"medium",completed:!1},{id:4,title:"ä¸“ä¸šè¯¾ç¬”è®°æ•´ç†",time:"14:00 - 16:00",priority:"medium",completed:!1}],collapsed:!1},{id:3,label:"æ™šä¸Š 16:00 - 24:00",timeBlockType:"evening",tasks:[],collapsed:!0}],this.unscheduledTasks=[{id:5,title:"å¤ä¹ è‹±è¯­å•è¯",priority:"low",completed:!1},{id:6,title:"æ•´ç†å­¦ä¹ èµ„æ–™",priority:"medium",completed:!1}],this.quadrants=[{id:1,title:"é‡è¦ä¸”ç´§æ€¥",tasks:[{id:2,title:"è€ƒç ”æ•°å­¦å¤ä¹ ",completed:!0}]},{id:2,title:"é‡è¦ä¸ç´§æ€¥",tasks:[{id:1,title:"è‹±è¯­æ™¨è¯»è®¡åˆ’",completed:!1},{id:4,title:"ä¸“ä¸šè¯¾ç¬”è®°æ•´ç†",completed:!1}]},{id:3,title:"ç´§æ€¥ä¸é‡è¦",tasks:[{id:3,title:"æ”¿æ²»çŸ¥è¯†ç‚¹èƒŒè¯µ",completed:!1}]},{id:4,title:"ä¸é‡è¦ä¸ç´§æ€¥",tasks:[]}]},toggleTimeBlockCollapse(e){const t=this.timeBlocks.find(t=>t.id===e);t&&(t.collapsed=!t.collapsed)},moveToTimeBlock(e,t){const s=this.unscheduledTasks.findIndex(t=>t.id===e.id);if(s>-1){this.unscheduledTasks.splice(s,1);const a=this.timeBlocks.find(e=>e.id===t);a&&a.tasks.push(e)}},switchView(e){this.currentView=e},toggleSidebar(){this.sidebarOpen=!this.sidebarOpen},openAddTask(){this.showAddModal=!0},closeAddTask(){this.showAddModal=!1},async handleAddTask(e){try{console.log("ðŸ”„ [TaskPage] å¼€å§‹åˆ›å»ºä»»åŠ¡:",e);const t=this.currentUserId;if(!t)return console.warn("âš ï¸ [TaskPage] æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ"),void this.$router.replace({path:"/auth/login",query:{redirect:this.$route.fullPath}});const s=await Ts.tasks.createTask({title:e.title,description:e.description||"",priority:e.priority||"medium",completed:!1,quadrant:e.quadrant,date:e.date,time:e.time,userId:t,timeBlockType:e.timeBlockType,isScheduled:e.isScheduled});console.log("âœ… [TaskPage] ä»»åŠ¡åˆ›å»ºæˆåŠŸ:",s),await this.fetchTasks(),this.closeAddTask()}catch(t){console.error("âŒ [TaskPage] åˆ›å»ºä»»åŠ¡å¤±è´¥:",t);const s={id:Date.now(),title:e.title,time:e.time?`${e.time} - ${this.addHour(e.time)}`:"æœªæŒ‡å®š",priority:e.priority||"medium",completed:!1,date:e.date},a=this.quadrants.find(t=>t.id===e.quadrant);if(a&&a.tasks.push(s),e.time&&e.timeBlockType){const t=this.timeBlocks.find(t=>t.timeBlockType===e.timeBlockType);t&&(t.tasks.push(s),console.log(`âœ… [TaskPage] ä»»åŠ¡æ·»åŠ åˆ°${t.label}:`,s.title))}this.closeAddTask()}},addHour(e){const[t,s]=e.split(":").map(Number),a=(t+1)%24;return`${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},async toggleTask(e){try{const t=await Ts.tasks.toggleTaskStatus(e.id);console.log("Toggled task status:",t);const s=!e.completed;e.completed=s,s&&$s("encourage")}catch(t){console.error("Failed to toggle task status:",t),e.completed=!e.completed}},openPomodoro(e){this.$router.push({path:"/pomodoro",query:{task:e.title,taskId:e.id,from:"/task"}})},switchTimeSegment(e){console.log("ðŸ”„ [TaskPage] åˆ‡æ¢æ—¶é—´æ®µ:",e),this.currentTimeSegment=e},autoSwitchTimeSegment(){const e=new Date,t=e.getHours();let s="morning";t>=0&&t<8?s="morning":t>=8&&t<16?s="afternoon":t>=16&&t<24&&(s="evening"),console.log(`ðŸ• [TaskPage] å½“å‰æ—¶é—´: ${t}:00, è‡ªåŠ¨åˆ‡æ¢åˆ°: ${s}`),this.currentTimeSegment=s},goToAISecretary(){console.log("ðŸ¤– [TaskPage] è·³è½¬åˆ°AIåŠ©æ‰‹é¡µé¢"),this.$router.push("/ai-secretary")}},mounted(){console.log("ðŸ”„ [TaskPage] ç»„ä»¶æŒ‚è½½ï¼Œå¼€å§‹èŽ·å–ä»»åŠ¡..."),this.fetchTasks(),this.autoSwitchTimeSegment(),this._aiPlanHandler=()=>{console.log("ðŸŽ¯ [TaskPage] æ”¶åˆ°AIè®¡åˆ’ç”Ÿæˆäº‹ä»¶ï¼Œåˆ·æ–°ä»»åŠ¡åˆ—è¡¨"),this.refreshTasks()},window.addEventListener("ai-plan-generated",this._aiPlanHandler)},beforeUnmount(){this._aiPlanHandler&&(window.removeEventListener("ai-plan-generated",this._aiPlanHandler),this._aiPlanHandler=null)}};const Fs=(0,l.A)(Ps,[["render",I],["__scopeId","data-v-37063cd0"]]);var _s=Fs;const Rs={class:"calendar-container"},xs={class:"header"},Xs={class:"header-content"},Us={class:"view-toggle"},Vs={class:"week-nav"},Bs={class:"week-range"},Ns={key:0,class:"week-dates"},Os={key:0,class:"content"},qs={class:"day-header"},zs={class:"day-title"},js={class:"day-date"},Ks={class:"task-list"},Ws={key:1,class:"month-view"},Qs={class:"month-grid"},Gs={class:"month-content"},Hs={class:"day-header"},Js={class:"day-title"},Ys={class:"day-date"},Zs={class:"task-list"};function ea(e,t,s,a,i,n){const r=(0,o.g2)("font-awesome-icon"),l=(0,o.g2)("CalendarCell"),c=(0,o.g2)("TaskItem"),d=(0,o.g2)("TabBar");return(0,o.uX)(),(0,o.CE)("div",Rs,[(0,o.Lk)("div",xs,[(0,o.Lk)("div",Xs,[t[5]||(t[5]=(0,o.Lk)("div",{class:"header-title"},"æ—¥åŽ†ä¸­å¿ƒ",-1)),(0,o.Lk)("div",Us,[(0,o.Lk)("button",{class:(0,h.C4)(["toggle-btn",{active:"week"===i.currentView}]),onClick:t[0]||(t[0]=e=>n.switchView("week"))}," å‘¨è§†å›¾ ",2),(0,o.Lk)("button",{class:(0,h.C4)(["toggle-btn",{active:"month"===i.currentView}]),onClick:t[1]||(t[1]=e=>n.switchView("month"))}," æœˆè§†å›¾ ",2)])]),(0,o.Lk)("div",Vs,[(0,o.Lk)("button",{class:"nav-btn",onClick:t[2]||(t[2]=(...e)=>n.previousPeriod&&n.previousPeriod(...e))},[(0,o.bF)(r,{icon:"chevron-left"})]),(0,o.Lk)("div",Bs,(0,h.v_)(n.periodLabel),1),(0,o.Lk)("button",{class:"nav-btn",onClick:t[3]||(t[3]=(...e)=>n.nextPeriod&&n.nextPeriod(...e))},[(0,o.bF)(r,{icon:"chevron-right"})])]),"week"===i.currentView?((0,o.uX)(),(0,o.CE)("div",Ns,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.weekDates,e=>((0,o.uX)(),(0,o.Wv)(l,{key:e.getTime(),date:e,"is-selected":n.isSelectedDate(e),"task-count":n.getTaskCount(e),"show-week-day":!0,onSelect:n.selectDate},null,8,["date","is-selected","task-count","onSelect"]))),128))])):(0,o.Q3)("",!0)]),"week"===i.currentView?((0,o.uX)(),(0,o.CE)("div",Os,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.daySections,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.date,class:"day-section"},[(0,o.Lk)("div",qs,[(0,o.Lk)("div",zs,(0,h.v_)(e.title),1),(0,o.Lk)("div",js,(0,h.v_)(e.dateText),1)]),(0,o.Lk)("div",Ks,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.tasks,e=>((0,o.uX)(),(0,o.Wv)(c,{key:e.id,task:e,onClick:n.openPomodoro,onToggle:n.toggleTask},null,8,["task","onClick","onToggle"]))),128))])]))),128))])):((0,o.uX)(),(0,o.CE)("div",Ws,[(0,o.Lk)("div",Qs,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.monthDates,e=>((0,o.uX)(),(0,o.Wv)(l,{key:e.getTime(),date:e,"is-selected":n.isSelectedDate(e),"is-other-month":!n.isCurrentMonth(e),"task-count":n.getTaskCount(e),onSelect:n.selectDate},null,8,["date","is-selected","is-other-month","task-count","onSelect"]))),128))]),(0,o.Lk)("div",Gs,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.daySections,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.date,class:"day-section"},[(0,o.Lk)("div",Hs,[(0,o.Lk)("div",Js,(0,h.v_)(e.title),1),(0,o.Lk)("div",Ys,(0,h.v_)(e.dateText),1)]),(0,o.Lk)("div",Zs,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.tasks,e=>((0,o.uX)(),(0,o.Wv)(c,{key:e.id,task:e,onClick:n.openPomodoro,onToggle:n.toggleTask},null,8,["task","onClick","onToggle"]))),128))])]))),128))])])),(0,o.Lk)("button",{class:"add-task-btn",onClick:t[4]||(t[4]=(...e)=>n.openAddTask&&n.openAddTask(...e))},[(0,o.bF)(r,{icon:"plus"})]),(0,o.bF)(d)])}s(7642),s(8004),s(3853),s(5876),s(2475),s(5024),s(1698);const ta={key:0,class:"week-day-name"},sa={class:"date-number"},aa={key:1,class:"task-indicator multiple"},oa={key:2,class:"task-indicator"};function ia(e,t,s,a,i,n){return(0,o.uX)(),(0,o.CE)("div",{class:(0,h.C4)(["date-cell",{today:n.isToday,selected:s.isSelected,"other-month":s.isOtherMonth}]),onClick:t[0]||(t[0]=t=>e.$emit("select",s.date))},[s.showWeekDay?((0,o.uX)(),(0,o.CE)("div",ta,(0,h.v_)(n.weekDayName),1)):(0,o.Q3)("",!0),(0,o.Lk)("div",sa,(0,h.v_)(s.date.getDate()),1),n.hasMultipleTasks?((0,o.uX)(),(0,o.CE)("div",aa)):n.hasTasks?((0,o.uX)(),(0,o.CE)("div",oa)):(0,o.Q3)("",!0)],2)}var na={name:"CalendarCell",props:{date:{type:Date,required:!0},isSelected:{type:Boolean,default:!1},isOtherMonth:{type:Boolean,default:!1},taskCount:{type:Number,default:0},showWeekDay:{type:Boolean,default:!1}},emits:["select"],computed:{isToday(){const e=new Date;return this.date.toDateString()===e.toDateString()},hasTasks(){return this.taskCount>0},hasMultipleTasks(){return this.taskCount>2},weekDayName(){const e=["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"];return e[this.date.getDay()]}}};const ra=(0,l.A)(na,[["render",ia],["__scopeId","data-v-4c307306"]]);var la=ra,ca={name:"CalendarView",components:{CalendarCell:la,TaskItem:q,TabBar:Ce},data(){return{currentView:"week",selectedDate:new Date,currentDate:new Date,weekDays:["å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­","å‘¨æ—¥"],tasks:[],loading:!1,error:null}},created(){this.fetchTasks()},activated(){this.fetchTasks()},computed:{currentUserId(){const e=JSON.parse(localStorage.getItem("user")||"null");return e?._id||e?.id||null},periodLabel(){if("week"===this.currentView){const e=this.getStartOfWeek(this.currentDate),t=new Date(e.getTime()+5184e5);return`${this.formatDate(e)} - ${this.formatDate(t)}`}return`${this.currentDate.getFullYear()}å¹´${this.currentDate.getMonth()+1}æœˆ`},weekDates(){const e=this.getStartOfWeek(this.currentDate),t=[];for(let s=0;s<7;s++){const a=new Date(e.getTime()+24*s*60*60*1e3);t.push(a)}return t},monthDates(){const e=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),1),t=this.getStartOfWeek(e),s=[];for(let a=0;a<42;a++){const e=new Date(t.getTime()+24*a*60*60*1e3);s.push(e)}return s},daySections(){const e=this.selectedDate;return[{date:e.toDateString(),title:"æ‰€é€‰æ—¥æœŸ",dateText:this.formatDateText(e),tasks:this.getTasksForDate(e)}]}},watch:{currentView(){this.fetchTasks()},currentDate(){this.fetchTasks()},selectedDate(){"week"===this.currentView&&this.fetchTasks()}},methods:{async fetchTasks(){this.loading=!0,this.error=null;try{const e=this.currentUserId;if(!e)return this.error="æœªç™»å½•ï¼Œæ— æ³•èŽ·å–ä»»åŠ¡",void(this.loading=!1);if("week"===this.currentView){const t=this.weekDates;this.tasks=await this.fetchTasksForDates(e,t)}else{const t=this.getMonthDays(this.currentDate);this.tasks=await this.fetchTasksForDates(e,t)}}catch(e){console.error("[Calendar] èŽ·å–ä»»åŠ¡å¤±è´¥",e),this.error="èŽ·å–ä»»åŠ¡å¤±è´¥"}finally{this.loading=!1}},async fetchTasksForDates(e,t){const s=Array.from(new Set(t.map(e=>this.formatYmd(e)))),a=s.map(t=>Ts.tasks.getAllTasks({userId:e,date:t}).then(e=>({res:e,dateStr:t})).catch(()=>({res:null,dateStr:t}))),o=await Promise.all(a),i=[],n=new Set;return o.forEach(({res:e,dateStr:t})=>{let s=[];e&&e.success&&Array.isArray(e.data)?s=e.data:e&&e.data&&Array.isArray(e.data.data)?s=e.data.data:Array.isArray(e)&&(s=e),s.map(e=>this.normalizeTask(e)).forEach(e=>{if(!e)return;e.date||(e.date=this.parseToLocalDate(t));const s=`${e.id}`;if(n.has(s)){const e=i.findIndex(e=>`${e.id}`===s);e>=0&&!i[e].date&&(i[e].date=this.parseToLocalDate(t))}else n.add(s),i.push(e)})}),i},getMonthDays(e){const t=e.getFullYear(),s=e.getMonth(),a=new Date(t,s+1,0).getDate(),o=[];for(let i=1;i<=a;i++)o.push(new Date(t,s,i));return o},formatYmd(e){const t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${a}`},normalizeTask(e){if(!e)return null;const t=e._id||e.id,s=e.title||e.name||"",a=!!e.completed,o=e.priority||"medium";let i="";"string"===typeof e.time&&e.time.trim()?i=e.time:e.startTime&&e.endTime&&(i=`${this.formatTime(e.startTime)} - ${this.formatTime(e.endTime)}`);let n=null;return e.date?n=this.parseToLocalDate(e.date):e.startTime?n=this.parseToLocalDate(e.startTime):e.createdAt&&(n=this.parseToLocalDate(e.createdAt)),t&&s?{id:t,title:s,time:i,date:n,priority:o,completed:a}:null},parseToLocalDate(e){if(!e)return null;if(e instanceof Date)return e;try{if("string"===typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e)){const[t,s,a]=e.split("-").map(e=>parseInt(e,10));return new Date(t,s-1,a)}const t=new Date(e);return isNaN(t.getTime())?null:t}catch(t){return null}},formatTime(e){const t=new Date(e);if(isNaN(t.getTime()))return"";const s=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0");return`${s}:${a}`},switchView(e){this.currentView=e},previousPeriod(){"week"===this.currentView?this.currentDate=new Date(this.currentDate.getTime()-6048e5):this.currentDate=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()-1,1)},nextPeriod(){"week"===this.currentView?this.currentDate=new Date(this.currentDate.getTime()+6048e5):this.currentDate=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()+1,1)},getStartOfWeek(e){const t=new Date(e),s=t.getDay(),a=t.getDate()-s+(0===s?-6:1);return new Date(t.setDate(a))},formatDate(e){return`${e.getMonth()+1}æœˆ${e.getDate()}æ—¥`},formatDateText(e){const t=["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"];return`${e.getMonth()+1}æœˆ${e.getDate()}æ—¥ ${t[e.getDay()]}`},isSelectedDate(e){return e.toDateString()===this.selectedDate.toDateString()},isCurrentMonth(e){return e.getMonth()===this.currentDate.getMonth()},selectDate(e){this.selectedDate=e,"week"===this.currentView&&(this.currentDate=e)},getTaskCount(e){return this.tasks.filter(t=>t&&t.date&&t.date.toDateString()===e.toDateString()).length},getTasksForDate(e){return this.tasks.filter(t=>t&&t.date&&t.date.toDateString()===e.toDateString())},async toggleTask(e){const t=e.completed;e.completed=!e.completed;try{await Ts.tasks.toggleTaskStatus(e.id),e.completed&&$s("encourage")}catch(s){e.completed=t}},openPomodoro(e){const t={task:e.title,from:"/calendar"};e.id&&(t.taskId=e.id),this.$router.push({path:"/pomodoro",query:t})},openAddTask(){this.$router.push("/ai-secretary")}}};const da=(0,l.A)(ca,[["render",ea],["__scopeId","data-v-7edf2a92"]]);var ua=da;const ha={class:"ai-secretary-container"},ma={key:0,class:"connection-status connecting"},ga={class:"chat-container"},pa={key:0,class:"message ai-message"},ka={class:"avatar"},va={class:"quick-actions"},fa=["onClick"];function ya(e,t,s,a,i,n){const r=(0,o.g2)("AIHeader"),l=(0,o.g2)("font-awesome-icon"),c=(0,o.g2)("MessageCard"),d=(0,o.g2)("MessageInput"),u=(0,o.g2)("AssistantSettingsModal"),m=(0,o.g2)("VoiceRecognitionStatus");return(0,o.uX)(),(0,o.CE)("div",ha,[(0,o.bF)(r,{assistant:i.assistant,onOpenSettings:n.openSettingsModal},null,8,["assistant","onOpenSettings"]),"connecting"===i.connectionStatus?((0,o.uX)(),(0,o.CE)("div",ma,[(0,o.bF)(l,{icon:"spinner",spin:""}),(0,o.Lk)("span",null,(0,h.v_)(n.connectionStatusText),1)])):(0,o.Q3)("",!0),n.showError?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"error-banner",onClick:t[0]||(t[0]=(...e)=>n.reconnect&&n.reconnect(...e))},[(0,o.bF)(l,{icon:"exclamation-circle"}),(0,o.Lk)("span",null,(0,h.v_)(i.errorMessage),1),t[1]||(t[1]=(0,o.Lk)("small",null,"ç‚¹å‡»é‡è¯•",-1))])):(0,o.Q3)("",!0),(0,o.Lk)("div",ga,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.messages,e=>((0,o.uX)(),(0,o.Wv)(c,{key:e.id,message:e},null,8,["message"]))),128)),n.isProcessing?((0,o.uX)(),(0,o.CE)("div",pa,[(0,o.Lk)("div",ka,[(0,o.bF)(l,{icon:"robot"})]),t[2]||(t[2]=(0,o.Lk)("div",{class:"message-content"},[(0,o.Lk)("div",{class:"typing-indicator"},[(0,o.Lk)("span"),(0,o.Lk)("span"),(0,o.Lk)("span")])],-1))])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",va,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.quickActions,e=>((0,o.uX)(),(0,o.CE)("button",{key:e.id,class:"quick-action-btn",onClick:t=>n.sendQuickMessage(e.text)},[(0,o.bF)(l,{icon:e.icon},null,8,["icon"]),(0,o.Lk)("span",null,(0,h.v_)(e.label),1)],8,fa))),128))]),(0,o.bF)(d,{onSendMessage:n.sendMessage,onSendVoiceMessage:n.sendVoiceMessage,onAiReply:n.handleAIReply},null,8,["onSendMessage","onSendVoiceMessage","onAiReply"]),(0,o.bF)(u,{visible:i.showSettingsModal,assistant:i.assistant,onClose:n.closeSettingsModal,onSave:n.saveAssistantSettings},null,8,["visible","assistant","onClose","onSave"]),(0,o.bF)(m,{show:i.showVoiceStatus,type:i.voiceStatusType,title:i.voiceStatusTitle,message:i.voiceStatusMessage,progress:i.voiceStatusProgress,"auto-close":i.voiceStatusAutoClose,onClose:n.hideVoiceStatus},null,8,["show","type","title","message","progress","auto-close","onClose"])])}s(4603),s(7566),s(8721);const ba={class:"header"},wa={class:"title-section"},Ca={class:"title"},La={key:0,class:"heart-value"},Ta={class:"heart-number"};function Sa(e,t,s,a,i,n){const r=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("header",ba,[(0,o.Lk)("div",{class:"back-btn",onClick:t[0]||(t[0]=(...e)=>n.goBack&&n.goBack(...e))},[(0,o.bF)(r,{icon:"chevron-left"})]),(0,o.Lk)("div",wa,[(0,o.Lk)("h1",Ca,(0,h.v_)(n.assistantName),1),s.assistant?((0,o.uX)(),(0,o.CE)("div",La,[(0,o.bF)(r,{icon:"heart",class:"heart-icon"}),(0,o.Lk)("span",Ta,(0,h.v_)(s.assistant.heartValue),1)])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",{class:"settings-btn",onClick:t[1]||(t[1]=(...e)=>n.openSettings&&n.openSettings(...e))},[(0,o.bF)(r,{icon:"cog"})])])}var Ia={name:"AIHeader",props:{assistant:{type:Object,default:null}},computed:{assistantName(){return this.assistant?.name||"AIå­¦ä¹ åŠ©æ‰‹"}},methods:{goBack(){window.history.back()},openSettings(){this.$emit("openSettings")}}};const Ea=(0,l.A)(Ia,[["render",Sa],["__scopeId","data-v-b5ecfaae"]]);var Ma=Ea;const Aa={key:0,class:"avatar"},Da={class:"message-content"},$a={key:0,class:"message-text"},Pa={key:1,class:"image-message"},Fa=["src"],_a={key:2,class:"voice-message"},Ra={class:"voice-content"},xa={class:"voice-icon"},Xa={class:"voice-duration"},Ua={key:3,class:"questions-container"},Va={class:"message-text"},Ba={class:"questions-list"},Na={class:"question-number"},Oa={class:"question-text"},qa={class:"questions-tip"},za={key:4,class:"task-created-container"},ja={class:"message-text"},Ka={key:0,class:"task-info"},Wa={class:"task-title"},Qa={class:"task-details"},Ga={class:"task-detail"},Ha={class:"task-detail"},Ja={class:"value"},Ya={key:5,class:"plan-container"},Za={class:"message-text"},eo={key:0,class:"plan-info"},to={class:"plan-overview"},so={key:0,class:"plan-summary"},ao={class:"summary-item"},oo={class:"summary-item"},io={key:6,class:"dynamic-adjustment-container"},no={class:"message-text"},ro={key:0,class:"adjustment-summary"},lo={class:"adjustment-header"},co={class:"adjustment-stats"},uo={key:0,class:"stat-item"},ho={key:1,class:"stat-item"},mo={key:2,class:"stat-item"},go={key:3,class:"stat-item"},po={key:0,class:"user-state-info"},ko={class:"state-indicator"},vo={key:7,class:"error-container"},fo={class:"message-text error-text"},yo={key:8,class:"message-text"},bo={key:1,class:"avatar user-avatar"};function wo(e,t,s,a,i,n){const r=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",{class:(0,h.C4)(["message",{"user-message":s.message.isUser,"ai-message":!s.message.isUser}])},[s.message.isUser?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",Aa,[(0,o.bF)(r,{icon:"robot"})])),(0,o.Lk)("div",Da,[n.isTextMessage?((0,o.uX)(),(0,o.CE)("div",$a,(0,h.v_)(s.message.content),1)):n.isImageMessage?((0,o.uX)(),(0,o.CE)("div",Pa,[(0,o.Lk)("img",{src:n.extractImageUrl(s.message.content),alt:"ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡",class:"message-image"},null,8,Fa)])):n.isVoiceMessage?((0,o.uX)(),(0,o.CE)("div",_a,[(0,o.Lk)("div",Ra,[(0,o.Lk)("div",xa,[(0,o.bF)(r,{icon:"play"})]),(0,o.Lk)("div",Xa,(0,h.v_)(n.formatDuration(s.message.duration||0)),1)])])):n.isQuestionsMessage?((0,o.uX)(),(0,o.CE)("div",Ua,[(0,o.Lk)("div",Va,(0,h.v_)(s.message.content),1),(0,o.Lk)("div",Ba,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.message.metadata.questions,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:"question-item"},[(0,o.Lk)("span",Na,(0,h.v_)(t+1),1),(0,o.Lk)("span",Oa,(0,h.v_)(e),1)]))),128))]),(0,o.Lk)("div",qa,[(0,o.bF)(r,{icon:"lightbulb"}),t[0]||(t[0]=(0,o.Lk)("span",null,"è¯·é€ä¸€å›žç­”è¿™äº›é—®é¢˜ï¼Œæˆ‘ä¼šæ ¹æ®ä½ çš„å›žç­”åˆ¶å®šè¯¦ç»†è®¡åˆ’",-1))])])):n.isTaskCreatedMessage?((0,o.uX)(),(0,o.CE)("div",za,[(0,o.Lk)("div",ja,(0,h.v_)(s.message.content),1),s.message.metadata.task?((0,o.uX)(),(0,o.CE)("div",Ka,[(0,o.Lk)("div",Wa,[(0,o.bF)(r,{icon:"check-circle"}),(0,o.Lk)("span",null,(0,h.v_)(s.message.metadata.task.title),1)]),(0,o.Lk)("div",Qa,[(0,o.Lk)("div",Ga,[t[1]||(t[1]=(0,o.Lk)("span",{class:"label"},"ä¼˜å…ˆçº§ï¼š",-1)),(0,o.Lk)("span",{class:(0,h.C4)(["value priority",s.message.metadata.task.priority])},(0,h.v_)(n.getPriorityText(s.message.metadata.task.priority)),3)]),(0,o.Lk)("div",Ha,[t[2]||(t[2]=(0,o.Lk)("span",{class:"label"},"æ—¶é—´å®‰æŽ’ï¼š",-1)),(0,o.Lk)("span",Ja,(0,h.v_)(n.getTimeBlockText(s.message.metadata.task.timeBlock)),1)])])])):(0,o.Q3)("",!0)])):n.isPlanMessage?((0,o.uX)(),(0,o.CE)("div",Ya,[(0,o.Lk)("div",Za,(0,h.v_)(s.message.content),1),s.message.metadata.plan?((0,o.uX)(),(0,o.CE)("div",eo,[(0,o.Lk)("div",to,(0,h.v_)(s.message.metadata.plan.plan_overview),1),s.message.metadata.summary?((0,o.uX)(),(0,o.CE)("div",so,[(0,o.Lk)("div",ao,[(0,o.bF)(r,{icon:"folder"}),(0,o.Lk)("span",null,(0,h.v_)(s.message.metadata.summary.collections_count)+"ä¸ªä»»åŠ¡é›†",1)]),(0,o.Lk)("div",oo,[(0,o.bF)(r,{icon:"tasks"}),(0,o.Lk)("span",null,(0,h.v_)(s.message.metadata.summary.tasks_count)+"ä¸ªä»»åŠ¡",1)])])):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0)])):n.isDynamicAdjustmentMessage?((0,o.uX)(),(0,o.CE)("div",io,[(0,o.Lk)("div",no,(0,h.v_)(s.message.content),1),s.message.metadata.adjustmentSummary?((0,o.uX)(),(0,o.CE)("div",ro,[(0,o.Lk)("div",lo,[(0,o.bF)(r,{icon:"magic"}),t[3]||(t[3]=(0,o.Lk)("span",null,"ä»»åŠ¡è°ƒæ•´ç»“æžœ",-1))]),(0,o.Lk)("div",co,[s.message.metadata.adjustmentSummary.modified_tasks>0?((0,o.uX)(),(0,o.CE)("div",uo,[(0,o.bF)(r,{icon:"edit"}),(0,o.Lk)("span",null,"ä¿®æ”¹äº† "+(0,h.v_)(s.message.metadata.adjustmentSummary.modified_tasks)+" ä¸ªä»»åŠ¡",1)])):(0,o.Q3)("",!0),s.message.metadata.adjustmentSummary.postponed_tasks>0?((0,o.uX)(),(0,o.CE)("div",ho,[(0,o.bF)(r,{icon:"clock"}),(0,o.Lk)("span",null,"å»¶åŽäº† "+(0,h.v_)(s.message.metadata.adjustmentSummary.postponed_tasks)+" ä¸ªä»»åŠ¡",1)])):(0,o.Q3)("",!0),s.message.metadata.adjustmentSummary.new_tasks>0?((0,o.uX)(),(0,o.CE)("div",mo,[(0,o.bF)(r,{icon:"plus-circle"}),(0,o.Lk)("span",null,"æ–°å¢žäº† "+(0,h.v_)(s.message.metadata.adjustmentSummary.new_tasks)+" ä¸ªä»»åŠ¡",1)])):(0,o.Q3)("",!0),s.message.metadata.adjustmentSummary.cancelled_tasks>0?((0,o.uX)(),(0,o.CE)("div",go,[(0,o.bF)(r,{icon:"times-circle"}),(0,o.Lk)("span",null,"å–æ¶ˆäº† "+(0,h.v_)(s.message.metadata.adjustmentSummary.cancelled_tasks)+" ä¸ªä»»åŠ¡",1)])):(0,o.Q3)("",!0)]),s.message.metadata.userState?((0,o.uX)(),(0,o.CE)("div",po,[(0,o.Lk)("div",ko,[t[4]||(t[4]=(0,o.Lk)("span",{class:"state-label"},"æ£€æµ‹çŠ¶æ€ï¼š",-1)),(0,o.Lk)("span",{class:(0,h.C4)(["state-value",n.getStateClass(s.message.metadata.userState.primaryState)])},(0,h.v_)(n.getStateText(s.message.metadata.userState.primaryState)),3)])])):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0)])):n.isErrorMessage?((0,o.uX)(),(0,o.CE)("div",vo,[(0,o.Lk)("div",fo,[(0,o.bF)(r,{icon:"exclamation-circle"}),(0,o.Lk)("span",null,(0,h.v_)(s.message.content),1)])])):((0,o.uX)(),(0,o.CE)("div",yo,(0,h.v_)(s.message.content||s.message.text),1))]),s.message.isUser?((0,o.uX)(),(0,o.CE)("div",bo,[(0,o.bF)(r,{icon:"user"})])):(0,o.Q3)("",!0)],2)}const Co=[{id:"create-task",label:"åˆ›å»ºä»»åŠ¡",text:"å¸®æˆ‘åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡",icon:"plus"},{id:"schedule-planning",label:"å®‰æŽ’æ—¥ç¨‹",text:"å¸®æˆ‘å®‰æŽ’ä¸€ä¸‹ä»Šå¤©çš„æ—¥ç¨‹",icon:"calendar"},{id:"goal-planning",label:"ç›®æ ‡è§„åˆ’",text:"æˆ‘æƒ³åˆ¶å®šä¸€ä¸ªå­¦ä¹ ç›®æ ‡è®¡åˆ’",icon:"bullseye"},{id:"habit-formation",label:"ä¹ æƒ¯å…»æˆ",text:"æˆ‘æƒ³å…»æˆä¸€ä¸ªæ–°çš„å­¦ä¹ ä¹ æƒ¯",icon:"sync"},{id:"emotional-support",label:"æƒ…ç»ªæ”¯æŒ",text:"æˆ‘ä»Šå¤©æ„Ÿè§‰æœ‰ç‚¹ç´¯ï¼Œéœ€è¦ä¸€äº›é¼“åŠ±",icon:"heart"}],Lo={TEXT:"text",VOICE:"voice",TASK_CREATED:"task_created",SCHEDULE_ADJUSTED:"schedule_adjusted",EMOTIONAL_SUPPORT:"emotional_support",ERROR:"error",TYPING:"typing"},To={USER:"user",AI:"ai",SYSTEM:"system"},So={MORNING:"morning",FORENOON:"forenoon",AFTERNOON:"afternoon",EVENING:"evening",UNSCHEDULED:"unscheduled"},Io={LOW:"low",MEDIUM:"medium",HIGH:"high"},Eo={URGENT_IMPORTANT:1,IMPORTANT:2,URGENT:3,NEITHER:4};const Mo={formatTime(e){return new Intl.DateTimeFormat("zh-CN",{hour:"2-digit",minute:"2-digit"}).format(e)},formatDate(e){return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).format(e)},getTimeBlockName(e){const t={[So.MORNING]:"æ—©æ™¨",[So.FORENOON]:"ä¸Šåˆ",[So.AFTERNOON]:"ä¸‹åˆ",[So.EVENING]:"æ™šä¸Š",[So.UNSCHEDULED]:"æœªå®‰æŽ’"};return t[e]||"æœªçŸ¥"},getPriorityName(e){const t={[Io.LOW]:"ä½Ž",[Io.MEDIUM]:"ä¸­",[Io.HIGH]:"é«˜"};return t[e]||"æœªçŸ¥"},getQuadrantName(e){const t={[Eo.URGENT_IMPORTANT]:"é‡è¦ä¸”ç´§æ€¥",[Eo.IMPORTANT]:"é‡è¦ä¸ç´§æ€¥",[Eo.URGENT]:"ç´§æ€¥ä¸é‡è¦",[Eo.NEITHER]:"ä¸é‡è¦ä¸ç´§æ€¥"};return t[e]||"æœªåˆ†ç±»"}};var Ao={name:"MessageCard",props:{message:{type:Object,required:!0}},computed:{isTextMessage(){return!this.message.type||this.message.type===Lo.TEXT},isQuestionsMessage(){return this.message.type===Lo.QUESTIONS},isTaskCreatedMessage(){return this.message.type===Lo.TASK_CREATED},isPlanMessage(){return this.message.type===Lo.PLAN},isErrorMessage(){return this.message.type===Lo.ERROR},isDynamicAdjustmentMessage(){return this.message.type===Lo.DYNAMIC_ADJUSTMENT},isVoiceMessage(){return this.message.type===Lo.VOICE},isImageMessage(){return"IMAGE"===this.message.type||this.message.content&&this.message.content.startsWith("ðŸ–¼ï¸ å›¾ç‰‡ï¼š")}},methods:{getPriorityText(e){return Mo.getPriorityName(e)},getTimeBlockText(e){if(!e)return"æœªå®‰æŽ’";const t=Mo.getTimeBlockName(e.timeBlockType);return e.startTime&&e.endTime?`${t} (${e.startTime}-${e.endTime})`:t},getStateText(e){const t={tired:"ç–²åŠ³",busy:"å¿™ç¢Œ",stressed:"åŽ‹åŠ›å¤§",motivated:"çŠ¶æ€è‰¯å¥½",sick:"èº«ä½“ä¸é€‚",normal:"æ­£å¸¸"};return t[e]||e},getStateClass(e){return`state-${e}`},formatDuration(e){if(e<60)return`${e}"`;{const t=Math.floor(e/60),s=e%60;return`${t}:${s.toString().padStart(2,"0")}`}},extractImageUrl(e){return this.message.metadata&&this.message.metadata.imageUrl?this.message.metadata.imageUrl:e&&e.startsWith("[å›¾ç‰‡]")?e.substring(4):""}}};const Do=(0,l.A)(Ao,[["render",wo],["__scopeId","data-v-0922388e"]]);var $o=Do;const Po={class:"input-container"},Fo=["disabled","title"],_o={class:"dynamic-input-area"},Ro=["disabled"],xo={class:"voice-placeholder"},Xo=["disabled"],Uo=["disabled"],Vo={key:0,class:"recognition-status"},Bo={class:"status-content"},No={key:1,class:"recognition-preview"},Oo={class:"preview-header"},qo={class:"preview-content"},zo={class:"preview-text"},jo={class:"preview-actions"},Ko={key:0,class:"function-panel"},Wo={class:"function-buttons"},Qo={class:"button-icon"},Go={class:"button-icon"};function Ho(e,t,s,i,n,r){const l=(0,o.g2)("font-awesome-icon"),c=(0,o.g2)("ImageAnalysisModal");return(0,o.uX)(),(0,o.CE)("div",null,[(0,o.Lk)("div",{class:(0,h.C4)(["input-area",{expanded:n.showPlusMenu}])},[(0,o.Lk)("div",Po,[(0,o.Lk)("button",{class:(0,h.C4)(["voice-btn",{active:n.isVoiceMode,processing:n.isProcessing}]),onClick:t[0]||(t[0]=(...e)=>r.toggleVoiceMode&&r.toggleVoiceMode(...e)),disabled:n.isProcessing,title:n.isVoiceMode?"åˆ‡æ¢åˆ°æ–‡å­—è¾“å…¥":"åˆ‡æ¢åˆ°è¯­éŸ³è¾“å…¥"},[(0,o.bF)(l,{icon:n.isVoiceMode?"keyboard":"microphone",class:(0,h.C4)({pulse:n.isProcessing})},null,8,["icon","class"])],10,Fo),(0,o.Lk)("input",{ref:"fileInput",type:"file",accept:"audio/*",style:{display:"none"},onChange:t[1]||(t[1]=(...e)=>r.handleFileSelect&&r.handleFileSelect(...e))},null,544),(0,o.Lk)("input",{ref:"imageInput",type:"file",accept:"image/*",style:{display:"none"},onChange:t[2]||(t[2]=(...e)=>r.handleImageSelect&&r.handleImageSelect(...e))},null,544),(0,o.Lk)("div",_o,[n.isVoiceMode?((0,o.uX)(),(0,o.CE)("div",{key:1,class:(0,h.C4)(["voice-input-area",{listening:n.isListening}]),onTouchstart:t[5]||(t[5]=(...e)=>r.startVoiceInput&&r.startVoiceInput(...e)),onTouchend:t[6]||(t[6]=(...e)=>r.endVoiceInput&&r.endVoiceInput(...e)),onTouchmove:t[7]||(t[7]=(...e)=>r.handleTouchMove&&r.handleTouchMove(...e)),onMousedown:t[8]||(t[8]=(...e)=>r.startVoiceInput&&r.startVoiceInput(...e)),onMouseup:t[9]||(t[9]=(...e)=>r.endVoiceInput&&r.endVoiceInput(...e)),onMouseleave:t[10]||(t[10]=(...e)=>r.cancelVoiceInput&&r.cancelVoiceInput(...e))},[(0,o.bF)(l,{icon:"microphone",class:"voice-area-icon"}),(0,o.Lk)("span",xo,(0,h.v_)(r.getVoicePlaceholderText()),1)],34)):(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:0,"onUpdate:modelValue":t[3]||(t[3]=e=>n.inputText=e),type:"text",placeholder:"è¾“å…¥ä½ çš„å­¦ä¹ ç›®æ ‡æˆ–é—®é¢˜...",class:"message-input",onKeypress:t[4]||(t[4]=(0,a.jR)((...e)=>r.sendMessage&&r.sendMessage(...e),["enter"])),disabled:n.isProcessing},null,40,Ro)),[[a.Jo,n.inputText]])]),(0,o.Lk)("button",{class:"send-btn",onClick:t[11]||(t[11]=(...e)=>r.sendMessage&&r.sendMessage(...e)),disabled:!n.inputText.trim()||n.isProcessing},[(0,o.bF)(l,{icon:"paper-plane"})],8,Xo),(0,o.Lk)("button",{class:(0,h.C4)(["plus-btn",{active:n.showPlusMenu}]),onClick:t[12]||(t[12]=(...e)=>r.togglePlusMenu&&r.togglePlusMenu(...e)),disabled:n.isProcessing,title:"æ›´å¤šåŠŸèƒ½"},[(0,o.bF)(l,{icon:"plus"})],10,Uo)]),n.isProcessing?((0,o.uX)(),(0,o.CE)("div",Vo,[(0,o.Lk)("div",Bo,[(0,o.bF)(l,{icon:"spinner",spin:""}),(0,o.Lk)("span",null,(0,h.v_)(n.recognitionStatusText),1)])])):(0,o.Q3)("",!0),n.recognitionResult&&!n.isProcessing?((0,o.uX)(),(0,o.CE)("div",No,[(0,o.Lk)("div",Oo,[(0,o.bF)(l,{icon:"microphone"}),t[18]||(t[18]=(0,o.Lk)("span",null,"è¯­éŸ³è¯†åˆ«ç»“æžœ",-1)),(0,o.Lk)("button",{class:"preview-close",onClick:t[13]||(t[13]=(...e)=>r.clearRecognitionResult&&r.clearRecognitionResult(...e))},[(0,o.bF)(l,{icon:"times"})])]),(0,o.Lk)("div",qo,[(0,o.Lk)("p",zo,(0,h.v_)(n.recognitionResult.transcription),1),(0,o.Lk)("div",jo,[(0,o.Lk)("button",{class:"preview-btn preview-btn-edit",onClick:t[14]||(t[14]=(...e)=>r.editRecognitionResult&&r.editRecognitionResult(...e))},[(0,o.bF)(l,{icon:"edit"}),t[19]||(t[19]=(0,o.eW)(" ç¼–è¾‘ ",-1))]),(0,o.Lk)("button",{class:"preview-btn preview-btn-send",onClick:t[15]||(t[15]=(...e)=>r.sendRecognitionResult&&r.sendRecognitionResult(...e))},[(0,o.bF)(l,{icon:"paper-plane"}),t[20]||(t[20]=(0,o.eW)(" å‘é€ ",-1))])])])])):(0,o.Q3)("",!0)],2),n.showPlusMenu?((0,o.uX)(),(0,o.CE)("div",Ko,[(0,o.Lk)("div",Wo,[(0,o.Lk)("div",{class:"function-button",onClick:t[16]||(t[16]=(...e)=>r.openPhotoLibrary&&r.openPhotoLibrary(...e))},[(0,o.Lk)("div",Qo,[(0,o.bF)(l,{icon:"images"})]),t[21]||(t[21]=(0,o.Lk)("span",{class:"button-text"},"ç›¸å†Œ",-1))]),(0,o.Lk)("div",{class:"function-button",onClick:t[17]||(t[17]=(...e)=>r.openCamera&&r.openCamera(...e))},[(0,o.Lk)("div",Go,[(0,o.bF)(l,{icon:"camera"})]),t[22]||(t[22]=(0,o.Lk)("span",{class:"button-text"},"æ‹æ‘„",-1))])])])):(0,o.Q3)("",!0),(0,o.bF)(c,{visible:n.showImageAnalysisModal,preSelectedFile:n.selectedFile,onClose:r.closeImageAnalysisModal,onAnalysisComplete:r.handleImageAnalysisComplete,onShowToast:r.showToast},null,8,["visible","preSelectedFile","onClose","onAnalysisComplete","onShowToast"])])}s(6573),s(8100),s(7936);const Jo={DEBUG:0,INFO:1,WARN:2,ERROR:3},Yo=Jo.WARN,Zo={DEBUG:"color: #6c757d;",INFO:"color: #007bff;",WARN:"color: #ffc107;",ERROR:"color: #dc3545;",SUCCESS:"color: #28a745;",API:"color: #17a2b8;",USER:"color: #6f42c1;",AI:"color: #fd7e14;"},ei={DEBUG:"ðŸ”",INFO:"â„¹ï¸",WARN:"âš ï¸",ERROR:"âŒ",SUCCESS:"âœ…",API:"ðŸŒ",USER:"ðŸ‘¤",AI:"ðŸ¤–",TIME:"â°",DATA:"ðŸ“Š",PROCESS:"âš™ï¸"};class ti{constructor(e="AIåŠ©æ‰‹"){this.context=e,this.startTime=Date.now(),this.sessionId=this.generateSessionId(),this.log("INFO","æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–",{sessionId:this.sessionId})}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,6)}`}formatTimestamp(){return(new Date).toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3})}shouldLog(e){return Jo[e]>=Yo}log(e,t,s=null){if(!this.shouldLog(e))return;const a=this.formatTimestamp(),o=ei[e]||"",i=Zo[e]||"",n=`${o} [${a}] [${this.context}]`;s?(console.groupCollapsed(`%c${n} ${t}`,i),console.log("è¯¦ç»†æ•°æ®:",s),console.groupEnd()):console.log(`%c${n} ${t}`,i)}debug(e,t=null){this.log("DEBUG",e,t)}info(e,t=null){this.log("INFO",e,t)}warn(e,t=null){this.log("WARN",e,t)}error(e,t=null){const s=t?{message:t.message,stack:t.stack,name:t.name}:null;this.log("ERROR",e,s)}success(e,t=null){this.log("SUCCESS",e,t)}api(e,t=null){this.log("API",`APIè°ƒç”¨: ${e}`,t)}user(e,t=null){this.log("USER",`ç”¨æˆ·æ“ä½œ: ${e}`,t)}ai(e,t=null){this.log("AI",`AIå¤„ç†: ${e}`,t)}time(e){const t=this.formatTimestamp();console.time(`${ei.TIME} [${t}] ${e}`)}timeEnd(e){const t=this.formatTimestamp();console.timeEnd(`${ei.TIME} [${t}] ${e}`)}group(e,t){const s=this.formatTimestamp();if(console.group(`${ei.PROCESS} [${s}] ${e}`),"function"===typeof t)try{t()}finally{console.groupEnd()}}groupEnd(){console.groupEnd()}table(e,t=null){t&&this.info(t),console.table(e)}performance(e,t){const s=Date.now()-t,a=s>1e3?"WARN":s>500?"INFO":"DEBUG";this.log(a,`æ€§èƒ½ç›‘æŽ§: ${e} è€—æ—¶ ${s}ms`)}getStats(){const e=Date.now()-this.startTime;return{sessionId:this.sessionId,uptime:e,context:this.context,startTime:new Date(this.startTime).toISOString()}}}const si=new ti("AIåŠ©æ‰‹");const ai={debug:(e,t)=>si.debug(e,t),info:(e,t)=>si.info(e,t),warn:(e,t)=>si.warn(e,t),error:(e,t)=>si.error(e,t),success:(e,t)=>si.success(e,t),api:(e,t)=>si.api(e,t),user:(e,t)=>si.user(e,t),ai:(e,t)=>si.ai(e,t),time:e=>si.time(e),timeEnd:e=>si.timeEnd(e),group:(e,t)=>si.group(e,t),table:(e,t)=>si.table(e,t),performance:(e,t)=>si.performance(e,t)},oi={RECOGNIZE:"/speech-recognition/recognize",UPLOAD_ONLY:"/speech-recognition/upload",RECOGNIZE_URL:"/speech-recognition/recognize-url"};function ii(){return localStorage.getItem("token")||localStorage.getItem("userToken")||""}function ni(){try{const e=JSON.parse(localStorage.getItem("user")||"null");return e?._id||e?.id||null}catch(e){return null}}class ri{constructor(){this.userId=ni(),this.isProcessing=!1,ai.info("è¯­éŸ³è¯†åˆ«æœåŠ¡åˆå§‹åŒ–",{userId:this.userId})}checkAuth(){const e=ii();if(!e)throw new Error("æœªç™»å½•ï¼Œè¯·å…ˆç™»å½•");return e}async recognizeVoice(e){try{this.isProcessing=!0,ai.info("å¼€å§‹è¯­éŸ³è¯†åˆ«",{fileName:e.name,fileSize:e.size});const t=["audio/mpeg","audio/wav","audio/mp4","audio/aac","audio/flac","audio/ogg","audio/webm"];if(!t.includes(e.type))throw new Error("ä¸æ”¯æŒçš„éŸ³é¢‘æ ¼å¼ï¼Œè¯·ä½¿ç”¨ MP3, WAV, M4A, AAC, FLAC, OGG, WEBM æ ¼å¼");if(e.size>10485760)throw new Error("æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB");const s=this.checkAuth(),a=new FormData;a.append("audio",e);const o=await fetch(Ee(oi.RECOGNIZE),{method:"POST",headers:{Authorization:`Bearer ${s}`},body:a});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);const i=await o.json();if(i.success)return ai.success("è¯­éŸ³è¯†åˆ«æˆåŠŸ",{transcription:i.data.transcription,audioUrl:i.data.audioUrl}),{success:!0,transcription:i.data.transcription,audioUrl:i.data.audioUrl,ossKey:i.data.ossKey};throw new Error(i.error||i.message||"è¯†åˆ«å¤±è´¥")}catch(t){throw ai.error("è¯­éŸ³è¯†åˆ«å¤±è´¥",t),t}finally{this.isProcessing=!1}}async uploadAudioOnly(e){try{this.isProcessing=!0,ai.info("å¼€å§‹ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶",{fileName:e.name,fileSize:e.size});const t=this.checkAuth(),s=new FormData;s.append("audio",e);const a=await fetch(Ee(oi.UPLOAD_ONLY),{method:"POST",headers:{Authorization:`Bearer ${t}`},body:s});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const o=await a.json();if(o.success)return ai.success("éŸ³é¢‘æ–‡ä»¶ä¸Šä¼ æˆåŠŸ",{audioUrl:o.data.audioUrl,ossKey:o.data.ossKey}),{success:!0,audioUrl:o.data.audioUrl,ossKey:o.data.ossKey};throw new Error(o.error||o.message||"ä¸Šä¼ å¤±è´¥")}catch(t){throw ai.error("éŸ³é¢‘æ–‡ä»¶ä¸Šä¼ å¤±è´¥",t),t}finally{this.isProcessing=!1}}async recognizeFromUrl(e){try{this.isProcessing=!0,ai.info("ä»ŽURLè¯†åˆ«éŸ³é¢‘",{audioUrl:e});const t=this.checkAuth(),s=await fetch(Ee(oi.RECOGNIZE_URL),{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({audioUrl:e})});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const a=await s.json();if(a.success)return ai.success("URLè¯†åˆ«æˆåŠŸ",{transcription:a.data.transcription}),{success:!0,transcription:a.data.transcription,audioUrl:a.data.audioUrl};throw new Error(a.error||a.message||"è¯†åˆ«å¤±è´¥")}catch(t){throw ai.error("URLè¯†åˆ«å¤±è´¥",t),t}finally{this.isProcessing=!1}}validateAudioFile(e){const t=["audio/mpeg","audio/wav","audio/mp4","audio/aac","audio/flac","audio/ogg","audio/webm"],s=104857600,a={isValid:!0,errors:[]};return e?(t.includes(e.type)||(a.isValid=!1,a.errors.push("ä¸æ”¯æŒçš„éŸ³é¢‘æ ¼å¼ï¼Œè¯·ä½¿ç”¨ MP3, WAV, M4A, AAC, FLAC, OGG æ ¼å¼")),e.size>s&&(a.isValid=!1,a.errors.push("æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB")),a):(a.isValid=!1,a.errors.push("è¯·é€‰æ‹©éŸ³é¢‘æ–‡ä»¶"),a)}getProcessingStatus(){return this.isProcessing}resetProcessingStatus(){this.isProcessing=!1}}const li=new ri;var ci=li;const di={class:"modal-content"},ui={class:"modal-header"},hi={class:"modal-body"},mi={class:"upload-area"},gi={key:0,class:"upload-placeholder"},pi={key:1,class:"image-preview"},ki=["src","alt"],vi={class:"image-info"},fi={class:"image-name"},yi={class:"image-size"},bi={key:2,class:"upload-progress"},wi={class:"prompt-section"},Ci={class:"prompt-label"},Li=["disabled"],Ti={key:0,class:"analysis-result"},Si={class:"result-content"},Ii={class:"result-text"},Ei={class:"result-meta"},Mi={class:"token-info"},Ai={key:1,class:"error-message"},Di={class:"modal-footer"},$i=["disabled"],Pi={key:1};function Fi(e,t,s,i,n,r){const l=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.Wv)(o.Im,{to:"body"},[s.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"image-analysis-modal",onClick:t[10]||(t[10]=(0,a.D$)((...e)=>r.closeModal&&r.closeModal(...e),["self"]))},[(0,o.Lk)("div",di,[(0,o.Lk)("div",ui,[t[11]||(t[11]=(0,o.Lk)("h3",null,"ðŸ–¼ï¸ å›¾ç‰‡åˆ†æž",-1)),(0,o.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>r.closeModal&&r.closeModal(...e))},[(0,o.bF)(l,{icon:"times"})])]),(0,o.Lk)("div",hi,[(0,o.Lk)("div",mi,[(0,o.Lk)("div",{class:(0,h.C4)(["upload-area",{dragover:n.isDragOver,"has-image":n.selectedFile,uploading:n.isUploading}]),onDrop:t[2]||(t[2]=(...e)=>r.handleDrop&&r.handleDrop(...e)),onDragover:t[3]||(t[3]=(0,a.D$)(e=>n.isDragOver=!0,["prevent"])),onDragleave:t[4]||(t[4]=(0,a.D$)(e=>n.isDragOver=!1,["prevent"])),onClick:t[5]||(t[5]=(...e)=>r.triggerFileSelect&&r.triggerFileSelect(...e))},[n.selectedFile?((0,o.uX)(),(0,o.CE)("div",pi,[(0,o.Lk)("img",{src:n.previewUrl,alt:n.selectedFile.name,class:"preview-image"},null,8,ki),(0,o.Lk)("div",vi,[(0,o.Lk)("p",fi,(0,h.v_)(n.selectedFile.name),1),(0,o.Lk)("p",yi,(0,h.v_)(r.formatFileSize(n.selectedFile.size)),1)]),(0,o.Lk)("button",{class:"remove-image",onClick:t[1]||(t[1]=(0,a.D$)((...e)=>r.removeImage&&r.removeImage(...e),["stop"]))},[(0,o.bF)(l,{icon:"times"})])])):((0,o.uX)(),(0,o.CE)("div",gi,[(0,o.bF)(l,{icon:"cloud-upload-alt",class:"upload-icon"}),t[12]||(t[12]=(0,o.Lk)("p",{class:"upload-text"},"æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©",-1)),t[13]||(t[13]=(0,o.Lk)("p",{class:"upload-hint"},"æ”¯æŒ JPEGã€PNGã€GIFã€WebPã€BMP æ ¼å¼ï¼Œæœ€å¤§ 10MB",-1))])),n.isUploading?((0,o.uX)(),(0,o.CE)("div",bi,[(0,o.bF)(l,{icon:"spinner",spin:""}),t[14]||(t[14]=(0,o.Lk)("span",null,"æ­£åœ¨åˆ†æžå›¾ç‰‡...",-1))])):(0,o.Q3)("",!0)],34),(0,o.Lk)("input",{ref:"fileInput",type:"file",accept:"image/*",style:{display:"none"},onChange:t[6]||(t[6]=(...e)=>r.handleFileSelect&&r.handleFileSelect(...e))},null,544)]),(0,o.Lk)("div",wi,[(0,o.Lk)("label",Ci,[(0,o.bF)(l,{icon:"comment"}),t[15]||(t[15]=(0,o.eW)(" è‡ªå®šä¹‰åˆ†æžæç¤ºè¯ï¼ˆå¯é€‰ï¼‰ ",-1))]),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[7]||(t[7]=e=>n.customPrompt=e),placeholder:"ä¾‹å¦‚ï¼šè¯·è¯¦ç»†æè¿°è¿™å¼ å›¾ç‰‡çš„å†…å®¹ï¼ŒåŒ…æ‹¬åœºæ™¯ã€å¯¹è±¡ã€é¢œè‰²ç­‰...",class:"prompt-input",rows:"3",disabled:n.isUploading},null,8,Li),[[a.Jo,n.customPrompt]])]),n.analysisResult?((0,o.uX)(),(0,o.CE)("div",Ti,[t[16]||(t[16]=(0,o.Lk)("h4",null,"ðŸ“Š åˆ†æžç»“æžœ",-1)),(0,o.Lk)("div",Si,[(0,o.Lk)("p",Ii,(0,h.v_)(n.analysisResult.analysis.content),1),(0,o.Lk)("div",Ei,[(0,o.Lk)("span",Mi,[(0,o.bF)(l,{icon:"info-circle"}),(0,o.eW)(" æ¶ˆè€— Token: "+(0,h.v_)(n.analysisResult.analysis.usage.total_tokens),1)])])])])):(0,o.Q3)("",!0),n.errorMessage?((0,o.uX)(),(0,o.CE)("div",Ai,[(0,o.bF)(l,{icon:"exclamation-triangle"}),(0,o.eW)(" "+(0,h.v_)(n.errorMessage),1)])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",Di,[(0,o.Lk)("button",{class:"btn btn-secondary",onClick:t[8]||(t[8]=(...e)=>r.closeModal&&r.closeModal(...e))}," å–æ¶ˆ "),"upload"===e.activeTab&&n.selectedFile?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"btn btn-primary",onClick:t[9]||(t[9]=(...e)=>r.analyzeImage&&r.analyzeImage(...e)),disabled:n.isUploading},[n.isUploading?((0,o.uX)(),(0,o.Wv)(l,{key:0,icon:"spinner",spin:""})):((0,o.uX)(),(0,o.CE)("span",Pi,"å¼€å§‹åˆ†æž"))],8,$i)):(0,o.Q3)("",!0)])])])):(0,o.Q3)("",!0)])}function _i(){return localStorage.getItem("token")||""}function Ri(e,t){const s=(new Date).toISOString();console.log(`\nðŸ–¼ï¸ === å›¾ç‰‡åˆ†æž ${e} APIè°ƒç”¨ ===`),console.log(`â° æ—¶é—´: ${s}`),console.log("ðŸ“¤ æ•°æ®:",t)}function xi(e,t){console.log("ðŸ“¥ å“åº”:",t),console.log(`ðŸ–¼ï¸ === å›¾ç‰‡åˆ†æž ${e} APIå®Œæˆ ===\n`)}async function Xi(e,t=null,s="GET"){const a=e.startsWith("/")?e:`/${e}`;try{Ri(e,t);const o=_i(),i={"Content-Type":"application/json"};o&&(i["Authorization"]=`Bearer ${o}`);const n={method:s,headers:i};t&&"GET"!==s&&(n.body=JSON.stringify(t));const r=await fetch(a,n);if(!r.ok){if(401===r.status)throw console.warn("ðŸ”’ æœªè®¤è¯æˆ–tokenå¤±æ•ˆ"),new Error("æœªè®¤è¯ï¼Œè¯·é‡æ–°ç™»å½•");throw new Error(`HTTP ${r.status}: ${r.statusText}`)}const l=await r.json();return xi(e,l),l}catch(o){throw console.error(`âŒ å›¾ç‰‡åˆ†æžAPIè°ƒç”¨å¤±è´¥ ${e}:`,o.message),o}}class Ui{constructor(){this.supportedFormats=["image/jpeg","image/png","image/gif","image/webp","image/bmp"],this.maxFileSize=52428800}validateImageFile(e){const t=[];return e?(this.supportedFormats.includes(e.type)||t.push(`ä¸æ”¯æŒçš„å›¾ç‰‡æ ¼å¼: ${e.type}ï¼Œæ”¯æŒæ ¼å¼: ${this.supportedFormats.join(", ")}`),e.size>this.maxFileSize&&t.push(`æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶: ${(e.size/1024/1024).toFixed(2)}MBï¼Œæœ€å¤§æ”¯æŒ: ${this.maxFileSize/1024/1024}MB`),{isValid:0===t.length,errors:t}):(t.push("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶"),{isValid:!1,errors:t})}async uploadAndAnalyze(e,t=""){try{const s=this.validateImageFile(e);if(!s.isValid)throw new Error(s.errors.join(", "));ai.info("å¼€å§‹ä¸Šä¼ å¹¶åˆ†æžå›¾ç‰‡",{fileName:e.name,fileSize:e.size,fileType:e.type,customPrompt:t});const a=new FormData;a.append("image",e),t&&a.append("custom_prompt",t);const o=await fetch("/api/image-analysis/upload-analyze",{method:"POST",headers:{Authorization:`Bearer ${_i()}`},body:a});if(!o.ok){const e=await o.json().catch(()=>({}));throw new Error(e.error||e.message||`HTTP ${o.status}`)}const i=await o.json();if(i.success)return ai.success("å›¾ç‰‡åˆ†æžæˆåŠŸ",{imageUrl:i.imageUrl,analysis:i.analysis}),i;throw new Error(i.error||"å›¾ç‰‡åˆ†æžå¤±è´¥")}catch(s){throw ai.error("å›¾ç‰‡åˆ†æžå¤±è´¥",s),s}}async analyzeImageUrl(e,t=""){try{if(!e||!e.trim())throw new Error("è¯·æä¾›æœ‰æ•ˆçš„å›¾ç‰‡URL");ai.info("å¼€å§‹åˆ†æžç½‘ç»œå›¾ç‰‡",{imageUrl:e,customPrompt:t});const s={image_url:e.trim()};t&&(s.custom_prompt=t);const a=await Xi("/api/image-analysis/analyze-url",s,"POST");if(a.success)return ai.success("ç½‘ç»œå›¾ç‰‡åˆ†æžæˆåŠŸ",{imageUrl:a.imageUrl,analysis:a.analysis}),a;throw new Error(a.error||"å›¾ç‰‡åˆ†æžå¤±è´¥")}catch(s){throw ai.error("ç½‘ç»œå›¾ç‰‡åˆ†æžå¤±è´¥",s),s}}getSupportedFormats(){return this.supportedFormats}getMaxFileSize(){return this.maxFileSize}formatFileSize(e){if(0===e)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,a)).toFixed(2))+" "+s[a]}}const Vi=new Ui;var Bi=Vi,Ni={name:"ImageAnalysisModal",emits:["close","analysisComplete","showToast"],props:{visible:{type:Boolean,default:!1},preSelectedFile:{type:File,default:null}},data(){return{selectedFile:null,previewUrl:"",customPrompt:"",isDragOver:!1,isUploading:!1,analysisResult:null,errorMessage:""}},watch:{preSelectedFile:{handler(e){e&&this.selectFile(e)},immediate:!0}},methods:{closeModal(){this.$emit("close"),this.resetForm()},resetForm(){this.selectedFile=null,this.previewUrl="",this.customPrompt="",this.isDragOver=!1,this.isUploading=!1,this.analysisResult=null,this.errorMessage=""},triggerFileSelect(){this.selectedFile||this.isUploading||this.$refs.fileInput.click()},handleFileSelect(e){const t=e.target.files[0];t&&this.selectFile(t)},handleDrop(e){e.preventDefault(),this.isDragOver=!1;const t=e.dataTransfer.files;t.length>0&&this.selectFile(t[0])},selectFile(e){const t=Bi.validateImageFile(e);t.isValid?(this.selectedFile=e,this.previewUrl=URL.createObjectURL(e),this.errorMessage="",this.analysisResult=null):this.showError(t.errors.join(", "))},removeImage(){this.previewUrl&&URL.revokeObjectURL(this.previewUrl),this.selectedFile=null,this.previewUrl="",this.analysisResult=null},async analyzeImage(){if(this.selectedFile)try{this.isUploading=!0,this.errorMessage="",this.analysisResult=null,ai.info("å¼€å§‹åˆ†æžä¸Šä¼ çš„å›¾ç‰‡",{fileName:this.selectedFile.name,customPrompt:this.customPrompt});const e=await Bi.uploadAndAnalyze(this.selectedFile,this.customPrompt);this.analysisResult=e,this.showSuccess("å›¾ç‰‡åˆ†æžå®Œæˆï¼"),this.$emit("analysisComplete",e)}catch(e){ai.error("å›¾ç‰‡åˆ†æžå¤±è´¥",e),this.showError(e.message||"å›¾ç‰‡åˆ†æžå¤±è´¥")}finally{this.isUploading=!1}},formatFileSize(e){return Bi.formatFileSize(e)},showSuccess(e){this.$emit("showToast",e,"success")},showError(e){this.errorMessage=e}},beforeUnmount(){this.previewUrl&&URL.revokeObjectURL(this.previewUrl)}};const Oi=(0,l.A)(Ni,[["render",Fi],["__scopeId","data-v-408617e0"]]);var qi=Oi,zi={name:"MessageInput",components:{ImageAnalysisModal:qi},data(){return{inputText:"",isListening:!1,isProcessing:!1,recognitionResult:null,recognitionStatusText:"æ­£åœ¨è¯†åˆ«ä¸­...",selectedFile:null,showImageAnalysisModal:!1,mediaRecorder:null,audioChunks:[],recordingTime:0,recordingTimer:null,stream:null,touchStartY:0,touchStartTime:0,shouldCancel:!1,isVoiceMode:!1,showPlusMenu:!1}},mounted(){document.addEventListener("click",this.handleGlobalClick)},beforeUnmount(){document.removeEventListener("click",this.handleGlobalClick),this.isProcessing&&ci.resetProcessingStatus(),this.stream&&this.stream.getTracks().forEach(e=>e.stop()),this.stopRecordingTimer()},methods:{sendMessage(){this.inputText.trim()&&!this.isProcessing&&(ai.user("å‘é€æ–‡æœ¬æ¶ˆæ¯",{message:this.inputText}),this.$emit("sendMessage",this.inputText),this.inputText="")},toggleVoiceMode(){this.isProcessing||(this.isVoiceMode=!this.isVoiceMode,this.isVoiceMode?(this.showToast("å·²åˆ‡æ¢åˆ°è¯­éŸ³è¾“å…¥æ¨¡å¼","info"),this.$nextTick(()=>{const e=this.$el.querySelector(".voice-input-area");e&&e.focus()})):(this.showToast("å·²åˆ‡æ¢åˆ°æ–‡å­—è¾“å…¥æ¨¡å¼","info"),this.$nextTick(()=>{const e=this.$el.querySelector(".message-input");e&&e.focus()})))},async startVoiceInput(e){!this.isProcessing&&this.isVoiceMode&&("touchstart"===e.type?(this.touchStartY=e.touches[0].clientY,this.touchStartTime=Date.now()):(this.touchStartY=e.clientY,this.touchStartTime=Date.now()),this.shouldCancel=!1,await this.startRecording())},endVoiceInput(){this.isListening&&(this.shouldCancel?this.cancelRecording():this.stopVoiceInput())},handleTouchMove(e){if(!this.isListening)return;const t=e.touches[0].clientY,s=this.touchStartY-t;this.shouldCancel=s>50},cancelVoiceInput(){this.isListening&&this.cancelRecording()},async startRecording(){try{ai.info("å¼€å§‹å®žæ—¶å½•éŸ³"),this.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}});let e="audio/wav";MediaRecorder.isTypeSupported("audio/wav")?e="audio/wav":MediaRecorder.isTypeSupported("audio/mp4")?e="audio/mp4":MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?e="audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")&&(e="audio/webm"),this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:e}),this.audioChunks=[],this.recordingTime=0,this.mediaRecorder.start(),this.isListening=!0,this.startRecordingTimer(),this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.audioChunks.push(e.data)},this.mediaRecorder.onstop=()=>{this.handleRecordingComplete()},ai.success("å®žæ—¶å½•éŸ³å¼€å§‹")}catch(e){ai.error("å¯åŠ¨å½•éŸ³å¤±è´¥",e),this.showToast("æ— æ³•è®¿é—®éº¦å…‹é£Žï¼Œè¯·æ£€æŸ¥æƒé™è®¾ç½®","error"),this.fallbackToFileInput()}},stopVoiceInput(){this.mediaRecorder&&this.isListening&&(ai.info("åœæ­¢å®žæ—¶å½•éŸ³"),this.mediaRecorder.stop(),this.isListening=!1,this.stopRecordingTimer(),this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null))},cancelRecording(){this.mediaRecorder&&this.isListening&&(ai.info("å–æ¶ˆå½•éŸ³"),this.mediaRecorder.stop(),this.isListening=!1,this.stopRecordingTimer(),this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null),this.audioChunks=[],this.recordingTime=0,this.shouldCancel=!1,this.showToast("å½•éŸ³å·²å–æ¶ˆ","info"))},startRecordingTimer(){this.recordingTimer=setInterval(()=>{this.recordingTime++},1e3)},stopRecordingTimer(){this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null)},async handleRecordingComplete(){try{if(0===this.audioChunks.length)return void this.showToast("å½•éŸ³å¤±è´¥ï¼Œæ²¡æœ‰å½•åˆ¶åˆ°éŸ³é¢‘","error");const e=new Blob(this.audioChunks,{type:this.mediaRecorder.mimeType}),t=await this.convertAudioFormat(e);ai.info("å½•éŸ³å®Œæˆï¼Œå¼€å§‹å¤„ç†",{fileName:t.name,fileSize:t.size,duration:this.recordingTime,originalType:this.mediaRecorder.mimeType,convertedType:t.type}),this.isVoiceMode?await this.sendVoiceMessage(t):await this.processAudioFile(t)}catch(e){ai.error("å¤„ç†å½•éŸ³å¤±è´¥",e),this.showToast(`å¤„ç†å½•éŸ³å¤±è´¥: ${e.message}`,"error")}finally{this.audioChunks=[],this.recordingTime=0,this.mediaRecorder=null}},async convertAudioFormat(e){try{const t=["audio/wav","audio/mpeg","audio/mp4","audio/aac","audio/flac"];if(t.includes(e.type))return new File([e],`recording_${Date.now()}.wav`,{type:e.type});const s=new(window.AudioContext||window.webkitAudioContext),a=await e.arrayBuffer(),o=await s.decodeAudioData(a),i=this.audioBufferToWav(o),n=new File([i],`recording_${Date.now()}.wav`,{type:"audio/wav"});return ai.info("éŸ³é¢‘æ ¼å¼è½¬æ¢å®Œæˆ",{originalType:e.type,convertedType:"audio/wav",originalSize:e.size,convertedSize:n.size}),n}catch(t){return ai.error("éŸ³é¢‘æ ¼å¼è½¬æ¢å¤±è´¥",t),this.showToast("éŸ³é¢‘æ ¼å¼è½¬æ¢å¤±è´¥ï¼Œä½¿ç”¨åŽŸå§‹æ ¼å¼","warning"),new File([e],`recording_${Date.now()}.wav`,{type:"audio/wav"})}},audioBufferToWav(e){const t=e.length,s=e.numberOfChannels,a=e.sampleRate,o=new ArrayBuffer(44+t*s*2),i=new DataView(o),n=(e,t)=>{for(let s=0;s<t.length;s++)i.setUint8(e+s,t.charCodeAt(s))};n(0,"RIFF"),i.setUint32(4,36+t*s*2,!0),n(8,"WAVE"),n(12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,s,!0),i.setUint32(24,a,!0),i.setUint32(28,a*s*2,!0),i.setUint16(32,2*s,!0),i.setUint16(34,16,!0),n(36,"data"),i.setUint32(40,t*s*2,!0);let r=44;for(let l=0;l<t;l++)for(let t=0;t<s;t++){const s=Math.max(-1,Math.min(1,e.getChannelData(t)[l]));i.setInt16(r,s<0?32768*s:32767*s,!0),r+=2}return new Blob([o],{type:"audio/wav"})},async sendVoiceMessage(e){try{this.isProcessing=!0,this.recognitionStatusText="æ­£åœ¨å¤„ç†è¯­éŸ³æ¶ˆæ¯...",ai.info("å¼€å§‹å¤„ç†è¯­éŸ³æ¶ˆæ¯",{fileName:e.name,fileSize:e.size});const t=ci.validateAudioFile(e);if(!t.isValid)throw new Error(t.errors.join(", "));this.recognitionStatusText="æ­£åœ¨è¯†åˆ«ä¸­ï¼Œè¯·ç¨å€™...";const s=await ci.recognizeVoice(e);if(!s.success)throw new Error("è¯†åˆ«å¤±è´¥");this.$emit("sendVoiceMessage",{type:"voice",audioFile:e,transcription:s.transcription,audioUrl:s.audioUrl,duration:this.recordingTime}),ai.success("è¯­éŸ³æ¶ˆæ¯å‘é€æˆåŠŸ",{transcription:s.transcription}),this.showToast("è¯­éŸ³æ¶ˆæ¯å‘é€æˆåŠŸï¼","success")}catch(t){ai.error("è¯­éŸ³æ¶ˆæ¯å‘é€å¤±è´¥",t),this.recognitionStatusText="å‘é€å¤±è´¥",this.showToast(`è¯­éŸ³æ¶ˆæ¯å‘é€å¤±è´¥: ${t.message}`,"error")}finally{this.isProcessing=!1,this.isListening=!1,this.selectedFile=null,this.$refs.fileInput&&(this.$refs.fileInput.value="")}},async processAudioFile(e){try{this.isProcessing=!0,this.recognitionStatusText="æ­£åœ¨ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶...",ai.info("å¼€å§‹è¯­éŸ³è¯†åˆ«",{fileName:e.name,fileSize:e.size});const t=ci.validateAudioFile(e);if(!t.isValid)throw new Error(t.errors.join(", "));this.recognitionStatusText="æ­£åœ¨è¯†åˆ«ä¸­ï¼Œè¯·ç¨å€™...";const s=await ci.recognizeVoice(e);if(!s.success)throw new Error("è¯†åˆ«å¤±è´¥");this.recognitionResult=s,this.recognitionStatusText="è¯†åˆ«å®Œæˆ",ai.success("è¯­éŸ³è¯†åˆ«æˆåŠŸ",{transcription:s.transcription}),this.inputText=s.transcription,this.showToast("è¯­éŸ³è¯†åˆ«æˆåŠŸï¼","success")}catch(t){ai.error("è¯­éŸ³è¯†åˆ«å¤±è´¥",t),this.recognitionStatusText="è¯†åˆ«å¤±è´¥",this.showToast(`è¯­éŸ³è¯†åˆ«å¤±è´¥: ${t.message}`,"error")}finally{this.isProcessing=!1,this.isListening=!1,this.selectedFile=null,this.$refs.fileInput&&(this.$refs.fileInput.value="")}},fallbackToFileInput(){ai.info("å›žé€€åˆ°æ–‡ä»¶é€‰æ‹©æ¨¡å¼"),this.$refs.fileInput.click()},async handleFileSelect(e){const t=e.target.files[0];if(t)try{this.selectedFile=t,await this.processAudioFile(t)}catch(s){ai.error("æ–‡ä»¶å¤„ç†å¤±è´¥",s),this.showToast(`æ–‡ä»¶å¤„ç†å¤±è´¥: ${s.message}`,"error")}else this.stopVoiceInput()},editRecognitionResult(){this.recognitionResult&&(this.inputText=this.recognitionResult.transcription,this.clearRecognitionResult(),this.$nextTick(()=>{const e=this.$el.querySelector(".message-input");e&&e.focus()}))},sendRecognitionResult(){this.recognitionResult&&(this.inputText=this.recognitionResult.transcription,this.sendMessage(),this.clearRecognitionResult())},clearRecognitionResult(){this.recognitionResult=null},getVoiceButtonIcon(){return this.isProcessing?"spinner":this.isListening?"microphone-slash":"microphone"},getVoiceButtonTitle(){return this.isProcessing?"æ­£åœ¨è¯†åˆ«ä¸­...":(this.isListening,"æŒ‰ä½è¯´è¯")},getVoicePlaceholderText(){return this.isListening?"å½•éŸ³ä¸­":"æŒ‰ä½è¯´è¯"},showToast(e,t="info"){this.$toast?this.$toast[t]?.(e)||this.$toast(e):console.log(`[${t.toUpperCase()}] ${e}`)},handleGlobalClick(e){e.target.closest(".plus-btn")||e.target.closest(".function-panel")||this.showPlusMenu&&(this.showPlusMenu=!1)},togglePlusMenu(){this.showPlusMenu=!this.showPlusMenu,ai.info("åˆ‡æ¢åŠ å·èœå•",{show:this.showPlusMenu})},openPhotoLibrary(){this.showPlusMenu=!1,this.$refs.imageInput.click(),ai.info("æ‰“å¼€ç›¸å†Œé€‰æ‹©å›¾ç‰‡")},openCamera(){this.showPlusMenu=!1;const e=document.createElement("input");e.type="file",e.accept="image/*",e.capture="camera",e.style.display="none",e.onchange=t=>{const s=t.target.files[0];s&&this.handleImageSelect({target:{files:[s]}}),document.body.removeChild(e)},document.body.appendChild(e),e.click(),ai.info("æ‰“å¼€ç›¸æœºæ‹ç…§")},async handleImageSelect(e){const t=e.target.files[0];if(t)if(ai.info("é€‰æ‹©å›¾ç‰‡æ–‡ä»¶",{fileName:t.name,fileSize:t.size,fileType:t.type}),t.type.startsWith("image/"))try{this.isProcessing=!0,this.recognitionStatusText="æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...";const e=await this.uploadImageToOSS(t);this.recognitionStatusText="æ­£åœ¨åˆ†æžå›¾ç‰‡...";const s=await this.analyzeImageByURL(e,"è¯·åˆ†æžè¿™å¼ å›¾ç‰‡çš„å†…å®¹");if(!s||!s.content)throw new Error("å›¾ç‰‡åˆ†æžå¤±è´¥æˆ–è¿”å›žç»“æžœä¸ºç©º");{const a={type:"image",fileName:t.name,fileSize:t.size,imageUrl:e};this.$emit("sendMessage",a),this.$emit("aiReply",s.content),this.showToast("å›¾ç‰‡ä¸Šä¼ åˆ†æžå®Œæˆï¼","success"),ai.info("å›¾ç‰‡åˆ†æžå®Œæˆï¼Œå·²å‘é€ç”¨æˆ·å›¾ç‰‡å’ŒAIå›žå¤",{fileName:t.name,imageUrl:e,analysisContent:s.content})}}catch(s){ai.error("å›¾ç‰‡å¤„ç†å¤±è´¥",s),this.showToast(`å›¾ç‰‡å¤„ç†å¤±è´¥: ${s.message}`,"error")}finally{this.isProcessing=!1,this.selectedFile=null,this.$refs.imageInput&&(this.$refs.imageInput.value="")}else this.showToast("è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶","error")},openImageAnalysis(){this.showImageAnalysisModal=!0,ai.info("æ‰“å¼€å›¾ç‰‡åˆ†æžæ¨¡æ€æ¡†")},closeImageAnalysisModal(){this.showImageAnalysisModal=!1,ai.info("å…³é—­å›¾ç‰‡åˆ†æžæ¨¡æ€æ¡†")},formatFileSize(e){if(0===e)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,a)).toFixed(2))+" "+s[a]},async uploadImageToOSS(e){try{const t=new FormData;t.append("image",e);const s=await fetch("/api/image-analysis/upload",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:t});if(!s.ok)throw new Error("å›¾ç‰‡ä¸Šä¼ å¤±è´¥");const a=await s.json();if(a.success&&a.imageUrl)return ai.info("å›¾ç‰‡ä¸Šä¼ æˆåŠŸ",{imageUrl:a.imageUrl}),a.imageUrl;throw ai.error("å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¿”å›žç»“æžœ:",a),new Error(a.error||"å›¾ç‰‡ä¸Šä¼ å¤±è´¥")}catch(t){throw ai.error("å›¾ç‰‡ä¸Šä¼ å¤±è´¥",t),new Error(`å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ${t.message}`)}},async analyzeImageByURL(e,t){try{const s=await fetch("/api/image-analysis/analyze-url",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({imageUrl:e,prompt:t||"è¯·åˆ†æžè¿™å¼ å›¾ç‰‡çš„å†…å®¹"})});if(!s.ok)throw new Error("å›¾ç‰‡åˆ†æžå¤±è´¥");const a=await s.json();if(ai.info("å›¾ç‰‡åˆ†æžAPIè¿”å›žç»“æžœ",{success:a.success,hasAnalysis:!!a.analysis,resultKeys:Object.keys(a),result:a}),a.success&&a.analysis)return ai.info("å›¾ç‰‡åˆ†æžæˆåŠŸ",{analysis:a.analysis}),a.analysis;if(a.success&&a.praise&&a.praise.content)return ai.info("å›¾ç‰‡åˆ†æžæˆåŠŸï¼ˆpraiseæ ¼å¼ï¼‰",{praise:a.praise}),{content:a.praise.content};if(a.success&&a.content)return ai.info("å›¾ç‰‡åˆ†æžæˆåŠŸï¼ˆcontentæ ¼å¼ï¼‰",{content:a.content}),{content:a.content};if(a.success&&a.data)return ai.info("å›¾ç‰‡åˆ†æžæˆåŠŸï¼ˆdataæ ¼å¼ï¼‰",{data:a.data}),a.data;throw ai.error("å›¾ç‰‡åˆ†æžè¿”å›žæ•°æ®ç»“æž„å¼‚å¸¸",{result:a}),new Error(a.error||"å›¾ç‰‡åˆ†æžè¿”å›žæ•°æ®ç»“æž„å¼‚å¸¸")}catch(s){throw ai.error("å›¾ç‰‡åˆ†æžå¤±è´¥",s),new Error(`å›¾ç‰‡åˆ†æžå¤±è´¥: ${s.message}`)}},handleImageAnalysisComplete(e){ai.info("å›¾ç‰‡åˆ†æžå®Œæˆ",e);const t=`ðŸ–¼ï¸ å›¾ç‰‡åˆ†æžç»“æžœï¼š\n\n${e.analysis.content}`;this.$emit("sendMessage",t),this.closeImageAnalysisModal(),this.showToast("å›¾ç‰‡åˆ†æžå®Œæˆï¼Œå·²å‘é€ç»“æžœï¼","success")}}};const ji=(0,l.A)(zi,[["render",Ho],["__scopeId","data-v-5d09d33d"]]);var Ki=ji;const Wi={class:"modal-header"},Qi={class:"modal-body"},Gi={class:"setting-item"},Hi={class:"input-group"},Ji={class:"char-count"},Yi={class:"setting-item"},Zi={class:"heart-value-display"},en={class:"heart-number"},tn={class:"modal-footer"},sn=["disabled"];function an(e,t,s,i,n,r){const l=(0,o.g2)("font-awesome-icon");return s.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"modal-overlay",onClick:t[5]||(t[5]=(...e)=>r.closeModal&&r.closeModal(...e))},[(0,o.Lk)("div",{class:"modal-content",onClick:t[4]||(t[4]=(0,a.D$)(()=>{},["stop"]))},[(0,o.Lk)("div",Wi,[t[6]||(t[6]=(0,o.Lk)("h3",null,"AIåŠ©æ‰‹è®¾ç½®",-1)),(0,o.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>r.closeModal&&r.closeModal(...e))},[(0,o.bF)(l,{icon:"times"})])]),(0,o.Lk)("div",Qi,[(0,o.Lk)("div",Gi,[t[7]||(t[7]=(0,o.Lk)("label",{for:"assistant-name"},"åŠ©æ‰‹åç§°",-1)),(0,o.Lk)("div",Hi,[(0,o.bo)((0,o.Lk)("input",{id:"assistant-name","onUpdate:modelValue":t[1]||(t[1]=e=>n.assistantName=e),type:"text",placeholder:"è¯·è¾“å…¥AIåŠ©æ‰‹åç§°",maxlength:"50",class:"name-input"},null,512),[[a.Jo,n.assistantName]]),(0,o.Lk)("span",Ji,(0,h.v_)(n.assistantName.length)+"/50",1)]),t[8]||(t[8]=(0,o.Lk)("small",{class:"help-text"},"ä¸ºä½ çš„AIåŠ©æ‰‹èµ·ä¸€ä¸ªä¸“å±žåå­—å§ï¼",-1))]),(0,o.Lk)("div",Yi,[t[10]||(t[10]=(0,o.Lk)("label",null,"å½“å‰å¿ƒåŠ¨å€¼",-1)),(0,o.Lk)("div",Zi,[(0,o.bF)(l,{icon:"heart",class:"heart-icon"}),(0,o.Lk)("span",en,(0,h.v_)(r.currentHeartValue),1),t[9]||(t[9]=(0,o.Lk)("span",{class:"heart-text"},"ç‚¹",-1))]),t[11]||(t[11]=(0,o.Lk)("small",{class:"help-text"},"æ¯æ¬¡å¯¹è¯éƒ½ä¼šå¢žåŠ å¿ƒåŠ¨å€¼ï¼Œä½“çŽ°ä½ ä»¬çš„äº²å¯†åº¦",-1))])]),(0,o.Lk)("div",tn,[(0,o.Lk)("button",{class:"btn btn-secondary",onClick:t[2]||(t[2]=(...e)=>r.closeModal&&r.closeModal(...e))},"å–æ¶ˆ"),(0,o.Lk)("button",{class:"btn btn-primary",onClick:t[3]||(t[3]=(...e)=>r.saveSettings&&r.saveSettings(...e)),disabled:!n.assistantName.trim()||n.isSaving},[n.isSaving?((0,o.uX)(),(0,o.Wv)(l,{key:0,icon:"spinner",spin:""})):(0,o.Q3)("",!0),(0,o.eW)(" "+(0,h.v_)(n.isSaving?"ä¿å­˜ä¸­...":"ä¿å­˜"),1)],8,sn)])])])):(0,o.Q3)("",!0)}var on={name:"AssistantSettingsModal",props:{visible:{type:Boolean,default:!1},assistant:{type:Object,default:null}},data(){return{assistantName:"",isSaving:!1}},computed:{currentHeartValue(){return this.assistant?.heartValue||0}},watch:{visible(e){e&&this.assistant&&(this.assistantName=this.assistant.name||"")},assistant:{handler(e){e&&this.visible&&(this.assistantName=e.name||"")},immediate:!0}},methods:{closeModal(){this.$emit("close")},async saveSettings(){if(this.assistantName.trim())try{this.isSaving=!0,await this.$emit("save",this.assistantName.trim()),this.closeModal()}catch(e){console.error("ä¿å­˜è®¾ç½®å¤±è´¥:",e)}finally{this.isSaving=!1}}}};const nn=(0,l.A)(on,[["render",an],["__scopeId","data-v-65f84830"]]);var rn=nn;const ln={key:0,class:"voice-recognition-status"},cn={class:"status-icon"},dn={class:"status-content"},un={class:"status-title"},hn={class:"status-message"},mn={key:0,class:"progress-bar"};function gn(e,t,s,a,i,n){const r=(0,o.g2)("font-awesome-icon");return n.showStatus?((0,o.uX)(),(0,o.CE)("div",ln,[(0,o.Lk)("div",{class:(0,h.C4)(["status-container",n.statusType])},[(0,o.Lk)("div",cn,[(0,o.bF)(r,{icon:n.statusIcon,class:(0,h.C4)({spin:n.isProcessing,pulse:n.isSuccess})},null,8,["icon","class"])]),(0,o.Lk)("div",dn,[(0,o.Lk)("div",un,(0,h.v_)(n.statusTitle),1),(0,o.Lk)("div",hn,(0,h.v_)(n.statusMessage),1),n.showProgress?((0,o.uX)(),(0,o.CE)("div",mn,[(0,o.Lk)("div",{class:"progress-fill",style:(0,h.Tr)({width:n.progressPercent+"%"})},null,4)])):(0,o.Q3)("",!0)]),n.showClose?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"status-close",onClick:t[0]||(t[0]=(...e)=>n.closeStatus&&n.closeStatus(...e))},[(0,o.bF)(r,{icon:"times"})])):(0,o.Q3)("",!0)],2)])):(0,o.Q3)("",!0)}var pn={name:"VoiceRecognitionStatus",props:{show:{type:Boolean,default:!1},type:{type:String,default:"processing"},title:{type:String,default:""},message:{type:String,default:""},progress:{type:Number,default:0},closable:{type:Boolean,default:!0},autoClose:{type:Number,default:0}},data(){return{isVisible:!1,autoCloseTimer:null}},computed:{showStatus(){return this.show&&this.isVisible},statusType(){return`status-${this.type}`},statusIcon(){const e={processing:"spinner",success:"check-circle",error:"exclamation-circle",warning:"exclamation-triangle"};return e[this.type]||"info-circle"},statusTitle(){if(this.title)return this.title;const e={processing:"æ­£åœ¨å¤„ç†",success:"å¤„ç†å®Œæˆ",error:"å¤„ç†å¤±è´¥",warning:"æ³¨æ„äº‹é¡¹"};return e[this.type]||"çŠ¶æ€ä¿¡æ¯"},statusMessage(){return this.message},showProgress(){return"processing"===this.type&&this.progress>0},progressPercent(){return Math.min(Math.max(this.progress,0),100)},showClose(){return this.closable&&"processing"!==this.type},isProcessing(){return"processing"===this.type},isSuccess(){return"success"===this.type}},watch:{show(e){e?this.showStatusBar():this.hideStatusBar()},type(e){"success"!==e&&"error"!==e||this.setupAutoClose()}},methods:{showStatusBar(){this.isVisible=!0,this.$emit("show")},hideStatusBar(){this.isVisible=!1,this.$emit("hide")},closeStatus(){this.hideStatusBar(),this.$emit("close")},setupAutoClose(){this.autoClose>0&&(this.clearAutoCloseTimer(),this.autoCloseTimer=setTimeout(()=>{this.closeStatus()},this.autoClose))},clearAutoCloseTimer(){this.autoCloseTimer&&(clearTimeout(this.autoCloseTimer),this.autoCloseTimer=null)}},mounted(){this.show&&this.showStatusBar()},beforeUnmount(){this.clearAutoCloseTimer()}};const kn=(0,l.A)(pn,[["render",gn],["__scopeId","data-v-20a1b3fc"]]);var vn=kn;const fn={baseURL:Ie(""),timeout:3e5,headers:{"Content-Type":"application/json"}};function yn(){try{const e=JSON.parse(localStorage.getItem("user")||"null");return e?._id||e?.id||null}catch(e){return null}}function bn(){return localStorage.getItem("token")||""}function wn(e,t){const s=(new Date).toISOString();console.log(`\nðŸŒ === ${e} APIè°ƒç”¨ ===`),console.log(`â° æ—¶é—´: ${s}`),console.log("ðŸ“¤ æ•°æ®:",t)}function Cn(e,t){console.log("ðŸ“¥ å“åº”:",t),console.log(`ðŸŒ === ${e} APIå®Œæˆ ===\n`)}async function Ln(e,t=null,s="GET"){const a=`${fn.baseURL}${e}`;try{wn(e,t);const o=new AbortController,i=setTimeout(()=>o.abort(),fn.timeout),n=bn(),r={...fn.headers};n&&(r["Authorization"]=`Bearer ${n}`);const l={method:s,headers:r,signal:o.signal};t&&"GET"!==s&&(l.body=JSON.stringify(t));const c=await fetch(a,l);if(clearTimeout(i),!c.ok)throw 401===c.status&&(console.warn("ðŸ”’ æœªè®¤è¯æˆ–tokenå¤±æ•ˆï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ"),"undefined"!==typeof window&&(window.location.href="/auth/login")),new Error(`HTTP ${c.status}: ${c.statusText}`);const d=await c.json();return Cn(e,d),d}catch(o){if("AbortError"===o.name)throw console.error(`âŒ APIè°ƒç”¨è¶…æ—¶ ${e}: ${fn.timeout}ms`),new Error(`è¯·æ±‚å¤±è´¥ï¼Œè¶…æ—¶ï¼š${fn.timeout}`);throw console.error(`âŒ APIè°ƒç”¨å¤±è´¥ ${e}:`,o.message),o}}class Tn{constructor(){this.userId=yn(),this.sessionId=this.generateSessionId(),console.log(`ðŸ¤– AIsiriæ™ºèƒ½è°ƒåº¦æœåŠ¡åˆå§‹åŒ–ï¼Œç”¨æˆ·ID: ${this.userId}`)}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}ensureUserIdOrRedirect(){return this.userId=yn(),!(!this.userId&&"undefined"!==typeof window)||(console.warn("âš ï¸ [AIsiri] æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ"),window.location.href="/auth/login",!1)}async healthCheck(){return await Ln("/dispatch/status")}async dispatch(e,t=null){if(console.log(`\nðŸš€ AIsiriæ™ºèƒ½è°ƒåº¦: "${e}"`),!this.ensureUserIdOrRedirect())return;const s={userInput:e.trim(),sessionId:t||this.sessionId,deviceInfo:{platform:"web",version:"2.0.0"}},a=await Ln("/dispatch",s,"POST");return a.success&&(console.log("âœ… æ™ºèƒ½è°ƒåº¦æˆåŠŸ"),console.log(`ðŸŽ¯ è¯†åˆ«æ„å›¾: ${a.data.intents?.join(", ")||"æ— "}`),console.log(`ðŸ”§ æ‰§è¡ŒæœåŠ¡: ${a.data.servicesExecuted?.join(", ")||"æ— "}`),a.data.servicesExecuted&&a.data.servicesExecuted.forEach(e=>{console.log(`âš™ï¸ æ‰§è¡ŒæœåŠ¡: ${e}`)}),a.data.taskCreated&&console.log(`ðŸ“ åˆ›å»ºä»»åŠ¡: ${a.data.taskCreated.title}`),a.data.scheduleAdjusted&&console.log("â° æ—¥ç¨‹å·²è°ƒæ•´"),a.data.emotionalSupport&&console.log(`ðŸ’ æä¾›æƒ…ç»ªæ”¯æŒ: ${a.data.emotionalSupport}`)),a}async getStatus(){return await Ln("/dispatch/status")}resetUserId(){this.userId=yn(),console.log(`ðŸ”„ é‡ç½®ç”¨æˆ·ID: ${this.userId}`)}getCurrentSessionId(){return this.sessionId}createNewSession(){return this.sessionId=this.generateSessionId(),console.log(`ðŸ†• åˆ›å»ºæ–°ä¼šè¯: ${this.sessionId}`),this.sessionId}}const Sn=new Tn;var In=Sn;function En(){return`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function Mn(e,t=To.AI,s=Lo.TEXT,a={}){return{id:En(),content:e,sender:t,type:s,timestamp:new Date,metadata:a,isUser:t===To.USER}}class An{constructor(){this.messages=[],this.isProcessing=!1,this.currentSessionId=null,this.addWelcomeMessage(),console.log("ðŸ’¬ AIsiriæ™ºèƒ½è°ƒåº¦æ¶ˆæ¯æœåŠ¡åˆå§‹åŒ–å®Œæˆ")}addWelcomeMessage(){const e=Mn("ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIæ™ºèƒ½åŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å¸®åŠ©ä½ åˆ›å»ºä»»åŠ¡ã€å®‰æŽ’æ—¥ç¨‹ã€æä¾›æƒ…ç»ªæ”¯æŒï¼Œä»¥åŠè°ƒç”¨å„ç§å¤–éƒ¨å·¥å…·ã€‚è¯·å‘Šè¯‰æˆ‘ä½ éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ",To.AI,Lo.TEXT);this.messages.push(e)}getMessages(){return[...this.messages]}addUserMessage(e,t=Lo.TEXT,s={}){let a=t;e&&e.startsWith("ðŸ–¼ï¸ å›¾ç‰‡ï¼š")&&(a="IMAGE");const o=Mn(e,To.USER,a,s);return this.messages.push(o),console.log(`ðŸ“ ç”¨æˆ·æ¶ˆæ¯: ${e}`),o}addAIMessage(e,t=Lo.TEXT,s={}){const a=Mn(e,To.AI,t,s);return this.messages.push(a),console.log(`ðŸ¤– AIå›žå¤: ${e.substring(0,50)}${e.length>50?"...":""}`),a}addAIReply(e,t=Lo.TEXT,s={}){const a=Mn(e,To.AI,t,s);return this.messages.push(a),console.log(`ðŸ¤– AIç›´æŽ¥å›žå¤: ${e.substring(0,50)}${e.length>50?"...":""}`),a}addVoiceMessage(e,t=!1){const s={id:Date.now()+Math.random(),type:Lo.VOICE,isUser:t,timestamp:new Date,duration:e.transcription?Math.ceil(e.transcription.length/5):3,transcription:e.transcription||"",audioUrl:e.audioUrl||"",audioFile:e.audioFile||null};return this.messages.push(s),console.log(`ðŸŽ¤ ${t?"ç”¨æˆ·":"AI"}è¯­éŸ³æ¶ˆæ¯å·²æ·»åŠ : ${e.transcription?.substring(0,50)||"æ— æ–‡å­—"}...`),s}addSystemMessage(e){const t=Mn(e,To.SYSTEM,Lo.TEXT);return this.messages.push(t),console.log(`âš™ï¸  ç³»ç»Ÿæ¶ˆæ¯: ${e}`),t}async processUserInput(e){if(this.isProcessing)console.log("â³ æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨ç­‰...");else try{this.isProcessing=!0,this.addUserMessage(e),console.log("\nðŸš€ å¼€å§‹æ™ºèƒ½è°ƒåº¦å¤„ç†...");const t=await In.dispatch(e,this.currentSessionId);await this.handleDispatchResponse(t)}catch(t){console.error("âŒ æ™ºèƒ½è°ƒåº¦å¤„ç†å¤±è´¥:",t),this.addAIMessage("æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›æŠ€æœ¯é—®é¢˜ã€‚è¯·ç¨åŽå†è¯•ï¼Œæˆ–è€…å°è¯•é‡æ–°æè¿°ä½ çš„éœ€æ±‚ã€‚",Lo.ERROR,{error:t.message})}finally{this.isProcessing=!1}}async processVoiceInput(e){if(this.isProcessing)console.log("â³ æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨ç­‰...");else try{this.isProcessing=!0,this.addVoiceMessage(e,!0),console.log("\nðŸš€ å¼€å§‹æ™ºèƒ½è°ƒåº¦å¤„ç†è¯­éŸ³è¾“å…¥...");const t=await In.dispatch(e.transcription,this.currentSessionId);await this.handleVoiceDispatchResponse(t,e)}catch(t){console.error("âŒ è¯­éŸ³æ™ºèƒ½è°ƒåº¦å¤„ç†å¤±è´¥:",t),this.addVoiceMessage({transcription:"æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›æŠ€æœ¯é—®é¢˜ã€‚è¯·ç¨åŽå†è¯•ï¼Œæˆ–è€…å°è¯•é‡æ–°æè¿°ä½ çš„éœ€æ±‚ã€‚",duration:3,isUser:!1},!1)}finally{this.isProcessing=!1}}async handleVoiceDispatchResponse(e){if(!e.success){const t=e.error||"æŠ±æ­‰ï¼Œç³»ç»Ÿé‡åˆ°äº†é—®é¢˜ã€‚";return void this.addAIMessage(t,Lo.ERROR,{apiError:e.error})}const{data:t}=e;if(this.addAIMessage(t.response,Lo.TEXT,{intents:t.intents,servicesExecuted:t.servicesExecuted,taskCreated:t.taskCreated,scheduleAdjusted:t.scheduleAdjusted,emotionalSupport:t.emotionalSupport,processingTime:e.processingTime,isVoiceInput:!0}),t.taskCreated&&this.addTaskCreatedMessage(t.taskCreated),t.scheduleAdjusted&&this.addScheduleAdjustedMessage(t.scheduleAdjusted),t.taskCreated||t.scheduleAdjusted)try{window.dispatchEvent(new CustomEvent("ai-dispatch-completed",{detail:{taskCreated:t.taskCreated,scheduleAdjusted:t.scheduleAdjusted,intents:t.intents}}))}catch(s){}}async handleDispatchResponse(e){if(!e.success){const t=e.error||"æŠ±æ­‰ï¼Œç³»ç»Ÿé‡åˆ°äº†é—®é¢˜ã€‚";return void this.addAIMessage(t,Lo.ERROR,{apiError:e.error})}const{data:t}=e;if(this.addAIMessage(t.response,Lo.TEXT,{intents:t.intents,servicesExecuted:t.servicesExecuted,taskCreated:t.taskCreated,scheduleAdjusted:t.scheduleAdjusted,emotionalSupport:t.emotionalSupport,processingTime:e.processingTime}),t.taskCreated&&this.addTaskCreatedMessage(t.taskCreated),t.scheduleAdjusted&&this.addScheduleAdjustedMessage(t.scheduleAdjusted),t.taskCreated||t.scheduleAdjusted)try{window.dispatchEvent(new CustomEvent("ai-dispatch-completed",{detail:{taskCreated:t.taskCreated,scheduleAdjusted:t.scheduleAdjusted,intents:t.intents}}))}catch(s){}}addTaskCreatedMessage(e){let t=`âœ… ä»»åŠ¡å·²åˆ›å»ºï¼š${e.title}`;e.scheduledTime&&(t+=`ï¼Œå®‰æŽ’åœ¨ ${e.date} ${e.scheduledTime}`),this.addAIMessage(t,Lo.TASK_CREATED,{task:e})}addScheduleAdjustedMessage(e){const t="â° æ—¥ç¨‹å·²æ ¹æ®ä½ çš„éœ€æ±‚è¿›è¡Œè°ƒæ•´";this.addAIMessage(t,Lo.SCHEDULE_ADJUSTED,{scheduleInfo:e})}isCurrentlyProcessing(){return this.isProcessing}getCurrentSessionId(){return this.currentSessionId}setSessionId(e){this.currentSessionId=e,console.log(`ðŸ”„ è®¾ç½®ä¼šè¯ID: ${e}`)}createNewSession(){return this.currentSessionId=In.createNewSession(),console.log(`ðŸ†• åˆ›å»ºæ–°ä¼šè¯: ${this.currentSessionId}`),this.currentSessionId}clearMessages(){this.messages=[],this.currentSessionId=null,this.addWelcomeMessage(),console.log("ðŸ§¹ æ¶ˆæ¯åŽ†å²å·²æ¸…é™¤")}exportMessages(){return{messages:this.getMessages(),sessionId:this.currentSessionId,timestamp:(new Date).toISOString()}}}const Dn=new An;var $n=Dn;function Pn(){return localStorage.getItem("token")||""}function Fn(e,t){const s=(new Date).toISOString();console.log(`\nðŸ¤– === AIåŠ©æ‰‹ ${e} APIè°ƒç”¨ ===`),console.log(`â° æ—¶é—´: ${s}`),console.log("ðŸ“¤ æ•°æ®:",t)}function _n(e,t){console.log("ðŸ“¥ å“åº”:",t),console.log(`ðŸ¤– === AIåŠ©æ‰‹ ${e} APIå®Œæˆ ===\n`)}async function Rn(e,t=null,s="GET"){const a=e.startsWith("/")?e:`/${e}`;try{Fn(e,t);const o=Pn(),i={"Content-Type":"application/json"};o&&(i["Authorization"]=`Bearer ${o}`);const n={method:s,headers:i};t&&"GET"!==s&&(n.body=JSON.stringify(t));const r=await fetch(a,n);if(!r.ok){if(401===r.status)throw console.warn("ðŸ”’ æœªè®¤è¯æˆ–tokenå¤±æ•ˆ"),new Error("æœªè®¤è¯ï¼Œè¯·é‡æ–°ç™»å½•");throw new Error(`HTTP ${r.status}: ${r.statusText}`)}const l=await r.json();return _n(e,l),l}catch(o){throw console.error(`âŒ AIåŠ©æ‰‹APIè°ƒç”¨å¤±è´¥ ${e}:`,o.message),o}}class xn{constructor(){this.assistant=null,this.listeners=[]}async getOrCreateAssistant(){try{const e=await Rn("/api/ai-assistant",null,"GET");if(e.success)return this.assistant=e.data,this.notifyListeners(),this.assistant;throw new Error(e.message||"èŽ·å–AIåŠ©æ‰‹å¤±è´¥")}catch(e){throw console.error("èŽ·å–AIåŠ©æ‰‹å¤±è´¥:",e),e}}async getAssistantInfo(){try{const e=await Rn("/api/ai-assistant/info",null,"GET");if(e.success)return this.assistant=e.data,this.notifyListeners(),this.assistant;throw new Error(e.message||"èŽ·å–AIåŠ©æ‰‹ä¿¡æ¯å¤±è´¥")}catch(e){throw console.error("èŽ·å–AIåŠ©æ‰‹ä¿¡æ¯å¤±è´¥:",e),e}}async updateAssistantName(e){try{const t=await Rn("/api/ai-assistant/name",{name:e},"PUT");if(t.success)return this.assistant=t.data,this.notifyListeners(),this.assistant;throw new Error(t.message||"æ›´æ–°AIåŠ©æ‰‹åç§°å¤±è´¥")}catch(t){throw console.error("æ›´æ–°AIåŠ©æ‰‹åç§°å¤±è´¥:",t),t}}async increaseHeartValue(){try{const e=await Rn("/api/ai-assistant/heart",null,"POST");if(e.success)return this.assistant=e.data,this.notifyListeners(),this.assistant;throw new Error(e.message||"å¢žåŠ å¿ƒåŠ¨å€¼å¤±è´¥")}catch(e){throw console.error("å¢žåŠ å¿ƒåŠ¨å€¼å¤±è´¥:",e),e}}getCurrentAssistant(){return this.assistant}addListener(e){this.listeners.push(e)}removeListener(e){const t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}notifyListeners(){this.listeners.forEach(e=>{try{e(this.assistant)}catch(t){console.error("ç›‘å¬å™¨æ‰§è¡Œå¤±è´¥:",t)}})}async initialize(){try{await this.getOrCreateAssistant(),console.log("ðŸ¤– AIåŠ©æ‰‹åˆå§‹åŒ–æˆåŠŸ:",this.assistant)}catch(e){console.error("ðŸ¤– AIåŠ©æ‰‹åˆå§‹åŒ–å¤±è´¥:",e),this.assistant={id:"default",name:"AIå­¦ä¹ åŠ©æ‰‹",heartValue:0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},this.notifyListeners()}}}const Xn=new xn;var Un=Xn,Vn={name:"AiSecretary",components:{AIHeader:Ma,MessageCard:$o,MessageInput:Ki,AssistantSettingsModal:rn,VoiceRecognitionStatus:vn},data(){return{isTyping:!1,messages:[],quickActions:Co,messageService:$n,connectionStatus:"connecting",errorMessage:null,assistant:null,showSettingsModal:!1,showVoiceStatus:!1,voiceStatusType:"processing",voiceStatusTitle:"",voiceStatusMessage:"",voiceStatusProgress:0,voiceStatusAutoClose:3e3}},methods:{async sendMessage(e){if("string"===typeof e){if(!e||!e.trim())return void ai.warn("å‘é€æ¶ˆæ¯å¤±è´¥ï¼šæ¶ˆæ¯å†…å®¹ä¸ºç©º");try{ai.user("å‘é€æ–‡æœ¬æ¶ˆæ¯",{message:e}),this.isTyping=!0,await this.messageService.processUserInput(e.trim()),this.updateMessages(),await this.increaseHeartValue()}catch(t){ai.error("å‘é€æ¶ˆæ¯å¤±è´¥",t),this.handleError("å‘é€æ¶ˆæ¯æ—¶å‡ºçŽ°é”™è¯¯ï¼Œè¯·ç¨åŽé‡è¯•")}finally{this.isTyping=!1,this.$nextTick(()=>{this.scrollToBottom()})}}else{if(!e||"image"!==e.type)return void ai.warn("å‘é€æ¶ˆæ¯å¤±è´¥ï¼šæ— æ•ˆçš„æ¶ˆæ¯æ ¼å¼");try{ai.user("å‘é€å›¾ç‰‡æ¶ˆæ¯",{fileName:e.fileName,fileSize:e.fileSize,imageUrl:e.imageUrl}),await this.messageService.addUserMessage(`ðŸ–¼ï¸ å›¾ç‰‡ï¼š${e.fileName} (${this.formatFileSize(e.fileSize)})`,"IMAGE",{imageUrl:e.imageUrl}),this.updateMessages(),this.$nextTick(()=>{this.scrollToBottom()})}catch(t){ai.error("å‘é€å›¾ç‰‡æ¶ˆæ¯å¤±è´¥",t),this.handleError("å‘é€å›¾ç‰‡æ¶ˆæ¯æ—¶å‡ºçŽ°é”™è¯¯ï¼Œè¯·ç¨åŽé‡è¯•")}}},formatFileSize(e){if(0===e)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,a)).toFixed(2))+" "+s[a]},async sendVoiceMessage(e){try{ai.user("å‘é€è¯­éŸ³æ¶ˆæ¯",{duration:e.duration,transcription:e.transcription}),e.transcription&&(this.isTyping=!0,await this.messageService.processVoiceInput(e),this.updateMessages(),await this.increaseHeartValue())}catch(t){ai.error("å‘é€è¯­éŸ³æ¶ˆæ¯å¤±è´¥",t),this.handleError("å‘é€è¯­éŸ³æ¶ˆæ¯å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{this.isTyping=!1,this.$nextTick(()=>{this.scrollToBottom()})}},async sendQuickMessage(e){ai.user("ä½¿ç”¨å¿«é€Ÿæ“ä½œ",{message:e}),await this.sendMessage(e)},updateMessages(){this.messages=this.messageService.getMessages(),ai.debug("æ¶ˆæ¯åˆ—è¡¨å·²æ›´æ–°",{messageCount:this.messages.length})},handleError(e){this.errorMessage=e,this.connectionStatus="error",setTimeout(()=>{this.errorMessage=null,this.connectionStatus="connected"},3e3)},async checkConnection(){try{ai.api("æ£€æŸ¥AIsiriæ™ºèƒ½è°ƒåº¦æœåŠ¡è¿žæŽ¥çŠ¶æ€"),this.connectionStatus="connecting";const e=await In.healthCheck();if(!e.success)throw new Error("å¥åº·æ£€æŸ¥å¤±è´¥");this.connectionStatus="connected",ai.success("AIsiriæ™ºèƒ½è°ƒåº¦æœåŠ¡è¿žæŽ¥æ­£å¸¸")}catch(e){ai.error("è¿žæŽ¥æ£€æŸ¥å¤±è´¥",e),this.connectionStatus="error",this.errorMessage="æ— æ³•è¿žæŽ¥åˆ°AIsiriæ™ºèƒ½è°ƒåº¦æœåŠ¡ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥"}},async reconnect(){ai.info("å°è¯•é‡æ–°è¿žæŽ¥AIsiriæ™ºèƒ½è°ƒåº¦æœåŠ¡"),await this.checkConnection()},clearMessages(){ai.user("æ¸…é™¤æ¶ˆæ¯åŽ†å²"),this.messageService.clearMessages(),this.updateMessages()},scrollToBottom(){this.$nextTick(()=>{const e=document.querySelector(".chat-container");e&&(e.scrollTop=e.scrollHeight)})},exportChatHistory(){const e=this.messageService.exportMessages();ai.table(e,"èŠå¤©è®°å½•å¯¼å‡º");const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`aisiri_chat_history_${(new Date).toISOString().slice(0,10)}.json`,a.click(),URL.revokeObjectURL(s)},async increaseHeartValue(){try{await Un.increaseHeartValue(),ai.info("å¿ƒåŠ¨å€¼å¢žåŠ æˆåŠŸ")}catch(e){ai.error("å¢žåŠ å¿ƒåŠ¨å€¼å¤±è´¥:",e)}},openSettingsModal(){this.showSettingsModal=!0},closeSettingsModal(){this.showSettingsModal=!1},async saveAssistantSettings(e){try{await Un.updateAssistantName(e),ai.success("AIåŠ©æ‰‹åç§°æ›´æ–°æˆåŠŸ:",e),this.$toast?.success?.(`AIåŠ©æ‰‹åç§°å·²æ›´æ–°ä¸º"${e}"`)||console.log(`AIåŠ©æ‰‹åç§°å·²æ›´æ–°ä¸º"${e}"`)}catch(t){throw ai.error("æ›´æ–°AIåŠ©æ‰‹åç§°å¤±è´¥:",t),this.$toast?.error?.(t.message||"æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•")||console.error("æ›´æ–°å¤±è´¥:",t.message),t}},async initializeAIAssistant(){try{Un.addListener(this.updateAssistantFromService),await Un.initialize(),this.assistant=Un.getCurrentAssistant(),ai.success("AIåŠ©æ‰‹åˆå§‹åŒ–å®Œæˆ:",this.assistant)}catch(e){ai.error("AIåŠ©æ‰‹åˆå§‹åŒ–å¤±è´¥:",e),this.assistant={id:"default",name:"AIå­¦ä¹ åŠ©æ‰‹",heartValue:0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}}},updateAssistantFromService(e){this.assistant=e,ai.debug("AIåŠ©æ‰‹ä¿¡æ¯å·²æ›´æ–°:",e)},showVoiceStatusBar(e,t,s,a=0,o=3e3){this.voiceStatusType=e,this.voiceStatusTitle=t,this.voiceStatusMessage=s,this.voiceStatusProgress=a,this.voiceStatusAutoClose=o,this.showVoiceStatus=!0,ai.info("æ˜¾ç¤ºè¯­éŸ³è¯†åˆ«çŠ¶æ€",{type:e,title:t,message:s,progress:a})},hideVoiceStatus(){this.showVoiceStatus=!1,ai.info("éšè—è¯­éŸ³è¯†åˆ«çŠ¶æ€")},updateVoiceStatusProgress(e){this.voiceStatusProgress=e},async handleAIReply(e){try{ai.info("æ”¶åˆ°AIå›žå¤",{content:e}),await this.messageService.addAIReply(e),this.updateMessages(),this.$nextTick(()=>{this.scrollToBottom()}),ai.success("AIå›žå¤å·²æ·»åŠ ")}catch(t){ai.error("å¤„ç†AIå›žå¤å¤±è´¥",t),this.handleError("å¤„ç†AIå›žå¤æ—¶å‡ºçŽ°é”™è¯¯ï¼Œè¯·ç¨åŽé‡è¯•")}},setupVoiceRecognitionListener(){const e=()=>{const e=ci.getProcessingStatus();e&&!this.showVoiceStatus?this.showVoiceStatusBar("processing","è¯­éŸ³è¯†åˆ«ä¸­","æ­£åœ¨å¤„ç†éŸ³é¢‘æ–‡ä»¶ï¼Œè¯·ç¨å€™...",0):!e&&this.showVoiceStatus&&"processing"===this.voiceStatusType&&this.hideVoiceStatus()};this.voiceStatusInterval=setInterval(e,500)}},async mounted(){ai.info("AIsiriæ™ºèƒ½è°ƒåº¦åŠ©æ‰‹é¡µé¢åˆå§‹åŒ–");try{await this.initializeAIAssistant(),this.updateMessages(),await this.checkConnection(),this.setupVoiceRecognitionListener(),this.scrollToBottom(),ai.success("AIsiriæ™ºèƒ½è°ƒåº¦åŠ©æ‰‹é¡µé¢åˆå§‹åŒ–å®Œæˆ")}catch(e){ai.error("é¡µé¢åˆå§‹åŒ–å¤±è´¥",e),this.handleError("åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•")}},beforeUnmount(){ai.info("AIsiriæ™ºèƒ½è°ƒåº¦åŠ©æ‰‹é¡µé¢å¸è½½"),Un.removeListener(this.updateAssistantFromService),this.voiceStatusInterval&&clearInterval(this.voiceStatusInterval)},watch:{messages:{handler(){this.$nextTick(()=>{this.scrollToBottom()})},deep:!0},connectionStatus(e){ai.info(`è¿žæŽ¥çŠ¶æ€å˜æ›´: ${e}`)}},computed:{isProcessing(){return this.messageService.isCurrentlyProcessing()||this.isTyping},connectionStatusText(){const e={connecting:"è¿žæŽ¥ä¸­...",connected:"å·²è¿žæŽ¥",error:"è¿žæŽ¥å¤±è´¥"};return e[this.connectionStatus]||"æœªçŸ¥çŠ¶æ€"},showError(){return"error"===this.connectionStatus&&this.errorMessage}}};const Bn=(0,l.A)(Vn,[["render",ya],["__scopeId","data-v-102246d8"]]);var Nn=Bn;const On={class:"collections-container"},qn={class:"header"},zn={key:0,class:"content"},jn={key:1,class:"empty-state"},Kn={key:1,class:"loading-container"};function Wn(e,t,s,a,i,n){const r=(0,o.g2)("font-awesome-icon"),l=(0,o.g2)("CollectionCard"),c=(0,o.g2)("LoadingSpinner"),d=(0,o.g2)("TabBar"),u=(0,o.g2)("CollectionModal"),h=(0,o.g2)("SubtaskModal");return(0,o.uX)(),(0,o.CE)("div",On,[(0,o.Lk)("div",qn,[t[2]||(t[2]=(0,o.Lk)("div",{class:"header-title"},"ä»»åŠ¡é›†",-1)),(0,o.Lk)("button",{class:"create-collection-btn",onClick:t[0]||(t[0]=(...e)=>n.openCreateCollectionModal&&n.openCreateCollectionModal(...e)),title:"åˆ›å»ºæ–°ä»»åŠ¡é›†"},[(0,o.bF)(r,{icon:"plus"})])]),i.loading?((0,o.uX)(),(0,o.CE)("div",Kn,[(0,o.bF)(c)])):((0,o.uX)(),(0,o.CE)("div",zn,[i.collections.length>0?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(i.collections,e=>((0,o.uX)(),(0,o.Wv)(l,{key:e._id,collection:e,onToggleExpansion:n.handleToggleExpansion,onAddSubtask:n.openAddSubtaskModal,onToggleSubtask:n.handleToggleSubtask},null,8,["collection","onToggleExpansion","onAddSubtask","onToggleSubtask"]))),128)):((0,o.uX)(),(0,o.CE)("div",jn,t[3]||(t[3]=[(0,o.Lk)("div",{class:"empty-icon"},"ðŸ“‹",-1),(0,o.Lk)("div",{class:"empty-title"},"æš‚æ— ä»»åŠ¡é›†",-1),(0,o.Lk)("div",{class:"empty-subtitle"},"ç‚¹å‡»å³ä¸Šè§’ + æŒ‰é’®åˆ›å»ºç¬¬ä¸€ä¸ªä»»åŠ¡é›†",-1)])))])),(0,o.Lk)("button",{class:"add-collection-btn",onClick:t[1]||(t[1]=(...e)=>n.openCreateCollectionModal&&n.openCreateCollectionModal(...e))},[(0,o.bF)(r,{icon:"plus"})]),(0,o.bF)(d),(0,o.bF)(u,{visible:i.showCollectionModal,collection:i.editingCollection,onClose:n.closeCollectionModal,onSubmit:n.handleCollectionSubmit},null,8,["visible","collection","onClose","onSubmit"]),(0,o.bF)(h,{visible:i.showSubtaskModal,"collection-id":i.currentCollectionId,subtask:i.editingSubtask,onClose:n.closeSubtaskModal,onSubmit:n.handleSubtaskSubmit},null,8,["visible","collection-id","subtask","onClose","onSubmit"])])}const Qn={class:"collection-card"},Gn={class:"collection-info"},Hn={class:"collection-name"},Jn={class:"collection-meta"},Yn={class:"collection-progress"},Zn={class:"progress-bar"},er={class:"collection-actions"},tr={key:1,class:"empty-state"};function sr(e,t,s,i,n,r){const l=(0,o.g2)("font-awesome-icon"),c=(0,o.g2)("SubtaskItem");return(0,o.uX)(),(0,o.CE)("div",Qn,[(0,o.Lk)("div",{class:"collection-header",onClick:t[1]||(t[1]=(...e)=>r.toggleExpansion&&r.toggleExpansion(...e))},[(0,o.Lk)("div",Gn,[(0,o.Lk)("div",Hn,(0,h.v_)(s.collection.name),1),(0,o.Lk)("div",Jn,[(0,o.Lk)("span",null,(0,h.v_)(s.collection.subtasks?.length||0)+"ä¸ªå­ä»»åŠ¡",1),(0,o.Lk)("div",Yn,[(0,o.Lk)("span",null,(0,h.v_)(r.progressPercentage)+"%",1),(0,o.Lk)("div",Zn,[(0,o.Lk)("div",{class:"progress-fill",style:(0,h.Tr)({width:r.progressPercentage+"%"})},null,4)])])])]),(0,o.Lk)("div",er,[(0,o.Lk)("button",{class:"add-subtask-btn",onClick:t[0]||(t[0]=(0,a.D$)(t=>e.$emit("add-subtask",s.collection._id),["stop"])),title:"æ·»åŠ å­ä»»åŠ¡"},[(0,o.bF)(l,{icon:"plus"})]),(0,o.Lk)("button",{class:(0,h.C4)(["expand-btn",{expanded:n.isExpanded}])},[(0,o.bF)(l,{icon:"chevron-down"})],2)])]),(0,o.Lk)("div",{class:(0,h.C4)(["subtasks",{expanded:n.isExpanded}]),style:(0,h.Tr)({maxHeight:n.isExpanded?70*s.collection.subtasks?.length+20+"px":"0px"})},[s.collection.subtasks&&s.collection.subtasks.length>0?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(s.collection.subtasks,s=>((0,o.uX)(),(0,o.Wv)(c,{key:s._id,subtask:s,onToggleSubtask:t[2]||(t[2]=t=>e.$emit("toggle-subtask",t))},null,8,["subtask"]))),128)):((0,o.uX)(),(0,o.CE)("div",tr,t[3]||(t[3]=[(0,o.Lk)("div",{class:"empty-icon"},"ðŸ“‹",-1),(0,o.Lk)("div",{class:"empty-title"},"æš‚æ— å­ä»»åŠ¡",-1),(0,o.Lk)("div",{class:"empty-subtitle"},"ç‚¹å‡»ä¸Šæ–¹ + æŒ‰é’®æ·»åŠ ç¬¬ä¸€ä¸ªå­ä»»åŠ¡",-1)])))],6)])}const ar={class:"subtask-item"},or={class:"subtask-content"},ir={class:"subtask-name"},nr={class:"subtask-time"};function rr(e,t,s,a,i,n){const r=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",ar,[(0,o.Lk)("div",{class:(0,h.C4)(["subtask-checkbox",{completed:s.subtask.completed}]),onClick:t[0]||(t[0]=t=>e.$emit("toggle-subtask",s.subtask._id))},[s.subtask.completed?((0,o.uX)(),(0,o.Wv)(r,{key:0,icon:"check",class:"check-icon"})):(0,o.Q3)("",!0)],2),(0,o.Lk)("div",or,[(0,o.Lk)("div",ir,(0,h.v_)(s.subtask.title),1),(0,o.Lk)("div",nr,(0,h.v_)(n.formatTime(s.subtask.estimatedTime)||"å¾…å®‰æŽ’"),1)]),(0,o.Lk)("div",{class:(0,h.C4)(["subtask-priority",`priority-${s.subtask.priority}`])},(0,h.v_)(i.priorityLabels[s.subtask.priority]||"ä¸­"),3)])}var lr={name:"SubtaskItem",props:{subtask:{type:Object,required:!0}},emits:["toggle-subtask"],data(){return{priorityLabels:{low:"ä½Ž",medium:"ä¸­",high:"é«˜"}}},methods:{formatTime(e){if(!e)return"";if(e<60)return`${e} åˆ†é’Ÿ`;const t=Math.floor(e/60),s=e%60;return 0===s?`${t} å°æ—¶`:`${t} å°æ—¶ ${s} åˆ†é’Ÿ`}}};const cr=(0,l.A)(lr,[["render",rr],["__scopeId","data-v-4571580b"]]);var dr=cr,ur={name:"CollectionCard",components:{SubtaskItem:dr},props:{collection:{type:Object,required:!0}},emits:["toggle-expansion","add-subtask","toggle-subtask"],data(){return{isExpanded:!1}},computed:{progressPercentage(){if(!this.collection.subtasks||0===this.collection.subtasks.length)return 0;const e=this.collection.subtasks.filter(e=>e.completed).length;return Math.round(e/this.collection.subtasks.length*100)}},methods:{toggleExpansion(){this.isExpanded=!this.isExpanded,this.$emit("toggle-expansion",this.collection._id,this.isExpanded)}}};const hr=(0,l.A)(ur,[["render",sr],["__scopeId","data-v-1161bf3c"]]);var mr=hr;const gr={class:"modal-header"},pr={class:"form-group"},kr={class:"modal-actions"},vr=["disabled"];function fr(e,t,s,i,n,r){return s.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"modal",onClick:t[4]||(t[4]=(...e)=>r.closeModal&&r.closeModal(...e))},[(0,o.Lk)("div",{class:"modal-content",onClick:t[3]||(t[3]=(0,a.D$)(()=>{},["stop"]))},[(0,o.Lk)("div",gr,(0,h.v_)(r.isEditing?"ç¼–è¾‘ä»»åŠ¡é›†":"åˆ›å»ºæ–°ä»»åŠ¡é›†"),1),(0,o.Lk)("form",{onSubmit:t[2]||(t[2]=(0,a.D$)((...e)=>r.handleSubmit&&r.handleSubmit(...e),["prevent"]))},[(0,o.Lk)("div",pr,[t[5]||(t[5]=(0,o.Lk)("label",{for:"collectionName"},"ä»»åŠ¡é›†åç§°",-1)),(0,o.bo)((0,o.Lk)("input",{id:"collectionName",type:"text",class:"modal-input","onUpdate:modelValue":t[0]||(t[0]=e=>n.formData.name=e),placeholder:"è¯·è¾“å…¥ä»»åŠ¡é›†åç§°",maxlength:"50",required:"",ref:"nameInput"},null,512),[[a.Jo,n.formData.name]])]),(0,o.Lk)("div",kr,[(0,o.Lk)("button",{type:"button",class:"modal-btn cancel",onClick:t[1]||(t[1]=(...e)=>r.closeModal&&r.closeModal(...e))}," å–æ¶ˆ "),(0,o.Lk)("button",{type:"submit",class:"modal-btn confirm",disabled:!n.formData.name.trim()},(0,h.v_)(r.isEditing?"ä¿å­˜":"åˆ›å»º"),9,vr)])],32)])])):(0,o.Q3)("",!0)}var yr={name:"CollectionModal",props:{visible:{type:Boolean,default:!1},collection:{type:Object,default:null}},emits:["close","submit"],data(){return{formData:{name:""}}},computed:{isEditing(){return null!==this.collection}},watch:{visible(e){e?(this.resetForm(),this.$nextTick(()=>{this.$refs.nameInput?.focus()}),document.addEventListener("keydown",this.handleKeyDown)):document.removeEventListener("keydown",this.handleKeyDown)},collection:{handler(e){e?this.formData.name=e.name||"":this.resetForm()},immediate:!0}},methods:{resetForm(){this.collection?this.formData.name=this.collection.name||"":this.formData.name=""},handleSubmit(){if(!this.formData.name.trim())return;const e={name:this.formData.name.trim()};this.isEditing&&(e._id=this.collection._id),this.$emit("submit",e)},closeModal(){this.$emit("close")},handleKeyDown(e){"Escape"===e.key&&this.closeModal()}},beforeUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}};const br=(0,l.A)(yr,[["render",fr],["__scopeId","data-v-5b2698ec"]]);var wr=br;const Cr={class:"modal-header"},Lr={class:"modal-title"},Tr={class:"form-section"},Sr={class:"form-section"},Ir={class:"quadrant-selector"},Er=["onClick"],Mr={class:"form-section"},Ar={class:"time-row"},Dr=["min"],$r={class:"form-actions"},Pr=["disabled"];function Fr(e,t,s,i,n,r){const l=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.Wv)(o.Im,{to:"body"},[(0,o.bF)(a.eB,{name:"modal-fade"},{default:(0,o.k6)(()=>[s.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"modal-overlay",onClick:t[7]||(t[7]=(...e)=>r.handleClose&&r.handleClose(...e))},[(0,o.bF)(a.eB,{name:"modal-slide"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",{class:"modal-container",onClick:t[6]||(t[6]=(0,a.D$)(()=>{},["stop"]))},[(0,o.Lk)("div",Cr,[(0,o.Lk)("h2",Lr,(0,h.v_)(r.isEditing?"ç¼–è¾‘å­ä»»åŠ¡":"æ·»åŠ å­ä»»åŠ¡"),1),(0,o.Lk)("button",{class:"close-button",onClick:t[0]||(t[0]=(...e)=>r.handleClose&&r.handleClose(...e))},[(0,o.bF)(l,{icon:"times"})])]),(0,o.Lk)("form",{onSubmit:t[5]||(t[5]=(0,a.D$)((...e)=>r.handleSubmit&&r.handleSubmit(...e),["prevent"])),class:"modal-form"},[(0,o.Lk)("div",Tr,[t[8]||(t[8]=(0,o.Lk)("label",{class:"form-label"},"ä»»åŠ¡åç§°",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.formData.title=e),type:"text",class:"form-input",placeholder:"ä¾‹å¦‚ï¼šè€ƒç ”æ•°å­¦å¤ä¹ ",maxlength:"50",required:"",ref:"titleInput"},null,512),[[a.Jo,n.formData.title]])]),(0,o.Lk)("div",Sr,[t[9]||(t[9]=(0,o.Lk)("label",{class:"form-label"},"åˆ†ç±»",-1)),(0,o.Lk)("div",Ir,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.quadrants,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:(0,h.C4)(["quadrant-option",{active:n.formData.quadrant===e.id}]),onClick:t=>n.formData.quadrant=e.id},[(0,o.Lk)("div",{class:"quadrant-color",style:(0,h.Tr)({backgroundColor:e.color})},null,4),(0,o.Lk)("span",null,(0,h.v_)(e.label),1)],10,Er))),128))])]),(0,o.Lk)("div",Mr,[t[10]||(t[10]=(0,o.Lk)("label",{class:"form-label"},[(0,o.eW)("æ—¥æœŸå’Œæ—¶é—´ "),(0,o.Lk)("span",{class:"optional-label"},"é€‰å¡«")],-1)),(0,o.Lk)("div",Ar,[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.formData.date=e),type:"date",class:"form-input date-input",min:r.today},null,8,Dr),[[a.Jo,n.formData.date]]),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>n.formData.time=e),type:"time",class:"form-input time-input"},null,512),[[a.Jo,n.formData.time]])])]),(0,o.Lk)("div",$r,[(0,o.Lk)("button",{type:"button",class:"btn-secondary",onClick:t[4]||(t[4]=(...e)=>r.handleClose&&r.handleClose(...e))}," å–æ¶ˆ "),(0,o.Lk)("button",{type:"submit",class:"btn-primary",disabled:!n.formData.title.trim()},(0,h.v_)(r.isEditing?"ä¿å­˜":"æ·»åŠ å­ä»»åŠ¡"),9,Pr)])],32)])]),_:1})])):(0,o.Q3)("",!0)]),_:1})])}var _r={name:"SubtaskModal",props:{visible:{type:Boolean,default:!1},collectionId:{type:String,required:!0},subtask:{type:Object,default:null}},emits:["close","submit"],data(){return{formData:{title:"",date:(new Date).toISOString().split("T")[0],time:"",quadrant:2},quadrants:[{id:1,label:"é‡è¦ä¸”ç´§æ€¥",color:"#ff3b30"},{id:2,label:"é‡è¦ä¸ç´§æ€¥",color:"#007aff"},{id:3,label:"ç´§æ€¥ä¸é‡è¦",color:"#ff9500"},{id:4,label:"ä¸é‡è¦ä¸ç´§æ€¥",color:"#34c759"}]}},computed:{isEditing(){return null!==this.subtask},today(){return(new Date).toISOString().split("T")[0]}},watch:{visible(e){e?(this.resetForm(),this.$nextTick(()=>{this.$refs.titleInput?.focus()}),document.addEventListener("keydown",this.handleKeyDown)):document.removeEventListener("keydown",this.handleKeyDown)},subtask:{handler(e){e?(this.formData.title=e.title||"",this.formData.quadrant=e.quadrant||2,this.formData.date=e.date?this.formatDateForInput(e.date):(new Date).toISOString().split("T")[0],this.formData.time=e.time||""):this.resetForm()},immediate:!0}},methods:{resetForm(){this.subtask?(this.formData.title=this.subtask.title||"",this.formData.quadrant=this.subtask.quadrant||2,this.formData.date=this.subtask.date?this.formatDateForInput(this.subtask.date):(new Date).toISOString().split("T")[0],this.formData.time=this.subtask.time||""):this.formData={title:"",date:(new Date).toISOString().split("T")[0],time:"",quadrant:2}},handleSubmit(){if(!this.formData.title.trim())return;console.log("ðŸš€ [SubtaskModal] æäº¤å­ä»»åŠ¡æ•°æ®:",this.formData);const e={title:this.formData.title.trim(),quadrant:this.formData.quadrant,date:this.formData.date,time:this.formData.time,collectionId:this.collectionId,completed:!1,createdAt:(new Date).toISOString(),timeBlockType:this.getTimeBlockType(this.formData.time),isScheduled:!!this.formData.time};this.isEditing&&(e._id=this.subtask._id),console.log("ðŸ“¤ [SubtaskModal] æœ€ç»ˆæäº¤æ•°æ®:",e),this.$emit("submit",e)},getTimeBlockType(e){if(!e)return"unscheduled";const t=parseInt(e.split(":")[0]);return t>=7&&t<12?"morning":t>=12&&t<18?"afternoon":t>=18&&t<24?"evening":"unscheduled"},handleClose(){console.log("âŒ [SubtaskModal] å…³é—­å¼¹çª—"),this.$emit("close")},handleKeyDown(e){"Escape"===e.key&&this.handleClose()},formatDateForInput(e){if(!e)return"";const t=new Date(e);return t.toISOString().split("T")[0]}},beforeUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}};const Rr=(0,l.A)(_r,[["render",Fr],["__scopeId","data-v-28337f8e"]]);var xr=Rr;const Xr={key:0,class:"loading-text"};function Ur(e,t,s,a,i,n){return(0,o.uX)(),(0,o.CE)("div",{class:(0,h.C4)(["loading-container",{overlay:s.isOverlay}])},[t[0]||(t[0]=(0,o.Lk)("div",{class:"loading-spinner"},[(0,o.Lk)("div",{class:"spinner-circle"})],-1)),s.text?((0,o.uX)(),(0,o.CE)("div",Xr,(0,h.v_)(s.text),1)):(0,o.Q3)("",!0)],2)}var Vr={name:"LoadingSpinner",props:{text:{type:String,default:""},isOverlay:{type:Boolean,default:!1}}};const Br=(0,l.A)(Vr,[["render",Ur],["__scopeId","data-v-e2a19d38"]]);var Nr=Br,Or={name:"TaskCollections",components:{CollectionCard:mr,CollectionModal:wr,SubtaskModal:xr,TabBar:Ce,LoadingSpinner:Nr},data(){return{collections:[],loading:!0,showCollectionModal:!1,showSubtaskModal:!1,editingCollection:null,editingSubtask:null,currentCollectionId:""}},computed:{currentUserId(){const e=JSON.parse(localStorage.getItem("user")||"null");return e?._id||e?.id||null}},async mounted(){await this.loadCollections()},methods:{async loadCollections(){try{this.loading=!0,console.log("ðŸ”„ [TaskCollections] å¼€å§‹åŠ è½½ä»»åŠ¡é›†åˆ—è¡¨...");const e=this.currentUserId;if(!e)return console.warn("âš ï¸ [TaskCollections] æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ"),void this.$router.replace({path:"/auth/login",query:{redirect:this.$route.fullPath}});const t=await bs.getCollections({userId:e});if(console.log("ðŸ“‹ [TaskCollections] APIå“åº”:",t),t&&t.data&&t.data.success)this.collections=t.data.data||[],console.log("âœ… [TaskCollections] æˆåŠŸåŠ è½½ä»»åŠ¡é›†åˆ—è¡¨:",this.collections.length);else{const e=t?.data?.message||"å“åº”æ ¼å¼é”™è¯¯";console.error("âŒ [TaskCollections] åŠ è½½ä»»åŠ¡é›†å¤±è´¥:",e),this.$toast?.error(e||"åŠ è½½ä»»åŠ¡é›†å¤±è´¥")}}catch(e){console.error("ðŸ’¥ [TaskCollections] åŠ è½½ä»»åŠ¡é›†å¼‚å¸¸:",e),this.$toast?.error("åŠ è½½ä»»åŠ¡é›†å¤±è´¥")}finally{this.loading=!1}},openCreateCollectionModal(){this.editingCollection=null,this.showCollectionModal=!0},closeCollectionModal(){this.showCollectionModal=!1,this.editingCollection=null},async handleCollectionSubmit(e){try{const t=this.currentUserId;if(!t)return console.warn("âš ï¸ [TaskCollections] æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ"),void this.$router.replace({path:"/auth/login",query:{redirect:this.$route.fullPath}});let s;const a={...e,userId:t};s=e._id?await bs.updateCollection(e._id,a):await bs.createCollection(a),s.data.success?(this.$toast?.success(e._id?"ä»»åŠ¡é›†æ›´æ–°æˆåŠŸ":"ä»»åŠ¡é›†åˆ›å»ºæˆåŠŸ"),this.closeCollectionModal(),await this.loadCollections()):this.$toast?.error(s.data.message||"æ“ä½œå¤±è´¥")}catch(t){console.error("ä»»åŠ¡é›†æ“ä½œå¤±è´¥:",t),this.$toast?.error("æ“ä½œå¤±è´¥")}},openAddSubtaskModal(e){this.currentCollectionId=e,this.editingSubtask={title:"",collectionId:e,priority:"medium",completed:!1},this.showSubtaskModal=!0},openEditSubtaskModal(e){this.currentCollectionId=e.collectionId,this.editingSubtask=e,this.showSubtaskModal=!0},closeSubtaskModal(){this.showSubtaskModal=!1,this.editingSubtask=null,this.currentCollectionId=""},async handleSubtaskSubmit(e){try{console.log("ðŸ”„ [TaskCollections] å¼€å§‹å¤„ç†å­ä»»åŠ¡æäº¤:",e);const t=this.currentUserId;if(!t)return console.warn("âš ï¸ [TaskCollections] æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ"),void this.$router.replace({path:"/auth/login",query:{redirect:this.$route.fullPath}});const s={...e,collectionId:this.currentCollectionId,userId:t};let a;if(e._id?(console.log("ðŸ“ [TaskCollections] æ›´æ–°çŽ°æœ‰å­ä»»åŠ¡:",e._id),a=await Ts.tasks.updateTask(e._id,s)):(console.log("ðŸ†• [TaskCollections] åˆ›å»ºæ–°å­ä»»åŠ¡"),a=await Ts.tasks.createTask(s)),console.log("âœ… [TaskCollections] å­ä»»åŠ¡APIå“åº”:",a),a.success){const t=e._id?"å­ä»»åŠ¡æ›´æ–°æˆåŠŸ":"å­ä»»åŠ¡æ·»åŠ æˆåŠŸ";console.log("ðŸŽ‰ [TaskCollections]",t),this.$toast?.success(t),this.closeSubtaskModal(),console.log("ðŸ”„ [TaskCollections] é‡æ–°åŠ è½½ä»»åŠ¡é›†åˆ—è¡¨"),await this.loadCollections()}else console.error("âŒ [TaskCollections] å­ä»»åŠ¡æ“ä½œå¤±è´¥:",a.message),this.$toast?.error(a.message||"æ“ä½œå¤±è´¥")}catch(t){console.error("ðŸ’¥ [TaskCollections] å­ä»»åŠ¡æ“ä½œå¼‚å¸¸:",t),this.$toast?.error("æ“ä½œå¤±è´¥")}},async handleToggleSubtask(e){try{console.log("ðŸ”„ [TaskCollections] åˆ‡æ¢å­ä»»åŠ¡çŠ¶æ€:",e);let t=null;for(const a of this.collections)if(a.subtasks){const s=a.subtasks.find(t=>t._id===e);if(s){t=s;break}}if(!t)return void console.error("âŒ [TaskCollections] æœªæ‰¾åˆ°ç›®æ ‡å­ä»»åŠ¡:",e);const s=await Ts.tasks.toggleTaskStatus(e);console.log("âœ… [TaskCollections] å­ä»»åŠ¡çŠ¶æ€å·²åˆ‡æ¢:",s),t.completed=!t.completed}catch(t){console.error("ðŸ’¥ [TaskCollections] åˆ‡æ¢å­ä»»åŠ¡çŠ¶æ€å¼‚å¸¸:",t)}},handleToggleExpansion(e){console.log("ðŸ”„ [TaskCollections] åˆ‡æ¢å±•å¼€çŠ¶æ€:",e)}}};const qr=(0,l.A)(Or,[["render",Wn],["__scopeId","data-v-1228216e"]]);var zr=qr;const jr={class:"stats-page"},Kr={class:"content-scroll"},Wr={class:"card overview"},Qr={class:"card-header"},Gr={class:"card-title"},Hr={class:"icon-box"},Jr={class:"icon-btn","aria-label":"share"},Yr={class:"metrics three"},Zr={class:"metric"},el={class:"metric-value"},tl={class:"num"},sl={class:"metric"},al={class:"metric-value"},ol={class:"num"},il={class:"metric"},nl={class:"metric-value"},rl={class:"num"},ll={class:"card today"},cl={class:"card-header"},dl={class:"card-title"},ul={class:"icon-box"},hl={class:"nav-date"},ml={class:"date-text"},gl={class:"metrics two"},pl={class:"metric"},kl={class:"metric-value"},vl={class:"num"},fl={class:"metric"},yl={class:"metric-value"},bl={class:"num"},wl={class:"card dist"},Cl={class:"card-header"},Ll={class:"card-title"},Tl={class:"icon-box"},Sl={class:"nav-date"},Il={class:"date-text"},El={class:"icon-btn","aria-label":"share"},Ml={class:"tabs"},Al={class:"card bars"},Dl={class:"card-header"},$l={class:"card-title"},Pl={class:"icon-box"},Fl={class:"nav-date"},_l={class:"date-text"},Rl={class:"bar-chart"},xl={class:"bars-wrap"},Xl={class:"x-labels"},Ul={class:"card line"},Vl={class:"card-header"},Bl={class:"card-title"},Nl={class:"icon-box"},Ol={class:"nav-date"},ql={class:"date-text"},zl={class:"icon-btn","aria-label":"share"},jl={class:"line-chart"},Kl=["viewBox"],Wl=["d"],Ql=["points"];function Gl(e,t,s,a,i,n){const r=(0,o.g2)("font-awesome-icon"),l=(0,o.g2)("TabBar");return(0,o.uX)(),(0,o.CE)("div",jr,[(0,o.Lk)("div",Kr,[(0,o.Lk)("section",Wr,[(0,o.Lk)("div",Qr,[(0,o.Lk)("div",Gr,[(0,o.Lk)("span",Hr,[(0,o.bF)(r,{icon:["far","calendar"]})]),t[12]||(t[12]=(0,o.Lk)("span",null,"ç´¯è®¡ä¸“æ³¨",-1))]),(0,o.Lk)("button",Jr,[(0,o.bF)(r,{icon:"share-nodes"})])]),(0,o.Lk)("div",Yr,[(0,o.Lk)("div",Zr,[t[13]||(t[13]=(0,o.Lk)("div",{class:"metric-label"},"æ¬¡æ•°",-1)),(0,o.Lk)("div",el,[(0,o.Lk)("span",tl,(0,h.v_)(i.totalTimes),1)])]),(0,o.Lk)("div",sl,[t[15]||(t[15]=(0,o.Lk)("div",{class:"metric-label"},"æ—¶é•¿",-1)),(0,o.Lk)("div",al,[(0,o.Lk)("span",ol,(0,h.v_)(i.totalMinutes),1),t[14]||(t[14]=(0,o.Lk)("span",{class:"unit"},"åˆ†é’Ÿ",-1))])]),(0,o.Lk)("div",il,[t[17]||(t[17]=(0,o.Lk)("div",{class:"metric-label"},"æ—¥å‡æ—¶é•¿",-1)),(0,o.Lk)("div",nl,[(0,o.Lk)("span",rl,(0,h.v_)(i.avgDailyMinutes),1),t[16]||(t[16]=(0,o.Lk)("span",{class:"unit"},"åˆ†é’Ÿ",-1))])])])]),(0,o.Lk)("section",ll,[(0,o.Lk)("div",cl,[(0,o.Lk)("div",dl,[(0,o.Lk)("span",ul,[(0,o.bF)(r,{icon:["far","calendar-days"]})]),t[18]||(t[18]=(0,o.Lk)("span",null,"å½“æ—¥ä¸“æ³¨",-1))]),(0,o.Lk)("div",hl,[(0,o.Lk)("button",{class:"icon-btn",onClick:t[0]||(t[0]=e=>n.shiftDay(-1)),"aria-label":"prev"},[(0,o.bF)(r,{icon:"chevron-left"})]),(0,o.Lk)("span",ml,(0,h.v_)(n.formattedDate),1),(0,o.Lk)("button",{class:"icon-btn",onClick:t[1]||(t[1]=e=>n.shiftDay(1)),"aria-label":"next"},[(0,o.bF)(r,{icon:"chevron-right"})])])]),(0,o.Lk)("div",gl,[(0,o.Lk)("div",pl,[t[19]||(t[19]=(0,o.Lk)("div",{class:"metric-label"},"æ¬¡æ•°",-1)),(0,o.Lk)("div",kl,[(0,o.Lk)("span",vl,(0,h.v_)(i.todayTimes),1)])]),(0,o.Lk)("div",fl,[t[21]||(t[21]=(0,o.Lk)("div",{class:"metric-label"},"æ—¶é•¿",-1)),(0,o.Lk)("div",yl,[(0,o.Lk)("span",bl,(0,h.v_)(i.todayMinutes),1),t[20]||(t[20]=(0,o.Lk)("span",{class:"unit"},"åˆ†é’Ÿ",-1))])])])]),(0,o.Lk)("section",wl,[(0,o.Lk)("div",Cl,[(0,o.Lk)("div",Ll,[(0,o.Lk)("span",Tl,[(0,o.bF)(r,{icon:"chart-column"})]),t[22]||(t[22]=(0,o.Lk)("span",null,"ä¸“æ³¨æ—¶é•¿åˆ†å¸ƒ",-1))]),(0,o.Lk)("div",Sl,[(0,o.Lk)("button",{class:"icon-btn",onClick:t[2]||(t[2]=e=>n.shiftDay(-1)),"aria-label":"prev"},[(0,o.bF)(r,{icon:"chevron-left"})]),(0,o.Lk)("span",Il,(0,h.v_)(n.formattedDate),1),(0,o.Lk)("button",{class:"icon-btn",onClick:t[3]||(t[3]=e=>n.shiftDay(1)),"aria-label":"next"},[(0,o.bF)(r,{icon:"chevron-right"})])]),(0,o.Lk)("button",El,[(0,o.bF)(r,{icon:"share-nodes"})])]),(0,o.Lk)("div",Ml,[(0,o.Lk)("button",{class:(0,h.C4)(["tab","day"===i.activeRange?"active":""]),onClick:t[4]||(t[4]=e=>i.activeRange="day")},"æ—¥",2),(0,o.Lk)("button",{class:(0,h.C4)(["tab","week"===i.activeRange?"active":""]),onClick:t[5]||(t[5]=e=>i.activeRange="week")},"å‘¨",2),(0,o.Lk)("button",{class:(0,h.C4)(["tab","month"===i.activeRange?"active":""]),onClick:t[6]||(t[6]=e=>i.activeRange="month")},"æœˆ",2),(0,o.Lk)("button",{class:(0,h.C4)(["tab","custom"===i.activeRange?"active":""]),onClick:t[7]||(t[7]=e=>i.activeRange="custom")},"è‡ªå®šä¹‰",2)]),t[23]||(t[23]=(0,o.Fv)('<div class="empty" data-v-2fe09a88><div class="empty-face" data-v-2fe09a88>â˜º</div><div class="empty-title" data-v-2fe09a88>æš‚æ— ä¸“æ³¨æ•°æ®</div><div class="empty-sub" data-v-2fe09a88>ç‚¹å‡»å¾…åŠžä¸Šçš„â€œå¼€å§‹â€æŒ‰é’®æ¥ä¸“æ³¨è®¡æ—¶å§</div><button class="primary-btn" data-v-2fe09a88>æŸ¥çœ‹ä¸“æ³¨è®°å½•</button></div>',1))]),(0,o.Lk)("section",Al,[(0,o.Lk)("div",Dl,[(0,o.Lk)("div",$l,[(0,o.Lk)("span",Pl,[(0,o.bF)(r,{icon:"chart-simple"})]),t[24]||(t[24]=(0,o.Lk)("span",null,"æœ¬æœˆä¸“æ³¨æ—¶æ®µåˆ†å¸ƒ",-1))]),(0,o.Lk)("div",Fl,[(0,o.Lk)("button",{class:"icon-btn",onClick:t[8]||(t[8]=e=>n.shiftMonth(-1)),"aria-label":"prev"},[(0,o.bF)(r,{icon:"chevron-left"})]),(0,o.Lk)("span",_l,(0,h.v_)(n.formattedMonth),1),(0,o.Lk)("button",{class:"icon-btn",onClick:t[9]||(t[9]=e=>n.shiftMonth(1)),"aria-label":"next"},[(0,o.bF)(r,{icon:"chevron-right"})])])]),(0,o.Lk)("div",Rl,[t[25]||(t[25]=(0,o.Lk)("div",{class:"y-scale"},"10åˆ†é’Ÿ",-1)),(0,o.Lk)("div",xl,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.hourlyBars,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:"bar",style:(0,h.Tr)({height:Math.round(8*e)+"px"})},null,4))),128))]),(0,o.Lk)("div",Xl,[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(12,e=>(0,o.Lk)("span",{key:e},(0,h.v_)(2*(e-1))+"ç‚¹",1)),64))])])]),(0,o.Lk)("section",Ul,[(0,o.Lk)("div",Vl,[(0,o.Lk)("div",Bl,[(0,o.Lk)("span",Nl,[(0,o.bF)(r,{icon:["far","calendar"]})]),t[26]||(t[26]=(0,o.Lk)("span",null,"æœˆåº¦ä¸“æ³¨ç»Ÿè®¡",-1))]),(0,o.Lk)("div",Ol,[(0,o.Lk)("button",{class:"icon-btn",onClick:t[10]||(t[10]=e=>n.shiftMonth(-1)),"aria-label":"prev"},[(0,o.bF)(r,{icon:"chevron-left"})]),(0,o.Lk)("span",ql,(0,h.v_)(n.formattedMonth),1),(0,o.Lk)("button",{class:"icon-btn",onClick:t[11]||(t[11]=e=>n.shiftMonth(1)),"aria-label":"next"},[(0,o.bF)(r,{icon:"chevron-right"})])]),(0,o.Lk)("button",zl,[(0,o.bF)(r,{icon:"share-nodes"})])]),(0,o.Lk)("div",jl,[((0,o.uX)(),(0,o.CE)("svg",{viewBox:"0 0 "+i.chartW+" "+i.chartH,preserveAspectRatio:"none"},[t[27]||(t[27]=(0,o.Lk)("defs",null,[(0,o.Lk)("linearGradient",{id:"area",x1:"0",y1:"0",x2:"0",y2:"1"},[(0,o.Lk)("stop",{offset:"0%","stop-color":"#4c8dff","stop-opacity":"0.35"}),(0,o.Lk)("stop",{offset:"100%","stop-color":"#4c8dff","stop-opacity":"0"})])],-1)),(0,o.Lk)("path",{d:n.areaPath,fill:"url(#area)"},null,8,Wl),(0,o.Lk)("polyline",{points:n.polyPoints,fill:"none",stroke:"#4c8dff","stroke-width":"2"},null,8,Ql)],8,Kl)),t[28]||(t[28]=(0,o.Lk)("div",{class:"y-scale"},"10åˆ†é’Ÿ",-1))])])]),(0,o.bF)(l)])}s(8237);var Hl={name:"StatisticsView",components:{TabBar:Ce},data(){const e=new Date;return{dayCursor:new Date(e.getFullYear(),e.getMonth(),e.getDate()),monthCursor:new Date(e.getFullYear(),e.getMonth(),1),activeRange:"day",hourlyBars:Array.from({length:24},()=>0),lineData:[],chartW:320,chartH:140,totalTimes:0,totalMinutes:0,avgDailyMinutes:0,todayTimes:0,todayMinutes:0}},computed:{formattedDate(){const e=this.dayCursor.getFullYear(),t=String(this.dayCursor.getMonth()+1).padStart(2,"0"),s=String(this.dayCursor.getDate()).padStart(2,"0");return`${e}-${t}-${s}`},formattedMonth(){const e=this.monthCursor.getFullYear(),t=String(this.monthCursor.getMonth()+1).padStart(2,"0");return`${e}å¹´${t}æœˆ`},polyPoints(){const e=this.lineData.length,t=this.chartW/(e-1||1),s=Math.max(...this.lineData,10);return this.lineData.map((e,a)=>{const o=a*t,i=this.chartH-e/s*(this.chartH-4)-2;return`${o},${i}`}).join(" ")},areaPath(){const e=this.lineData.length;if(0===e)return"";const t=this.polyPoints.split(" "),s=t[0],a=t[t.length-1];return`M ${s} L ${t.join(" ")} L ${a.split(",")[0]},${this.chartH} L ${s.split(",")[0]},${this.chartH} Z`}},created(){this.loadAll()},methods:{shiftDay(e){const t=new Date(this.dayCursor);t.setDate(t.getDate()+e),this.dayCursor=t,this.loadToday()},shiftMonth(e){const t=new Date(this.monthCursor);t.setMonth(t.getMonth()+e),this.monthCursor=t,this.loadMonth()},async loadAll(){await Promise.all([this.loadOverview(),this.loadToday(),this.loadMonth()])},toISOStart(e){const t=new Date(e);return t.setHours(0,0,0,0),t.toISOString()},toISOEnd(e){const t=new Date(e);return t.setHours(0,0,0,0),t.setDate(t.getDate()+1),t.toISOString()},minutesFromSeconds(e){const t=Number(e||0);return Math.round(t/60)},async loadOverview(){try{const e=await Ts.pomodoros.getPomodoroStats({}),t=e?.data||e?.data?.data||e||{},s=Number(t.totalFocusSeconds??t.totalSeconds??t.totalFocusTime??0),a=Number(t.totalSessions??t.total??t.count??0),o=Number(t.avgDailyFocusSeconds??t.avgDailySeconds??0);let i=this.minutesFromSeconds(o);i||(i=Math.round(this.minutesFromSeconds(s)/30)),this.totalTimes=a,this.totalMinutes=this.minutesFromSeconds(s),this.avgDailyMinutes=i}catch(e){}},async loadToday(){try{const e=this.toISOStart(this.dayCursor),t=this.toISOEnd(this.dayCursor),s=await Ts.pomodoros.getAllPomodoros({startDate:e,endDate:t}),a=s?.data||s?.data?.data||s||[],o=a.reduce((e,t)=>{const s=Number(t?.actualFocusTime??t?.duration??0);return e+(isFinite(s)?s:0)},0);this.todayTimes=a.length,this.todayMinutes=this.minutesFromSeconds(o)}catch(e){this.todayTimes=0,this.todayMinutes=0}},async loadMonth(){try{const e=new Date(this.monthCursor.getFullYear(),this.monthCursor.getMonth(),1),t=e.toISOString(),s=new Date(this.monthCursor.getFullYear(),this.monthCursor.getMonth()+1,1).toISOString(),a=await Ts.pomodoros.getAllPomodoros({startDate:t,endDate:s}),o=a?.data||a?.data?.data||a||[],i=Array.from({length:24},()=>0),n=new Date(this.monthCursor.getFullYear(),this.monthCursor.getMonth()+1,0).getDate(),r=Array.from({length:n},()=>0);o.forEach(e=>{const t=new Date(e?.createdAt||e?.startTime||Date.now()),s=t.getHours(),a=t.getDate(),o=Number(e?.actualFocusTime??e?.duration??0),n=Math.max(0,Math.round(o/60));isFinite(s)&&(i[s]+=n),isFinite(a)&&(r[a-1]+=n)});const l=Math.max(...i,10);this.hourlyBars=i.map(e=>l?Math.min(10,e/l*10):0),this.lineData=r}catch(e){this.hourlyBars=Array.from({length:24},()=>0),this.lineData=[]}}}};const Jl=(0,l.A)(Hl,[["render",Gl],["__scopeId","data-v-2fe09a88"]]);var Yl=Jl;const Zl={class:"app-container"},ec={class:"header"},tc={class:"header-top"},sc={class:"task-name"},ac={class:"timer-container"},oc={class:"timer-controls"},ic={class:"session-info"},nc={class:"session-count"},rc={class:"session-message"},lc={class:"motivational-quote"},cc={class:"modal-body"},dc={class:"modal-time-info"},uc={class:"modal-actions"};function hc(e,t,s,i,n,r){const l=(0,o.g2)("font-awesome-icon"),c=(0,o.g2)("TimerCircle");return(0,o.uX)(),(0,o.CE)("div",Zl,[(0,o.Lk)("div",ec,[(0,o.Lk)("div",tc,[(0,o.Lk)("div",{class:"back-btn",onClick:t[0]||(t[0]=(...e)=>r.goBack&&r.goBack(...e)),title:"è¿”å›žä»»åŠ¡åˆ—è¡¨"},[(0,o.bF)(l,{icon:"arrow-left"})]),t[8]||(t[8]=(0,o.Lk)("h1",null,"ç•ªèŒ„å·¥ä½œæ³•",-1)),t[9]||(t[9]=(0,o.Lk)("div",{class:"header-spacer"},null,-1))]),(0,o.Lk)("div",sc,(0,h.v_)(n.taskName),1)]),(0,o.Lk)("div",ac,[(0,o.bF)(c,{"time-left":n.timeLeft,"total-time":n.modes[n.currentMode],label:n.modeLabels[n.currentMode]},null,8,["time-left","total-time","label"]),(0,o.Lk)("div",oc,[n.isRunning?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"control-btn pause-btn playing",onClick:t[2]||(t[2]=(...e)=>r.pauseTimer&&r.pauseTimer(...e))},[(0,o.bF)(l,{icon:"pause"})])):((0,o.uX)(),(0,o.CE)("div",{key:0,class:"control-btn start-btn",onClick:t[1]||(t[1]=(...e)=>r.startTimer&&r.startTimer(...e))},[(0,o.bF)(l,{icon:"play"})])),(0,o.Lk)("div",{class:"control-btn stop-btn",onClick:t[3]||(t[3]=(...e)=>r.showStopModal&&r.showStopModal(...e))},[(0,o.bF)(l,{icon:"stop"})])]),(0,o.Lk)("div",ic,[(0,o.Lk)("div",nc,"ä»Šæ—¥å·²å®Œæˆ: "+(0,h.v_)(n.completedPomodoros)+"ä¸ªç•ªèŒ„",1),(0,o.Lk)("div",rc,(0,h.v_)(n.sessionMessage),1)])]),(0,o.Lk)("div",lc,(0,h.v_)(n.currentQuote),1),n.showModal?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"modal-overlay",onClick:t[7]||(t[7]=(...e)=>r.hideStopModal&&r.hideStopModal(...e))},[(0,o.Lk)("div",{class:"modal-content",onClick:t[6]||(t[6]=(0,a.D$)(()=>{},["stop"]))},[t[13]||(t[13]=(0,o.Lk)("div",{class:"modal-header"},[(0,o.Lk)("h3",null,"ç»“æŸå½“å‰è®¡æ—¶")],-1)),(0,o.Lk)("div",cc,[t[10]||(t[10]=(0,o.Lk)("p",null,"æ‚¨æƒ³è¦å¦‚ä½•å¤„ç†å½“å‰çš„è®¡æ—¶ï¼Ÿ",-1)),(0,o.Lk)("div",dc,[(0,o.Lk)("span",null,"å·²ç”¨æ—¶é—´: "+(0,h.v_)(r.formatTime(n.modes[n.currentMode]-n.timeLeft)),1)])]),(0,o.Lk)("div",uc,[(0,o.Lk)("button",{class:"modal-btn abandon-btn",onClick:t[4]||(t[4]=(...e)=>r.abandonTimer&&r.abandonTimer(...e))},[(0,o.bF)(l,{icon:"times"}),t[11]||(t[11]=(0,o.eW)(" æ”¾å¼ƒè®¡æ—¶ ",-1))]),(0,o.Lk)("button",{class:"modal-btn complete-btn",onClick:t[5]||(t[5]=(...e)=>r.completeTimer&&r.completeTimer(...e))},[(0,o.bF)(l,{icon:"check"}),t[12]||(t[12]=(0,o.eW)(" æå‰å®Œæˆ ",-1))])])])])):(0,o.Q3)("",!0)])}const mc={class:"timer-circle"},gc={class:"timer-display"},pc={class:"timer-label"};function kc(e,t,s,a,i,n){return(0,o.uX)(),(0,o.CE)("div",mc,[(0,o.Lk)("div",{class:"timer-progress",style:(0,h.Tr)(n.progressStyle)},null,4),(0,o.Lk)("div",gc,(0,h.v_)(n.displayTime),1),(0,o.Lk)("div",pc,(0,h.v_)(s.label),1)])}var vc={name:"TimerCircle",props:{timeLeft:{type:Number,required:!0},totalTime:{type:Number,required:!0},label:{type:String,default:"ä¸“æ³¨æ—¶é—´"}},computed:{displayTime(){const e=Math.floor(this.timeLeft/60),t=this.timeLeft%60;return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},progressStyle(){const e=1-this.timeLeft/this.totalTime,t=360*e;return{background:`conic-gradient(\n          from 0deg,\n          rgba(255, 255, 255, 0.8) 0deg,\n          rgba(255, 255, 255, 0.8) ${t}deg,\n          rgba(255, 255, 255, 0.15) ${t}deg,\n          rgba(255, 255, 255, 0.15) 360deg\n        )`,transform:"rotate(-90deg)"}}}};const fc=(0,l.A)(vc,[["render",kc],["__scopeId","data-v-61dbf9a3"]]);var yc=fc,bc={name:"PomodoroTimer",components:{TimerCircle:yc},data(){return{timer:null,timeLeft:1500,isRunning:!1,currentMode:"pomodoro",completedPomodoros:0,taskName:"è‹±è¯­æ™¨è¯»è®¡åˆ’",sessionMessage:"ä¸“æ³¨æ—¶é—´ï¼Œä¿æŒé«˜æ•ˆï¼",showModal:!1,sessionStartTime:null,currentSessionId:null,fromRoute:"/task",modes:{pomodoro:1500,shortBreak:300,longBreak:900},modeLabels:{pomodoro:"ä¸“æ³¨æ—¶é—´",shortBreak:"çŸ­ä¼‘æ¯",longBreak:"é•¿ä¼‘æ¯"},quotes:["æˆåŠŸçš„ç§˜è¯€åœ¨äºŽåšæŒç›®æ ‡çš„å¿—å‘ä¸æ‡ˆã€‚","æ¯ä¸€ä¸ªç•ªèŒ„æ—¶é—´éƒ½æ˜¯å‘æ¢¦æƒ³è¿ˆè¿›çš„ä¸€æ­¥ã€‚","ä¸“æ³¨å½“ä¸‹ï¼Œæˆå°±æœªæ¥ã€‚","ä»Šå¤©çš„åŠªåŠ›ï¼Œæ˜¯æ˜Žå¤©çš„å®žåŠ›ã€‚","åšæŒå°±æ˜¯èƒœåˆ©ï¼Œä¸“æ³¨å°±æ˜¯åŠ›é‡ã€‚","å°æ­¥å¿«è·‘ï¼ŒæŒç»­è¿›æ­¥ã€‚"],currentQuote:""}},mounted(){const e=this.$route.query.task;e&&(this.taskName="string"===typeof e?e:String(e)),this.fromRoute=this.$route.query.from&&"string"===typeof this.$route.query.from?this.$route.query.from:"/task",this.currentQuote=this.getRandomQuote(),this.timeLeft=this.modes[this.currentMode],this.loadTodayPomodoros()},beforeUnmount(){this.timer&&clearInterval(this.timer)},methods:{startTimer(){this.isRunning||(this.isRunning=!0,this.sessionStartTime=new Date,this.timer=setInterval(()=>{this.timeLeft--,this.timeLeft<=0&&this.onTimerComplete()},1e3))},pauseTimer(){this.isRunning&&(clearInterval(this.timer),this.isRunning=!1)},showStopModal(){this.showModal=!0},hideStopModal(){this.showModal=!1},async abandonTimer(){await this.savePomodoroRecord(!1),$s("criticize"),this.resetTimer(),this.hideStopModal(),this.goBack()},async completeTimer(){await this.savePomodoroRecord(!0),$s("encourage");try{const e=this.$route.query.taskId;if(e){console.log("ðŸ”„ [Pomodoro] æ›´æ–°ä»»åŠ¡å®ŒæˆçŠ¶æ€:",e);const t=await Ts.tasks.updateTask(e,{completed:!0});console.log("âœ… [Pomodoro] ä»»åŠ¡çŠ¶æ€æ›´æ–°å“åº”:",t)}else console.warn("âš ï¸ [Pomodoro] æœªæä¾›taskIdï¼Œæ— æ³•å›žå†™ä»»åŠ¡å®ŒæˆçŠ¶æ€")}catch(e){console.error("âŒ [Pomodoro] æ›´æ–°ä»»åŠ¡å®ŒæˆçŠ¶æ€å¤±è´¥:",e)}"pomodoro"===this.currentMode&&this.completedPomodoros++,this.resetTimer(),this.hideStopModal(),this.goBack()},resetTimer(){clearInterval(this.timer),this.isRunning=!1,this.timeLeft=this.modes[this.currentMode],this.sessionStartTime=null},setMode(e){this.currentMode=e,this.timeLeft=this.modes[e],this.resetTimer()},async onTimerComplete(){if(clearInterval(this.timer),this.isRunning=!1,this.playNotificationSound(),await this.savePomodoroRecord(!0),$s("encourage"),"pomodoro"===this.currentMode){this.completedPomodoros++;const e=this.completedPomodoros%4===0?"longBreak":"shortBreak";this.sessionMessage="longBreak"===e?"é•¿æ—¶é—´ä¼‘æ¯ï¼Œå¥½å¥½æ”¾æ¾ï¼":"çŸ­æš‚ä¼‘æ¯ï¼Œå‡†å¤‡ä¸‹ä¸€è½®ï¼",setTimeout(()=>{this.setMode(e),setTimeout(()=>{this.startTimer()},1e3)},2e3)}else this.sessionMessage="ç»§ç»­åŠ æ²¹ï¼ä¿æŒä¸“æ³¨",setTimeout(()=>{this.setMode("pomodoro"),setTimeout(()=>{this.startTimer()},1e3)},2e3);this.currentQuote=this.getRandomQuote()},playNotificationSound(){const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=800,t.type="sine",s.gain.setValueAtTime(.3,e.currentTime),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),t.start(e.currentTime),t.stop(e.currentTime+.5)},getRandomQuote(){return this.quotes[Math.floor(Math.random()*this.quotes.length)]},goBack(){const e=this.fromRoute||"/task";this.$router.replace(e)},formatTime(e){const t=Math.floor(e/60),s=e%60;return`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},async savePomodoroRecord(e){if(!this.sessionStartTime)return;const t=new Date,s=Math.floor((t-this.sessionStartTime)/1e3),a=this.modes[this.currentMode];let o="normal";e?s<a&&(o="early"):o="abandoned";const i=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),l=`${i}-${n}-${r}`,c=t.getHours();let d="evening";c>=7&&c<12?d="morning":c>=12&&c<18&&(d="afternoon");const u=JSON.parse(localStorage.getItem("user")||"null"),h=u?._id||u?.id||null;if(!h)return console.warn("âš ï¸ [Pomodoro] æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ"),void this.$router.replace({path:"/auth/login",query:{redirect:this.$route.fullPath}});const m={taskName:this.taskName,mode:this.currentMode,startTime:this.sessionStartTime.toISOString(),endTime:t.toISOString(),duration:a,actualFocusTime:s,completed:e,completionStatus:o,userId:h,sourceRoute:this.fromRoute,date:l,timeBlockType:d,taskId:this.$route.query.taskId||null};try{const t=await Cs.createPomodoro(m);console.log("ç•ªèŒ„é’Ÿè®°å½•ä¿å­˜æˆåŠŸ:",t.data),this.sessionMessage=e?"early"===o?"æå‰å®Œæˆï¼Œè®°å½•å·²ä¿å­˜ï¼":"ä»»åŠ¡å®Œæˆï¼Œè®°å½•å·²ä¿å­˜ï¼":"å·²æ”¾å¼ƒï¼Œè®°å½•å·²ä¿å­˜ï¼"}catch(g){console.error("ä¿å­˜ç•ªèŒ„é’Ÿè®°å½•å¤±è´¥:",g),this.sessionMessage="è®°å½•ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥"}},async loadTodayPomodoros(){try{const e=JSON.parse(localStorage.getItem("user")||"null"),t=e?._id||e?.id||null;if(!t)return console.warn("âš ï¸ [Pomodoro] æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ"),void this.$router.replace({path:"/auth/login",query:{redirect:this.$route.fullPath}});const s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),o=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1),i=await Cs.getAllPomodoros({userId:t,startDate:a.toISOString(),endDate:o.toISOString()}),n=i.data?.data||i.data||[],r=n.filter(e=>"pomodoro"===e.mode&&e.completed);this.completedPomodoros=r.length}catch(e){console.error("åŠ è½½ä»Šæ—¥ç•ªèŒ„é’Ÿè®°å½•å¤±è´¥:",e)}}}};const wc=(0,l.A)(bc,[["render",hc],["__scopeId","data-v-2eb7d17e"]]);var Cc=wc;const Lc={class:"auth-page"},Tc={class:"auth-container"};function Sc(e,t,s,a,i,n){const r=(0,o.g2)("AuthLogo"),l=(0,o.g2)("LoginForm"),c=(0,o.g2)("RegisterForm");return(0,o.uX)(),(0,o.CE)("div",Lc,[(0,o.Lk)("div",Tc,[(0,o.bF)(r),"login"===a.currentMode?((0,o.uX)(),(0,o.Wv)(l,{key:0,onSwitchMode:a.switchMode,onSubmit:a.handleLogin},null,8,["onSwitchMode","onSubmit"])):((0,o.uX)(),(0,o.Wv)(c,{key:1,onSwitchMode:a.switchMode,onSubmit:a.handleRegister},null,8,["onSwitchMode","onSubmit"]))]),t[0]||(t[0]=(0,o.Lk)("div",{class:"bg-decoration"},[(0,o.Lk)("div",{class:"bg-circle bg-circle-1"}),(0,o.Lk)("div",{class:"bg-circle bg-circle-2"}),(0,o.Lk)("div",{class:"bg-circle bg-circle-3"})],-1))])}var Ic=s(7411);const Ec={class:"logo"},Mc={class:"logo-icon"};function Ac(e,t,s,a,i,n){const r=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("div",Ec,[(0,o.Lk)("div",Mc,[(0,o.bF)(r,{icon:"robot"})]),t[0]||(t[0]=(0,o.Lk)("h1",{class:"app-title"},"Tempo",-1)),t[1]||(t[1]=(0,o.Lk)("p",{class:"app-subtitle"},"ä¸åªè§„åˆ’ä½ çš„æ—¶é—´ï¼Œæ›´é™ªä¼´ä½ çš„æˆé•¿ã€‚",-1))])}var Dc=s(292),$c={name:"AuthLogo",components:{FontAwesomeIcon:Dc.gc}};const Pc=(0,l.A)($c,[["render",Ac],["__scopeId","data-v-2d369dd3"]]);var Fc=Pc;const _c={class:"form-group"},Rc={class:"input-wrapper"},xc={key:0,class:"error-message"},Xc={class:"form-group"},Uc={class:"input-wrapper"},Vc=["type"],Bc={key:0,class:"error-message"},Nc=["disabled"],Oc={class:"switch-mode"};function qc(e,t,s,i,n,r){const l=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("form",{onSubmit:t[7]||(t[7]=(0,a.D$)((...e)=>i.handleSubmit&&i.handleSubmit(...e),["prevent"])),class:"auth-form"},[(0,o.Lk)("div",_c,[t[8]||(t[8]=(0,o.Lk)("label",{class:"form-label"},"æ‰‹æœºå·",-1)),(0,o.Lk)("div",Rc,[(0,o.bF)(l,{icon:"phone",class:"input-icon"}),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.formData.phoneNumber=e),type:"tel",class:(0,h.C4)(["form-input",{error:i.errors.phoneNumber}]),placeholder:"è¯·è¾“å…¥æ‰‹æœºå·",maxlength:"11",required:"",onInput:t[1]||(t[1]=(...e)=>i.validatePhoneNumber&&i.validatePhoneNumber(...e)),onBlur:t[2]||(t[2]=(...e)=>i.validatePhoneNumber&&i.validatePhoneNumber(...e))},null,34),[[a.Jo,i.formData.phoneNumber]])]),i.errors.phoneNumber?((0,o.uX)(),(0,o.CE)("div",xc,(0,h.v_)(i.errors.phoneNumber),1)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",Xc,[t[9]||(t[9]=(0,o.Lk)("label",{class:"form-label"},"å¯†ç ",-1)),(0,o.Lk)("div",Uc,[(0,o.bF)(l,{icon:"lock",class:"input-icon"}),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>i.formData.password=e),type:i.showPassword?"text":"password",class:(0,h.C4)(["form-input",{error:i.errors.password}]),placeholder:"è¯·è¾“å…¥å¯†ç ",minlength:"6",required:"",onBlur:t[4]||(t[4]=(...e)=>i.validatePassword&&i.validatePassword(...e))},null,42,Vc),[[a.hp,i.formData.password]]),(0,o.Lk)("button",{type:"button",class:"password-toggle",onClick:t[5]||(t[5]=e=>i.showPassword=!i.showPassword)},[(0,o.bF)(l,{icon:i.showPassword?"eye-slash":"eye"},null,8,["icon"])])]),i.errors.password?((0,o.uX)(),(0,o.CE)("div",Bc,(0,h.v_)(i.errors.password),1)):(0,o.Q3)("",!0)]),(0,o.Lk)("button",{type:"submit",class:(0,h.C4)(["auth-btn",{loading:i.isLoading}]),disabled:i.isLoading||!i.isFormValid},[i.isLoading?((0,o.uX)(),(0,o.Wv)(l,{key:0,icon:"spinner",spin:"",class:"btn-icon"})):((0,o.uX)(),(0,o.Wv)(l,{key:1,icon:"sign-in-alt",class:"btn-icon"})),(0,o.eW)(" "+(0,h.v_)(i.isLoading?"ç™»å½•ä¸­...":"ç™»å½•"),1)],10,Nc),i.message.text?((0,o.uX)(),(0,o.CE)("div",{key:0,class:(0,h.C4)(["message",i.message.type])},[(0,o.bF)(l,{icon:"error"===i.message.type?"exclamation-circle":"check-circle",class:"message-icon"},null,8,["icon"]),(0,o.eW)(" "+(0,h.v_)(i.message.text),1)],2)):(0,o.Q3)("",!0),(0,o.Lk)("div",Oc,[t[10]||(t[10]=(0,o.eW)(" è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ ",-1)),(0,o.Lk)("button",{type:"button",class:"switch-link",onClick:t[6]||(t[6]=t=>e.$emit("switch-mode","register"))}," ç«‹å³æ³¨å†Œ ")])],32)}var zc={name:"LoginForm",components:{FontAwesomeIcon:Dc.gc},emits:["switch-mode","submit"],setup(e,{emit:t}){const s=(0,Le.Kh)({phoneNumber:"",password:""}),a=(0,Le.KR)(!1),i=(0,Le.KR)(!1),n=(0,Le.Kh)({phoneNumber:"",password:""}),r=(0,Le.Kh)({text:"",type:""}),l=()=>{const e=/^1[3-9]\d{9}$/;s.phoneNumber?e.test(s.phoneNumber)?n.phoneNumber="":n.phoneNumber="è¯·è¾“å…¥æ­£ç¡®çš„11ä½æ‰‹æœºå·":n.phoneNumber="è¯·è¾“å…¥æ‰‹æœºå·"},c=()=>{s.password?s.password.length<6?n.password="å¯†ç é•¿åº¦è‡³å°‘6ä½":n.password="":n.password="è¯·è¾“å…¥å¯†ç "},d=(0,o.EW)(()=>s.phoneNumber&&s.password&&!n.phoneNumber&&!n.password),u=(e,t="error")=>{console.log(`${"error"===t?"âŒ":"âœ…"} ${e}`),r.text=e,r.type=t,setTimeout(()=>{r.text="",r.type=""},3e3)},h=async()=>{if(console.log("ðŸ”„ ç™»å½•è¡¨å•æäº¤"),l(),c(),d.value){a.value=!0;try{console.log("ðŸ“¤ æäº¤ç™»å½•æ•°æ®:",{phoneNumber:s.phoneNumber,password:"***"});const e=t("submit",{...s});e&&"function"===typeof e.then&&await e}catch(e){console.error("âŒ ç™»å½•å¤±è´¥:",e);const t=e?.response?.data?.message||e?.message||"ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•";u(t)}finally{a.value=!1}}else u("è¯·æ­£ç¡®å¡«å†™æ‰€æœ‰å­—æ®µ")};return{formData:s,errors:n,message:r,isLoading:a,showPassword:i,isFormValid:d,validatePhoneNumber:l,validatePassword:c,handleSubmit:h,showMessage:u}}};const jc=(0,l.A)(zc,[["render",qc],["__scopeId","data-v-73ed84be"]]);var Kc=jc;const Wc={class:"form-group"},Qc={class:"input-wrapper"},Gc={key:0,class:"error-message"},Hc={class:"form-group"},Jc={class:"input-wrapper"},Yc={key:0,class:"error-message"},Zc={class:"form-group"},ed={class:"input-wrapper"},td=["type"],sd={key:0,class:"error-message"},ad={class:"form-group"},od={class:"input-wrapper"},id=["type"],nd={key:0,class:"error-message"},rd=["disabled"],ld={class:"switch-mode"};function cd(e,t,s,i,n,r){const l=(0,o.g2)("font-awesome-icon");return(0,o.uX)(),(0,o.CE)("form",{onSubmit:t[13]||(t[13]=(0,a.D$)((...e)=>i.handleSubmit&&i.handleSubmit(...e),["prevent"])),class:"auth-form"},[(0,o.Lk)("div",Wc,[t[14]||(t[14]=(0,o.Lk)("label",{class:"form-label"},"æ‰‹æœºå·",-1)),(0,o.Lk)("div",Qc,[(0,o.bF)(l,{icon:"phone",class:"input-icon"}),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.formData.phoneNumber=e),type:"tel",class:(0,h.C4)(["form-input",{error:i.errors.phoneNumber}]),placeholder:"è¯·è¾“å…¥æ‰‹æœºå·",maxlength:"11",required:"",onInput:t[1]||(t[1]=(...e)=>i.validatePhoneNumber&&i.validatePhoneNumber(...e)),onBlur:t[2]||(t[2]=(...e)=>i.validatePhoneNumber&&i.validatePhoneNumber(...e))},null,34),[[a.Jo,i.formData.phoneNumber]])]),i.errors.phoneNumber?((0,o.uX)(),(0,o.CE)("div",Gc,(0,h.v_)(i.errors.phoneNumber),1)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",Hc,[t[15]||(t[15]=(0,o.Lk)("label",{class:"form-label"},[(0,o.eW)("æ˜µç§° "),(0,o.Lk)("span",{class:"optional"},"(å¯é€‰)")],-1)),(0,o.Lk)("div",Jc,[(0,o.bF)(l,{icon:"user",class:"input-icon"}),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>i.formData.nickname=e),type:"text",class:(0,h.C4)(["form-input",{error:i.errors.nickname}]),placeholder:"è¯·è¾“å…¥æ˜µç§°",maxlength:"50",onBlur:t[4]||(t[4]=(...e)=>i.validateNickname&&i.validateNickname(...e))},null,34),[[a.Jo,i.formData.nickname]])]),i.errors.nickname?((0,o.uX)(),(0,o.CE)("div",Yc,(0,h.v_)(i.errors.nickname),1)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",Zc,[t[16]||(t[16]=(0,o.Lk)("label",{class:"form-label"},"å¯†ç ",-1)),(0,o.Lk)("div",ed,[(0,o.bF)(l,{icon:"lock",class:"input-icon"}),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.formData.password=e),type:i.showPassword?"text":"password",class:(0,h.C4)(["form-input",{error:i.errors.password}]),placeholder:"è¯·è®¾ç½®å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰",minlength:"6",required:"",onInput:t[6]||(t[6]=(...e)=>i.validatePassword&&i.validatePassword(...e)),onBlur:t[7]||(t[7]=(...e)=>i.validatePassword&&i.validatePassword(...e))},null,42,td),[[a.hp,i.formData.password]]),(0,o.Lk)("button",{type:"button",class:"password-toggle",onClick:t[8]||(t[8]=e=>i.showPassword=!i.showPassword)},[(0,o.bF)(l,{icon:i.showPassword?"eye-slash":"eye"},null,8,["icon"])])]),i.errors.password?((0,o.uX)(),(0,o.CE)("div",sd,(0,h.v_)(i.errors.password),1)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",ad,[t[17]||(t[17]=(0,o.Lk)("label",{class:"form-label"},"ç¡®è®¤å¯†ç ",-1)),(0,o.Lk)("div",od,[(0,o.bF)(l,{icon:"lock",class:"input-icon"}),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>i.formData.confirmPassword=e),type:i.showConfirmPassword?"text":"password",class:(0,h.C4)(["form-input",{error:i.errors.confirmPassword}]),placeholder:"è¯·å†æ¬¡è¾“å…¥å¯†ç ",minlength:"6",required:"",onBlur:t[10]||(t[10]=(...e)=>i.validateConfirmPassword&&i.validateConfirmPassword(...e))},null,42,id),[[a.hp,i.formData.confirmPassword]]),(0,o.Lk)("button",{type:"button",class:"password-toggle",onClick:t[11]||(t[11]=e=>i.showConfirmPassword=!i.showConfirmPassword)},[(0,o.bF)(l,{icon:i.showConfirmPassword?"eye-slash":"eye"},null,8,["icon"])])]),i.errors.confirmPassword?((0,o.uX)(),(0,o.CE)("div",nd,(0,h.v_)(i.errors.confirmPassword),1)):(0,o.Q3)("",!0)]),(0,o.Lk)("button",{type:"submit",class:(0,h.C4)(["auth-btn",{loading:i.isLoading}]),disabled:i.isLoading||!i.isFormValid},[i.isLoading?((0,o.uX)(),(0,o.Wv)(l,{key:0,icon:"spinner",spin:"",class:"btn-icon"})):((0,o.uX)(),(0,o.Wv)(l,{key:1,icon:"user-plus",class:"btn-icon"})),(0,o.eW)(" "+(0,h.v_)(i.isLoading?"æ³¨å†Œä¸­...":"æ³¨å†Œ"),1)],10,rd),i.message.text?((0,o.uX)(),(0,o.CE)("div",{key:0,class:(0,h.C4)(["message",i.message.type])},[(0,o.bF)(l,{icon:"error"===i.message.type?"exclamation-circle":"check-circle",class:"message-icon"},null,8,["icon"]),(0,o.eW)(" "+(0,h.v_)(i.message.text),1)],2)):(0,o.Q3)("",!0),(0,o.Lk)("div",ld,[t[18]||(t[18]=(0,o.eW)(" å·²æœ‰è´¦å·ï¼Ÿ ",-1)),(0,o.Lk)("button",{type:"button",class:"switch-link",onClick:t[12]||(t[12]=t=>e.$emit("switch-mode","login"))}," ç«‹å³ç™»å½• ")])],32)}var dd={name:"RegisterForm",components:{FontAwesomeIcon:Dc.gc},emits:["switch-mode","submit"],setup(e,{emit:t}){const s=(0,Le.Kh)({phoneNumber:"",nickname:"",password:"",confirmPassword:""}),a=(0,Le.KR)(!1),i=(0,Le.KR)(!1),n=(0,Le.KR)(!1),r=(0,Le.Kh)({phoneNumber:"",nickname:"",password:"",confirmPassword:""}),l=(0,Le.Kh)({text:"",type:""}),c=()=>{const e=/^1[3-9]\d{9}$/;s.phoneNumber?e.test(s.phoneNumber)?r.phoneNumber="":r.phoneNumber="è¯·è¾“å…¥æ­£ç¡®çš„11ä½æ‰‹æœºå·":r.phoneNumber="è¯·è¾“å…¥æ‰‹æœºå·"},d=()=>{s.nickname&&s.nickname.length>50?r.nickname="æ˜µç§°é•¿åº¦ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦":r.nickname=""},u=()=>{s.password?s.password.length<6?r.password="å¯†ç é•¿åº¦è‡³å°‘6ä½":r.password="":r.password="è¯·è¾“å…¥å¯†ç ",s.confirmPassword&&h()},h=()=>{s.confirmPassword?s.password!==s.confirmPassword?r.confirmPassword="ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´":r.confirmPassword="":r.confirmPassword="è¯·ç¡®è®¤å¯†ç "},m=(0,o.EW)(()=>s.phoneNumber&&s.password&&s.confirmPassword&&!r.phoneNumber&&!r.nickname&&!r.password&&!r.confirmPassword),g=(e,t="error")=>{console.log(`${"error"===t?"âŒ":"âœ…"} ${e}`),l.text=e,l.type=t,setTimeout(()=>{l.text="",l.type=""},3e3)},p=async()=>{if(console.log("ðŸ”„ æ³¨å†Œè¡¨å•æäº¤"),c(),d(),u(),h(),m.value){a.value=!0;try{const e={phoneNumber:s.phoneNumber,password:s.password};s.nickname.trim()&&(e.nickname=s.nickname.trim()),console.log("ðŸ“¤ æäº¤æ³¨å†Œæ•°æ®:",{...e,password:"***"}),await t("submit",e),g("æ³¨å†ŒæˆåŠŸï¼","success")}catch(e){console.error("âŒ æ³¨å†Œå¤±è´¥:",e);const t=e.response?.data?.message||e.message||"æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•";g(t)}finally{a.value=!1}}else g("è¯·æ­£ç¡®å¡«å†™æ‰€æœ‰å­—æ®µ")};return{formData:s,errors:r,message:l,isLoading:a,showPassword:i,showConfirmPassword:n,isFormValid:m,validatePhoneNumber:c,validateNickname:d,validatePassword:u,validateConfirmPassword:h,handleSubmit:p,showMessage:g}}};const ud=(0,l.A)(dd,[["render",cd],["__scopeId","data-v-381ecd1e"]]);var hd=ud;const md={register:async e=>{console.log("ðŸ”„ å‘èµ·æ³¨å†Œè¯·æ±‚:",e);try{const t=await De.post("/users/register",e);return console.log("âœ… æ³¨å†ŒæˆåŠŸ:",t),t}catch(t){throw console.error("âŒ æ³¨å†Œå¤±è´¥:",t.response?.data||t.message),t}},login:async e=>{console.log("ðŸ”„ å‘èµ·ç™»å½•è¯·æ±‚:",{phoneNumber:e.phoneNumber,password:"***"});try{const t=await De.post("/users/login",e);return console.log("âœ… ç™»å½•æˆåŠŸ:",{...t,data:{...t.data,token:"***"}}),t}catch(t){throw console.error("âŒ ç™»å½•å¤±è´¥:",t.response?.data||t.message),t}},getUserProfile:async()=>{console.log("ðŸ”„ èŽ·å–ç”¨æˆ·ä¿¡æ¯...");try{const e=await De.get("/users/profile");return console.log("âœ… ç”¨æˆ·ä¿¡æ¯èŽ·å–æˆåŠŸ:",e),e}catch(e){throw console.error("âŒ èŽ·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",e.response?.data||e.message),e}},updateUserProfile:async e=>{console.log("ðŸ”„ æ›´æ–°ç”¨æˆ·ä¿¡æ¯:",e);try{const t=await De.put("/users/profile",e);return console.log("âœ… ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸ:",t),t}catch(t){throw console.error("âŒ ç”¨æˆ·ä¿¡æ¯æ›´æ–°å¤±è´¥:",t.response?.data||t.message),t}}};var gd=md;const pd=(0,Le.Kh)({user:JSON.parse(localStorage.getItem("user"))||null,token:localStorage.getItem("token")||null,isLoading:!1}),kd=()=>{const e=(0,o.EW)(()=>!!pd.token&&!!pd.user),t=(0,o.EW)(()=>pd.user),s=(0,o.EW)(()=>pd.isLoading),a=(e,t)=>{console.log("ðŸ’¾ ä¿å­˜ç”¨æˆ·è®¤è¯ä¿¡æ¯åˆ°æœ¬åœ°å­˜å‚¨"),pd.user=e,pd.token=t,localStorage.setItem("user",JSON.stringify(e)),localStorage.setItem("token",t)},i=()=>{console.log("ðŸ—‘ï¸ æ¸…é™¤ç”¨æˆ·è®¤è¯ä¿¡æ¯"),pd.user=null,pd.token=null,localStorage.removeItem("user"),localStorage.removeItem("token")},n=async e=>{console.log("ðŸ“ å¼€å§‹ç”¨æˆ·æ³¨å†Œæµç¨‹"),pd.isLoading=!0;try{const t=await gd.register(e);if(t.success){const{user:e,token:s}=t.data;return a(e,s),console.log("ðŸŽ‰ æ³¨å†Œå¹¶è‡ªåŠ¨ç™»å½•æˆåŠŸ!"),{success:!0,user:e}}throw new Error(t.message||"æ³¨å†Œå¤±è´¥")}catch(t){throw console.error("âŒ æ³¨å†Œå¤±è´¥:",t),t}finally{pd.isLoading=!1}},r=async e=>{console.log("ðŸ” å¼€å§‹ç”¨æˆ·ç™»å½•æµç¨‹"),pd.isLoading=!0;try{const t=await gd.login(e);if(t.success){const{user:e,token:s}=t.data;return a(e,s),console.log("ðŸŽ‰ ç™»å½•æˆåŠŸ!"),{success:!0,user:e}}throw new Error(t.message||"ç™»å½•å¤±è´¥")}catch(t){throw console.error("âŒ ç™»å½•å¤±è´¥:",t),t}finally{pd.isLoading=!1}},l=()=>{console.log("ðŸ‘‹ ç”¨æˆ·ç™»å‡º"),i()},c=async()=>{console.log("ðŸ‘¤ èŽ·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯");try{const e=await gd.getUserProfile();if(e.success)return pd.user=e.data.user,localStorage.setItem("user",JSON.stringify(e.data.user)),e.data.user}catch(e){throw console.error("âŒ èŽ·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",e),401===e.response?.status&&l(),e}},d=async e=>{console.log("âœï¸ æ›´æ–°ç”¨æˆ·ä¿¡æ¯");try{const t=await gd.updateUserProfile(e);if(t.success)return pd.user=t.data.user,localStorage.setItem("user",JSON.stringify(t.data.user)),console.log("âœ… ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸ"),t.data.user}catch(t){throw console.error("âŒ æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",t),t}};return{isAuthenticated:e,currentUser:t,isLoading:s,register:n,login:r,logout:l,fetchUserProfile:c,updateProfile:d}};var vd={name:"AuthPage",components:{AuthLogo:Fc,LoginForm:Kc,RegisterForm:hd},setup(){const e=(0,u.rd)(),t=(0,u.lq)(),s=(0,Ic.dj)(),a=kd(),i=(0,Le.KR)("login");(0,o.sV)(()=>{if(console.log("ðŸ” æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€"),a.isAuthenticated.value)return console.log("âœ… ç”¨æˆ·å·²ç™»å½•ï¼Œè·³è½¬åˆ°ä¸»é¡µ"),void e.replace("/");const s=t.params.mode||"login";["login","register"].includes(s)&&(i.value=s,console.log(`ðŸ“± è®¾ç½®è®¤è¯æ¨¡å¼: ${s}`))});const n=s=>{console.log(`ðŸ”„ åˆ‡æ¢è®¤è¯æ¨¡å¼: ${i.value} -> ${s}`),i.value=s;const a=`/auth/${s}`;t.path!==a&&e.replace(a)},r=async o=>{console.log("ðŸ” å¤„ç†ç”¨æˆ·ç™»å½•");try{const i=await a.login(o);i.success&&(s.success(`æ¬¢è¿Žå›žæ¥ï¼Œ${i.user.nickname||i.user.maskedPhoneNumber}ï¼`),console.log("ðŸŽ‰ ç™»å½•æˆåŠŸï¼Œå‡†å¤‡è·³è½¬"),setTimeout(()=>{const s=t.query.redirect||"/";console.log(`ðŸ”„ è·³è½¬åˆ°: ${s}`),e.replace(s)},1e3))}catch(i){console.error("âŒ ç™»å½•å¤±è´¥:",i);const e=i.response?.data?.message||i.message||"ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•";s.error(e)}},l=async t=>{console.log("ðŸ“ å¤„ç†ç”¨æˆ·æ³¨å†Œ");try{const o=await a.register(t);o.success&&(s.success(`æ³¨å†ŒæˆåŠŸï¼æ¬¢è¿ŽåŠ å…¥ï¼Œ${o.user.nickname||o.user.maskedPhoneNumber}ï¼`),console.log("ðŸŽ‰ æ³¨å†ŒæˆåŠŸï¼Œå‡†å¤‡è·³è½¬"),setTimeout(()=>{console.log("ðŸ”„ è·³è½¬åˆ°ä¸»é¡µ"),e.replace("/")},1e3))}catch(o){console.error("âŒ æ³¨å†Œå¤±è´¥:",o);const e=o.response?.data?.message||o.message||"æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•";throw s.error(e),o}};return{currentMode:i,switchMode:n,handleLogin:r,handleRegister:l}}};const fd=(0,l.A)(vd,[["render",Sc],["__scopeId","data-v-8ea52cd6"]]);var yd=fd;const bd=[{path:"/",redirect:"/task"},{path:"/auth/:mode?",name:"Auth",component:yd,props:!0,meta:{requiresGuest:!0}},{path:"/task",name:"Task",component:_s,meta:{requiresAuth:!0}},{path:"/calendar",name:"Calendar",component:ua,meta:{requiresAuth:!0}},{path:"/ai-secretary",name:"AiSecretary",component:Nn,meta:{requiresAuth:!0}},{path:"/task-collections",name:"TaskCollections",component:zr,meta:{requiresAuth:!0}},{path:"/stats",name:"Stats",component:Yl,meta:{requiresAuth:!0}},{path:"/pomodoro",name:"Pomodoro",component:Cc,meta:{requiresAuth:!0}}],wd=(0,u.aE)({history:(0,u.LA)(),routes:bd});wd.beforeEach(async(e,t,s)=>{console.log(`ðŸ§­ è·¯ç”±å¯¼èˆª: ${t.path} -> ${e.path}`);const a=localStorage.getItem("token"),o=localStorage.getItem("user"),i=!(!a||!o);if(console.log("ðŸ” è®¤è¯çŠ¶æ€æ£€æŸ¥: "+(i?"å·²ç™»å½•":"æœªç™»å½•")),e.matched.some(e=>e.meta.requiresAuth)){if(!i)return console.log("âŒ ç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ"),void s({path:"/auth/login",query:{redirect:e.fullPath}});const t="true"===localStorage.getItem("auth_verified");if(!t)try{const e=await gd.getUserProfile();if(!e?.success)throw new Error("Profile invalid");localStorage.setItem("auth_verified","true")}catch(n){return console.warn("ðŸ”’ è¿œç¨‹æ ¡éªŒå¤±è´¥ï¼Œæ¸…é™¤æœ¬åœ°è®¤è¯å¹¶è·³è½¬ç™»å½•",n),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("auth_verified"),void s({path:"/auth/login",query:{redirect:e.fullPath}})}}return e.matched.some(e=>e.meta.requiresGuest)&&i?(console.log("âœ… ç”¨æˆ·å·²ç™»å½•ï¼Œè·³è½¬åˆ°ä¸»é¡µ"),void s("/")):"/"===e.path&&i?(console.log("ðŸ  å·²ç™»å½•ç”¨æˆ·è®¿é—®æ ¹è·¯å¾„ï¼Œè·³è½¬åˆ°ä»»åŠ¡é¡µé¢"),void s("/task")):"/"!==e.path||i?(console.log("âœ… è·¯ç”±å¯¼èˆªé€šè¿‡"),void s()):(console.log("ðŸ”‘ æœªç™»å½•ç”¨æˆ·è®¿é—®æ ¹è·¯å¾„ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ"),void s("/auth/login"))});var Cd=wd,Ld=(s(7917),s(8950)),Td=s(2353),Sd=s(92);Ld.Yv.add(Td.v02,Td.okg,Td.UBk,Td.qIE,Td.W1p,Td.QLR,Td.dB,Td.ijD,Td.G1Y,Td.APi,Td.Wzs,Td.XkK,Td.Jt$,Td.e68,Td.MT7,Td.yLS,Td.GRI,Td.X46,Td.A54,Td.$zK,Td.isI,Td.eST,Td.jTw,Td.mh,Td.gK3,Td.a$,Td.GQu,Td.qcK,Td.SGM,Td.kNw,Td.AgW,Td.oMq,Td.zqi,Td.l9V,Td.e74,Td.SVv,Td.Uj9,Td.LBj,Td.VwO,Td.u4D,Td.yqK,Td.KKr,Td.DW4,Td.rhE,Td.nWR,Td.pS3,Td.k6j,Td.z1G,Td.tUE,Td.w2A,Td.CeG,Td.q9c,Td.s67,Td.ekB,Sd.okg,Sd.l6G,Td.Vpu,Td.pvD,Td.Cyq,Td.DN2,Td.rOd,Td.MjD,Td.Lhe,Td.yvG,Td.rwq);const Id=(0,a.Ef)(d);Id.component("font-awesome-icon",Dc.gc),Id.use(Cd),Id.use(Ic.Ay),Id.mount("#app")}},t={};function s(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,s),i.exports}s.m=e,function(){var e=[];s.O=function(t,a,o,i){if(!a){var n=1/0;for(d=0;d<e.length;d++){a=e[d][0],o=e[d][1],i=e[d][2];for(var r=!0,l=0;l<a.length;l++)(!1&i||n>=i)&&Object.keys(s.O).every(function(e){return s.O[e](a[l])})?a.splice(l--,1):(r=!1,i<n&&(n=i));if(r){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[a,o,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,i,n=a[0],r=a[1],l=a[2],c=0;if(n.some(function(t){return 0!==e[t]})){for(o in r)s.o(r,o)&&(s.m[o]=r[o]);if(l)var d=l(s)}for(t&&t(a);c<n.length;c++)i=n[c],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(d)},a=self["webpackChunktimer"]=self["webpackChunktimer"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],function(){return s(9869)});a=s.O(a)})();
//# sourceMappingURL=app.e053a4c0.js.map